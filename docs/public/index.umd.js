(function(O,H){typeof exports=="object"&&typeof module<"u"?module.exports=H():typeof define=="function"&&define.amd?define(H):(O=typeof globalThis<"u"?globalThis:O||self,O.EVirtTable=H())})(this,function(){"use strict";var Vi=Object.defineProperty;var zi=(O,H,P)=>H in O?Vi(O,H,{enumerable:!0,configurable:!0,writable:!0,value:P}):O[H]=P;var h=(O,H,P)=>zi(O,typeof H!="symbol"?H+"":H,P);function O(){return O=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},O.apply(this,arguments)}function H(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,st(n,t)}function P(n){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(n)}function st(n,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},st(n,t)}function de(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ft(n,t,e){return de()?ft=Reflect.construct.bind():ft=function(s,o,r){var a=[null];a.push.apply(a,o);var l=Function.bind.apply(s,a),c=new l;return r&&st(c,r.prototype),c},ft.apply(null,arguments)}function fe(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function Et(n){var t=typeof Map=="function"?new Map:void 0;return Et=function(i){if(i===null||!fe(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(i))return t.get(i);t.set(i,s)}function s(){return ft(i,arguments,P(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),st(s,i)},Et(n)}var xe=/%[sdj%]/g,Nt=function(){};typeof process<"u"&&process.env&&process.env.NODE_ENV!=="production"&&typeof window<"u"&&typeof document<"u"&&(Nt=function(t,e){typeof console<"u"&&console.warn&&typeof ASYNC_VALIDATOR_NO_WARNING>"u"&&e.every(function(i){return typeof i=="string"})&&console.warn(t,e)});function bt(n){if(!n||!n.length)return null;var t={};return n.forEach(function(e){var i=e.field;t[i]=t[i]||[],t[i].push(e)}),t}function D(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];var s=0,o=e.length;if(typeof n=="function")return n.apply(null,e);if(typeof n=="string"){var r=n.replace(xe,function(a){if(a==="%%")return"%";if(s>=o)return a;switch(a){case"%s":return String(e[s++]);case"%d":return Number(e[s++]);case"%j":try{return JSON.stringify(e[s++])}catch{return"[Circular]"}break;default:return a}});return r}return n}function ue(n){return n==="string"||n==="url"||n==="hex"||n==="email"||n==="date"||n==="pattern"}function I(n,t){return!!(n==null||t==="array"&&Array.isArray(n)&&!n.length||ue(t)&&typeof n=="string"&&!n)}function ge(n,t,e){var i=[],s=0,o=n.length;function r(a){i.push.apply(i,a||[]),s++,s===o&&e(i)}n.forEach(function(a){t(a,r)})}function Kt(n,t,e){var i=0,s=n.length;function o(r){if(r&&r.length){e(r);return}var a=i;i=i+1,a<s?t(n[a],o):e([])}o([])}function we(n){var t=[];return Object.keys(n).forEach(function(e){t.push.apply(t,n[e]||[])}),t}var Xt=function(n){H(t,n);function t(e,i){var s;return s=n.call(this,"Async Validation Error")||this,s.errors=e,s.fields=i,s}return t}(Et(Error));function pe(n,t,e,i,s){if(t.first){var o=new Promise(function(x,u){var y=function(p){return i(p),p.length?u(new Xt(p,bt(p))):x(s)},g=we(n);Kt(g,e,y)});return o.catch(function(x){return x}),o}var r=t.firstFields===!0?Object.keys(n):t.firstFields||[],a=Object.keys(n),l=a.length,c=0,f=[],d=new Promise(function(x,u){var y=function(w){if(f.push.apply(f,w),c++,c===l)return i(f),f.length?u(new Xt(f,bt(f))):x(s)};a.length||(i(f),x(s)),a.forEach(function(g){var w=n[g];r.indexOf(g)!==-1?Kt(w,e,y):ge(w,e,y)})});return d.catch(function(x){return x}),d}function ye(n){return!!(n&&n.message!==void 0)}function me(n,t){for(var e=n,i=0;i<t.length;i++){if(e==null)return e;e=e[t[i]]}return e}function Bt(n,t){return function(e){var i;return n.fullFields?i=me(t,n.fullFields):i=t[e.field||n.fullField],ye(e)?(e.field=e.field||n.fullField,e.fieldValue=i,e):{message:typeof e=="function"?e():e,fieldValue:i,field:e.field||n.fullField}}}function Yt(n,t){if(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];typeof i=="object"&&typeof n[e]=="object"?n[e]=O({},n[e],i):n[e]=i}}return n}var Wt=function(t,e,i,s,o,r){t.required&&(!i.hasOwnProperty(t.field)||I(e,r||t.type))&&s.push(D(o.messages.required,t.fullField))},Ee=function(t,e,i,s,o){(/^\s+$/.test(e)||e==="")&&s.push(D(o.messages.whitespace,t.fullField))},xt,be=function(){if(xt)return xt;var n="[a-fA-F\\d:]",t=function(b){return b&&b.includeBoundaries?"(?:(?<=\\s|^)(?="+n+")|(?<="+n+")(?=\\s|$))":""},e="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",s=(`
(?:
(?:`+i+":){7}(?:"+i+`|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:`+i+":){6}(?:"+e+"|:"+i+`|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:`+i+":){5}(?::"+e+"|(?::"+i+`){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:`+i+":){4}(?:(?::"+i+"){0,1}:"+e+"|(?::"+i+`){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:`+i+":){3}(?:(?::"+i+"){0,2}:"+e+"|(?::"+i+`){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:`+i+":){2}(?:(?::"+i+"){0,3}:"+e+"|(?::"+i+`){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:`+i+":){1}(?:(?::"+i+"){0,4}:"+e+"|(?::"+i+`){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::`+i+"){0,5}:"+e+"|(?::"+i+`){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`).replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp("(?:^"+e+"$)|(?:^"+s+"$)"),r=new RegExp("^"+e+"$"),a=new RegExp("^"+s+"$"),l=function(b){return b&&b.exact?o:new RegExp("(?:"+t(b)+e+t(b)+")|(?:"+t(b)+s+t(b)+")","g")};l.v4=function(m){return m&&m.exact?r:new RegExp(""+t(m)+e+t(m),"g")},l.v6=function(m){return m&&m.exact?a:new RegExp(""+t(m)+s+t(m),"g")};var c="(?:(?:[a-z]+:)?//)",f="(?:\\S+(?::\\S*)?@)?",d=l.v4().source,x=l.v6().source,u="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",y="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",w="(?::\\d{2,5})?",p='(?:[/?#][^\\s"]*)?',E="(?:"+c+"|www\\.)"+f+"(?:localhost|"+d+"|"+x+"|"+u+y+g+")"+w+p;return xt=new RegExp("(?:^"+E+"$)","i"),xt},Pt={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},rt={integer:function(t){return rt.number(t)&&parseInt(t,10)===t},float:function(t){return rt.number(t)&&!rt.integer(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch{return!1}},date:function(t){return typeof t.getTime=="function"&&typeof t.getMonth=="function"&&typeof t.getYear=="function"&&!isNaN(t.getTime())},number:function(t){return isNaN(t)?!1:typeof t=="number"},object:function(t){return typeof t=="object"&&!rt.array(t)},method:function(t){return typeof t=="function"},email:function(t){return typeof t=="string"&&t.length<=320&&!!t.match(Pt.email)},url:function(t){return typeof t=="string"&&t.length<=2048&&!!t.match(be())},hex:function(t){return typeof t=="string"&&!!t.match(Pt.hex)}},Ce=function(t,e,i,s,o){if(t.required&&e===void 0){Wt(t,e,i,s,o);return}var r=["integer","float","array","regexp","object","method","email","number","date","url","hex"],a=t.type;r.indexOf(a)>-1?rt[a](e)||s.push(D(o.messages.types[a],t.fullField,t.type)):a&&typeof e!==t.type&&s.push(D(o.messages.types[a],t.fullField,t.type))},ve=function(t,e,i,s,o){var r=typeof t.len=="number",a=typeof t.min=="number",l=typeof t.max=="number",c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=e,d=null,x=typeof e=="number",u=typeof e=="string",y=Array.isArray(e);if(x?d="number":u?d="string":y&&(d="array"),!d)return!1;y&&(f=e.length),u&&(f=e.replace(c,"_").length),r?f!==t.len&&s.push(D(o.messages[d].len,t.fullField,t.len)):a&&!l&&f<t.min?s.push(D(o.messages[d].min,t.fullField,t.min)):l&&!a&&f>t.max?s.push(D(o.messages[d].max,t.fullField,t.max)):a&&l&&(f<t.min||f>t.max)&&s.push(D(o.messages[d].range,t.fullField,t.min,t.max))},U="enum",Re=function(t,e,i,s,o){t[U]=Array.isArray(t[U])?t[U]:[],t[U].indexOf(e)===-1&&s.push(D(o.messages[U],t.fullField,t[U].join(", ")))},Ie=function(t,e,i,s,o){if(t.pattern){if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||s.push(D(o.messages.pattern.mismatch,t.fullField,e,t.pattern));else if(typeof t.pattern=="string"){var r=new RegExp(t.pattern);r.test(e)||s.push(D(o.messages.pattern.mismatch,t.fullField,e,t.pattern))}}},C={required:Wt,whitespace:Ee,type:Ce,range:ve,enum:Re,pattern:Ie},Oe=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e,"string")&&!t.required)return i();C.required(t,e,s,r,o,"string"),I(e,"string")||(C.type(t,e,s,r,o),C.range(t,e,s,r,o),C.pattern(t,e,s,r,o),t.whitespace===!0&&C.whitespace(t,e,s,r,o))}i(r)},_e=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},Te=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e===""&&(e=void 0),I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},Se=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},Le=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),I(e)||C.type(t,e,s,r,o)}i(r)},Ae=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},He=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},De=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e==null&&!t.required)return i();C.required(t,e,s,r,o,"array"),e!=null&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},Me=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},ke="enum",Fe=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C[ke](t,e,s,r,o)}i(r)},Ne=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e,"string")&&!t.required)return i();C.required(t,e,s,r,o),I(e,"string")||C.pattern(t,e,s,r,o)}i(r)},Ke=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e,"date")&&!t.required)return i();if(C.required(t,e,s,r,o),!I(e,"date")){var l;e instanceof Date?l=e:l=new Date(e),C.type(t,l,s,r,o),l&&C.range(t,l.getTime(),s,r,o)}}i(r)},Xe=function(t,e,i,s,o){var r=[],a=Array.isArray(e)?"array":typeof e;C.required(t,e,s,r,o,a),i(r)},Ct=function(t,e,i,s,o){var r=t.type,a=[],l=t.required||!t.required&&s.hasOwnProperty(t.field);if(l){if(I(e,r)&&!t.required)return i();C.required(t,e,s,a,o,r),I(e,r)||C.type(t,e,s,a,o)}i(a)},Be=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(I(e)&&!t.required)return i();C.required(t,e,s,r,o)}i(r)},ot={string:Oe,method:_e,number:Te,boolean:Se,regexp:Le,integer:Ae,float:He,array:De,object:Me,enum:Fe,pattern:Ne,date:Ke,url:Ct,hex:Ct,email:Ct,required:Xe,any:Be};function vt(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}var Rt=vt(),nt=function(){function n(e){this.rules=null,this._messages=Rt,this.define(e)}var t=n.prototype;return t.define=function(i){var s=this;if(!i)throw new Error("Cannot configure a schema with no rules");if(typeof i!="object"||Array.isArray(i))throw new Error("Rules must be an object");this.rules={},Object.keys(i).forEach(function(o){var r=i[o];s.rules[o]=Array.isArray(r)?r:[r]})},t.messages=function(i){return i&&(this._messages=Yt(vt(),i)),this._messages},t.validate=function(i,s,o){var r=this;s===void 0&&(s={}),o===void 0&&(o=function(){});var a=i,l=s,c=o;if(typeof l=="function"&&(c=l,l={}),!this.rules||Object.keys(this.rules).length===0)return c&&c(null,a),Promise.resolve(a);function f(g){var w=[],p={};function E(b){if(Array.isArray(b)){var v;w=(v=w).concat.apply(v,b)}else w.push(b)}for(var m=0;m<g.length;m++)E(g[m]);w.length?(p=bt(w),c(w,p)):c(null,a)}if(l.messages){var d=this.messages();d===Rt&&(d=vt()),Yt(d,l.messages),l.messages=d}else l.messages=this.messages();var x={},u=l.keys||Object.keys(this.rules);u.forEach(function(g){var w=r.rules[g],p=a[g];w.forEach(function(E){var m=E;typeof m.transform=="function"&&(a===i&&(a=O({},a)),p=a[g]=m.transform(p)),typeof m=="function"?m={validator:m}:m=O({},m),m.validator=r.getValidationMethod(m),m.validator&&(m.field=g,m.fullField=m.fullField||g,m.type=r.getType(m),x[g]=x[g]||[],x[g].push({rule:m,value:p,source:a,field:g}))})});var y={};return pe(x,l,function(g,w){var p=g.rule,E=(p.type==="object"||p.type==="array")&&(typeof p.fields=="object"||typeof p.defaultField=="object");E=E&&(p.required||!p.required&&g.value),p.field=g.field;function m(R,L){return O({},L,{fullField:p.fullField+"."+R,fullFields:p.fullFields?[].concat(p.fullFields,[R]):[R]})}function b(R){R===void 0&&(R=[]);var L=Array.isArray(R)?R:[R];!l.suppressWarning&&L.length&&n.warning("async-validator:",L),L.length&&p.message!==void 0&&(L=[].concat(p.message));var A=L.map(Bt(p,a));if(l.first&&A.length)return y[p.field]=1,w(A);if(!E)w(A);else{if(p.required&&!g.value)return p.message!==void 0?A=[].concat(p.message).map(Bt(p,a)):l.error&&(A=[l.error(p,D(l.messages.required,p.field))]),w(A);var k={};p.defaultField&&Object.keys(g.value).map(function(_){k[_]=p.defaultField}),k=O({},k,g.rule.fields);var K={};Object.keys(k).forEach(function(_){var S=k[_],T=Array.isArray(S)?S:[S];K[_]=T.map(m.bind(null,_))});var $=new n(K);$.messages(l.messages),g.rule.options&&(g.rule.options.messages=l.messages,g.rule.options.error=l.error),$.validate(g.value,g.rule.options||l,function(_){var S=[];A&&A.length&&S.push.apply(S,A),_&&_.length&&S.push.apply(S,_),w(S.length?S:null)})}}var v;if(p.asyncValidator)v=p.asyncValidator(p,g.value,b,g.source,l);else if(p.validator){try{v=p.validator(p,g.value,b,g.source,l)}catch(R){console.error==null||console.error(R),l.suppressValidatorError||setTimeout(function(){throw R},0),b(R.message)}v===!0?b():v===!1?b(typeof p.message=="function"?p.message(p.fullField||p.field):p.message||(p.fullField||p.field)+" fails"):v instanceof Array?b(v):v instanceof Error&&b(v.message)}v&&v.then&&v.then(function(){return b()},function(R){return b(R)})},function(g){f(g)},a)},t.getType=function(i){if(i.type===void 0&&i.pattern instanceof RegExp&&(i.type="pattern"),typeof i.validator!="function"&&i.type&&!ot.hasOwnProperty(i.type))throw new Error(D("Unknown rule type %s",i.type));return i.type||"string"},t.getValidationMethod=function(i){if(typeof i.validator=="function")return i.validator;var s=Object.keys(i),o=s.indexOf("message");return o!==-1&&s.splice(o,1),s.length===1&&s[0]==="required"?ot.required:ot[this.getType(i)]||void 0},n}();nt.register=function(t,e){if(typeof e!="function")throw new Error("Cannot register a validator by type, validator is not a function");ot[t]=e},nt.warning=Nt,nt.messages=Rt,nt.validators=ot;function It(){return"xxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(n){const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)})}function Ye(n,t){let e=0,i;return function(...s){const o=new Date().getTime(),r=o-e;!e||r>=t?(n.apply(this,s),e=o):i||(i=setTimeout(()=>{n.apply(this,s),e=new Date().getTime(),i=void 0},t-r))}}function Vt(n){return n?n.map(t=>Vt(t.children)+1).sort((t,e)=>e-t)[0]:0}function We(n=[]){let t=[],e=[],i=[];return n.forEach(s=>{s.fixed==="left"?t.push(s):s.fixed==="right"?i.push(s):e.push(s)}),[...t,...e,...i]}function zt(n=[],t=1,e=0){return n.map(i=>{if(i.children){let s=0,o=i.fixed;i.children.forEach(a=>{a.fixed=o});const r=zt(i.children,t-1,e+1);return r&&r.forEach(a=>{s+=a.colspan}),{...i,width:i.width,level:e,rowspan:1,colspan:s,children:r}}return{...i,level:e,rowspan:t,colspan:1}})}function Ot(n=[]){let t=[];return n.forEach(e=>{e.children?t=t.concat(Ot(e.children)):t.push(e)}),t}class Pe{constructor(t,e){h(this,"loading",!1);h(this,"ctx");h(this,"data");h(this,"columns");h(this,"footerData",[]);h(this,"rowKeyMap",new Map);h(this,"colIndexKeyMap",new Map);h(this,"headerMap",new Map);h(this,"rowIndexRowKeyMap",new Map);h(this,"checkboxKeyMap",new Map);h(this,"originalDataMap",new Map);h(this,"changedDataMap",new Map);h(this,"validationErrorMap",new Map);h(this,"itemRowKeyMap",new WeakMap);h(this,"bufferData",[]);h(this,"sumHeight",0);h(this,"filterMethod");h(this,"positions",[]);this.ctx=t;const{data:i=[],columns:s=[],footerData:o=[]}=e;this.data=i,this.footerData=o,this.columns=s,this.setLoading(!0),this.init()}init(){this.clearBufferData(),this.rowKeyMap.clear(),this.checkboxKeyMap.clear(),this.colIndexKeyMap.clear(),this.rowIndexRowKeyMap.clear(),this.originalDataMap.clear(),this.changedDataMap.clear(),this.validationErrorMap.clear(),this.itemRowKeyMap=new WeakMap,this.initData(this.data)}clearBufferData(){this.bufferData=[]}initData(t,e=0){t.forEach((i,s)=>{let o=!1;Array.isArray(i.children)&&(o=!0,this.initData(i.children,e+1));const{ROW_KEY:r="",DEFAULT_EXPAND_ALL:a,CELL_HEIGHT:l,SELECTABLE_METHOD:c,CHECKBOX_KEY:f}=this.ctx.config,d=i[r],x=d??It();this.itemRowKeyMap.set(i,x);const u=i._height||l,y=i._readonly;let g=!0;if(typeof c=="function"&&(g=c),f){const w=i[f];if(this.checkboxKeyMap.has(w)){const p=this.checkboxKeyMap.get(w);p.push(x),this.checkboxKeyMap.set(w,p)}else this.checkboxKeyMap.set(w,[x])}this.rowKeyMap.set(x,{readonly:y,index:s,rowIndex:s,level:e,height:u,check:!1,selectable:g,expand:a,expandLazy:!1,hasChildren:o,expandLoading:!1,item:i})})}setRowHeight(t,e){const i=this.rowIndexRowKeyMap.get(t),s=this.rowKeyMap.get(i);s.height=e,s.item._height=e,this.clearBufferData()}getAllRowsData(){let t=[];const e=i=>{i.forEach(s=>{t.push(s),Array.isArray(s.children)&&e(s.children)})};return e(this.data),t}getColumns(){return this.columns}setColumns(t){this.columns=t,this.clearBufferData()}setData(t){this.data=t,this.columns.length&&this.init()}getData(){if(this.bufferData.length>0)return{data:this.bufferData,sumHeight:this.sumHeight,positions:this.positions};let t=[],e=0;this.sumHeight=0,this.positions=[];const i=o=>{o.forEach(r=>{t.push(r);const a=this.itemRowKeyMap.get(r),{expand:l,hasChildren:c,height:f}=this.rowKeyMap.get(a),d=this.sumHeight;this.sumHeight+=f,this.rowIndexRowKeyMap.set(e,a),this.positions.push({top:d,height:f,bottom:this.sumHeight}),e+=1,l&&c&&i(r.children)})};this.rowIndexRowKeyMap.clear();let s=this.data;return typeof this.filterMethod=="function"&&(s=this.filterMethod(s)),i(s),this.bufferData=t,{data:t,sumHeight:this.sumHeight,positions:this.positions}}setFooterData(t){this.footerData=t}getFooterData(){return this.footerData}setFilterMethod(t){this.filterMethod=t}clearFilterMethod(){this.filterMethod=void 0}expandItem(t,e=!1){const i=this.rowKeyMap.get(t);i.expand=e,this.clearBufferData(),this.ctx.emit("draw")}expandAll(t){this.rowKeyMap.forEach(e=>{e.expand=t}),this.clearBufferData(),this.ctx.emit("draw")}expandLoading(t,e=!1){const i=this.rowKeyMap.get(t);i.expandLoading=e,this.clearBufferData(),this.ctx.emit("draw")}setExpandChildren(t,e){const i=this.rowKeyMap.get(t);i.expand=!0,i.expandLazy=!0,i.item.children=e,this.initData(i.item.children,i.level+1),this.clearBufferData()}getIsExpandLoading(t){return this.rowKeyMap.get(t).expandLoading}getIsExpandLazy(t){return this.rowKeyMap.get(t).expandLazy}getIsExpand(t){return this.rowKeyMap.get(t).expand}getRowForRowKey(t){return this.rowKeyMap.get(t)}getRowKeyForRowIndex(t){return this.rowIndexRowKeyMap.get(t)}getRowKeyByItem(t){return this.itemRowKeyMap.get(t)}getRowIndexForRowKey(t){return this.rowKeyMap.get(t).index}getItemValueForRowIndexAndColIndex(t,e){if(!(this.rowIndexRowKeyMap.has(t)&&this.colIndexKeyMap.get(e)))return null;const s=this.rowIndexRowKeyMap.get(t),o=this.colIndexKeyMap.get(e);return{rowKey:s,key:o,value:this.getItemValue(s,o)}}getItemValue(t,e){const i=this.rowKeyMap.get(t);return i&&i.item?i.item[e]===void 0?null:i.item[e]:null}batchSetItemValue(t,e=!1){let i=[];const s=new Set;t.forEach(a=>{const{value:l,rowKey:c,key:f}=a,{oldValue:d,newValue:x}=this.setItemValue(c,f,l);s.add(c),i.push({rowKey:c,key:f,oldValue:d,newValue:x})});let o=[];const r=i.map(a=>{const l=this.ctx.database.getRowDataItemForRowKey(a.rowKey);return{rowKey:a.rowKey,key:a.key,value:a.newValue,row:l}});return s.forEach(a=>{o.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("change",r,o),e&&this.ctx.history.pushState({changeList:i,scrollX:this.ctx.scrollX,scrollY:this.ctx.scrollY,type:"multiple"}),i}setItemValue(t,e,i,s=!1,o=!1,r=!1){if(!this.rowKeyMap.has(t))return{};const{item:a}=this.rowKeyMap.get(t);let l=a[e];if(this.ctx.database.getReadonly(t,e))return{oldValue:l,newValue:l};a[e]!==null&&typeof a[e]=="object"&&(l=JSON.parse(JSON.stringify(a[e])));const c=`${t}_${e}`;if(this.originalDataMap.has(c)||this.originalDataMap.set(c,l),this.changedDataMap.set(c,i),a[e]=i,r){const f=this.ctx.database.getRowDataItemForRowKey(t),d={rowKey:t,key:e,value:i,row:f};this.ctx.emit("change",[d],[f]),this.ctx.emit("editChange",{rowKey:t,key:e,oldValue:l,value:i,originalValue:this.originalDataMap.get(c),row:f})}return this.ctx.hasEvent("iterationChange")&&this.ctx.emit("iterationChange",{rowKey:t,key:e,oldValue:l,value:i,originalValue:this.originalDataMap.get(c),row:this.ctx.database.getRowDataItemForRowKey(t)}),s&&this.ctx.history.pushState({type:"single",scrollX:this.ctx.scrollX,scrollY:this.ctx.scrollY,changeList:[{rowKey:t,key:e,oldValue:l,newValue:i}]}),o&&this.ctx.emit("draw"),{oldValue:l,newValue:i}}getRowDataItemForRowKey(t){if(!this.rowKeyMap.has(t))return{};const{item:e}=this.rowKeyMap.get(t);return e}setRowSelectionByCheckboxKey(t,e){const{CHECKBOX_KEY:i}=this.ctx.config;if(i){if(!this.rowKeyMap.has(t))return!1;const{item:s}=this.rowKeyMap.get(t),o=s[i];this.checkboxKeyMap.has(o)&&this.checkboxKeyMap.get(o).forEach(a=>{const l=this.rowKeyMap.get(a);l.check=e})}}toggleRowSelection(t){const e=this.rowKeyMap.get(t);e.check=!e.check,this.setRowSelectionByCheckboxKey(t,e.check),this.ctx.emit("toggleRowSelection",e);const i=this.getSelectionRows();this.ctx.emit("selectionChange",i),this.ctx.emit("draw")}setRowSelection(t,e){const i=this.rowKeyMap.get(t);i.check=e,this.setRowSelectionByCheckboxKey(t,i.check);const s=this.getSelectionRows();this.ctx.emit("setRowSelection",s),this.ctx.emit("draw")}getSelectionRows(){let t=[];return this.rowKeyMap.forEach(e=>{e.check&&t.push(e.item)}),t}getRowSelection(t){const{check:e}=this.rowKeyMap.get(t);return e}getRowSelectable(t){const{selectable:e,item:i,rowIndex:s}=this.rowKeyMap.get(t);return typeof e=="function"?e({row:i,rowIndex:s}):e}toggleAllSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!0):i&&(e.check=!0)});const t=this.getSelectionRows();this.ctx.emit("toggleAllSelection",t),this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}clearSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!1):i&&(e.check=!1)});const t=this.getSelectionRows();this.ctx.emit("clearSelection"),this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}getCheckedState(){let t=0,e=0;this.rowKeyMap.forEach(r=>{r.check&&(t+=1);const a=r.selectable;typeof a=="function"?a({row:r.item,rowIndex:r.rowIndex})&&(e+=1):a&&(e+=1)});const i=e&&e>t&&t>0;return{check:e&&e===t,indeterminate:i,selectable:e!==0}}updateColIndexKeyMap(t=[]){this.colIndexKeyMap.clear(),t.forEach(e=>{this.colIndexKeyMap.set(e.colIndex,e.key)})}getChangedData(){let t=[];return this.changedDataMap.forEach((e,i)=>{const s=this.originalDataMap.get(i),o=i.split("_")[0],r=i.split("_")[1];s!==e&&t.push({rowKey:o,colKey:r,originalValue:s,row:this.rowKeyMap.get(o),value:e})}),t}getChangedRows(){const t=new Set;this.changedDataMap.forEach((i,s)=>{const o=this.originalDataMap.get(s),r=s.split("_")[0];o!==i&&t.add(r)});let e=[];return t.forEach(i=>{e.push(this.ctx.database.getRowDataItemForRowKey(i))}),e}isHasChangedData(t,e){const i=`${t}_${e}`;if(!this.changedDataMap.has(i))return!1;const s=this.originalDataMap.get(i),o=this.changedDataMap.get(i);return s!==o}getPositionForRowIndex(t){return t<this.positions.length?this.positions[t]:{height:0,top:0,bottom:0}}setHeader(t,e){return t?(this.headerMap.set(t,e),!0):!1}getReadonly(t,e){const i=this.rowKeyMap.get(t),s=this.headerMap.get(e),o=i==null?void 0:i.readonly,r=s==null?void 0:s.readonly,{CELL_READONLY_METHOD:a}=this.ctx.config;if(typeof a=="function"){const c=a({row:i.item,rowIndex:i.rowIndex,colIndex:s.colIndex,column:s.column,value:this.getItemValue(t,e)});if(c!==void 0)return c}return r||o}clearValidate(){this.validationErrorMap.clear()}getValidator(t,e){return new Promise(i=>{const s=this.rowKeyMap.get(t),o=this.headerMap.get(e),{CELL_RULES_METHOD:r}=this.ctx.config,a=o.column;let l=a.rules;if(typeof r=="function"){const f=r({row:s.item,rowIndex:s.rowIndex,colIndex:o.colIndex,column:a,value:this.getItemValue(t,e)});f&&(l=f)}if(l){let c={},f={};if(f[e]=this.getItemValue(t,e),Array.isArray(l)&&l.length){const x=l.map(u=>({...u,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex}));c[e]=x}else c[e]={...l,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex};new nt(c).validate(f).then(()=>{this.setValidationError(t,e,[]),i([])}).catch(({errors:x})=>{const u=x.map(y=>({...y,column:a,key:e,row:s.item,rowKey:t}));this.setValidationError(t,e,u),i(u)})}else i([])})}getHeightByRowIndexRowSpan(t,e){let i=0;for(let s=0;s<e;s++){const o=this.positions[t+s];o&&(i+=o.height)}return i}setLoading(t){this.loading=t,this.ctx.emit("loadingChange",t)}getLoading(){return this.loading}setValidationErrorByRowIndex(t,e,i){const o=`${this.rowIndexRowKeyMap.get(t)}_${e}`,r=[{message:i}];this.validationErrorMap.set(o,r)}setValidationError(t,e,i){const s=`${t}_${e}`;this.validationErrorMap.set(s,i)}getValidationError(t,e){const i=`${t}_${e}`;return this.validationErrorMap.get(i)||[]}}class Ve{constructor(t){h(this,"ctx");h(this,"history",[]);h(this,"historyIndex",-1);this.ctx=t,this.init()}init(){this.ctx.on("keydown",t=>{if(t.ctrlKey&&!t.shiftKey&&t.code==="KeyZ"||t.metaKey&&!t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.backState();return}if(t.ctrlKey&&t.code==="KeyY"||t.ctrlKey&&t.shiftKey&&t.code==="KeyZ"||t.metaKey&&t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.forwardState();return}})}pushState(t){const{HISTORY_NUM:e=0,ENABLE_HISTORY:i}=this.ctx.config;i&&(this.history.push(t),this.history.length>e&&this.history.splice(0,1),this.historyIndex=this.history.length-1)}backState(){if(this.historyIndex>=0){const{changeList:t,scrollX:e,scrollY:i}=this.history[this.historyIndex],s=t.map(o=>({rowKey:o.rowKey,key:o.key,value:o.oldValue,row:{}}));this.ctx.setScroll(e,i),this.ctx.database.batchSetItemValue(s,!1),this.historyIndex-=1,this.ctx.emit("draw")}}forwardState(){if(this.historyIndex<this.history.length-1){this.historyIndex+=1;const{changeList:t}=this.history[this.historyIndex],e=t.map(i=>({rowKey:i.rowKey,key:i.key,value:i.newValue,row:{}}));this.ctx.database.batchSetItemValue(e,!1),this.ctx.emit("draw")}}clear(){this.history=[],this.historyIndex=-1}}class ze{constructor(t){h(this,"eventTasks",new Map);h(this,"ctx");this.ctx=t,this.init()}init(){this.bind(window,"resize",this.handleResize.bind(this)),this.bind(window,"mousedown",this.handleMouseDown.bind(this)),this.bind(window,"mouseup",this.handleMouseUp.bind(this)),this.bind(window,"mousemove",this.handleMousemove.bind(this)),this.bind(this.ctx.target,"click",this.handleClick.bind(this)),this.bind(this.ctx.target,"keydown",this.handleKeydown.bind(this)),this.bind(this.ctx.target,"wheel",this.handleWheel.bind(this))}destroy(){this.eventTasks.forEach((t,e)=>{this.unbind(window,e,t)}),this.eventTasks.clear()}handleResize(t){this.ctx.emit("resetHeader",t),this.ctx.emit("resize",t)}handleMouseDown(t){t.button===0&&(this.ctx.mousedown=!0),this.ctx.emit("mousedown",t)}handleMousemove(t){this.ctx.emit("mousemove",t)}handleMouseUp(t){t.button===0&&(this.ctx.mousedown=!1),this.ctx.emit("mouseup",t)}handleClick(t){this.ctx.emit("click",t)}handleKeydown(t){const{ENABLE_KEYBOARD:e}=this.ctx.config;e&&this.ctx.emit("keydown",t)}handleWheel(t){this.ctx.emit("wheel",t)}bind(t,e,i){t instanceof HTMLCanvasElement&&e==="keydown"&&(t.tabIndex=0),t.addEventListener(e,i),this.eventTasks.set(e,i)}unbind(t,e,i){t.removeEventListener(e,i),this.eventTasks.delete(e)}}class $e{constructor(){h(this,"events",new Map)}has(t){return this.events.has(t)}on(t,e){const i=this.events.get(t)||[];i.push(e),this.events.set(t,i)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};return this.on(t,i),this}off(t,e){const i=this.events.get(t);if(i){const s=i.indexOf(e);s>=0&&(i.splice(s,1),i.length===0?this.events.delete(t):this.events.set(t,i))}}emit(t,...e){const i=this.events.get(t);i&&i.forEach(s=>{s(...e)})}destroy(){this.events.clear()}}class qe{constructor(t){h(this,"ctx");const e=t.getContext("2d");if(!e)throw new Error("canvas context not found");this.ctx=e}save(){this.ctx.save()}restore(){this.ctx.restore()}translate(t,e){this.ctx.translate(t,e)}setCursor(t="default"){this.ctx.canvas.style.cursor=t}clear(t=0,e=0,i,s){this.ctx.clearRect(t,e,i||this.ctx.canvas.width,s||this.ctx.canvas.height)}drawShadow(t,e,i,s,o){const{fillColor:r,side:a,shadowWidth:l,colorStart:c,colorEnd:f}=o;this.ctx.save(),r&&(this.ctx.fillStyle=r,this.ctx.fillRect(t,e,i,s));let d;switch(a){case"left":d=this.ctx.createLinearGradient(t-l,e,t,e),d.addColorStop(0,c),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t-l,e,l,s);break;case"right":d=this.ctx.createLinearGradient(t+i,e,t+i+l,e),d.addColorStop(0,c),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t+i,e,l,s);break;case"top":d=this.ctx.createLinearGradient(t,e-l,t,e),d.addColorStop(0,c),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t,e-l,i,l);break;case"bottom":d=this.ctx.createLinearGradient(t,e+s,t,e+s+l),d.addColorStop(0,c),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t,e+s,i,l);break;default:console.error("Invalid side specified for shadow");break}}drawLine(t,e){if(t.length<4||t.length%2!==0)throw new Error("A valid array of points is required to draw a line");this.ctx.save();const{borderColor:i="black",borderWidth:s=1}=e;this.ctx.beginPath(),this.ctx.moveTo(t[0]+.5,t[1]+.5);for(let o=2;o<t.length;o+=2)this.ctx.lineTo(t[o]+.5,t[o+1]+.5);this.ctx.strokeStyle=i,this.ctx.lineWidth=s,e.lineDash&&(this.ctx.lineDashOffset=4,this.ctx.setLineDash(e.lineDash)),e.fillColor&&(this.ctx.fillStyle=e.fillColor,this.ctx.fill()),e.borderColor&&(this.ctx.strokeStyle=e.borderColor),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}drawImage(t,e,i,s,o){this.ctx.save(),this.ctx.drawImage(t,e,i,s,o),this.ctx.restore()}drawRect(t,e,i,s,{borderWidth:o=1,borderColor:r,fillColor:a,radius:l=0}={}){if(this.ctx.save(),this.ctx.beginPath(),a!==void 0&&(this.ctx.fillStyle=a),r!==void 0&&(this.ctx.lineWidth=o,this.ctx.strokeStyle=r),l===0)this.ctx.rect(t+.5,e+.5,i,s);else{const[c,f,d,x]=typeof l=="number"?[l,l,l,l]:l;this.ctx.moveTo(t+c,e),this.ctx.arcTo(t+i,e,t+i,e+f,f),this.ctx.arcTo(t+i,e+s,t+i-d,e+s,d),this.ctx.arcTo(t,e+s,t,e+s-x,x),this.ctx.arcTo(t,e,t+c,e,c)}a!==void 0&&this.ctx.fill(),r!==void 0&&this.ctx.stroke(),this.ctx.restore()}drawText(t="",e,i,s,o,r={}){this.ctx.save();const{font:a="12px Arial",align:l="center",color:c="#495060",padding:f=0,verticalAlign:d="middle"}=r;this.ctx.font=a,this.ctx.fillStyle=c,this.ctx.textBaseline=d,this.ctx.textAlign=l;let x=0;d==="top"?x=i+f:d==="bottom"?x=i+o-f:x=i+(o+f)/2;let u=0;l==="left"?u=e+f:l==="right"?u=e+s-f:u=e+s/2;const{_text:y,ellipsis:g}=this.handleEllipsis(t,s,f);return this.ctx.fillText(y,u,x),this.ctx.restore(),g}handleEllipsis(t,e,i=0){let s=!1,o=t;if(t==null||t==="")return{_text:"",ellipsis:s};const r=this.ctx.measureText("...").width,a=this.ctx.measureText(t).width;if(a&&a+r>=e-i*2){s=!0;let l=0;for(let c=0;c<t.length;c++)if(l+=this.ctx.measureText(t[c]).width,l>=e-i*2-r){o=t.slice(0,c)+"...";break}}return{_text:o,ellipsis:s}}}class Ge{constructor(t){h(this,"PROCESSOR_NUM",50);h(this,"CSS_PREFIX","e-virt-table");h(this,"ICONS",[]);h(this,"ROW_KEY","");h(this,"HEADER_FONT","12px normal Arial");h(this,"BODY_FONT","12px normal Arial");h(this,"BORDER_COLOR","#e1e6eb");h(this,"WIDTH",0);h(this,"RESIZE_MIN_WIDTH",40);h(this,"HEIGHT",0);h(this,"EMPTY_BODY_HEIGHT",120);h(this,"EMPTY_CUSTOM",!1);h(this,"EMPTY_CUSTOM_STYLE",{});h(this,"EMPTY_TEXT","暂无数据");h(this,"MAX_HEIGHT",1e3);h(this,"BORDER_RADIUS",8);h(this,"ENABLE_OFFSET_HEIGHT",!1);h(this,"OFFSET_HEIGHT",0);h(this,"HEADER_HEIGHT",36);h(this,"HEADER_BG_COLOR","#F8FAFF");h(this,"BODY_BG_COLOR","#FFF");h(this,"HEADER_TEXT_COLOR","#1D2129");h(this,"LOADING_ICON_SVG","");h(this,"LOADING_ICON_COLOR","#4E5969");h(this,"EXPAND_ICON_SVG","");h(this,"SHRINK_ICON_SVG","");h(this,"EXPAND_ICON_COLOR","#4E5969");h(this,"SHRINK_ICON_COLOR","#4E5969");h(this,"ERROR_TIP_ICON_COLOR","red");h(this,"ERROR_TIP_ICON_SIZE",6);h(this,"EXPAND_LAZY",!0);h(this,"DEFAULT_EXPAND_ALL",!1);h(this,"CELL_WIDTH",100);h(this,"CELL_HEIGHT",36);h(this,"CELL_PADDING",8);h(this,"CELL_HOVER_ICON_SIZE",20);h(this,"SCROLLER_TRACK_SIZE",14);h(this,"SCROLLER_SIZE",8);h(this,"SCROLLER_COLOR","#dee0e3");h(this,"SCROLLER_TRACK_COLOR","#fff");h(this,"SCROLLER_FOCUS_COLOR","#bbbec4");h(this,"SELECT_BORDER_COLOR","rgb(82,146,247)");h(this,"SELECT_AREA_COLOR","rgba(82,146,247,0.1)");h(this,"SELECT_BG_COLOR","rgba(82,146,247,0.1)");h(this,"EDIT_BG_COLOR","#fcf6ed");h(this,"CHECKBOX_KEY","");h(this,"CHECKBOX_COLOR","rgb(82,146,247)");h(this,"CHECKBOX_SIZE",20);h(this,"CHECKBOX_DISABLED_SVG","");h(this,"CHECKBOX_CHECK_SVG","");h(this,"CHECKBOX_UNCHECK_SVG","");h(this,"CHECKBOX_INDETERMINATE_SVG","");h(this,"READONLY_COLOR","#fff");h(this,"READONLY_TEXT_COLOR","#4E5969");h(this,"ERROR_TIP_COLOR","#ED3F14");h(this,"FOOTER_BG_COLOR","#fafafa");h(this,"FOOTER_FIXED",!1);h(this,"CELL_FOOTER_HEIGHT",36);h(this,"ENABLE_SELECTOR",!1);h(this,"ENABLE_EDIT_SINGLE_CLICK",!1);h(this,"ENABLE_SELECTOR_SINGLE",!1);h(this,"ENABLE_SELECTOR_SPAN_COL",!0);h(this,"ENABLE_SELECTOR_SPAN_ROW",!0);h(this,"ENABLE_SELECTOR_ALL_ROWS",!0);h(this,"ENABLE_SELECTOR_ALL_COLS",!0);h(this,"ENABLE_AUTOFILL",!1);h(this,"ENABLE_CONTEXTMENU",!0);h(this,"ENABLE_COPY",!0);h(this,"ENABLE_PASTER",!0);h(this,"ENABLE_RESIZE_ROW",!0);h(this,"ENABLE_RESIZE_COLUMN",!0);h(this,"RESIZE_ROW_LINE_COLOR","#e1e6eb");h(this,"RESIZE_COLUMN_LINE_COLOR","#e1e6eb");h(this,"RESIZE_ROW_MIN_HEIGHT",36);h(this,"RESIZE_COLUMN_MIN_WIDTH",40);h(this,"ENABLE_KEYBOARD",!0);h(this,"ENABLE_HISTORY",!1);h(this,"ENABLE_VALIDATOR_IMMEDIATE",!0);h(this,"HISTORY_NUM",50);h(this,"HIGHLIGHT_HOVER_ROW",!1);h(this,"HIGHLIGHT_HOVER_ROW_COLOR","rgba(186,203,231,0.1)");h(this,"HIGHLIGHT_SELECTED_ROW",!1);h(this,"HIGHLIGHT_SELECTED_ROW_COLOR","rgba(82,146,247,0.1)");h(this,"TOOLTIP_BG_COLOR","#303133");h(this,"TOOLTIP_TEXT_COLOR","#fff");h(this,"TOOLTIP_ZINDEX",3e3);h(this,"TOOLTIP_CUSTOM_STYLE",{});h(this,"CONTEXT_MENU",[{label:"复制",value:"copy"},{label:"剪切",value:"cut"},{label:"粘贴",value:"paste"},{label:"清空选中内容",value:"clearSelected"}]);h(this,"HEADER_CELL_STYLE_METHOD");h(this,"BODY_CELL_STYLE_METHOD");h(this,"FOOTER_CELL_STYLE_METHOD");h(this,"CELL_READONLY_METHOD");h(this,"CELL_FORMATTER_METHOD");h(this,"CELL_RULES_METHOD");h(this,"CELL_TYPE_METHOD");h(this,"CELL_EDITOR_TYPE_METHOD");h(this,"CELL_RENDER_METHOD");h(this,"CELL_HOVER_ICON_METHOD");h(this,"SPAN_METHOD");h(this,"SELECTABLE_METHOD");h(this,"EXPAND_LAZY_METHOD");Object.assign(this,t)}}class je{constructor(t){h(this,"ctx");h(this,"list",[{name:"loading",configName:"LOADING_ICON_SVG",configColorName:"LOADING_ICON_COLOR",svg:'<svg t="1724133395728" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2893" width="32" height="32"><path d="M512 226.8476541a19.82487759 19.82487759 0 0 1 14.66497778 5.70304692c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497779v122.20814825a19.82487759 19.82487759 0 0 1-5.70304693 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304691 19.82487759 19.82487759 0 0 1-14.66497778-5.70304691 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778v-122.20814825a19.82487759 19.82487759 0 0 1 5.70304693-14.66497779 19.82487759 19.82487759 0 0 1 14.66497778-5.70304692z m0 407.36049415a19.82487759 19.82487759 0 0 1 14.66497778 5.70304691c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497778v122.20814827a19.82487759 19.82487759 0 0 1-5.70304693 14.66497776 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693 19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497776v-122.20814827a19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304691zM797.1523459 512a19.82487759 19.82487759 0 0 1-5.70304692 14.66497778 19.82487759 19.82487759 0 0 1-14.66497779 5.70304693h-122.20814825a19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304693h122.20814825a19.82487759 19.82487759 0 0 1 14.66497779 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304692 14.66497778z m-407.36049415 0a19.82487759 19.82487759 0 0 1-5.70304691 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693h-122.20814827a19.82487759 19.82487759 0 0 1-14.66497776-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497776-5.70304693h122.20814827a19.82487759 19.82487759 0 0 1 14.66497778 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304691 14.66497778zM310.22076878 310.22076878a21.29137537 21.29137537 0 0 1 14.66497779-5.70304693c5.51294514 0 10.18401235 1.90101585 14.01320099 5.70304693l86.55052591 86.57768347a20.91117183 20.91117183 0 0 1 5.73020449 14.31193182 19.28172983 19.28172983 0 0 1-6.05609289 14.013201 19.11878565 19.11878565 0 0 1-14.013201 6.05609289 20.96548698 20.96548698 0 0 1-14.31193182-5.70304692L310.22076878 338.87178998a19.06447114 19.06447114 0 0 1-5.70304693-14.01320099c0-5.54010272 1.90101585-10.42842865 5.70304693-14.66497778z m288.32975775 288.32975775a19.79772001 19.79772001 0 0 1 14.3390894-6.35482371c5.29568642 0 10.04822572 2.11827457 14.31193182 6.38198066l86.57768347 86.55052651c3.80203107 3.80203107 5.70304692 8.47309828 5.70304691 14.01320102a19.55330372 19.55330372 0 0 1-6.05609225 14.31193182 19.66193339 19.66193339 0 0 1-14.31193245 6.05609288 19.01015661 19.01015661 0 0 1-14.01320099-5.70304692l-86.55052591-86.57768347a19.79772001 19.79772001 0 0 1-6.38198129-14.31193245c0-5.29568642 2.11827457-10.07538268 6.38198129-14.33908939zM713.77923122 310.22076878c3.80203107 4.26370672 5.70304692 9.15203265 5.70304693 14.66497779s-1.90101585 10.18401235-5.70304693 14.01320099l-86.57768347 86.55052591a20.91117183 20.91117183 0 0 1-14.31193182 5.73020449 19.28172983 19.28172983 0 0 1-14.013201-6.05609289 19.11878565 19.11878565 0 0 1-6.05609289-14.013201c0-5.29568642 1.90101585-10.07538268 5.70304692-14.31193182l86.57768348-86.57768347c3.80203107-3.80203107 8.50025585-5.70304692 14.01320099-5.70304693 5.54010272 0 10.40127108 1.90101585 14.66497779 5.70304693zM425.44947347 598.57768347a19.79772001 19.79772001 0 0 1 6.35482371 14.33908939c0 5.29568642-2.11827457 10.04822572-6.38198066 14.31193245L338.89894756 713.77923122a19.06447114 19.06447114 0 0 1-14.01320099 5.70304693 19.55330372 19.55330372 0 0 1-14.31193245-6.05609227 19.68909035 19.68909035 0 0 1-6.05609227-14.31193245 19.01015661 19.01015661 0 0 1 5.70304693-14.01320099l86.57768347-86.55052591a19.79772001 19.79772001 0 0 1 14.31193182-6.38198129c5.29568642 0 10.07538268 2.11827457 14.3390894 6.38198129z" fill="#000000" fill-opacity=".65" p-id="2894"></path></svg>',color:"#4E5969"},{name:"expand",configName:"EXPAND_ICON_SVG",configColorName:"EXPAND_ICON_COLOR",svg:'<svg t="1724122015492" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4237" width="32" height="32"><path d="M401.472 316.992l159.04 217.664L591.488 512l-30.976-22.656-159.04 217.728q-2.24 3.008-3.84 6.464-1.6 3.456-2.496 7.104-0.896 3.648-1.024 7.424-0.192 3.84 0.384 7.552 0.64 3.712 1.92 7.296 1.28 3.52 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992 3.072 2.24 6.464 3.84 3.456 1.6 7.168 2.496 3.648 0.896 7.424 1.024 3.776 0.192 7.488-0.448 3.776-0.576 7.296-1.856 3.584-1.28 6.784-3.264 3.2-1.92 6.016-4.48 2.816-2.56 5.056-5.632l159.04-217.728q3.584-4.928 5.504-10.752 1.92-5.76 1.92-11.904 0-6.08-1.92-11.904-1.92-5.76-5.504-10.752L463.488 271.68q-2.24-3.072-5.056-5.632-2.752-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.52-1.28-7.296-1.856-3.712-0.576-7.488-0.448-3.84 0.192-7.424 1.088-3.712 0.896-7.168 2.496-3.392 1.6-6.4 3.84-3.136 2.176-5.696 4.992-2.56 2.752-4.48 6.016-1.984 3.2-3.264 6.784-1.28 3.52-1.92 7.296-0.576 3.712-0.384 7.488 0.128 3.84 1.024 7.488 0.896 3.648 2.496 7.04 1.6 3.456 3.84 6.528z m30.976-61.056q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.24-3.52 1.408-6.656 3.52-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.232 1.408 3.456 3.52 6.592 2.112 3.2 4.8 5.824 2.688 2.688 5.76 4.8 3.2 2.112 6.72 3.52 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.656 1.472-3.52 2.24-7.232 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.456-3.52-6.592-2.112-3.2-4.8-5.824-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.52-3.52-1.472-7.232-2.24Q436.224 256 432.448 256z m0 435.392q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.176-3.52 1.472-6.656 3.584-3.2 2.112-5.824 4.736-2.688 2.688-4.8 5.824-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.76 2.688 2.752 5.76 4.8 3.2 2.112 6.72 3.584 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.472 6.592-3.584 3.2-2.048 5.824-4.736 2.688-2.688 4.8-5.824 2.112-3.2 3.52-6.656 1.472-3.456 2.24-7.168 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.52-3.52-6.656-2.112-3.136-4.8-5.76-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704z" p-id="4238"></path></svg>',color:"#4E5969"},{name:"shrink",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"SHRINK_ICON_COLOR",svg:'<svg t="1724122044148" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M707.648 401.28L489.28 560.704l22.656 30.976 22.656-30.976L316.16 401.216q-3.072-2.24-6.464-3.84-3.456-1.536-7.104-2.432-3.712-0.896-7.488-1.088-3.776-0.128-7.488 0.448-3.776 0.64-7.296 1.92-3.584 1.28-6.784 3.2-3.2 1.984-6.016 4.544-2.816 2.56-5.056 5.632-2.176 3.072-3.84 6.464-1.536 3.456-2.432 7.104-0.896 3.712-1.088 7.488-0.128 3.776 0.448 7.488 0.64 3.776 1.92 7.296 1.28 3.584 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992l218.368 159.552q4.928 3.584 10.752 5.504 5.76 1.92 11.904 1.92 6.08 0 11.904-1.92 5.76-1.92 10.752-5.504l218.368-159.552q3.008-2.24 5.568-4.992 2.56-2.816 4.544-6.016 1.92-3.2 3.264-6.784 1.28-3.52 1.92-7.296 0.576-3.712 0.384-7.488-0.128-3.84-1.024-7.488-0.896-3.648-2.496-7.04-1.6-3.456-3.84-6.528-2.24-3.072-4.992-5.632-2.816-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.584-1.28-7.296-1.856-3.712-0.64-7.488-0.448-3.84 0.192-7.488 1.088-3.648 0.896-7.04 2.496-3.456 1.536-6.528 3.84z m61.056 30.976q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.472-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.72-3.584-3.456-1.408-7.168-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.656 3.584-3.136 2.112-5.76 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.584 6.656-1.408 3.52-2.176 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.176 7.168 1.472 3.52 3.584 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.168-2.176 3.52-1.408 6.656-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.048-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z m-436.736 0q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.408-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.592 3.584-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.24 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.24 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z" p-id="4552"></path></svg>',color:"#4E5969"},{name:"checkbox-uncheck",configName:"CHECKBOX_UNCHECK_SVG",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:""},{name:"checkbox-check",configName:"CHECKBOX_CHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-hover",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-indeterminate",configName:"CHECKBOX_INDETERMINATE_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595280953" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4394" width="32" height="32"><path d="M128 384v256q0 12.608 1.28 25.088 1.216 12.544 3.648 24.832 2.432 12.352 6.08 24.384t8.448 23.68q4.864 11.584 10.752 22.72 5.952 11.072 12.928 21.504 7.04 10.496 14.976 20.224 8 9.728 16.896 18.56 8.896 8.96 18.56 16.896 9.728 8 20.224 14.976 10.432 7.04 21.504 12.928 11.136 5.888 22.72 10.688 11.648 4.864 23.68 8.512 12.032 3.648 24.32 6.08 12.352 2.432 24.896 3.712Q371.392 896 384 896h256q12.608 0 25.088-1.28 12.544-1.216 24.832-3.648 12.352-2.432 24.384-6.08t23.68-8.512q11.584-4.8 22.72-10.688 11.072-5.952 21.504-12.928 10.496-7.04 20.224-14.976 9.728-8 18.56-16.896 8.96-8.832 16.896-18.56 8-9.728 14.976-20.224 7.04-10.432 12.928-21.504 5.888-11.136 10.688-22.72 4.864-11.648 8.512-23.68 3.648-12.032 6.08-24.32 2.432-12.352 3.712-24.896Q896 652.608 896 640V384q0-12.608-1.28-25.088-1.216-12.544-3.648-24.832-2.432-12.352-6.08-24.384t-8.512-23.68q-4.8-11.584-10.688-22.72-5.952-11.072-12.928-21.504-7.04-10.496-14.976-20.224-8-9.664-16.896-18.56-8.832-8.96-18.56-16.896-9.728-8-20.224-14.976-10.432-7.04-21.504-12.928-11.136-5.888-22.72-10.752-11.648-4.8-23.68-8.448-12.032-3.648-24.32-6.08-12.352-2.432-24.896-3.712Q652.608 128 640 128H384q-12.608 0-25.088 1.28-12.544 1.216-24.832 3.648-12.352 2.432-24.384 6.08t-23.68 8.448q-11.584 4.864-22.72 10.752-11.072 5.952-21.504 12.928-10.496 7.04-20.224 14.976-9.664 8-18.56 16.896-8.96 8.896-16.896 18.56-8 9.728-14.976 20.224-7.04 10.432-12.928 21.504-5.888 11.136-10.752 22.72-4.8 11.648-8.448 23.68-3.648 12.032-6.08 24.32-2.432 12.352-3.712 24.896Q128 371.392 128 384z m566.016 166.336H330.112a38.4 38.4 0 0 1 0-76.8h363.904a38.4 38.4 0 0 1 0 76.8z" p-id="4395"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-check-disabled",configName:"CHECKBOX_CHECK_SVG",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"#DDE0EA"},{name:"checkbox-disabled",configName:"CHECKBOX_DISABLED_SVG",svg:'<svg t="1722595946663" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4865" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z" fill="#F1F2F4" p-id="4866"></path><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4867"></path></svg>',color:""}]);h(this,"icons",new Map);this.ctx=t,this.init()}async init(){const t=[];for(let e=0;e<this.list.length;e++){const i=this.list[e];let s=i.color;if(i.configColorName){const r=this.ctx.config[i.configColorName];r&&(s=r)}const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}for(let e=0;e<this.ctx.config.ICONS.length;e++){const i=this.ctx.config.ICONS[e];let s=i.color;const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}await Promise.all(t),this.ctx.emit("draw")}async createImageFromSVG(t,e){const o=new DOMParser().parseFromString(t,"image/svg+xml").documentElement;e&&o.querySelectorAll("*").forEach(c=>{c.setAttribute("fill",e)});const r=new Image,a=new Blob([new XMLSerializer().serializeToString(o)],{type:"image/svg+xml"}),l=URL.createObjectURL(a);return r.src=l,new Promise((c,f)=>{r.onerror=()=>f(new Error("Failed to load image")),r.onload=()=>{c(r)}})}get(t){return this.icons.get(t)}}class $t{constructor(t,e,i,s,o,r,a){h(this,"ctx");h(this,"x",0);h(this,"y",0);h(this,"width",0);h(this,"height",0);h(this,"fixed");h(this,"cellType");this.ctx=t,this.x=e,this.y=i,this.width=s,this.height=o,this.fixed=r,this.cellType=a}isHorizontalVisible(){if(this.fixed)return!0;const{target:t,fixedLeftWidth:e,scrollX:i,fixedRightWidth:s}=this.ctx,o=t.width;return!(this.x+this.width-e-i<=0||this.x-i>=o-s)}isVerticalVisible(){const{target:t,scrollY:e}=this.ctx,i=t.height;return!(this.y+this.height-e<=0||this.y-e>=i)}getDrawX(){return this.fixed==="left"?this.x:this.fixed==="right"?this.ctx.header.visibleWidth-(this.ctx.header.width-this.x)+1:this.x-this.ctx.scrollX}getDrawY(){return this.cellType==="header"?this.y:this.cellType==="footer"&&this.ctx.config.FOOTER_FIXED?this.y:this.y-this.ctx.scrollY}getLeftFixedX(){return this.x-this.ctx.scrollX}getRightFixedX(){}}class qt extends $t{constructor(e,i,s,o,r,a,l,c,f,d="body"){super(e,o,r,a,l,c.fixed,d);h(this,"formatter");h(this,"hoverIconName","");h(this,"align");h(this,"verticalAlign");h(this,"fixed");h(this,"type");h(this,"editorType");h(this,"cellType");h(this,"level");h(this,"colspan",1);h(this,"rowspan",1);h(this,"key");h(this,"column");h(this,"rowIndex");h(this,"colIndex");h(this,"rowKey");h(this,"row");h(this,"value");h(this,"render");h(this,"renderFooter");h(this,"style",{});h(this,"rules",{});h(this,"message","");h(this,"text","");h(this,"displayText","");h(this,"visibleWidth",0);h(this,"visibleHeight",0);h(this,"drawX",0);h(this,"drawY",0);h(this,"drawCellBgColor","");h(this,"drawCellSkyBgColor","");h(this,"drawTextColor","");h(this,"drawTextX",0);h(this,"drawTextY",0);h(this,"drawImageX",0);h(this,"drawImageY",0);h(this,"drawImageWidth",0);h(this,"drawImageHeight",0);h(this,"drawImageName","");h(this,"drawImageSource");h(this,"ellipsis",!1);h(this,"overflowTooltipShow",!0);h(this,"overflowTooltipMaxWidth",500);h(this,"overflowTooltipPlacement","top");this.visibleWidth=this.width,this.visibleHeight=this.height,this.colIndex=s,this.rowIndex=i,this.key=c.key,this.type=c.type||"text",this.editorType=c.editorType||"text",this.cellType=d,this.align=c.align||"center",this.verticalAlign=c.verticalAlign||"middle",this.fixed=c.fixed,this.level=c.level,this.column=c,this.rules=c.rules,this.row=f,this.rowKey=this.cellType==="body"?this.ctx.database.getRowKeyForRowIndex(i):`${this.cellType}_${this.rowIndex}`,this.value=this.getValue(),this.render=c.render,this.overflowTooltipShow=c.overflowTooltipShow!==!1,this.overflowTooltipMaxWidth=c.overflowTooltipMaxWidth||500,this.overflowTooltipPlacement=c.overflowTooltipPlacement||"top",this.renderFooter=c.renderFooter,this.hoverIconName=c.hoverIconName,this.formatter=c.formatter,this.update()}getValidationMessage(){const e=this.ctx.database.getValidationError(this.rowKey,this.key);if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message}return this.message}update(){this.drawX=this.getDrawX(),this.drawY=this.getDrawY(),this.drawTextX=this.drawX,this.drawTextY=this.drawY,this.updateSpan(),this.updateStyle(),this.updateType(),this.updateHoverIcon(),this.updateSelection(),this.updateTree(),this.updateEditorType(),this.updateRender(),this.getValidationMessage(),this.updateContainer(),this.text=this.getText(),this.displayText=this.getDisplayText()}updateSpan(){if(this.cellType==="footer")return;const{SPAN_METHOD:e}=this.ctx.config;if(typeof e=="function"){const i=e,{colspan:s=1,rowspan:o=1}=i({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue(),headIndex:this.ctx.body.headIndex,headPosition:this.ctx.database.getPositionForRowIndex(this.ctx.body.headIndex),visibleRows:this.ctx.body.visibleRows,visibleLeafColumns:this.ctx.header.visibleLeafColumns,rows:this.ctx.body.data})||{};this.colspan=s,this.rowspan=o,this.visibleWidth=this.getWidthByColIndexColSpan(this.colIndex,this.colspan),this.visibleHeight=this.ctx.database.getHeightByRowIndexRowSpan(this.rowIndex,this.rowspan)}}updateType(){const{CELL_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.type=s)}}updateEditorType(){const{CELL_EDITOR_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.editorType=s)}}updateRender(){const{CELL_RENDER_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.render=s)}}validate(){this.ctx.database.getValidator(this.rowKey,this.key).then(()=>{this.ctx.database.setValidationError(this.rowKey,this.key,[]),this.message=""}).catch(e=>{if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message,this.ctx.database.setValidationError(this.rowKey,this.key,e)}}).finally(()=>{this.ctx.emit("draw")})}updateStyle(){this.style=this.getOverlayerViewsStyle()}updateTree(){const{CELL_PADDING:e=0}=this.ctx.config,{rowKey:i,cellType:s}=this;let o,r=0,a="";if(this.type==="tree"&&s==="body"){const l=this.ctx.database.getRowForRowKey(i),{expand:c=!1,hasChildren:f=!1,expandLoading:d=!1,level:x=0}=l||{};if(d){const u=this.ctx.icons.get("loading");a="loading",o=u,r=x*8}else if(f){const u=this.ctx.icons.get("expand"),y=this.ctx.icons.get("shrink");o=c?y:u,a=c?"shrink":"expand",r=x*8}else r=x*8;if(o){let u=20,y=20,g=this.drawX+r+e,w=this.drawY+(this.visibleHeight-y)/2+2;this.ctx.paint.drawImage(o,g,w,u,y),this.drawImageX=g,this.drawImageY=w,this.drawImageWidth=u,this.drawImageHeight=y,this.drawImageName=a,this.drawImageSource=o,this.align="left",this.drawTextX=r+this.drawX+u+.5}}}updateContainer(){const{BODY_BG_COLOR:e,EDIT_BG_COLOR:i,BODY_CELL_STYLE_METHOD:s,FOOTER_CELL_STYLE_METHOD:o,READONLY_TEXT_COLOR:r,FOOTER_BG_COLOR:a,HIGHLIGHT_SELECTED_ROW:l,HIGHLIGHT_SELECTED_ROW_COLOR:c,HIGHLIGHT_HOVER_ROW:f,HIGHLIGHT_HOVER_ROW_COLOR:d}=this.ctx.config;if(this.cellType==="footer"){let p=a,E=r;if(typeof o=="function"){const m=o,{backgroundColor:b,color:v}=m({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()})||{};b&&(p=b),v&&(E=v)}this.drawCellSkyBgColor="transparent",this.drawCellBgColor=p,this.drawTextColor=E;return}let x="transparent";const u=this.ctx.focusCell,y=this.ctx.hoverCell;f&&(y==null?void 0:y.rowKey)===this.rowKey&&(x=d),l&&(u==null?void 0:u.rowKey)===this.rowKey&&(x=c),this.drawCellSkyBgColor=x;let g=e,w=r;if(["index","index-selection","selection"].includes(this.type)){this.drawCellBgColor=e,this.drawTextColor=r;return}if(this.ctx.database.getReadonly(this.rowKey,this.key)||(g=i,w=r),typeof s=="function"){const p=s,{backgroundColor:E,color:m}=p({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()})||{};E&&(g=E),m&&(w=m)}this.drawCellBgColor=g,this.drawTextColor=w}updateSelection(){const{visibleWidth:e,visibleHeight:i,rowspan:s,colspan:o,cellType:r,type:a,rowIndex:l,rowKey:c}=this;if(!(s===0||o===0)&&r!=="footer"&&["index-selection","selection"].includes(a)){const f=this.ctx.database.getRowSelection(c),d=this.ctx.database.getRowSelectable(c),{CHECKBOX_SIZE:x=0}=this.ctx.config,u=this.drawX+(e-x)/2,y=this.drawY+(i-x)/2;let g=this.ctx.icons.get("checkbox-uncheck"),w="checkbox-uncheck";f&&d?(g=this.ctx.icons.get("checkbox-check"),w="checkbox-check"):f&&d?(g=this.ctx.icons.get("checkbox-check-disabled"),w="checkbox-check-disabled"):!f&&d?(g=this.ctx.icons.get("checkbox-uncheck"),w="checkbox-uncheck"):(g=this.ctx.icons.get("checkbox-disabled"),w="checkbox-disabled"),g&&a=="index-selection"?(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===l||["checkbox-disabled","checkbox-check"].includes(w))&&(this.drawImageX=u,this.drawImageY=y,this.drawImageWidth=x,this.drawImageHeight=x,this.drawImageName=w,this.drawImageSource=g):g&&a==="selection"&&(this.drawImageX=u,this.drawImageY=y,this.drawImageWidth=x,this.drawImageHeight=x,this.drawImageName=w,this.drawImageSource=g)}}updateHoverIcon(){const{CELL_HOVER_ICON_METHOD:e,CELL_HOVER_ICON_SIZE:i,CELL_PADDING:s}=this.ctx.config;if(typeof e=="function"){const l=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});l!==void 0&&(this.hoverIconName=l)}const o=this.drawX+this.width-i-s,r=this.drawY+(this.height-i)/2;if(this.hoverIconName&&this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex){const a=this.ctx.icons.get(this.hoverIconName);this.drawImageX=o,this.drawImageY=r,this.drawImageWidth=i,this.drawImageHeight=i,this.drawImageName=this.hoverIconName,this.drawImageSource=a}}getDisplayText(){return this.cellType==="footer"?this.renderFooter||this.text===null||this.text===void 0?"":this.text:this.rowspan===0||this.colspan===0||this.render||this.type==="index-selection"&&(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex||["checkbox-disabled","checkbox-check"].includes(this.drawImageName))||this.text===null||this.text===void 0?"":`${this.text}`}getText(){if(this.cellType==="footer")return this.row[this.key];if(typeof this.formatter=="function")return this.formatter({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});const{CELL_FORMATTER_METHOD:e}=this.ctx.config;return typeof e=="function"?e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()}):["index-selection","index"].includes(this.type)?`${this.rowIndex+1}`:(this.value=this.ctx.database.getItemValue(this.rowKey,this.key),this.value)}getValue(){return this.ctx.database.getItemValue(this.rowKey,this.key)}getOverlayerViewsStyle(){let e=`${this.drawX-this.ctx.fixedLeftWidth}px`,i=`${this.drawY-this.ctx.body.y}px`;return this.fixed==="left"?e=`${this.drawX}px`:this.fixed==="right"&&(e=`${this.drawX-(this.ctx.target.width-this.ctx.fixedRightWidth)}px`),this.cellType==="footer"&&this.ctx.config.FOOTER_FIXED&&(i=`${this.drawY-this.ctx.footer.y}px`),{position:"absolute",overflow:"hidden",left:e,top:i,width:`${this.visibleWidth}px`,height:`${this.visibleHeight}px`,pointerEvents:"none"}}draw(){const{paint:e,config:{BORDER_COLOR:i}}=this.ctx,{drawX:s,drawY:o}=this;e.drawRect(s,o,this.visibleWidth,this.visibleHeight,{borderColor:i,fillColor:this.drawCellBgColor}),e.drawRect(s,o,this.width,this.height,{borderColor:"transparent",borderWidth:1,fillColor:this.drawCellSkyBgColor}),this.ellipsis=this.drawText(),this.drawImage(),this.drawSelector(),this.drawAutofillPiont(),this.drawErrorTip()}getWidthByColIndexColSpan(e,i){if(i===0)return 0;let s=0;for(let o=e;o<e+i;o++){const r=this.ctx.header.leafCellHeaders[o];s+=r.width}return s}drawText(){const{CELL_PADDING:e,BODY_FONT:i}=this.ctx.config;return this.ctx.paint.drawText(this.displayText,this.drawTextX,this.drawTextY,this.visibleWidth,this.visibleHeight,{font:i,padding:e,align:this.align,verticalAlign:this.verticalAlign,color:this.drawTextColor})}drawImage(){this.drawImageSource&&this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight)}drawAutofillPiont(){if(this.cellType==="footer")return;const{SELECT_BORDER_COLOR:e,ENABLE_AUTOFILL:i,ENABLE_SELECTOR:s}=this.ctx.config;if(!s||!i)return;const{xArr:o,yArr:r}=this.ctx.selector,a=o[1],l=r[1],{colIndex:c,rowIndex:f,drawX:d,drawY:x}=this;c===a&&f===l&&this.ctx.paint.drawRect(d+this.width-6,x+this.height-6,6,6,{borderColor:"#fff",fillColor:e})}drawSelector(){if(this.cellType==="footer")return;const{ENABLE_SELECTOR:e}=this.ctx.config;if(!e)return;const{xArr:i,yArr:s,xArrCopy:o,yArrCopy:r}=this.ctx.selector;this.drawBorder({xArr:o,yArr:r,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:this.ctx.autofill.xArr,yArr:this.ctx.autofill.yArr,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:i,yArr:s,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1})}drawErrorTip(){if(this.cellType==="footer"||!this.message)return;const{ERROR_TIP_ICON_SIZE:e,ERROR_TIP_COLOR:i}=this.ctx.config,{width:s}=this,o=this.drawX,r=this.drawY,a=[o+s-e-.5,r,o+s-.5,r,o+s-.5,r+e];this.ctx.paint.drawLine(a,{borderColor:i,fillColor:i,borderWidth:1,lineCap:"round",lineJoin:"round"})}drawBorder(e){const{drawX:i,drawY:s,width:o,rowIndex:r,colIndex:a}=this,l=i+.5;let c=s+.5,f=this.height;r===0&&(c=this.y+1,f=f-1);const{xArr:d,yArr:x,lineDash:u=[],borderWidth:y=1,borderColor:g,fillColor:w}=e,p=d[0],E=d[1],m=x[0],b=x[1];a>=p&&a<=E&&r===m&&this.ctx.paint.drawLine([l,c,l+o-2,c],{borderColor:g,fillColor:w,borderWidth:y,lineCap:"round",lineJoin:"round",lineDash:u}),a>=p&&a<=E&&r===b&&this.ctx.paint.drawLine([l,c+f-1.5,l+o,c+f-1.5],{borderColor:g,fillColor:w,borderWidth:y,lineCap:"round",lineJoin:"round",lineDash:u}),a===p&&r>=m&&r<=b&&this.ctx.paint.drawLine([l,c,l,c+f-1],{borderColor:g,fillColor:w,borderWidth:y,lineCap:"round",lineJoin:"round",lineDash:u}),a===E&&r>=m&&r<=b&&this.ctx.paint.drawLine([l+o-1,c,l+o-1,c+f-1],{borderColor:g,fillColor:w,borderWidth:y,lineCap:"round",lineJoin:"round",lineDash:u})}}class Gt extends $t{constructor(e,i,s,o,r,a,l){super(e,s,o,r,a,l.fixed,"header");h(this,"align");h(this,"verticalAlign","middle");h(this,"fixed");h(this,"widthFillDisable");h(this,"type");h(this,"editorType");h(this,"level");h(this,"text");h(this,"displayText","");h(this,"colspan");h(this,"rowspan");h(this,"key");h(this,"required",!1);h(this,"readonly",!1);h(this,"children",[]);h(this,"column");h(this,"colIndex");h(this,"rowKey");h(this,"rules");h(this,"hasChildren");h(this,"render");h(this,"style",{});h(this,"drawX",0);h(this,"drawY",0);h(this,"drawCellBgColor","");h(this,"drawTextColor","");h(this,"drawImageX",0);h(this,"drawImageY",0);h(this,"drawImageWidth",0);h(this,"drawImageHeight",0);h(this,"drawImageName","");h(this,"drawImageSource");this.ctx=e,this.x=s,this.y=o,this.width=r,this.height=a,this.colIndex=i,this.key=l.key,this.type=l.type,this.editorType=l.editorType||"text",this.align=l.align||"center",this.verticalAlign=l.verticalAlign||"middle",this.fixed=l.fixed,this.level=l.level,this.text=l.title,this.column=l,this.colspan=l.colspan,this.widthFillDisable=l.widthFillDisable,this.rowspan=l.rowspan,this.rules=l.rules,this.readonly=l.readonly,this.required=l.required,this.rowKey=It(),this.hasChildren=l.children&&l.children.length>0||!1,this.render=l.renderHeader}isVerticalVisible(){const{target:e}=this.ctx,i=e.height;return!(this.y+this.height<=0||this.y>=i)}updateStyle(){this.style=this.getOverlayerViewsStyle()}updateContainer(){const{HEADER_CELL_STYLE_METHOD:e,HEADER_BG_COLOR:i,HEADER_TEXT_COLOR:s}=this.ctx.config;let o=i,r=s;if(typeof e=="function"){const a=e,{backgroundColor:l,color:c}=a({colIndex:this.colIndex,column:this.column})||{};l&&(o=l),c&&(r=c)}this.drawCellBgColor=o,this.drawTextColor=r}update(){this.updateContainer(),this.displayText=this.getText(),this.drawX=this.getDrawX(),this.drawY=this.getDrawY(),this.updateStyle()}draw(){const{paint:e,config:{BORDER_COLOR:i,CELL_PADDING:s,HEADER_FONT:o}}=this.ctx,{drawX:r,drawY:a,displayText:l}=this;e.drawRect(r,a,this.width,this.height,{borderColor:i,fillColor:this.drawCellBgColor}),e.drawText(l,r,a,this.width,this.height,{font:o,padding:s,color:this.drawTextColor,align:this.align,verticalAlign:this.verticalAlign}),this.drawSelection()}drawSelection(){const{width:e,height:i,type:s}=this;if(["index-selection","selection"].includes(s)){const{indeterminate:o,check:r,selectable:a}=this.ctx.database.getCheckedState(),{CHECKBOX_SIZE:l=0}=this.ctx.config,c=this.drawX+(e-l)/2,f=this.drawY+(i-l)/2;let d=this.ctx.icons.get("checkbox-uncheck"),x="checkbox-uncheck";o?(d=this.ctx.icons.get("checkbox-indeterminate"),x="checkbox-indeterminate"):r&&a?(d=this.ctx.icons.get("checkbox-check"),x="checkbox-check"):r&&a?(d=this.ctx.icons.get("checkbox-check-disabled"),x="checkbox-check-disabled"):!r&&a?(d=this.ctx.icons.get("checkbox-uncheck"),x="checkbox-uncheck"):(d=this.ctx.icons.get("checkbox-disabled"),x="checkbox-disabled"),d&&(this.drawImageX=c,this.drawImageY=f,this.drawImageWidth=l,this.drawImageHeight=l,this.drawImageName=x,this.drawImageSource=d,this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight))}}getText(){return this.render?"":this.text}getOverlayerViewsStyle(){let e="";return this.fixed==="left"?e=`${this.drawX}px`:this.fixed==="right"?e=`${this.drawX-(this.ctx.target.width-this.ctx.fixedRightWidth)}px`:e=`${this.drawX-this.ctx.fixedLeftWidth}px`,{position:"absolute",overflow:"hidden",left:e,top:`${this.drawY+1}px`,width:`${this.width}px`,height:`${this.height}px`,pointerEvents:"none"}}}class Ue{constructor(t){h(this,"ctx");h(this,"visibleHoverCell");h(this,"resizeObserver");this.ctx=t,this.init()}init(){this.resizeObserver=new ResizeObserver(()=>{this.ctx.emit("resetHeader"),this.ctx.emit("resizeObserver")}),this.ctx.target.parentElement&&this.resizeObserver.observe(this.ctx.target),this.ctx.on("mousedown",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),l=r.getDrawY();if(i>a&&i<a+r.width&&e>l&&e<l+r.height){this.ctx.focusCellHeader=r,this.ctx.emit("cellHeaderMousedown",r,t);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const l of a){const c=l.getDrawX(),f=l.getDrawY();if(i>c&&i<c+l.width&&e>f&&e<f+l.height){this.ctx.setFocusCell(l),this.ctx.emit("cellMousedown",l,t);return}}}}),this.ctx.on("click",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),l=r.getDrawY();if(i>a&&i<a+r.width&&e>l&&e<l+r.height){this.ctx.clickCellHeader=r,this.ctx.emit("cellHeaderClick",r,t),this.selectionClick(r);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const l of a){const c=l.getDrawX(),f=l.getDrawY();if(i>c&&i<c+l.width&&e>f&&e<f+l.height){this.ctx.clickCell=l,this.ctx.emit("cellClick",l,t),this.selectionClick(l),this.treeClick(l);return}}}}),this.ctx.on("mousemove",t=>{var r;if(this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const a of s){const l=a.getDrawX(),c=a.getDrawY();if(i>l&&i<l+a.width&&e>c&&e<c+a.height){if(this.ctx.emit("cellHeaderMouseenter",a,t),this.ctx.hoverCellHeader&&this.ctx.hoverCellHeader!==a&&this.ctx.emit("cellHeaderMouseleave",this.ctx.hoverCellHeader,t),this.imageEnterAndLeave(a,t),this.ctx.hoverCellHeader===a)return;this.ctx.hoverCellHeader=a,this.ctx.emit("cellHeaderHoverChange",a);return}}const o=this.ctx.body.renderRows;for(const a of o){const l=a.fixedCells.concat(a.noFixedCells);for(const c of l){const f=c.getDrawX(),d=c.getDrawY();if(i>f&&i<f+c.visibleWidth&&e>d&&e<d+c.visibleHeight&&(this.imageEnterAndLeave(c,t),this.visibleHoverCell!==c&&(this.ctx.emit("visibleCellMouseleave",c,t),this.visibleHoverCell=c,this.ctx.emit("visibleCellHoverChange",c,t))),i>f&&i<f+c.width&&e>d&&e<d+c.height){if(this.ctx.emit("cellMouseenter",c,t),this.ctx.hoverCell&&this.ctx.hoverCell!==c&&this.ctx.emit("cellMouseleave",this.ctx.hoverCell,t),this.ctx.hoverCell===c)return;((r=this.ctx.hoverCell)==null?void 0:r.rowKey)!==c.rowKey&&(this.ctx.hoverCell=c,this.ctx.hoverRow=this.ctx.body.renderRows[c.rowIndex],this.ctx.emit("rowHoverChange",this.ctx.hoverRow,c,t),this.ctx.emit("draw")),this.ctx.hoverCell=c,this.ctx.emit("cellHoverChange",c,t);return}}}})}selectionClick(t){if(["selection","index-selection"].includes(t.type)&&this.ctx.isPointer)if(t instanceof Gt)t.drawImageName==="checkbox-uncheck"||t.drawImageName==="checkbox-indeterminate"?this.ctx.database.toggleAllSelection():t.drawImageName==="checkbox-check"&&this.ctx.database.clearSelection();else{if(!this.ctx.database.getRowSelectable(t.rowKey))return;this.ctx.database.toggleRowSelection(t.rowKey)}}treeClick(t){if(t.type==="tree"&&this.ctx.isPointer){const e=this.ctx.database.getRowForRowKey(t.rowKey),{expand:i=!1,expandLazy:s=!1}=e||{},{EXPAND_LAZY:o,EXPAND_LAZY_METHOD:r}=this.ctx.config;if(o&&r&&!i&&!s)typeof r=="function"&&(this.ctx.database.expandLoading(t.rowKey,!0),r({row:t.row,rowIndex:t.rowIndex,colIndex:t.colIndex,column:t.column,value:t.getValue()}).then(l=>{this.ctx.database.setExpandChildren(t.rowKey,l),this.ctx.database.expandLoading(t.rowKey,!1)}).catch(l=>{this.ctx.database.expandLoading(t.rowKey,!1),console.error(l)}));else{const a=this.ctx.database.getIsExpand(t.rowKey);this.ctx.database.expandItem(t.rowKey,!a),this.ctx.emit("expandChange")}}}imageEnterAndLeave(t,e){const i=e.offsetY,s=e.offsetX;s>t.drawImageX&&s<t.drawImageX+t.drawImageWidth&&i>t.drawImageY&&i<t.drawImageY+t.drawImageHeight?(this.ctx.target.style.cursor="pointer",this.ctx.isPointer=!0,t instanceof qt&&["selection","index-selection"].includes(t.type)&&(this.ctx.database.getRowSelectable(t.rowKey)||(this.ctx.target.style.cursor="not-allowed"))):(this.ctx.isPointer=!1,this.ctx.target.style.cursor==="pointer"&&(this.ctx.target.style.cursor="default"))}isBusy(t){const e=t.offsetY,i=t.offsetX;if(!(t.target instanceof HTMLCanvasElement)||!this.ctx.isTarget(t.target)||this.ctx.target.style.cursor==="row-resize"||this.ctx.target.style.cursor==="col-resize"||this.ctx.columnResizing||this.ctx.rowResizing)return!0;const{SCROLLER_TRACK_SIZE:s}=this.ctx.config;return!!(this.ctx.scrollerMove||this.ctx.scrollerFocus||e>this.ctx.target.height-s||i>this.ctx.target.width-s)}destroy(){this.resizeObserver.unobserve(this.ctx.target)}}class Ze{constructor(t,e,i){h(this,"eventBus");h(this,"eventBrowser");h(this,"eventTable");h(this,"uuid",It());h(this,"targetContainer");h(this,"target");h(this,"paint");h(this,"icons");h(this,"mousedown",!1);h(this,"isPointer",!1);h(this,"rowResizing",!1);h(this,"columnResizing",!1);h(this,"scrollerMove",!1);h(this,"scrollerFocus",!1);h(this,"autofillMove",!1);h(this,"editing",!1);h(this,"scrollY",0);h(this,"scrollX",0);h(this,"fixedLeftWidth",0);h(this,"fixedRightWidth",0);h(this,"maxColIndex",0);h(this,"maxRowIndex",0);h(this,"hoverRow");h(this,"clickCell");h(this,"focusCell");h(this,"hoverCell");h(this,"clickCellHeader");h(this,"focusCellHeader");h(this,"hoverCellHeader");h(this,"body",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,headIndex:0,tailIndex:0,visibleRows:[],renderRows:[],data:[]});h(this,"footer",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,renderRows:[]});h(this,"header",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,visibleLeafColumns:[],leafCellHeaders:[],renderLeafCellHeaders:[],renderCellHeaders:[],fixedLeftCellHeaders:[],fixedRightCellHeaders:[],renderCenterCellHeaders:[]});h(this,"selector",{enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]});h(this,"autofill",{enable:!1,xArr:[-1,-1],yArr:[-1,-1]});h(this,"database");h(this,"history");h(this,"config");this.target=e,this.targetContainer=t,this.target.setAttribute("uuid",this.uuid),this.config=new Ge(i.config||{}),this.eventBus=new $e,this.eventBrowser=new ze(this),this.eventTable=new Ue(this),this.paint=new qe(e),this.database=new Pe(this,i),this.history=new Ve(this),this.icons=new je(this)}setFocusCell(t){var e;this.focusCell!==t&&(((e=this.focusCell)==null?void 0:e.rowKey)!==t.rowKey&&(this.focusCell=t,this.emit("rowFocusChange",t)),this.focusCell=t,this.emit("cellFocusChange",t))}clearSelector(){this.selector={enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]}}clearAutofill(){this.autofill={enable:!1,xArr:[-1,-1],yArr:[-1,-1]}}getSelectedData(){const t=[],e=this.selector.yArr,i=this.selector.xArr;let s="";for(let o=0;o<=e[1]-e[0];o++){const r=[];for(let a=0;a<=i[1]-i[0];a++){const l=o+e[0],c=a+i[0],f=this.database.getItemValueForRowIndexAndColIndex(l,c);f&&r.push(f.value)}s+=`${r.join("	")}\r`,t.push(r)}return s=s?s.replace(/\r$/,""):" ",{xArr:i,yArr:e,text:s,value:t}}setScroll(t,e){let i=Math.floor(t);const s=this.body.width-this.body.visibleWidth;i<0?i=0:i>s&&(i=s);let o=Math.floor(e);const r=this.body.height-this.body.visibleHeight-this.footer.height;o<0?o=0:o>r&&(o=r),this.emit("setScroll",i,o)}setScrollX(t){let e=Math.floor(t);const i=this.body.width-this.body.visibleWidth;e<0?e=0:e>i&&(e=i),this.emit("setScrollX",e)}setScrollY(t){let e=Math.floor(t);const i=this.body.height-this.body.visibleHeight-this.footer.height;e<0?e=0:e>i&&(e=i),this.emit("setScrollY",e)}isTarget(t){if(t===null)return!1;const e=t.getAttribute("uuid");return this.uuid===e}hasEvent(t){return this.eventBus.has(t)}on(t,e){this.eventBus.on(t,e)}once(t,e){this.eventBus.once(t,e)}off(t,e){this.eventBus.off(t,e)}emit(t,...e){this.eventBus.emit(t,...e)}destroy(){this.eventTable.destroy(),this.eventBrowser.destroy(),this.eventBus.destroy()}}class jt{constructor(t,e){h(this,"ctx");h(this,"type");h(this,"isFocus",!1);h(this,"trackX",0);h(this,"trackY",0);h(this,"trackWidth",0);h(this,"trackHeight",0);h(this,"splitPoints",[]);h(this,"barX",0);h(this,"barY",0);h(this,"barWidth",0);h(this,"barHeight",0);h(this,"distance",0);h(this,"visibleDistance",0);h(this,"offsetX",0);h(this,"offsetY",0);h(this,"dragStart",0);h(this,"isDragging",!1);h(this,"scroll",0);this.ctx=t,this.type=e,this.type==="vertical"?this.scroll=this.ctx.scrollY:this.scroll=this.ctx.scrollX}onWheel(t){this.updateScroll(t)}onMouseDown(t){const{offsetX:e,offsetY:i}=t;if(!(e==this.offsetX&&i==this.offsetY)){if(this.isOnScrollbar(e,i))this.offsetX=e,this.offsetY=i,this.isDragging=!0,this.ctx.scrollerMove=!0,this.isFocus=!0,this.dragStart=this.scroll;else if(this.isOnTrack(e,i)){let s=0;this.type==="vertical"?s=(i-this.ctx.header.height-this.barHeight/2)/(this.visibleDistance-this.barHeight)*this.distance:s=(e-this.barWidth/2)/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(s,this.distance))}}}onMouseUp(){this.isDragging=!1,this.isFocus=!1,this.offsetY=0,this.offsetX=0}onMouseMove(t){const{offsetX:e,offsetY:i}=t;if(this.isOnScrollbar(e,i)&&t.target===this.ctx.target?this.isFocus=!0:this.isFocus=!1,e==this.offsetX&&i==this.offsetY)return;let s=0;if(this.type==="horizontal"?s=e-this.offsetX:s=i-this.offsetY,this.isDragging&&s!==0){let o=0;this.type==="vertical"?o=this.dragStart+s/(this.visibleDistance-this.barHeight)*this.distance:o=this.dragStart+s/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(o,this.distance))}}isPointInElement(t,e,i,s,o,r){return t>=i&&t<=i+o&&e>=s&&e<=s+r}isOnScrollbar(t,e){return this.isPointInElement(t,e,this.barX,this.barY,this.barWidth,this.barHeight)}isOnTrack(t,e){return this.isPointInElement(t,e,this.trackX,this.trackY,this.trackWidth,this.trackHeight)}updateScroll(t){t.preventDefault();const e=t.deltaX,i=t.deltaY;this.type==="vertical"&&t.shiftKey===!1?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.type==="horizontal"&&(t.shiftKey?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.scroll=Math.max(0,Math.min(this.scroll+e,this.distance)))}updatedSize(){const{body:t,header:e,config:{SCROLLER_TRACK_SIZE:i=0,SCROLLER_SIZE:s=0}}=this.ctx,o=this.ctx.target.width+1,r=this.ctx.target.height,a=e.height,l=e.width,c=t.height,f=this.ctx.footer.height;if(this.type==="vertical"){this.visibleDistance=r-i-a,this.distance=c-this.visibleDistance+f,this.trackX=o-i,this.trackY=0,this.splitPoints=[this.trackX,a,this.trackX+i,a],this.trackWidth=i,this.trackHeight=r,this.barX=this.trackX+(i-s)/2,this.barWidth=s;const d=this.distance?this.visibleDistance/c:0;let x=Math.floor(d*this.visibleDistance);x<30?x=30:x>this.visibleDistance&&(x=0),this.barHeight=x,this.barY=a+this.scroll/this.distance*(this.visibleDistance-this.barHeight),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}else{this.visibleDistance=o-i,this.distance=l-this.visibleDistance,this.splitPoints=[o-i,r-i,o-i,r],this.trackX=0,this.trackY=r-i,this.trackWidth=o,this.trackHeight=i;const d=this.distance?this.visibleDistance/l:0;let x=Math.floor(d*this.visibleDistance);this.barY=this.trackY+.5+(i-s)/2,x<30?x=30:x>=this.visibleDistance&&(x=0),this.barWidth=x,this.barHeight=s,this.barX=this.scroll/this.distance*(this.visibleDistance-this.barWidth),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}}draw(){const{config:{SCROLLER_FOCUS_COLOR:t,SCROLLER_COLOR:e,BORDER_COLOR:i,SCROLLER_TRACK_COLOR:s}}=this.ctx;this.updatedSize(),this.ctx.paint.drawRect(this.trackX,this.trackY,this.trackWidth,this.trackHeight,{borderColor:i,fillColor:s}),this.ctx.paint.drawRect(this.barX,this.barY,this.barWidth,this.barHeight,{fillColor:this.isFocus||this.isDragging?t:e,radius:4}),this.splitPoints.length>0&&this.ctx.paint.drawLine(this.splitPoints,{borderColor:i,borderWidth:1}),this.ctx.scrollerFocus=this.isFocus}}class Je{constructor(t){h(this,"ctx");h(this,"verticalScrollbar");h(this,"horizontalScrollbar");this.ctx=t,this.verticalScrollbar=new jt(t,"vertical"),this.horizontalScrollbar=new jt(t,"horizontal"),this.ctx.on("wheel",e=>this.onWheel(e)),this.ctx.on("mousedown",e=>this.onMouseDown(e)),this.ctx.on("mousemove",e=>this.onMouseMove(e)),this.ctx.on("mouseup",()=>this.onMouseUp()),this.ctx.on("setScroll",(e,i)=>{this.setScroll(e,i)}),this.ctx.on("setScrollX",e=>{this.setScrollX(e)}),this.ctx.on("setScrollY",e=>{this.setScrollY(e)})}onWheel(t){this.verticalScrollbar.onWheel(t),this.horizontalScrollbar.onWheel(t),this.draw()}onMouseDown(t){this.verticalScrollbar.onMouseDown(t),this.horizontalScrollbar.onMouseDown(t),this.draw()}onMouseMove(t){this.verticalScrollbar.onMouseMove(t),this.horizontalScrollbar.onMouseMove(t),this.draw()}onMouseUp(){this.verticalScrollbar.onMouseUp(),this.horizontalScrollbar.onMouseUp(),this.ctx.scrollerMove=!1}draw(){this.verticalScrollbar.draw(),this.horizontalScrollbar.draw();const t=Math.floor(this.horizontalScrollbar.scroll),e=Math.floor(this.verticalScrollbar.scroll);(t!==this.ctx.scrollX||e!==this.ctx.scrollY)&&(this.ctx.scrollX=t,this.ctx.scrollY=e,this.ctx.emit("draw"),this.ctx.emit("onScroll",t,e),t!==this.ctx.scrollX&&this.ctx.emit("onScrollX",t),e!==this.ctx.scrollY&&this.ctx.emit("onScrollY",e))}setScroll(t,e){this.horizontalScrollbar.scroll=t,this.verticalScrollbar.scroll=e,this.ctx.emit("draw")}setScrollX(t){this.horizontalScrollbar.scroll=t,this.ctx.emit("draw")}setScrollY(t){this.verticalScrollbar.scroll=t,this.ctx.emit("draw")}scrollToColkey(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.key===t);i&&this.setScrollX(i.x-e.visibleWidth/2)}scrollToColIndex(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.colIndex===t);i&&i.x>e.visibleWidth/2&&this.setScrollX(i.x-e.visibleWidth/2)}scrollToRowIndex(t){const{body:e,database:i}=this.ctx,{top:s}=i.getPositionForRowIndex(t);s>e.visibleHeight&&this.setScrollY(s-e.visibleHeight/2)}scrollToRowKey(t){const{body:e,database:i}=this.ctx,s=i.getRowIndexForRowKey(t),{top:o}=i.getPositionForRowIndex(s);this.setScrollY(o-e.visibleHeight/2)}}class Qe{constructor(t){h(this,"ctx");h(this,"x",0);h(this,"y",0);h(this,"width",0);h(this,"height",0);h(this,"resizeTarget",null);h(this,"resizeNum",0);h(this,"isResizing",!1);h(this,"offsetX",0);h(this,"resizeDiff",0);h(this,"columnIndex",0);h(this,"isMouseDown",!1);h(this,"columns");h(this,"visibleLeafColumns",[]);h(this,"visibleHeight",0);h(this,"visibleWidth",0);h(this,"allCellHeaders",[]);h(this,"leafCellHeaders",[]);h(this,"renderLeafCellHeaders",[]);h(this,"fixedLeftCellHeaders",[]);h(this,"centerCellHeaders",[]);h(this,"fixedRightCellHeaders",[]);h(this,"renderCenterCellHeaders",[]);h(this,"renderFixedCellHeaders",[]);this.ctx=t,this.ctx.on("resetHeader",Ye(()=>{this.init(),this.ctx.emit("draw")},100)),this.init(),this.initResizeColumn()}init(){const{config:{HEADER_HEIGHT:t,SCROLLER_TRACK_SIZE:e}}=this.ctx,i=this.ctx.database.getColumns();this.columns=i,this.allCellHeaders=[],this.leafCellHeaders=[],this.fixedLeftCellHeaders=[],this.fixedRightCellHeaders=[],this.centerCellHeaders=[];const s=Vt(i),o=Ot(i);this.height=t*s,this.width=o.reduce((f,d)=>f+((d==null?void 0:d.width)||100),0),this.visibleHeight=this.height;const r=We(zt(i,s));this.columnIndex=0,this.resizeNum=0,this.render(r,0),this.ctx.database.updateColIndexKeyMap(this.leafCellHeaders);const a=this.ctx.targetContainer.getBoundingClientRect();if(this.resizeNum>0?this.ctx.target.width=a.width:this.ctx.target.width=this.width+e-1,this.visibleWidth=this.ctx.target.width-e,this.resizeNum){const f=this.visibleWidth-this.width,d=Math.floor(f/this.resizeNum*100)/100;this.resizeAllColumn(d)}const l=this.fixedLeftCellHeaders.filter(f=>!f.hasChildren);this.ctx.fixedLeftWidth=l.reduce((f,d)=>f+d.width,0);const c=this.fixedRightCellHeaders.filter(f=>!f.hasChildren);this.ctx.fixedRightWidth=c.reduce((f,d)=>f+d.width,e),this.ctx.maxColIndex=this.leafCellHeaders.length-1,this.ctx.header.x=this.x,this.ctx.header.y=this.y,this.ctx.header.width=this.width,this.ctx.header.height=this.height,this.ctx.header.visibleWidth=this.visibleWidth,this.ctx.header.visibleHeight=this.visibleHeight}initResizeColumn(){const{config:{ENABLE_RESIZE_COLUMN:t}}=this.ctx;t&&(this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetX=e.offsetX,this.resizeTarget?(this.isResizing=!0,this.ctx.columnResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeColumn(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.isResizing=!1,this.ctx.columnResizing=!1,this.offsetX=0}),this.ctx.on("mousemove",e=>{if(this.ctx.editing)return;const{target:i,config:{RESIZE_COLUMN_MIN_WIDTH:s}}=this.ctx;if(this.isResizing&&this.resizeTarget){const o=this.resizeTarget.width;let r=e.offsetX-this.offsetX;r+o<s&&(r=-(o-s)),this.resizeDiff=r,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown)return;this.ctx.target.style.cursor==="col-resize"&&(this.ctx.target.style.cursor="default");const o=[...this.renderFixedCellHeaders,...this.renderCenterCellHeaders];for(const r of o){const a=e.layerX,l=r.getDrawX();a>l+r.width-5&&a<l+r.width+4&&a<i.width-4&&r.colspan<=1&&e.target instanceof HTMLCanvasElement&&this.ctx.isTarget(e.target)&&e.layerY<=this.height&&(this.ctx.target.style.cursor="col-resize",this.resizeTarget=r)}}}))}resizeColumn(t,e){const i=o=>{o.forEach(r=>{if(r.children&&r.children.length>0&&i(r.children),r.key===t.key){const a=r.width||100;r.width=a+e}})};i(this.columns),this.ctx.database.setColumns(this.columns),this.init(),this.ctx.emit("draw");let s=0;if(this.width<this.visibleWidth){const o=this.visibleWidth-this.width;s=Math.floor(o/this.resizeNum*100)/100,this.resizeAllColumn(s),this.ctx.emit("draw")}this.ctx.emit("resizeColumnChange",{colIndex:t.colIndex,key:t.key,oldWidth:t.width,width:t.width+e+s,column:t.column,columns:this.columns})}resizeAllColumn(t){if(t===0)return;const e=new Map;let i=!0;for(const o of this.allCellHeaders)if(o.widthFillDisable)e.set(o.key,o.width);else{const r=o.width+t*o.colspan;e.set(o.key,r),r<this.ctx.config.RESIZE_COLUMN_MIN_WIDTH&&(i=!1)}if(!i)return;const s=o=>{o.forEach(r=>{e.has(r.key)&&(r.width=e.get(r.key)),r.children&&r.children.length>0&&s(r.children)})};s(this.columns),this.ctx.database.setColumns(this.columns),this.init()}render(t,e){const i=t.length;let s=e;const{HEADER_HEIGHT:o=0}=this.ctx.config;for(let r=0;r<i;r++){const a=t[r],l=o*(a.rowspan||1),c=o*a.level;let f=a.width||100;a.children&&(f=Ot(a.children).reduce((u,y)=>u+((y==null?void 0:y.width)||100),0));const d=new Gt(this.ctx,this.columnIndex,s,c,f,l,a);this.ctx.database.setHeader(a.key,d),this.allCellHeaders.push(d),a.children||(this.leafCellHeaders.push(d),d.column.widthFillDisable||this.resizeNum++),a.fixed==="left"?this.fixedLeftCellHeaders.push(d):a.fixed==="right"?this.fixedRightCellHeaders.push(d):this.centerCellHeaders.push(d),!a.children&&this.columnIndex++,a.children&&this.render(a.children,s),s+=f}}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,config:{RESIZE_COLUMN_LINE_COLOR:e}}=this.ctx,i=this.resizeTarget.getDrawX(),s=this.resizeTarget.width,o=i+s+this.resizeDiff-.5,r=[o+.5,0,o+.5,t.height];this.ctx.paint.drawLine(r,{borderColor:e,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<Math.floor(s.width-s.visibleWidth-1)&&e!==a){const l=s.width-(this.x+this.width)+o.width-e;this.ctx.paint.drawShadow(l+1,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}update(){const t=[],e=[],i=[];this.centerCellHeaders.forEach(s=>{s.isHorizontalVisible()&&s.isVerticalVisible()&&(e.push(s),s.hasChildren||t.push(s))}),this.fixedLeftCellHeaders.forEach(s=>{i.push(s),s.hasChildren||t.push(s)}),this.fixedRightCellHeaders.forEach(s=>{i.push(s),s.hasChildren||t.push(s)}),this.renderCenterCellHeaders=e,this.renderFixedCellHeaders=i,this.renderLeafCellHeaders=t.sort((s,o)=>s.x-o.x),this.visibleLeafColumns=this.renderLeafCellHeaders.map(s=>s.column),this.ctx.header.visibleLeafColumns=this.visibleLeafColumns,this.ctx.header.leafCellHeaders=this.leafCellHeaders,this.ctx.header.renderLeafCellHeaders=this.renderLeafCellHeaders,this.ctx.header.renderCellHeaders=this.renderFixedCellHeaders.concat(this.renderCenterCellHeaders)}draw(){this.renderCenterCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawFiexShadow(),this.renderFixedCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawTipLine()}}class Ut{constructor(t,e,i=0,s=0,o=0,r=0,a,l="body"){h(this,"ctx");h(this,"x",0);h(this,"y",0);h(this,"width",0);h(this,"height");h(this,"cells",[]);h(this,"fixedCells",[]);h(this,"noFixedCells",[]);h(this,"rowIndex",0);h(this,"rowKey","");h(this,"rowType","body");h(this,"data");this.ctx=t,this.x=i,this.y=s,this.width=o,this.height=r,this.rowIndex=e,this.rowKey=t.database.getRowKeyForRowIndex(e),this.rowType=l,this.data=a,this.update()}update(){const{header:t}=this.ctx,e=[],i=[],s=[];t.renderLeafCellHeaders.forEach(o=>{const r=new qt(this.ctx,this.rowIndex,o.colIndex,o.x,this.y,o.width,this.height,o.column,this.data,this.rowType);r.fixed?i.push(r):s.push(r),e.push(r)}),this.cells=e,this.fixedCells=i,this.noFixedCells=s}drawCenter(){this.noFixedCells.forEach(t=>{t.draw()})}drawFixed(){this.fixedCells.forEach(t=>{t.draw()})}draw(){this.noFixedCells.forEach(t=>{t.draw()}),this.fixedCells.forEach(t=>{t.draw()})}}class ti{constructor(t){h(this,"resizeTarget",null);h(this,"isMouseDown",!1);h(this,"resizeDiff",0);h(this,"offsetY",0);h(this,"ctx");h(this,"x",0);h(this,"y",0);h(this,"width",0);h(this,"height",0);h(this,"headIndex",0);h(this,"tailIndex",0);h(this,"isResizing",!1);h(this,"renderRows",[]);h(this,"visibleRows",[]);h(this,"visibleHeight",0);h(this,"visibleWidth",0);h(this,"data",[]);this.ctx=t,this.init(),this.initResizeRow()}init(){const{target:t,header:e,database:i,config:{FOOTER_FIXED:s,SCROLLER_TRACK_SIZE:o=0,BORDER_COLOR:r,BORDER_RADIUS:a,HEIGHT:l,EMPTY_BODY_HEIGHT:c=0,MAX_HEIGHT:f=0,ENABLE_OFFSET_HEIGHT:d=0,OFFSET_HEIGHT:x=0}}=this.ctx;if(!e.width)return;this.x=0,this.y=e.height;const{data:u,sumHeight:y}=i.getData();this.height=y,this.data=u;const{top:g}=t.getBoundingClientRect();this.width=e.width,this.visibleWidth=t.width-o;const w=this.ctx.footer.height;this.data.length||(this.height=c);const p=this.data.length?"not-empty":"empty";this.ctx.emit("emptyChange",{isEmpty:p,type:p,headerHeight:e.height,bodyHeight:this.height,footerHeight:w,width:this.width,height:this.data.length?0:c+w});let E=this.height+e.height+o;E+=w;let m=0;this.data.length&&d?(m=window.innerHeight-g-x,m<0&&(m=32,console.error("There is an error in the height calculation ENABLE_OFFSET_HEIGHT and OFFSET_HEIGHT are invalid"))):this.data.length&&l?m=l:this.data.length&&f&&E>f?m=f:m=E,m>0&&(this.ctx.target.height=m);let b=t.height-e.height-o;s?this.visibleHeight=b-w:this.visibleHeight=b,this.ctx.body.x=this.x,this.ctx.body.y=this.y,this.ctx.body.width=this.width,this.ctx.body.height=this.height,this.ctx.body.visibleWidth=this.visibleWidth,this.ctx.body.visibleHeight=this.visibleHeight,this.ctx.body.data=u,this.ctx.target.setAttribute("style",`outline: none; position: relative; border-radius: ${a}px; border: 1px solid ${r}; height:${this.ctx.target.height}px;width:${this.ctx.target.width-1}px;`)}initResizeRow(){const{config:{ENABLE_RESIZE_ROW:t}}=this.ctx;t&&(this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeRow(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.resizeDiff=0,this.isResizing=!1,this.ctx.rowResizing=!1,this.offsetY=0}),this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetY=e.offsetY,this.resizeTarget?(this.isResizing=!0,this.ctx.rowResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mousemove",e=>{if(this.ctx.editing)return;const i=e.offsetY,s=e.offsetX,{target:o,scrollY:r,config:{RESIZE_ROW_MIN_HEIGHT:a=0}}=this.ctx;if(this.isResizing&&this.resizeTarget){const l=this.resizeTarget.height;let c=i-this.offsetY;c+l<a&&(c=-(l-a)),this.resizeDiff=c,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown||this.ctx.target.style.cursor==="crosshair")return;this.ctx.target.style.cursor==="row-resize"&&(this.ctx.target.style.cursor="default");for(let l=0;l<this.renderRows.length;l++){const c=this.renderRows[l];if(i>c.y-r+c.height-1.5&&i<c.y-r+c.height+1.5&&i<o.height-4)for(let d=0;d<c.cells.length;d++){const x=c.cells[d];s>x.drawX+10&&s<x.drawX+x.width-10&&x.rowspan===1&&(this.ctx.target.style.cursor="row-resize",this.resizeTarget=c)}}}}))}resizeRow(t,e){const{rowIndex:i,height:s,rowKey:o,data:r}=t;this.ctx.database.setRowHeight(i,s+e),this.init(),this.ctx.emit("draw"),this.ctx.emit("resizeRowChange",{rowIndex:i,oldHeight:s,height:s+e,rowKey:o,row:r,data:this.data})}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,scrollY:e,config:{RESIZE_ROW_LINE_COLOR:i}}=this.ctx,s=this.resizeTarget.y-e,o=this.resizeTarget.height,r=s+o+this.resizeDiff-.5,a=[0,r+.5,t.width,r+.5];this.ctx.paint.drawLine(a,{borderColor:i,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<Math.floor(s.width-s.visibleWidth-1)&&e!==a){const l=s.width-(this.x+this.width)+o.width-e;this.ctx.paint.drawShadow(l+1,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}binarySearch(t,e){let i=0,s=t.length-1,o=-1;for(;i<=s;){let r=Math.floor((i+s)/2),a=t[r].bottom;if(a===e)return r;a<e?i=r+1:(o=r,s=r-1)}return o}update(){this.init();const{header:t,database:e,scrollY:i}=this.ctx,s=i,{data:o,positions:r}=e.getData();this.ctx.maxRowIndex=o.length-1;const a=this.binarySearch(r,s);let l=this.binarySearch(r,s+this.visibleHeight);l===-1&&(l=o.length),this.headIndex=Math.max(0,a),this.tailIndex=Math.min(this.ctx.maxRowIndex,l+1),this.visibleRows=o.slice(this.headIndex,this.tailIndex+1),this.ctx.body.headIndex=this.headIndex,this.ctx.body.tailIndex=this.tailIndex,this.ctx.body.visibleRows=this.visibleRows;const c=[];for(let f=0;f<this.visibleRows.length;f++){const d=this.headIndex+f,x=this.visibleRows[f],{height:u,top:y}=this.ctx.database.getPositionForRowIndex(d),g=new Ut(this.ctx,d,0,y+this.y,t.width,u,x);c.push(g)}this.renderRows=c,this.ctx.body.renderRows=c}draw(){this.renderRows.forEach(t=>{t.drawCenter()}),this.drawFiexShadow(),this.renderRows.forEach(t=>{t.drawFixed()}),this.drawTipLine()}}class ei{constructor(t){h(this,"ctx");h(this,"renderRows",[]);h(this,"data",[]);h(this,"x",0);h(this,"y",0);h(this,"width",0);h(this,"height",0);h(this,"visibleWidth",0);h(this,"visibleHeight",0);this.ctx=t,this.init()}init(){this.data=this.ctx.database.getFooterData();const{header:t,body:e,config:{CELL_FOOTER_HEIGHT:i,FOOTER_FIXED:s,SCROLLER_TRACK_SIZE:o}}=this.ctx;this.width=t.width,this.visibleWidth=t.visibleWidth,this.height=this.data.reduce(r=>r+i,0),this.visibleHeight=this.height,s?this.y=this.ctx.target.height-this.height-o:this.y=e.y+e.height,this.ctx.footer.x=this.x,this.ctx.footer.y=this.y,this.ctx.footer.height=this.height,this.ctx.footer.width=this.width,this.ctx.footer.visibleWidth=this.visibleWidth,this.ctx.footer.visibleHeight=this.visibleHeight}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;let l=this.y;if(this.ctx.config.FOOTER_FIXED||(l=this.y-this.ctx.scrollY),i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,l,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<Math.floor(s.width-s.visibleWidth-1)&&e!==a){const c=s.width-(this.x+this.width)+o.width-e;this.ctx.paint.drawShadow(c+1,l,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}update(){this.init();const{CELL_FOOTER_HEIGHT:t}=this.ctx.config;let e=this.y;const i=[];this.data.forEach((s,o)=>{const r=new Ut(this.ctx,o,0,e,this.width,t,s,"footer");e+=t,i.push(r)}),this.renderRows=i,this.ctx.footer.renderRows=this.renderRows}draw(){this.renderRows.forEach(t=>{t.drawCenter()}),this.drawFiexShadow(),this.renderRows.forEach(t=>{t.drawFixed()})}}class ii{constructor(t){h(this,"isCut",!1);h(this,"isMultipleRow",!1);h(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellHoverChange",t=>{if(!this.ctx.autofillMove){if(["index-selection","selection","index"].includes(t.type)){this.selectRows(t,!1);return}this.isMultipleRow||this.mouseenter()}}),this.ctx.on("cellMousedown",(t,e)=>{if(this.ctx.isTarget(e.target)&&this.ctx.target.style.cursor!=="pointer"&&!this.ctx.isPointer&&this.ctx.target.style.cursor!=="crosshair"){if(["index-selection","selection","index"].includes(t.type)){this.isMultipleRow=!0,this.selectRows(t);return}this.isMultipleRow=!1,this.click(e.shiftKey)}}),this.ctx.on("cellHeaderHoverChange",t=>{this.ctx.mousedown&&this.selectCols(t)}),this.ctx.on("cellHeaderMousedown",t=>{this.ctx.target.style.cursor!=="pointer"&&(this.ctx.isPointer||this.selectCols(t))}),this.ctx.on("keydown",t=>{if(t.ctrlKey&&t.code==="KeyV"||t.metaKey&&t.code==="KeyV"){this.paste();return}if(t.ctrlKey&&t.code==="KeyC"||t.metaKey&&t.code==="KeyC"){t.preventDefault(),this.copy(),this.isCut=!1;return}if(t.ctrlKey&&t.code==="KeyX"||t.metaKey&&t.code==="KeyX"){t.preventDefault(),this.isCut=!0,this.copy();return}if((t.ctrlKey&&t.code==="KeyA"||t.metaKey&&t.code==="KeyA")&&(t.preventDefault(),this.selectAll()),t.code==="ArrowLeft"){t.preventDefault(),this.moveFocus("LEFT");return}if(t.code==="ArrowUp"){t.preventDefault(),this.moveFocus("TOP");return}if(t.code==="ArrowRight"||t.code==="Tab"){t.preventDefault(),this.moveFocus("RIGHT");return}if(t.code==="ArrowDown"){t.preventDefault(),this.moveFocus("BOTTOM");return}if(t.code==="Delete"||t.code==="Backspace"){t.preventDefault();const{xArr:e,yArr:i}=this.ctx.selector;this.clearSelectedData(e,i);return}})}setSelector(t,e){const{ENABLE_SELECTOR_SPAN_COL:i,ENABLE_SELECTOR_SPAN_ROW:s}=this.ctx.config;let o=t,r=e;if(!s){const[a]=r;r=[a,a]}if(!i){const[a]=o;o=[a,a]}(JSON.stringify(this.ctx.selector.xArr)!==JSON.stringify(o)||JSON.stringify(this.ctx.selector.yArr)!==JSON.stringify(r))&&(this.ctx.selector.enable=!0,this.ctx.selector.xArr=o,this.ctx.selector.yArr=r,this.ctx.emit("setSelector",this.ctx.selector),this.ctx.emit("draw"))}selectCols(t){if(this.ctx.columnResizing||this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_ROWS)return;if(["index","index-selection","selection"].includes(t.type)){this.selectAll();return}const e=0,i=this.ctx.maxRowIndex;if(this.ctx.mousedown&&this.ctx.focusCellHeader){const{colIndex:s}=this.ctx.focusCellHeader;if(t.colIndex>=s){const o=[s,t.colIndex+t.colspan-1],r=[e,i];this.setSelector(o,r)}else{const o=[t.colIndex,s],r=[e,i];this.setSelector(o,r)}}else{const s=[t.colIndex,t.colIndex+t.colspan-1],o=[e,i];this.setSelector(s,o)}}selectAll(){const{ENABLE_SELECTOR_ALL_ROWS:t,ENABLE_SELECTOR_ALL_COLS:e}=this.ctx.config;if(t&&e){const s=this.ctx.maxColIndex,o=0,r=this.ctx.maxRowIndex,a=[1,s],l=[o,r];this.setSelector(a,l)}}selectRows(t,e=!0){if(this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_COLS)return;const i=this.ctx.maxColIndex,s=t.colIndex+1;if(e){this.ctx.setFocusCell(t);const o=[s,i],r=[t.rowIndex,t.rowIndex];this.setSelector(o,r)}if(this.ctx.focusCell&&this.ctx.mousedown){const{rowIndex:o}=this.ctx.focusCell;if(t.rowIndex>=o){const r=[s,i],a=[o,t.rowIndex];this.setSelector(r,a)}else{const r=[s,i],a=[t.rowIndex,o];this.setSelector(r,a)}}}mouseenter(){if(this.ctx.config.ENABLE_SELECTOR_SINGLE)return;const{mousedown:t,focusCell:e,hoverCell:i}=this.ctx;if(t&&e&&i){const{rowIndex:s,colIndex:o}=e,r=Math.min(i.colIndex,o),a=Math.max(i.colIndex,o),l=Math.min(i.rowIndex,s),c=Math.max(i.rowIndex,s),f=[r,a],d=[l,c];this.setSelector(f,d)}}click(t=!1){const{focusCell:e,clickCell:i}=this.ctx;if(e)if(this.ctx.selector.enable=!0,i&&t){const{colIndex:s,rowIndex:o}=i,{colIndex:r,rowIndex:a}=e,l=Math.min(r,s),c=Math.max(r,s),f=Math.min(a,o),d=Math.max(a,o),x=[l,c],u=[f,d];this.setSelector(x,u)}else{this.ctx.emit("cellSelectedClick",e);const s=[e.colIndex,e.colIndex],o=[e.rowIndex,e.rowIndex];this.setSelector(s,o),this.adjustBoundaryPosition()}}clearCopyLine(){this.ctx.selector.xArrCopy=[-1,-1],this.ctx.selector.yArrCopy=[-1,-1]}getCell(t,e){const i=this.ctx.body.renderRows.find(o=>o.rowIndex===t);return i==null?void 0:i.cells.find(o=>o.colIndex===e)}copy(){if(!this.ctx.config.ENABLE_COPY)return;const{text:t}=this.ctx.getSelectedData();navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{this.ctx.selector.xArrCopy=this.ctx.selector.xArr.slice(),this.ctx.selector.yArrCopy=this.ctx.selector.yArr.slice(),this.ctx.emit("setCopy",this.ctx.selector),this.ctx.emit("draw")}).catch(e=>console.error("复制失败：",e)):console.error("当前浏览器不支持Clipboard API")}clearSelectedData(t,e,i=!1){let s=[];const o=new Set;for(let a=0;a<=e[1]-e[0];a++)for(let l=0;l<=t[1]-t[0];l++){const c=a+e[0],f=l+t[0],d=this.ctx.database.getItemValueForRowIndexAndColIndex(c,f);if(d){const{rowKey:x,key:u}=d;this.ctx.database.getReadonly(x,u)||(o.add(x),s.push({rowKey:x,key:u,value:null,row:{}}))}}if(!s.length)return[];if(i)return s;this.ctx.database.batchSetItemValue(s,!0);let r=[];return o.forEach(a=>{r.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("clearSelectedDataChange",s,r),this.ctx.emit("draw"),s}paste(){if(!navigator.clipboard){console.error("当前浏览器不支持Clipboard API");return}const{ENABLE_PASTER:t}=this.ctx.config;if(this.ctx.selector.enable&&t){const e=this.ctx.selector.yArr[0],i=this.ctx.selector.xArr[0],s=new Set;navigator.clipboard.readText().then(o=>{let r=[];const a=o.split("\r");a.length===1?r=a[0].split(`
`).map(d=>d.split("	")):r=a.map(f=>f.split("	"));let l=[];for(let f=0;f<=r.length-1;f++){const d=r[f].length;for(let x=0;x<=d-1;x++){const u=f+e,y=x+i,g=r[f][x],w=this.ctx.database.getItemValueForRowIndexAndColIndex(u,y);if(w){const{rowKey:p,key:E}=w;this.ctx.database.getReadonly(p,E)||(s.add(p),l.push({rowKey:p,key:E,value:g,row:{}}))}}}if(this.isCut){const f=this.clearSelectedData(this.ctx.selector.xArrCopy,this.ctx.selector.yArrCopy,!0),d=l.map(x=>`${x.rowKey}-${x.key}`);f.forEach(x=>{d.includes(`${x.rowKey}-${x.key}`)||l.unshift(x)}),this.isCut=!1}if(!l.length)return;this.ctx.database.batchSetItemValue(l,!0);let c=[];s.forEach(f=>{c.push(this.ctx.database.getRowDataItemForRowKey(f))}),this.ctx.emit("pasteChange",l,c),this.clearCopyLine(),this.ctx.emit("draw")}).catch(o=>{console.error("获取剪贴板内容失败：",o)})}}moveFocus(t){if(this.ctx.editing)return;const{focusCell:e}=this.ctx;if(!e)return;let{colIndex:i=0,rowIndex:s=0}=e;const o=0,r=0,a=this.ctx.maxColIndex,l=this.ctx.maxRowIndex;switch(t){case"LEFT":i>o&&i--;break;case"TOP":s>r&&s--;break;case"RIGHT":i<a&&i++;break;case"BOTTOM":s<l&&s++;break}const c=[i,i],f=[s,s],d=this.getCell(s,i);if(d){if(["index","index-selection","selection"].includes(d.type))return;this.ctx.setFocusCell(d)}this.setSelector(c,f),this.adjustBoundaryPosition(),this.ctx.emit("draw")}adjustBoundaryPosition(){const{target:t,focusCell:e,fixedRightWidth:i,fixedLeftWidth:s,header:o,footer:r,scrollX:a,scrollY:l}=this.ctx;if(!e)return;const{SCROLLER_TRACK_SIZE:c=0,FOOTER_FIXED:f}=this.ctx.config;let d=0;f&&(d=r.visibleHeight);const x=s-e.drawX+1,u=e.drawX+e.width-(t.width-i)+1,y=o.height-e.drawY,g=e.drawY+e.height-(t.height-d-c);u>0&&!e.fixed?this.ctx.setScrollX(a+u):x>0&&!e.fixed&&this.ctx.setScrollX(a-x),y>0?this.ctx.setScrollY(l-y):g>0&&this.ctx.setScrollY(l+g)}destroy(){}}class si{constructor(t){h(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellMouseenter",(t,e)=>{this.ctx.target.style.cursor==="crosshair"&&(this.ctx.target.style.cursor="default");const{xArr:i,yArr:s}=this.ctx.selector,o=i[1],r=s[1],{colIndex:a,rowIndex:l,drawX:c,drawY:f,width:d,height:x}=t;if(this.ctx.config.ENABLE_AUTOFILL&&a===o&&l===r){const y=c+d-6,g=f+x-6;e.offsetX>y&&e.offsetY>g&&(this.ctx.target.style.cursor="crosshair")}this.mouseenter(t)}),this.ctx.on("cellMousedown",()=>{this.ctx.target.style.cursor==="crosshair"&&this.setMousedown()}),this.ctx.on("mouseup",()=>{this.setMouseUp()})}isAutofillIng(){const{xArr:t,yArr:e}=this.ctx.selector;return!(JSON.stringify(this.ctx.autofill.xArr)===JSON.stringify(t)&&JSON.stringify(this.ctx.autofill.yArr)===JSON.stringify(e))}setMousedown(){this.ctx.autofill.enable=!0,this.ctx.autofillMove=!0}setMouseUp(){if(!this.ctx.autofill.enable)return;this.isAutofillIng()&&this.autofillData(),this.ctx.autofill.enable=!1,this.ctx.autofillMove=!1,this.ctx.autofill.xArr=[-1,-1],this.ctx.autofill.yArr=[-1,-1]}setAutofill(t,e){const{ENABLE_AUTOFILL:i,ENABLE_SELECTOR_SPAN_COL:s,ENABLE_SELECTOR_SPAN_ROW:o}=this.ctx.config;if(!i)return;let r=t,a=e;if(!o){const[l]=a;a=[l,l]}if(!s){const[l]=r;r=[l,l]}(JSON.stringify(this.ctx.autofill.xArr)!==JSON.stringify(r)||JSON.stringify(this.ctx.autofill.yArr)!==JSON.stringify(a))&&(this.ctx.autofill.xArr=r,this.ctx.autofill.yArr=a,this.ctx.emit("setAutofill",this.ctx.autofill),this.ctx.emit("draw"))}autofillData(){const t=new Set,e=this.ctx.getSelectedData(),i=new Map;for(let d=0;d<=e.yArr[1]-e.yArr[0];d++)for(let x=0;x<=e.xArr[1]-e.xArr[0];x++){const u=d+e.yArr[0],y=x+e.xArr[0];i.set(`${u}-${y}`,!0)}const{value:s}=e,o=s[0].length,r=s.length,a=this.ctx.autofill.xArr,l=this.ctx.autofill.yArr;let c=[];for(let d=0;d<=l[1]-l[0];d++)for(let x=0;x<=a[1]-a[0];x++){const u=x+a[0],y=d+l[0],g=s[d%r][x%o],w=this.ctx.database.getItemValueForRowIndexAndColIndex(y,u),p=`${y}-${u}`;if(w&&!i.has(p)){const{rowKey:E,key:m}=w;this.ctx.database.getReadonly(E,m)||(t.add(E),c.push({rowKey:E,key:m,value:g,row:{}}))}}if(!c.length)return;this.ctx.database.batchSetItemValue(c,!0);let f=[];t.forEach(d=>{f.push(this.ctx.database.getRowDataItemForRowKey(d))}),this.ctx.emit("autofillChange",c,f),this.ctx.selector.xArr=this.ctx.autofill.xArr,this.ctx.selector.yArr=this.ctx.autofill.yArr,this.ctx.emit("draw")}mouseenter(t){if(["index","selection","index-selection"].includes(t.type))return;const{selector:e,autofill:i}=this.ctx;if(this.ctx.mousedown&&e.enable&&i.enable){const{rowIndex:s,colIndex:o}=t,r=e.xArr.slice(),a=e.yArr.slice();s>=e.yArr[0]&&s<=e.yArr[1]?o>e.xArr[1]?r.splice(1,1,o):o<e.xArr[0]&&r.splice(0,1,o):s>e.yArr[1]?a.splice(1,1,s):s<e.yArr[0]&&a.splice(0,1,s),this.setAutofill(r,a)}}destroy(){}}const at=Math.min,Z=Math.max,ut=Math.round,V=n=>({x:n,y:n}),ri={left:"right",right:"left",bottom:"top",top:"bottom"},oi={start:"end",end:"start"};function _t(n,t,e){return Z(n,at(t,e))}function ht(n,t){return typeof n=="function"?n(t):n}function j(n){return n.split("-")[0]}function lt(n){return n.split("-")[1]}function Zt(n){return n==="x"?"y":"x"}function Tt(n){return n==="y"?"height":"width"}function J(n){return["top","bottom"].includes(j(n))?"y":"x"}function St(n){return Zt(J(n))}function ni(n,t,e){e===void 0&&(e=!1);const i=lt(n),s=St(n),o=Tt(s);let r=s==="x"?i===(e?"end":"start")?"right":"left":i==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(r=gt(r)),[r,gt(r)]}function ai(n){const t=gt(n);return[Lt(n),t,Lt(t)]}function Lt(n){return n.replace(/start|end/g,t=>oi[t])}function hi(n,t,e){const i=["left","right"],s=["right","left"],o=["top","bottom"],r=["bottom","top"];switch(n){case"top":case"bottom":return e?t?s:i:t?i:s;case"left":case"right":return t?o:r;default:return[]}}function li(n,t,e,i){const s=lt(n);let o=hi(j(n),e==="start",i);return s&&(o=o.map(r=>r+"-"+s),t&&(o=o.concat(o.map(Lt)))),o}function gt(n){return n.replace(/left|right|bottom|top/g,t=>ri[t])}function ci(n){return{top:0,right:0,bottom:0,left:0,...n}}function Jt(n){return typeof n!="number"?ci(n):{top:n,right:n,bottom:n,left:n}}function wt(n){const{x:t,y:e,width:i,height:s}=n;return{width:i,height:s,top:e,left:t,right:t+i,bottom:e+s,x:t,y:e}}function Qt(n,t,e){let{reference:i,floating:s}=n;const o=J(t),r=St(t),a=Tt(r),l=j(t),c=o==="y",f=i.x+i.width/2-s.width/2,d=i.y+i.height/2-s.height/2,x=i[a]/2-s[a]/2;let u;switch(l){case"top":u={x:f,y:i.y-s.height};break;case"bottom":u={x:f,y:i.y+i.height};break;case"right":u={x:i.x+i.width,y:d};break;case"left":u={x:i.x-s.width,y:d};break;default:u={x:i.x,y:i.y}}switch(lt(t)){case"start":u[r]-=x*(e&&c?-1:1);break;case"end":u[r]+=x*(e&&c?-1:1);break}return u}const di=async(n,t,e)=>{const{placement:i="bottom",strategy:s="absolute",middleware:o=[],platform:r}=e,a=o.filter(Boolean),l=await(r.isRTL==null?void 0:r.isRTL(t));let c=await r.getElementRects({reference:n,floating:t,strategy:s}),{x:f,y:d}=Qt(c,i,l),x=i,u={},y=0;for(let g=0;g<a.length;g++){const{name:w,fn:p}=a[g],{x:E,y:m,data:b,reset:v}=await p({x:f,y:d,initialPlacement:i,placement:x,strategy:s,middlewareData:u,rects:c,platform:r,elements:{reference:n,floating:t}});f=E??f,d=m??d,u={...u,[w]:{...u[w],...b}},v&&y<=50&&(y++,typeof v=="object"&&(v.placement&&(x=v.placement),v.rects&&(c=v.rects===!0?await r.getElementRects({reference:n,floating:t,strategy:s}):v.rects),{x:f,y:d}=Qt(c,x,l)),g=-1)}return{x:f,y:d,placement:x,strategy:s,middlewareData:u}};async function te(n,t){var e;t===void 0&&(t={});const{x:i,y:s,platform:o,rects:r,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:x=!1,padding:u=0}=ht(t,n),y=Jt(u),w=a[x?d==="floating"?"reference":"floating":d],p=wt(await o.getClippingRect({element:(e=await(o.isElement==null?void 0:o.isElement(w)))==null||e?w:w.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:f,strategy:l})),E=d==="floating"?{x:i,y:s,width:r.floating.width,height:r.floating.height}:r.reference,m=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),b=await(o.isElement==null?void 0:o.isElement(m))?await(o.getScale==null?void 0:o.getScale(m))||{x:1,y:1}:{x:1,y:1},v=wt(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:E,offsetParent:m,strategy:l}):E);return{top:(p.top-v.top+y.top)/b.y,bottom:(v.bottom-p.bottom+y.bottom)/b.y,left:(p.left-v.left+y.left)/b.x,right:(v.right-p.right+y.right)/b.x}}const fi=n=>({name:"arrow",options:n,async fn(t){const{x:e,y:i,placement:s,rects:o,platform:r,elements:a,middlewareData:l}=t,{element:c,padding:f=0}=ht(n,t)||{};if(c==null)return{};const d=Jt(f),x={x:e,y:i},u=St(s),y=Tt(u),g=await r.getDimensions(c),w=u==="y",p=w?"top":"left",E=w?"bottom":"right",m=w?"clientHeight":"clientWidth",b=o.reference[y]+o.reference[u]-x[u]-o.floating[y],v=x[u]-o.reference[u],R=await(r.getOffsetParent==null?void 0:r.getOffsetParent(c));let L=R?R[m]:0;(!L||!await(r.isElement==null?void 0:r.isElement(R)))&&(L=a.floating[m]||o.floating[y]);const A=b/2-v/2,k=L/2-g[y]/2-1,K=at(d[p],k),$=at(d[E],k),_=K,S=L-g[y]-$,T=L/2-g[y]/2+A,it=_t(_,T,S),W=!l.arrow&&lt(s)!=null&&T!==it&&o.reference[y]/2-(T<_?K:$)-g[y]/2<0,B=W?T<_?T-_:T-S:0;return{[u]:x[u]+B,data:{[u]:it,centerOffset:T-it-B,...W&&{alignmentOffset:B}},reset:W}}}),xi=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var e,i;const{placement:s,middlewareData:o,rects:r,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:f=!0,crossAxis:d=!0,fallbackPlacements:x,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:g=!0,...w}=ht(n,t);if((e=o.arrow)!=null&&e.alignmentOffset)return{};const p=j(s),E=J(a),m=j(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),v=x||(m||!g?[gt(a)]:ai(a)),R=y!=="none";!x&&R&&v.push(...li(a,g,y,b));const L=[a,...v],A=await te(t,w),k=[];let K=((i=o.flip)==null?void 0:i.overflows)||[];if(f&&k.push(A[p]),d){const T=ni(s,r,b);k.push(A[T[0]],A[T[1]])}if(K=[...K,{placement:s,overflows:k}],!k.every(T=>T<=0)){var $,_;const T=((($=o.flip)==null?void 0:$.index)||0)+1,it=L[T];if(it)return{data:{index:T,overflows:K},reset:{placement:it}};let W=(_=K.filter(B=>B.overflows[0]<=0).sort((B,q)=>B.overflows[1]-q.overflows[1])[0])==null?void 0:_.placement;if(!W)switch(u){case"bestFit":{var S;const B=(S=K.filter(q=>{if(R){const G=J(q.placement);return G===E||G==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(G=>G>0).reduce((G,Pi)=>G+Pi,0)]).sort((q,G)=>q[1]-G[1])[0])==null?void 0:S[0];B&&(W=B);break}case"initialPlacement":W=a;break}if(s!==W)return{reset:{placement:W}}}return{}}}};async function ui(n,t){const{placement:e,platform:i,elements:s}=n,o=await(i.isRTL==null?void 0:i.isRTL(s.floating)),r=j(e),a=lt(e),l=J(e)==="y",c=["left","top"].includes(r)?-1:1,f=o&&l?-1:1,d=ht(t,n);let{mainAxis:x,crossAxis:u,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(u=a==="end"?y*-1:y),l?{x:u*f,y:x*c}:{x:x*c,y:u*f}}const gi=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(t){var e,i;const{x:s,y:o,placement:r,middlewareData:a}=t,l=await ui(t,n);return r===((e=a.offset)==null?void 0:e.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:s+l.x,y:o+l.y,data:{...l,placement:r}}}}},wi=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:e,y:i,placement:s}=t,{mainAxis:o=!0,crossAxis:r=!1,limiter:a={fn:w=>{let{x:p,y:E}=w;return{x:p,y:E}}},...l}=ht(n,t),c={x:e,y:i},f=await te(t,l),d=J(j(s)),x=Zt(d);let u=c[x],y=c[d];if(o){const w=x==="y"?"top":"left",p=x==="y"?"bottom":"right",E=u+f[w],m=u-f[p];u=_t(E,u,m)}if(r){const w=d==="y"?"top":"left",p=d==="y"?"bottom":"right",E=y+f[w],m=y-f[p];y=_t(E,y,m)}const g=a.fn({...t,[x]:u,[d]:y});return{...g,data:{x:g.x-e,y:g.y-i,enabled:{[x]:o,[d]:r}}}}}};function pt(){return typeof window<"u"}function Q(n){return ee(n)?(n.nodeName||"").toLowerCase():"#document"}function M(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function Y(n){var t;return(t=(ee(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function ee(n){return pt()?n instanceof Node||n instanceof M(n).Node:!1}function F(n){return pt()?n instanceof Element||n instanceof M(n).Element:!1}function X(n){return pt()?n instanceof HTMLElement||n instanceof M(n).HTMLElement:!1}function ie(n){return!pt()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof M(n).ShadowRoot}function ct(n){const{overflow:t,overflowX:e,overflowY:i,display:s}=N(n);return/auto|scroll|overlay|hidden|clip/.test(t+i+e)&&!["inline","contents"].includes(s)}function pi(n){return["table","td","th"].includes(Q(n))}function yt(n){return[":popover-open",":modal"].some(t=>{try{return n.matches(t)}catch{return!1}})}function At(n){const t=Ht(),e=F(n)?N(n):n;return e.transform!=="none"||e.perspective!=="none"||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(e.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(e.contain||"").includes(i))}function yi(n){let t=z(n);for(;X(t)&&!tt(t);){if(At(t))return t;if(yt(t))return null;t=z(t)}return null}function Ht(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function tt(n){return["html","body","#document"].includes(Q(n))}function N(n){return M(n).getComputedStyle(n)}function mt(n){return F(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function z(n){if(Q(n)==="html")return n;const t=n.assignedSlot||n.parentNode||ie(n)&&n.host||Y(n);return ie(t)?t.host:t}function se(n){const t=z(n);return tt(t)?n.ownerDocument?n.ownerDocument.body:n.body:X(t)&&ct(t)?t:se(t)}function Dt(n,t,e){var i;t===void 0&&(t=[]),e===void 0&&(e=!0);const s=se(n),o=s===((i=n.ownerDocument)==null?void 0:i.body),r=M(s);if(o){const a=Mt(r);return t.concat(r,r.visualViewport||[],ct(s)?s:[],a&&e?Dt(a):[])}return t.concat(s,Dt(s,[],e))}function Mt(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function re(n){const t=N(n);let e=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const s=X(n),o=s?n.offsetWidth:e,r=s?n.offsetHeight:i,a=ut(e)!==o||ut(i)!==r;return a&&(e=o,i=r),{width:e,height:i,$:a}}function oe(n){return F(n)?n:n.contextElement}function et(n){const t=oe(n);if(!X(t))return V(1);const e=t.getBoundingClientRect(),{width:i,height:s,$:o}=re(t);let r=(o?ut(e.width):e.width)/i,a=(o?ut(e.height):e.height)/s;return(!r||!Number.isFinite(r))&&(r=1),(!a||!Number.isFinite(a))&&(a=1),{x:r,y:a}}const mi=V(0);function ne(n){const t=M(n);return!Ht()||!t.visualViewport?mi:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Ei(n,t,e){return t===void 0&&(t=!1),!e||t&&e!==M(n)?!1:t}function dt(n,t,e,i){t===void 0&&(t=!1),e===void 0&&(e=!1);const s=n.getBoundingClientRect(),o=oe(n);let r=V(1);t&&(i?F(i)&&(r=et(i)):r=et(n));const a=Ei(o,e,i)?ne(o):V(0);let l=(s.left+a.x)/r.x,c=(s.top+a.y)/r.y,f=s.width/r.x,d=s.height/r.y;if(o){const x=M(o),u=i&&F(i)?M(i):i;let y=x,g=Mt(y);for(;g&&i&&u!==y;){const w=et(g),p=g.getBoundingClientRect(),E=N(g),m=p.left+(g.clientLeft+parseFloat(E.paddingLeft))*w.x,b=p.top+(g.clientTop+parseFloat(E.paddingTop))*w.y;l*=w.x,c*=w.y,f*=w.x,d*=w.y,l+=m,c+=b,y=M(g),g=Mt(y)}}return wt({width:f,height:d,x:l,y:c})}function bi(n){let{elements:t,rect:e,offsetParent:i,strategy:s}=n;const o=s==="fixed",r=Y(i),a=t?yt(t.floating):!1;if(i===r||a&&o)return e;let l={scrollLeft:0,scrollTop:0},c=V(1);const f=V(0),d=X(i);if((d||!d&&!o)&&((Q(i)!=="body"||ct(r))&&(l=mt(i)),X(i))){const x=dt(i);c=et(i),f.x=x.x+i.clientLeft,f.y=x.y+i.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+f.x,y:e.y*c.y-l.scrollTop*c.y+f.y}}function Ci(n){return Array.from(n.getClientRects())}function kt(n,t){const e=mt(n).scrollLeft;return t?t.left+e:dt(Y(n)).left+e}function vi(n){const t=Y(n),e=mt(n),i=n.ownerDocument.body,s=Z(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),o=Z(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let r=-e.scrollLeft+kt(n);const a=-e.scrollTop;return N(i).direction==="rtl"&&(r+=Z(t.clientWidth,i.clientWidth)-s),{width:s,height:o,x:r,y:a}}function Ri(n,t){const e=M(n),i=Y(n),s=e.visualViewport;let o=i.clientWidth,r=i.clientHeight,a=0,l=0;if(s){o=s.width,r=s.height;const c=Ht();(!c||c&&t==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:o,height:r,x:a,y:l}}function Ii(n,t){const e=dt(n,!0,t==="fixed"),i=e.top+n.clientTop,s=e.left+n.clientLeft,o=X(n)?et(n):V(1),r=n.clientWidth*o.x,a=n.clientHeight*o.y,l=s*o.x,c=i*o.y;return{width:r,height:a,x:l,y:c}}function ae(n,t,e){let i;if(t==="viewport")i=Ri(n,e);else if(t==="document")i=vi(Y(n));else if(F(t))i=Ii(t,e);else{const s=ne(n);i={...t,x:t.x-s.x,y:t.y-s.y}}return wt(i)}function he(n,t){const e=z(n);return e===t||!F(e)||tt(e)?!1:N(e).position==="fixed"||he(e,t)}function Oi(n,t){const e=t.get(n);if(e)return e;let i=Dt(n,[],!1).filter(a=>F(a)&&Q(a)!=="body"),s=null;const o=N(n).position==="fixed";let r=o?z(n):n;for(;F(r)&&!tt(r);){const a=N(r),l=At(r);!l&&a.position==="fixed"&&(s=null),(o?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||ct(r)&&!l&&he(n,r))?i=i.filter(f=>f!==r):s=a,r=z(r)}return t.set(n,i),i}function _i(n){let{element:t,boundary:e,rootBoundary:i,strategy:s}=n;const r=[...e==="clippingAncestors"?yt(t)?[]:Oi(t,this._c):[].concat(e),i],a=r[0],l=r.reduce((c,f)=>{const d=ae(t,f,s);return c.top=Z(d.top,c.top),c.right=at(d.right,c.right),c.bottom=at(d.bottom,c.bottom),c.left=Z(d.left,c.left),c},ae(t,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Ti(n){const{width:t,height:e}=re(n);return{width:t,height:e}}function Si(n,t,e){const i=X(t),s=Y(t),o=e==="fixed",r=dt(n,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=V(0);if(i||!i&&!o)if((Q(t)!=="body"||ct(s))&&(a=mt(t)),i){const u=dt(t,!0,o,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else s&&(l.x=kt(s));let c=0,f=0;if(s&&!i&&!o){const u=s.getBoundingClientRect();f=u.top+a.scrollTop,c=u.left+a.scrollLeft-kt(s,u)}const d=r.left+a.scrollLeft-l.x-c,x=r.top+a.scrollTop-l.y-f;return{x:d,y:x,width:r.width,height:r.height}}function Ft(n){return N(n).position==="static"}function le(n,t){if(!X(n)||N(n).position==="fixed")return null;if(t)return t(n);let e=n.offsetParent;return Y(n)===e&&(e=e.ownerDocument.body),e}function ce(n,t){const e=M(n);if(yt(n))return e;if(!X(n)){let s=z(n);for(;s&&!tt(s);){if(F(s)&&!Ft(s))return s;s=z(s)}return e}let i=le(n,t);for(;i&&pi(i)&&Ft(i);)i=le(i,t);return i&&tt(i)&&Ft(i)&&!At(i)?e:i||yi(n)||e}const Li=async function(n){const t=this.getOffsetParent||ce,e=this.getDimensions,i=await e(n.floating);return{reference:Si(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function Ai(n){return N(n).direction==="rtl"}const Hi={convertOffsetParentRelativeRectToViewportRelativeRect:bi,getDocumentElement:Y,getClippingRect:_i,getOffsetParent:ce,getElementRects:Li,getClientRects:Ci,getDimensions:Ti,getScale:et,isElement:F,isRTL:Ai},Di=gi,Mi=wi,ki=xi,Fi=fi,Ni=(n,t,e)=>{const i=new Map,s={platform:Hi,...e},o={...s.platform,_c:i};return di(n,t,{...s,platform:o})};let Ki=class{constructor(t){h(this,"ctx");h(this,"enable",!1);h(this,"contentEl");h(this,"floatingEl");h(this,"arrowEl");this.ctx=t;const{TOOLTIP_BG_COLOR:e,TOOLTIP_TEXT_COLOR:i,TOOLTIP_ZINDEX:s,TOOLTIP_CUSTOM_STYLE:o,CSS_PREFIX:r}=this.ctx.config;this.contentEl=document.createElement("div"),this.arrowEl=document.createElement("div"),this.floatingEl=document.createElement("div"),this.floatingEl.className=`${r}-tooltip`,this.contentEl.className=`${r}-tooltip-content`,this.arrowEl.className=`${r}-tooltip-arrow`;const a={display:"none",position:"absolute",background:e,color:i,boxSizing:"border-box",zIndex:s,padding:"8px",borderRadius:"4px",fontSize:"12px",...o},l={position:"absolute",width:"10px",height:"10px",background:a.background,backgroundColor:a.backgroundColor,transform:"rotate(45deg)",zIndex:a.zIndex};Object.assign(this.arrowEl.style,l),Object.assign(this.floatingEl.style,a),this.floatingEl.appendChild(this.contentEl),this.floatingEl.appendChild(this.arrowEl),this.ctx.targetContainer.appendChild(this.floatingEl),this.init()}init(){this.ctx.on("mousemove",t=>{const e=this.ctx.target.getBoundingClientRect();e&&(t.clientX<e.x||t.clientX>e.x+e.width||t.clientY<e.y||t.clientY>e.y+e.height)&&this.hide()}),this.ctx.on("startEdit",()=>{this.hide()}),this.ctx.on("visibleCellHoverChange",t=>{(t.ellipsis||t.message)&&this.show(t)}),this.ctx.on("visibleCellMouseleave",()=>{this.hide()})}show(t){if(!t.overflowTooltipShow||this.ctx.mousedown)return;this.floatingEl.style.display="block";let e=t.getText();t.message&&(e=t.message);const i=this.ctx.target.getBoundingClientRect();if(!i)return;this.enable=!0,this.contentEl.style.maxWidth=`${t.overflowTooltipMaxWidth||500}px`,this.contentEl.style.width="100%",this.contentEl.style.display="inline-block",this.contentEl.style.wordBreak="break-all",this.contentEl.style.lineHeight="1.5",this.contentEl.innerText=e;const s=t.drawX+i.x,o=t.drawY+i.y;Ni({getBoundingClientRect(){return{width:t.visibleWidth,height:t.visibleHeight,x:s,y:o,left:s,right:s+t.visibleWidth,top:o,bottom:o+t.visibleHeight}}},this.floatingEl,{placement:t.overflowTooltipPlacement,middleware:[Mi(),ki(),Di(6),Fi({element:this.arrowEl})]}).then(a=>{const{x:l,y:c,placement:f,middlewareData:d}=a;if(Object.assign(this.floatingEl.style,{top:`${c}px`,left:`${l}px`}),d.arrow){const x=d.arrow;["left","left-start","left-end"].includes(f)?Object.assign(this.arrowEl.style,{top:`${x.y}px`,bottom:"",left:"",right:"-5px"}):["right","right-start","right-end"].includes(f)?Object.assign(this.arrowEl.style,{top:`${x.y}px`,bottom:"",left:"-5px",right:""}):["bottom","bottom-start","bottom-end"].includes(f)?Object.assign(this.arrowEl.style,{top:"-5px",bottom:"",left:`${x.x}px`,right:""}):["top","top-start","top-end"].includes(f)&&Object.assign(this.arrowEl.style,{top:"",bottom:"-5px",left:`${x.x}px`,right:""})}})}hide(){this.enable&&(this.enable=!1,this.floatingEl.style.display="none")}destroy(){this.contentEl.remove(),this.arrowEl.remove(),this.floatingEl.remove()}};class Xi{constructor(t){h(this,"editorEl");h(this,"inputEl");h(this,"enable",!1);h(this,"cellTarget",null);h(this,"ctx");this.ctx=t,this.initTextEditor(),this.init()}init(){this.ctx.on("onScroll",()=>{var t;this.enable&&((t=this.cellTarget)==null?void 0:t.editorType)!=="text"&&this.doneEdit()}),this.ctx.on("cellHeaderMousedown",()=>{var t;this.enable&&((t=this.cellTarget)==null?void 0:t.editorType)!=="text"&&this.doneEdit()}),this.ctx.on("keydown",t=>{const e=t.key,i=t.ctrlKey,s=t.altKey,o=t.shiftKey,r=t.metaKey;if(!(i||s||o||r||["Escape","Tab","Backspace","Delete","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown","Insert","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"].includes(e))){if(t.code==="Enter"&&!this.enable){t.preventDefault(),this.startEdit();return}this.startEdit()}}),this.ctx.on("cellClick",t=>{var e,i;t.rowKey===((e=this.cellTarget)==null?void 0:e.rowKey)&&t.key===((i=this.cellTarget)==null?void 0:i.key)?this.startEdit():(this.doneEdit(),this.cellTarget=t,this.ctx.config.ENABLE_EDIT_SINGLE_CLICK&&this.startEdit())})}initTextEditor(){const{CSS_PREFIX:t,SELECT_BORDER_COLOR:e}=this.ctx.config;this.inputEl=document.createElement("div"),this.inputEl.addEventListener("keydown",r=>{this.enable&&(r.code==="Enter"||r.code==="Escape")&&(r.preventDefault(),this.inputEl.blur())}),this.inputEl.addEventListener("blur",()=>{this.doneEdit()}),this.editorEl=document.createElement("div"),this.editorEl.className=`${t}-self-editor`,this.inputEl.className=`${t}-self-editor-input`;const i={position:"absolute",top:"-10000px",left:"-10000px",textAlign:"left",lineHeight:"0",zIndex:100,overflow:"hidden",backgroundColor:"#fff",border:`2px solid ${e}`,boxSizing:"border-box",boxShadow:"rgba(0, 0, 0, 0.2) 0px 6px 16px",pointerEvents:"auto",display:"flex",alignItems:"center"};Object.assign(this.editorEl.style,i);const s={width:"100%",boxSizing:"border-box",padding:"8px",outline:"none",fontWeight:"400",fontSize:"12px",color:"inherit",whiteSpace:"normal",wordWrap:"break-word",wordBreak:"break-all",lineHeight:"18px",margin:"0",background:"#fff",cursor:"text"};Object.assign(this.inputEl.style,s);const o=navigator.userAgent.toLowerCase().includes("firefox");this.inputEl.contentEditable=o?"true":"plaintext-only",this.editorEl.appendChild(this.inputEl),this.ctx.targetContainer.appendChild(this.editorEl)}startEditByInput(t){if(t.editorType!=="text")return;const e=t.getValue(),{width:i,height:s}=t,o=t.getDrawX(),r=t.getDrawY(),{CELL_PADDING:a}=this.ctx.config;this.editorEl.style.left=`${o}px`,this.editorEl.style.top=`${r}px`,this.inputEl.style.minWidth=`${i-1}px`,this.inputEl.style.minHeight=`${s-1}px`,this.inputEl.style.padding=`${a}px`,e!==null&&(this.inputEl.innerText=e),this.inputEl.focus();const l=window.getSelection();l==null||l.selectAllChildren(this.inputEl),l==null||l.collapseToEnd()}doneEditByInput(){if(!this.cellTarget||this.cellTarget.editorType!=="text")return;const{rowKey:t,key:e}=this.cellTarget,i=this.cellTarget.getValue(),s=this.inputEl.textContent;s!==i&&!(s===""&&i===null)&&this.ctx.database.setItemValue(t,e,s,!0,!0,!0),this.inputEl.textContent=null,this.editorEl.style.left="-10000px",this.editorEl.style.top="-10000px"}startEdit(){const t=this.ctx.focusCell;if(!t||["index","index-selection","selection"].includes(t.type)||this.enable)return;const{rowKey:e,key:i}=t,s=this.ctx.database.getReadonly(e,i);t&&!s&&(this.enable=!0,this.ctx.editing=!0,this.cellTarget=t,this.startEditByInput(this.cellTarget),this.ctx.emit("startEdit",this.cellTarget))}doneEdit(){this.enable&&this.cellTarget&&(this.ctx.emit("doneEdit",this.cellTarget),this.doneEditByInput(),this.enable=!1,this.ctx.target.focus(),this.ctx.editing=!1,this.cellTarget=null,this.ctx.emit("draw"))}destroy(){}}class Bi{constructor(t){h(this,"ctx");h(this,"emptyEl");this.ctx=t;const{EMPTY_TEXT:e,EMPTY_CUSTOM:i,EMPTY_CUSTOM_STYLE:s,CSS_PREFIX:o}=this.ctx.config;this.emptyEl=document.createElement("div"),this.emptyEl.className=`${o}-empty`,this.emptyEl.style.display="none",this.emptyEl.innerText=e,this.ctx.targetContainer.appendChild(this.emptyEl),this.ctx.on("emptyChange",({type:r,headerHeight:a,bodyHeight:l,footerHeight:c})=>{if(i)return;const f=a+(l+c)/2,d={display:r==="empty"?"block":"none",position:"absolute",fontSize:"14px",color:"#666",left:"50%",top:`${f}px`,transform:"translate(-50%, -50%)",...s};Object.assign(this.emptyEl.style,d)})}destroy(){this.emptyEl.remove()}}class Yi{constructor(t){h(this,"ctx");this.ctx=t}draw(){const t=this.getContainer();this.ctx.emit("overlayerChange",t)}getContainer(){const{target:t,config:{SCROLLER_TRACK_SIZE:e}}=this.ctx,i=t.width-e,s=t.height-e,o=this.getHeader(),r=this.getBody(),a=this.getFooter();let l=[o,r,a];const{FOOTER_FIXED:c}=this.ctx.config;return c||(l=[o,r]),{style:{position:"absolute",left:"0px",top:"0px",pointerEvents:"none",overflow:"hidden",width:`${i}px`,height:`${s}px`},views:l}}getHeader(){const{fixedLeftWidth:t,fixedRightWidth:e,config:{SCROLLER_TRACK_SIZE:i,CSS_PREFIX:s}}=this.ctx,{visibleWidth:o,visibleHeight:r,renderCellHeaders:a}=this.ctx.header;let l=[],c=[],f=[];a.forEach(w=>{w.render&&(w.fixed==="left"?c.push(w):w.fixed==="right"?f.push(w):l.push(w))});const d=e-i,x={key:"left",style:{position:"absolute",top:`${.5}px`,left:`${.5}px`,overflow:"hidden",width:`${t}px`,height:`${r}px`},cells:c},u={key:"center",style:{position:"absolute",top:`${.5}px`,left:`${t}px`,overflow:"hidden",width:`${o-t-d}px`,height:`${r}px`},cells:l},y={key:"right",style:{position:"absolute",top:`${.5}px`,right:`${.5}px`,overflow:"hidden",width:`${d}px`,height:`${r}px`},cells:f};return{type:"header",class:`${s}-overlayer-header`,style:{position:"relative",overflow:"hidden",width:`${o}px`,height:`${r}px`},views:[x,u,y]}}getBody(){const t=[],e=[],i=[];let s=this.ctx.body.renderRows;this.ctx.config.FOOTER_FIXED||(s=s.concat(this.ctx.footer.renderRows)),s.forEach(w=>{w.cells.forEach(p=>{p.cellType==="footer"&&(p.render=p.renderFooter),p.render&&(p.fixed==="left"?e.push(p):p.fixed==="right"?i.push(p):t.push(p))})});const{fixedLeftWidth:o,fixedRightWidth:r,config:{SCROLLER_TRACK_SIZE:a,CSS_PREFIX:l}}=this.ctx,{visibleWidth:c,visibleHeight:f}=this.ctx.body,d=r-a,x={key:"left",style:{position:"absolute",top:`${.5}px`,left:`${.5}px`,overflow:"hidden",width:`${o}px`,height:`${f}px`},cells:e},u={key:"center",style:{position:"absolute",top:`${.5}px`,left:`${o+.5}px`,overflow:"hidden",width:`${c-o-d}px`,height:`${f}px`},cells:t},y={key:"right",style:{position:"absolute",top:"0px",right:"0px",overflow:"hidden",width:`${d}px`,height:`${f}px`},cells:i};return{type:"body",class:`${l}-overlayer-body`,style:{position:"relative",overflow:"hidden",width:`${c}px`,height:`${f}px`},views:[x,u,y]}}getFooter(){const t=[],e=[],i=[];this.ctx.footer.renderRows.forEach(g=>{g.cells.forEach(w=>{w.cellType==="footer"&&w.renderFooter&&(w.render=w.renderFooter,w.fixed==="left"?e.push(w):w.fixed==="right"?i.push(w):t.push(w))})});const{fixedLeftWidth:s,fixedRightWidth:o,config:{SCROLLER_TRACK_SIZE:r,CSS_PREFIX:a}}=this.ctx,{visibleWidth:l,visibleHeight:c}=this.ctx.footer,f=o-r,d={key:"left",style:{position:"absolute",top:`${.5}px`,left:`${.5}px`,overflow:"hidden",width:`${s}px`,height:`${c}px`},cells:e},x={key:"center",style:{position:"absolute",top:`${.5}px`,left:`${s+.5}px`,overflow:"hidden",width:`${l-s-f}px`,height:`${c}px`},cells:t},u={key:"right",style:{position:"absolute",top:`${.5}px`,right:`${.5}px`,overflow:"hidden",width:`${f}px`,height:`${c}px`},cells:i};return{type:"footer",class:`${a}-overlayer-footer`,style:{position:"relative",overflow:"hidden",width:`${l}px`,height:`${c}px`},views:[d,x,u]}}}class Wi{constructor(t,e){h(this,"targetContainer");h(this,"target");h(this,"scroller");h(this,"header");h(this,"body");h(this,"footer");h(this,"selector");h(this,"autofill");h(this,"tooltip");h(this,"editor");h(this,"empty");h(this,"overlayer");h(this,"ctx");this.target=document.createElement("canvas"),this.targetContainer=t,this.targetContainer.style.position="relative",this.targetContainer.appendChild(this.target),this.ctx=new Ze(this.targetContainer,this.target,e),this.header=new Qe(this.ctx),this.body=new ti(this.ctx),this.footer=new ei(this.ctx),this.scroller=new Je(this.ctx),this.selector=new ii(this.ctx),this.autofill=new si(this.ctx),this.tooltip=new Ki(this.ctx),this.empty=new Bi(this.ctx),this.editor=new Xi(this.ctx),this.overlayer=new Yi(this.ctx),this.ctx.on("draw",this.draw.bind(this)),this.draw()}draw(){requestAnimationFrame(()=>{this.header.update(),this.footer.update(),this.body.update(),this.ctx.paint.clear(),this.body.draw(),this.footer.draw(),this.header.draw(),this.scroller.draw(),this.overlayer.draw()})}loadConfig(t){}loadColumns(t){this.editor.doneEdit(),this.ctx.database.setColumns(t),this.header.init(),this.ctx.emit("draw")}loadData(t){this.editor.doneEdit(),this.ctx.database.setData(t),this.ctx.emit("draw")}loadFooterData(t){this.ctx.database.setFooterData(t),this.ctx.emit("draw")}setLoading(t){this.ctx.database.setLoading(t)}on(t,e){this.ctx.on(t,e)}off(t,e){this.ctx.off(t,e)}filterMethod(t){this.ctx.setScrollY(0),this.ctx.setScrollX(0),this.ctx.database.init(),this.ctx.database.setFilterMethod(t),this.ctx.emit("draw")}setItemValue(t,e,i,s=!0,o=!0,r=!1){this.ctx.database.setItemValue(t,e,i,s,o,r)}batchSetItemValue(t,e=!0,i=!0){this.ctx.database.batchSetItemValue(t,e),i&&this.ctx.emit("draw")}setItemValueByEditor(t,e,i,s=!0,o=!0){this.ctx.database.setItemValue(t,e,i,s,o,!0),this.editor.doneEdit()}doLayout(){this.ctx.emit("draw")}getChangedData(){return this.ctx.database.getChangedData()}getChangedRows(){return this.ctx.database.getChangedRows()}clearValidate(){this.ctx.database.clearValidate(),this.ctx.emit("draw")}async validate(t=!0){return this.editor.doneEdit(),new Promise(async(e,i)=>{try{const s=await this.getValidations();e(s)}catch(s){if(t&&Array.isArray(s)&&s.length){const[o]=s;if(Array.isArray(o)&&o.length){const[r]=o,{rowKey:a,key:l}=r;this.scrollToRowkey(a),this.scrollToColkey(l)}}i(s)}})}setValidations(t){if(t.forEach(e=>{const{rowIndex:i,key:s,message:o}=e;this.ctx.database.setValidationErrorByRowIndex(i,s,o)}),t&&Array.isArray(t)&&t.length){const[e]=t;if(e&&e.rowIndex>=0&&e.key){const{rowIndex:i,key:s}=e;this.scrollToRowIndex(i),this.scrollToColkey(s)}}}getValidations(){return new Promise(async(t,e)=>{const i=this.ctx.database.getAllRowsData(),s=this.ctx.header.leafCellHeaders;let o=[];for(let r=0;r<i.length;r++)for(let a=0;a<s.length;a++){const l=this.ctx.database.getRowKeyByItem(i[r]),f=s[a].key,d=await this.ctx.database.getValidator(l,f);Array.isArray(d)&&d.length&&o.push(d)}o.length?(e(o),this.ctx.emit("draw")):(t([]),this.ctx.emit("draw"))})}scrollTo(t,e){this.scrollXTo(t),this.scrollYTo(e)}scrollXTo(t){this.ctx.setScrollX(t)}scrollToColkey(t){this.scroller.scrollToColkey(t)}scrollToRowkey(t){this.scroller.scrollToRowKey(t)}scrollToColIndex(t){this.scroller.scrollToColIndex(t)}scrollToRowIndex(t){this.scroller.scrollToRowIndex(t)}scrollYTo(t){this.ctx.setScrollY(t)}clearSelection(){this.ctx.database.clearSelection(),this.ctx.emit("draw")}toggleRowSelection(t){const e=this.ctx.database.getRowKeyByItem(t);this.ctx.database.toggleRowSelection(e),this.ctx.emit("draw")}setSelectionByRows(t,e=!0){t.forEach(i=>{const s=this.ctx.database.getRowKeyByItem(i);this.ctx.database.setRowSelection(s,e)}),this.ctx.emit("selectionChange",this.getSelectionRows()),this.ctx.emit("draw")}setSelectionByRowKeys(t,e=!0){t.forEach(i=>{this.ctx.database.setRowSelection(i,e)}),this.ctx.emit("selectionChange",this.getSelectionRows()),this.ctx.emit("draw")}toggleAllSelection(){this.ctx.database.toggleAllSelection(),this.ctx.emit("draw")}getSelectionRows(){return this.ctx.database.getSelectionRows()}getPositionForRowIndex(t){return this.ctx.database.getPositionForRowIndex(t)}destroy(){this.empty.destroy(),this.editor.destroy(),this.tooltip.destroy(),this.selector.destroy(),this.autofill.destroy(),this.ctx.destroy(),this.target.remove(),console.log("销毁")}}return Wi});
//# sourceMappingURL=index.umd.js.map
