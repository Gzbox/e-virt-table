(function(_,O){typeof exports=="object"&&typeof module<"u"?module.exports=O():typeof define=="function"&&define.amd?define(O):(_=typeof globalThis<"u"?globalThis:_||self,_.EVirtTable=O())})(this,function(){"use strict";var oe=Object.defineProperty;var ne=(_,O,D)=>O in _?oe(_,O,{enumerable:!0,configurable:!0,writable:!0,value:D}):_[O]=D;var n=(_,O,D)=>ne(_,typeof O!="symbol"?O+"":O,D);function _(){return _=Object.assign?Object.assign.bind():function(d){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(d[i]=e[i])}return d},_.apply(this,arguments)}function O(d,t){d.prototype=Object.create(t.prototype),d.prototype.constructor=d,k(d,t)}function D(d){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(d)}function k(d,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},k(d,t)}function dt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function W(d,t,e){return dt()?W=Reflect.construct.bind():W=function(s,o,r){var a=[null];a.push.apply(a,o);var h=Function.bind.apply(s,a),c=new h;return r&&k(c,r.prototype),c},W.apply(null,arguments)}function ft(d){return Function.toString.call(d).indexOf("[native code]")!==-1}function P(d){var t=typeof Map=="function"?new Map:void 0;return P=function(i){if(i===null||!ft(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(i))return t.get(i);t.set(i,s)}function s(){return W(i,arguments,D(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),k(s,i)},P(d)}var xt=/%[sdj%]/g,J=function(){};typeof process<"u"&&process.env&&process.env.NODE_ENV!=="production"&&typeof window<"u"&&typeof document<"u"&&(J=function(t,e){typeof console<"u"&&console.warn&&typeof ASYNC_VALIDATOR_NO_WARNING>"u"&&e.every(function(i){return typeof i=="string"})&&console.warn(t,e)});function q(d){if(!d||!d.length)return null;var t={};return d.forEach(function(e){var i=e.field;t[i]=t[i]||[],t[i].push(e)}),t}function L(d){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];var s=0,o=e.length;if(typeof d=="function")return d.apply(null,e);if(typeof d=="string"){var r=d.replace(xt,function(a){if(a==="%%")return"%";if(s>=o)return a;switch(a){case"%s":return String(e[s++]);case"%d":return Number(e[s++]);case"%j":try{return JSON.stringify(e[s++])}catch{return"[Circular]"}break;default:return a}});return r}return d}function gt(d){return d==="string"||d==="url"||d==="hex"||d==="email"||d==="date"||d==="pattern"}function R(d,t){return!!(d==null||t==="array"&&Array.isArray(d)&&!d.length||gt(t)&&typeof d=="string"&&!d)}function ut(d,t,e){var i=[],s=0,o=d.length;function r(a){i.push.apply(i,a||[]),s++,s===o&&e(i)}d.forEach(function(a){t(a,r)})}function Q(d,t,e){var i=0,s=d.length;function o(r){if(r&&r.length){e(r);return}var a=i;i=i+1,a<s?t(d[a],o):e([])}o([])}function wt(d){var t=[];return Object.keys(d).forEach(function(e){t.push.apply(t,d[e]||[])}),t}var tt=function(d){O(t,d);function t(e,i){var s;return s=d.call(this,"Async Validation Error")||this,s.errors=e,s.fields=i,s}return t}(P(Error));function yt(d,t,e,i,s){if(t.first){var o=new Promise(function(x,w){var p=function(u){return i(u),u.length?w(new tt(u,q(u))):x(s)},g=wt(d);Q(g,e,p)});return o.catch(function(x){return x}),o}var r=t.firstFields===!0?Object.keys(d):t.firstFields||[],a=Object.keys(d),h=a.length,c=0,f=[],l=new Promise(function(x,w){var p=function(y){if(f.push.apply(f,y),c++,c===h)return i(f),f.length?w(new tt(f,q(f))):x(s)};a.length||(i(f),x(s)),a.forEach(function(g){var y=d[g];r.indexOf(g)!==-1?Q(y,e,p):ut(y,e,p)})});return l.catch(function(x){return x}),l}function pt(d){return!!(d&&d.message!==void 0)}function mt(d,t){for(var e=d,i=0;i<t.length;i++){if(e==null)return e;e=e[t[i]]}return e}function et(d,t){return function(e){var i;return d.fullFields?i=mt(t,d.fullFields):i=t[e.field||d.fullField],pt(e)?(e.field=e.field||d.fullField,e.fieldValue=i,e):{message:typeof e=="function"?e():e,fieldValue:i,field:e.field||d.fullField}}}function it(d,t){if(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];typeof i=="object"&&typeof d[e]=="object"?d[e]=_({},d[e],i):d[e]=i}}return d}var st=function(t,e,i,s,o,r){t.required&&(!i.hasOwnProperty(t.field)||R(e,r||t.type))&&s.push(L(o.messages.required,t.fullField))},Et=function(t,e,i,s,o){(/^\s+$/.test(e)||e==="")&&s.push(L(o.messages.whitespace,t.fullField))},z,bt=function(){if(z)return z;var d="[a-fA-F\\d:]",t=function(b){return b&&b.includeBoundaries?"(?:(?<=\\s|^)(?="+d+")|(?<="+d+")(?=\\s|$))":""},e="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",s=(`
(?:
(?:`+i+":){7}(?:"+i+`|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:`+i+":){6}(?:"+e+"|:"+i+`|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:`+i+":){5}(?::"+e+"|(?::"+i+`){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:`+i+":){4}(?:(?::"+i+"){0,1}:"+e+"|(?::"+i+`){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:`+i+":){3}(?:(?::"+i+"){0,2}:"+e+"|(?::"+i+`){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:`+i+":){2}(?:(?::"+i+"){0,3}:"+e+"|(?::"+i+`){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:`+i+":){1}(?:(?::"+i+"){0,4}:"+e+"|(?::"+i+`){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::`+i+"){0,5}:"+e+"|(?::"+i+`){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`).replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp("(?:^"+e+"$)|(?:^"+s+"$)"),r=new RegExp("^"+e+"$"),a=new RegExp("^"+s+"$"),h=function(b){return b&&b.exact?o:new RegExp("(?:"+t(b)+e+t(b)+")|(?:"+t(b)+s+t(b)+")","g")};h.v4=function(m){return m&&m.exact?r:new RegExp(""+t(m)+e+t(m),"g")},h.v6=function(m){return m&&m.exact?a:new RegExp(""+t(m)+s+t(m),"g")};var c="(?:(?:[a-z]+:)?//)",f="(?:\\S+(?::\\S*)?@)?",l=h.v4().source,x=h.v6().source,w="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",p="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",y="(?::\\d{2,5})?",u='(?:[/?#][^\\s"]*)?',C="(?:"+c+"|www\\.)"+f+"(?:localhost|"+l+"|"+x+"|"+w+p+g+")"+y+u;return z=new RegExp("(?:^"+C+"$)","i"),z},rt={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},B={integer:function(t){return B.number(t)&&parseInt(t,10)===t},float:function(t){return B.number(t)&&!B.integer(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch{return!1}},date:function(t){return typeof t.getTime=="function"&&typeof t.getMonth=="function"&&typeof t.getYear=="function"&&!isNaN(t.getTime())},number:function(t){return isNaN(t)?!1:typeof t=="number"},object:function(t){return typeof t=="object"&&!B.array(t)},method:function(t){return typeof t=="function"},email:function(t){return typeof t=="string"&&t.length<=320&&!!t.match(rt.email)},url:function(t){return typeof t=="string"&&t.length<=2048&&!!t.match(bt())},hex:function(t){return typeof t=="string"&&!!t.match(rt.hex)}},Ct=function(t,e,i,s,o){if(t.required&&e===void 0){st(t,e,i,s,o);return}var r=["integer","float","array","regexp","object","method","email","number","date","url","hex"],a=t.type;r.indexOf(a)>-1?B[a](e)||s.push(L(o.messages.types[a],t.fullField,t.type)):a&&typeof e!==t.type&&s.push(L(o.messages.types[a],t.fullField,t.type))},vt=function(t,e,i,s,o){var r=typeof t.len=="number",a=typeof t.min=="number",h=typeof t.max=="number",c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=e,l=null,x=typeof e=="number",w=typeof e=="string",p=Array.isArray(e);if(x?l="number":w?l="string":p&&(l="array"),!l)return!1;p&&(f=e.length),w&&(f=e.replace(c,"_").length),r?f!==t.len&&s.push(L(o.messages[l].len,t.fullField,t.len)):a&&!h&&f<t.min?s.push(L(o.messages[l].min,t.fullField,t.min)):h&&!a&&f>t.max?s.push(L(o.messages[l].max,t.fullField,t.max)):a&&h&&(f<t.min||f>t.max)&&s.push(L(o.messages[l].range,t.fullField,t.min,t.max))},F="enum",It=function(t,e,i,s,o){t[F]=Array.isArray(t[F])?t[F]:[],t[F].indexOf(e)===-1&&s.push(L(o.messages[F],t.fullField,t[F].join(", ")))},Rt=function(t,e,i,s,o){if(t.pattern){if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||s.push(L(o.messages.pattern.mismatch,t.fullField,e,t.pattern));else if(typeof t.pattern=="string"){var r=new RegExp(t.pattern);r.test(e)||s.push(L(o.messages.pattern.mismatch,t.fullField,e,t.pattern))}}},E={required:st,whitespace:Et,type:Ct,range:vt,enum:It,pattern:Rt},_t=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e,"string")&&!t.required)return i();E.required(t,e,s,r,o,"string"),R(e,"string")||(E.type(t,e,s,r,o),E.range(t,e,s,r,o),E.pattern(t,e,s,r,o),t.whitespace===!0&&E.whitespace(t,e,s,r,o))}i(r)},Ot=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&E.type(t,e,s,r,o)}i(r)},Lt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e===""&&(e=void 0),R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&(E.type(t,e,s,r,o),E.range(t,e,s,r,o))}i(r)},St=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&E.type(t,e,s,r,o)}i(r)},Ht=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),R(e)||E.type(t,e,s,r,o)}i(r)},At=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&(E.type(t,e,s,r,o),E.range(t,e,s,r,o))}i(r)},Tt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&(E.type(t,e,s,r,o),E.range(t,e,s,r,o))}i(r)},Dt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e==null&&!t.required)return i();E.required(t,e,s,r,o,"array"),e!=null&&(E.type(t,e,s,r,o),E.range(t,e,s,r,o))}i(r)},Mt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&E.type(t,e,s,r,o)}i(r)},Kt="enum",Ft=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o),e!==void 0&&E[Kt](t,e,s,r,o)}i(r)},Nt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e,"string")&&!t.required)return i();E.required(t,e,s,r,o),R(e,"string")||E.pattern(t,e,s,r,o)}i(r)},kt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e,"date")&&!t.required)return i();if(E.required(t,e,s,r,o),!R(e,"date")){var h;e instanceof Date?h=e:h=new Date(e),E.type(t,h,s,r,o),h&&E.range(t,h.getTime(),s,r,o)}}i(r)},Bt=function(t,e,i,s,o){var r=[],a=Array.isArray(e)?"array":typeof e;E.required(t,e,s,r,o,a),i(r)},G=function(t,e,i,s,o){var r=t.type,a=[],h=t.required||!t.required&&s.hasOwnProperty(t.field);if(h){if(R(e,r)&&!t.required)return i();E.required(t,e,s,a,o,r),R(e,r)||E.type(t,e,s,a,o)}i(a)},Xt=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(R(e)&&!t.required)return i();E.required(t,e,s,r,o)}i(r)},X={string:_t,method:Ot,number:Lt,boolean:St,regexp:Ht,integer:At,float:Tt,array:Dt,object:Mt,enum:Ft,pattern:Nt,date:kt,url:G,hex:G,email:G,required:Bt,any:Xt};function U(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}var Z=U(),Y=function(){function d(e){this.rules=null,this._messages=Z,this.define(e)}var t=d.prototype;return t.define=function(i){var s=this;if(!i)throw new Error("Cannot configure a schema with no rules");if(typeof i!="object"||Array.isArray(i))throw new Error("Rules must be an object");this.rules={},Object.keys(i).forEach(function(o){var r=i[o];s.rules[o]=Array.isArray(r)?r:[r]})},t.messages=function(i){return i&&(this._messages=it(U(),i)),this._messages},t.validate=function(i,s,o){var r=this;s===void 0&&(s={}),o===void 0&&(o=function(){});var a=i,h=s,c=o;if(typeof h=="function"&&(c=h,h={}),!this.rules||Object.keys(this.rules).length===0)return c&&c(null,a),Promise.resolve(a);function f(g){var y=[],u={};function C(b){if(Array.isArray(b)){var I;y=(I=y).concat.apply(I,b)}else y.push(b)}for(var m=0;m<g.length;m++)C(g[m]);y.length?(u=q(y),c(y,u)):c(null,a)}if(h.messages){var l=this.messages();l===Z&&(l=U()),it(l,h.messages),h.messages=l}else h.messages=this.messages();var x={},w=h.keys||Object.keys(this.rules);w.forEach(function(g){var y=r.rules[g],u=a[g];y.forEach(function(C){var m=C;typeof m.transform=="function"&&(a===i&&(a=_({},a)),u=a[g]=m.transform(u)),typeof m=="function"?m={validator:m}:m=_({},m),m.validator=r.getValidationMethod(m),m.validator&&(m.field=g,m.fullField=m.fullField||g,m.type=r.getType(m),x[g]=x[g]||[],x[g].push({rule:m,value:u,source:a,field:g}))})});var p={};return yt(x,h,function(g,y){var u=g.rule,C=(u.type==="object"||u.type==="array")&&(typeof u.fields=="object"||typeof u.defaultField=="object");C=C&&(u.required||!u.required&&g.value),u.field=g.field;function m(v,M){return _({},M,{fullField:u.fullField+"."+v,fullFields:u.fullFields?[].concat(u.fullFields,[v]):[v]})}function b(v){v===void 0&&(v=[]);var M=Array.isArray(v)?v:[v];!h.suppressWarning&&M.length&&d.warning("async-validator:",M),M.length&&u.message!==void 0&&(M=[].concat(u.message));var S=M.map(et(u,a));if(h.first&&S.length)return p[u.field]=1,y(S);if(!C)y(S);else{if(u.required&&!g.value)return u.message!==void 0?S=[].concat(u.message).map(et(u,a)):h.error&&(S=[h.error(u,L(h.messages.required,u.field))]),y(S);var K={};u.defaultField&&Object.keys(g.value).map(function(T){K[T]=u.defaultField}),K=_({},K,g.rule.fields);var N={};Object.keys(K).forEach(function(T){var H=K[T],V=Array.isArray(H)?H:[H];N[T]=V.map(m.bind(null,T))});var A=new d(N);A.messages(h.messages),g.rule.options&&(g.rule.options.messages=h.messages,g.rule.options.error=h.error),A.validate(g.value,g.rule.options||h,function(T){var H=[];S&&S.length&&H.push.apply(H,S),T&&T.length&&H.push.apply(H,T),y(H.length?H:null)})}}var I;if(u.asyncValidator)I=u.asyncValidator(u,g.value,b,g.source,h);else if(u.validator){try{I=u.validator(u,g.value,b,g.source,h)}catch(v){console.error==null||console.error(v),h.suppressValidatorError||setTimeout(function(){throw v},0),b(v.message)}I===!0?b():I===!1?b(typeof u.message=="function"?u.message(u.fullField||u.field):u.message||(u.fullField||u.field)+" fails"):I instanceof Array?b(I):I instanceof Error&&b(I.message)}I&&I.then&&I.then(function(){return b()},function(v){return b(v)})},function(g){f(g)},a)},t.getType=function(i){if(i.type===void 0&&i.pattern instanceof RegExp&&(i.type="pattern"),typeof i.validator!="function"&&i.type&&!X.hasOwnProperty(i.type))throw new Error(L("Unknown rule type %s",i.type));return i.type||"string"},t.getValidationMethod=function(i){if(typeof i.validator=="function")return i.validator;var s=Object.keys(i),o=s.indexOf("message");return o!==-1&&s.splice(o,1),s.length===1&&s[0]==="required"?X.required:X[this.getType(i)]||void 0},d}();Y.register=function(t,e){if(typeof e!="function")throw new Error("Cannot register a validator by type, validator is not a function");X[t]=e},Y.warning=J,Y.messages=Z,Y.validators=X;function $(){return"xxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(d){const t=Math.random()*16|0;return(d==="x"?t:t&3|8).toString(16)})}function ot(d){return d?d.map(t=>ot(t.children)+1).sort((t,e)=>e-t)[0]:0}function Yt(d=[]){let t=[],e=[],i=[];return d.forEach(s=>{s.fixed==="left"?t.push(s):s.fixed==="right"?i.push(s):e.push(s)}),[...t,...e,...i]}function nt(d=[],t=1,e=0){return d.map(i=>{if(i.children){let s=0,o=i.fixed;i.children.forEach(a=>{a.fixed=o});const r=nt(i.children,t-1,e+1);return r&&r.forEach(a=>{s+=a.colspan}),{...i,width:i.width,level:e,rowspan:1,colspan:s,children:r}}return{...i,level:e,rowspan:t,colspan:1}})}function j(d=[]){let t=[];return d.forEach(e=>{e.children?t=t.concat(j(e.children)):t.push(e)}),t}class Wt{constructor(t,e){n(this,"loading",!1);n(this,"ctx");n(this,"data");n(this,"columns");n(this,"footerData",[]);n(this,"rowKeyMap",new Map);n(this,"colIndexKeyMap",new Map);n(this,"headerMap",new Map);n(this,"rowIndexRowKeyMap",new Map);n(this,"checkboxKeyMap",new Map);n(this,"originalDataMap",new Map);n(this,"changedDataMap",new Map);n(this,"validationErrorMap",new Map);n(this,"itemRowKeyMap",new WeakMap);n(this,"bufferData",[]);n(this,"sumHeight",0);n(this,"filterMethod");n(this,"positions",[]);n(this,"renderHeaderCells",[]);n(this,"renderBodyCells",[]);n(this,"renderFooterCells",[]);this.ctx=t;const{data:i=[],columns:s=[],footerData:o=[]}=e;this.data=i,this.footerData=o,this.columns=s,this.setLoading(!0),this.init()}init(){this.clearBufferData(),this.rowKeyMap.clear(),this.checkboxKeyMap.clear(),this.headerMap.clear(),this.colIndexKeyMap.clear(),this.rowIndexRowKeyMap.clear(),this.originalDataMap.clear(),this.changedDataMap.clear(),this.validationErrorMap.clear(),this.itemRowKeyMap=new WeakMap,this.initData(this.data)}clearBufferData(){this.bufferData=[]}initData(t,e=0){t.forEach((i,s)=>{let o=!1;Array.isArray(i.children)&&(o=!0,this.initData(i.children,e+1));const{ROW_KEY:r="",DEFAULT_EXPAND_ALL:a,CELL_HEIGHT:h,SELECTABLE_METHOD:c,CHECKBOX_KEY:f}=this.ctx.config,l=i[r],x=l??$();this.itemRowKeyMap.set(i,x);const w=i._height||h,p=i._readonly;let g=!0;if(typeof c=="function"&&(g=c),f){const y=i[f];if(this.checkboxKeyMap.has(y)){const u=this.checkboxKeyMap.get(y);u.push(x),this.checkboxKeyMap.set(y,u)}else this.checkboxKeyMap.set(y,[x])}this.rowKeyMap.set(x,{readonly:p,index:s,rowIndex:s,level:e,height:w,check:!1,selectable:g,expand:a,expandLazy:!1,hasChildren:o,expandLoading:!1,item:i})})}setRowHeight(t,e){const i=this.rowIndexRowKeyMap.get(t),s=this.rowKeyMap.get(i);s.height=e,s.item._height=e,this.clearBufferData()}getAllRowsData(){let t=[];const e=i=>{i.forEach(s=>{t.push(s),Array.isArray(s.children)&&e(s.children)})};return e(this.data),t}getColumns(){return this.columns}setColumns(t){this.columns=t,this.clearBufferData()}setData(t){this.data=t,this.columns.length&&this.init()}getData(){if(this.bufferData.length>0)return{data:this.bufferData,sumHeight:this.sumHeight,positions:this.positions};let t=[],e=0;this.sumHeight=0,this.positions=[];const i=o=>{o.forEach(r=>{t.push(r);const a=this.itemRowKeyMap.get(r),{expand:h,hasChildren:c,height:f}=this.rowKeyMap.get(a),l=this.sumHeight;this.sumHeight+=f,this.rowIndexRowKeyMap.set(e,a),this.positions.push({top:l,height:f,bottom:this.sumHeight}),e+=1,h&&c&&i(r.children)})};this.rowIndexRowKeyMap.clear();let s=this.data;return typeof this.filterMethod=="function"&&(s=this.filterMethod(s)),i(s),this.bufferData=t,{data:t,sumHeight:this.sumHeight,positions:this.positions}}setFooterData(t){this.footerData=t}getFooterData(){return this.footerData}setFilterMethod(t){this.filterMethod=t}clearFilterMethod(){this.filterMethod=void 0}expandItem(t,e=!1){const i=this.rowKeyMap.get(t);i.expand=e,this.clearBufferData(),this.ctx.emit("draw")}expandAll(t){this.rowKeyMap.forEach(e=>{e.expand=t}),this.clearBufferData(),this.ctx.emit("draw")}expandLoading(t,e=!1){const i=this.rowKeyMap.get(t);i.expandLoading=e,this.clearBufferData(),this.ctx.emit("draw")}setExpandChildren(t,e){const i=this.rowKeyMap.get(t);i.expand=!0,i.expandLazy=!0,i.item.children=e,this.initData(i.item.children,i.level+1),this.clearBufferData()}getIsExpandLoading(t){return this.rowKeyMap.get(t).expandLoading}getIsExpandLazy(t){return this.rowKeyMap.get(t).expandLazy}getIsExpand(t){return this.rowKeyMap.get(t).expand}getRowForRowKey(t){return this.rowKeyMap.get(t)}getRowKeyForRowIndex(t){return this.rowIndexRowKeyMap.get(t)}getRowKeyByItem(t){return this.itemRowKeyMap.get(t)}getRowIndexForRowKey(t){return this.rowKeyMap.get(t).index}getItemValueForRowIndexAndColIndex(t,e){if(!(this.rowIndexRowKeyMap.has(t)&&this.colIndexKeyMap.get(e)))return null;const s=this.rowIndexRowKeyMap.get(t),o=this.colIndexKeyMap.get(e);return{rowKey:s,key:o,value:this.getItemValue(s,o)}}getItemValue(t,e){const i=this.rowKeyMap.get(t);return i&&i.item?i.item[e]===void 0?null:i.item[e]:null}batchSetItemValue(t,e=!1){let i=[];const s=new Set;t.forEach(a=>{const{value:h,rowKey:c,key:f}=a,{oldValue:l,newValue:x}=this.setItemValue(c,f,h);s.add(c),i.push({rowKey:c,key:f,oldValue:l,newValue:x})});let o=[];const r=i.map(a=>{const h=this.ctx.database.getRowDataItemForRowKey(a.rowKey);return{rowKey:a.rowKey,key:a.key,value:a.newValue,row:h}});return s.forEach(a=>{o.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("change",r,o),e&&this.ctx.history.pushState({changeList:i,type:"multiple"}),i}setItemValue(t,e,i,s=!1,o=!1,r=!1){if(!this.rowKeyMap.has(t))return{};const{item:a}=this.rowKeyMap.get(t);let h=a[e];if(this.ctx.database.getReadonly(t,e))return{oldValue:h,newValue:h};a[e]!==null&&typeof a[e]=="object"&&(h=JSON.parse(JSON.stringify(a[e])));const c=`${t}_${e}`;if(this.originalDataMap.has(c)||this.originalDataMap.set(c,h),this.changedDataMap.set(c,i),a[e]=i,r){const f=this.ctx.database.getRowDataItemForRowKey(t),l={rowKey:t,key:e,value:i,row:f};this.ctx.emit("change",[l],[f]),this.ctx.emit("editChange",{rowKey:t,key:e,oldValue:h,value:i,originalValue:this.originalDataMap.get(c),row:f})}return this.ctx.hasEvent("iterationChange")&&this.ctx.emit("iterationChange",{rowKey:t,key:e,oldValue:h,value:i,originalValue:this.originalDataMap.get(c),row:this.ctx.database.getRowDataItemForRowKey(t)}),s&&this.ctx.history.pushState({type:"single",changeList:[{rowKey:t,key:e,oldValue:h,newValue:i}]}),o&&this.ctx.emit("asyncDrawBody"),{oldValue:h,newValue:i}}getRowDataItemForRowKey(t){if(!this.rowKeyMap.has(t))return{};const{item:e}=this.rowKeyMap.get(t);return e}setRowSelectionByCheckboxKey(t,e){const{CHECKBOX_KEY:i}=this.ctx.config;if(i){if(!this.rowKeyMap.has(t))return!1;const{item:s}=this.rowKeyMap.get(t),o=s[i];this.checkboxKeyMap.has(o)&&this.checkboxKeyMap.get(o).forEach(a=>{const h=this.rowKeyMap.get(a);h.check=e})}}toggleRowSelection(t){const e=this.rowKeyMap.get(t);e.check=!e.check,this.setRowSelectionByCheckboxKey(t,e.check),this.ctx.emit("toggleRowSelection");const i=this.getSelectionRows();this.ctx.emit("selectionChange",i),this.ctx.emit("draw")}setRowSelection(t,e){const i=this.rowKeyMap.get(t);i.check=e,this.setRowSelectionByCheckboxKey(t,i.check);const s=this.getSelectionRows();this.ctx.emit("setRowSelection",s),this.ctx.emit("draw")}getSelectionRows(){let t=[];return this.rowKeyMap.forEach(e=>{e.check&&t.push(e.item)}),t}getRowSelection(t){const{check:e}=this.rowKeyMap.get(t);return e}getRowSelectable(t){const{selectable:e,item:i,rowIndex:s}=this.rowKeyMap.get(t);return typeof e=="function"?e({row:i,rowIndex:s}):e}toggleAllSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!0):i&&(e.check=!0)}),this.ctx.emit("toggleAllSelection");const t=this.getSelectionRows();this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}clearSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!1):i&&(e.check=!1)}),this.ctx.emit("clearSelection");const t=this.getSelectionRows();this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}getCheckedState(){let t=0,e=0;this.rowKeyMap.forEach(r=>{r.check&&(t+=1);const a=r.selectable;typeof a=="function"?a({row:r.item,rowIndex:r.rowIndex})&&(e+=1):a&&(e+=1)});const i=e&&e>t&&t>0;return{check:e&&e===t,indeterminate:i,selectable:e!==0}}updateColIndexKeyMap(t=[]){this.colIndexKeyMap.clear(),t.forEach(e=>{this.colIndexKeyMap.set(e.colIndex,e.key)})}getChangedData(){let t=[];return this.changedDataMap.forEach((e,i)=>{const s=this.originalDataMap.get(i),o=i.split("_")[0],r=i.split("_")[1];s!==e&&t.push({rowKey:o,colKey:r,originalValue:s,row:this.rowKeyMap.get(o),value:e})}),t}getChangedRows(){const t=new Set;this.changedDataMap.forEach((i,s)=>{const o=this.originalDataMap.get(s),r=s.split("_")[0];o!==i&&t.add(r)});let e=[];return t.forEach(i=>{e.push(this.ctx.database.getRowDataItemForRowKey(i))}),e}isHasChangedData(t,e){const i=`${t}_${e}`;if(!this.changedDataMap.has(i))return!1;const s=this.originalDataMap.get(i),o=this.changedDataMap.get(i);return s!==o}getPositionForRowIndex(t){return t<this.positions.length?this.positions[t]:{height:0,top:0,bottom:0}}setHeader(t,e){return t?(this.headerMap.set(t,e),!0):!1}getReadonly(t,e){const i=this.rowKeyMap.get(t),s=this.headerMap.get(e),o=i==null?void 0:i.readonly,r=s==null?void 0:s.readonly,{CELL_READONLY_METHOD:a}=this.ctx.config;if(typeof a=="function"){const c=a({row:i.item,rowIndex:i.rowIndex,colIndex:s.colIndex,column:s.column,value:this.getItemValue(t,e)});if(c!==void 0)return c}return r||o}clearValidate(){this.validationErrorMap.clear()}getValidator(t,e){return new Promise(i=>{const s=this.rowKeyMap.get(t),o=this.headerMap.get(e),{CELL_RULES_METHOD:r}=this.ctx.config,a=o.column;let h=a.rules;if(typeof r=="function"){const f=r({row:s.item,rowIndex:s.rowIndex,colIndex:o.colIndex,column:a,value:this.getItemValue(t,e)});f&&(h=f)}if(h){let c={},f={};if(f[e]=this.getItemValue(t,e),Array.isArray(h)&&h.length){const x=h.map(w=>({...w,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex}));c[e]=x}else c[e]={...h,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex};new Y(c).validate(f).then(()=>{this.setValidationError(t,e,[]),i([])}).catch(({errors:x})=>{const w=x.map(p=>({...p,column:a,key:e,row:s.item,rowKey:t}));this.setValidationError(t,e,w),i(w)})}else i([])})}getHeightByRowIndexRowSpan(t,e){let i=0;for(let s=0;s<e;s++){const o=this.positions[t+s];o&&(i+=o.height)}return i}setLoading(t){this.loading=t,this.ctx.emit("loadingChange",t)}getLoading(){return this.loading}clearRenderHeaderCell(){this.renderHeaderCells=[]}getRenderHeaderCells(){return this.renderHeaderCells}addRenderHeaderCell(t){this.renderHeaderCells.push(t)}clearRenderBodyCell(){this.renderBodyCells=[]}addRenderBodyCell(t){this.renderBodyCells.push(t)}getRenderBodyCells(){return this.renderBodyCells}clearRenderFooterCell(){this.renderFooterCells=[]}addRenderFooterCell(t){this.renderFooterCells.push(t)}getRenderFooterCells(){return this.renderFooterCells}setValidationError(t,e,i){const s=`${t}_${e}`;this.validationErrorMap.set(s,i)}getValidationError(t,e){const i=`${t}_${e}`;return this.validationErrorMap.get(i)||[]}}class zt{constructor(t){n(this,"ctx");n(this,"history",[]);n(this,"historyIndex",-1);this.ctx=t,this.init()}init(){this.ctx.on("keydown",t=>{if(t.ctrlKey&&!t.shiftKey&&t.code==="KeyZ"||t.metaKey&&!t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.backState();return}if(t.ctrlKey&&t.code==="KeyY"||t.ctrlKey&&t.shiftKey&&t.code==="KeyZ"||t.metaKey&&t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.forwardState();return}})}pushState(t){const{HISTORY_NUM:e=0,ENABLE_HISTORY:i}=this.ctx.config;i&&(this.history.push(t),this.history.length>e&&this.history.splice(0,1),this.historyIndex=this.history.length-1)}backState(){if(this.historyIndex>=0){const{changeList:t}=this.history[this.historyIndex],e=t.map(i=>({rowKey:i.rowKey,key:i.key,value:i.oldValue,row:{}}));this.ctx.database.batchSetItemValue(e,!1),this.historyIndex-=1,this.ctx.emit("draw")}}forwardState(){if(this.historyIndex<this.history.length-1){this.historyIndex+=1;const{changeList:t}=this.history[this.historyIndex],e=t.map(i=>({rowKey:i.rowKey,key:i.key,value:i.newValue,row:{}}));this.ctx.database.batchSetItemValue(e,!1),this.ctx.emit("draw")}}clear(){this.history=[],this.historyIndex=-1}}class Vt{constructor(t){n(this,"eventTasks",new Map);n(this,"ctx");this.ctx=t,this.init()}init(){this.bind(window,"resize",this.handleResize.bind(this)),this.bind(window,"mousedown",this.handleMouseDown.bind(this)),this.bind(window,"mouseup",this.handleMouseUp.bind(this)),this.bind(window,"mousemove",this.handleMousemove.bind(this)),this.bind(this.ctx.target,"click",this.handleClick.bind(this)),this.bind(this.ctx.target,"keydown",this.handleKeydown.bind(this)),this.bind(this.ctx.target,"wheel",this.handleWheel.bind(this))}destroy(){this.eventTasks.forEach((t,e)=>{this.unbind(window,e,t)}),this.eventTasks.clear()}handleResize(t){this.ctx.emit("resize",t),this.ctx.emit("draw")}handleMouseDown(t){t.button===0&&(this.ctx.mousedown=!0),this.ctx.emit("mousedown",t)}handleMousemove(t){this.ctx.emit("mousemove",t)}handleMouseUp(t){t.button===0&&(this.ctx.mousedown=!1),this.ctx.emit("mouseup",t)}handleClick(t){this.ctx.emit("click",t)}handleKeydown(t){console.log("handleKeydown");const{ENABLE_KEYBOARD:e}=this.ctx.config;e&&this.ctx.emit("keydown",t)}handleWheel(t){this.ctx.emit("wheel",t)}bind(t,e,i){t instanceof HTMLCanvasElement&&e==="keydown"&&(t.tabIndex=0),t.addEventListener(e,i),this.eventTasks.set(e,i)}unbind(t,e,i){t.removeEventListener(e,i),this.eventTasks.delete(e)}}class Pt{constructor(){n(this,"events",new Map)}has(t){return this.events.has(t)}on(t,e){const i=this.events.get(t)||[];i.push(e),this.events.set(t,i)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};return this.on(t,i),this}off(t,e){const i=this.events.get(t);if(i){const s=i.indexOf(e);s>=0&&(console.log("off",t,s),i.splice(s,1),i.length===0?this.events.delete(t):this.events.set(t,i))}}emit(t,...e){const i=this.events.get(t);i&&i.forEach(s=>{s(...e)})}destroy(){this.events.clear()}}class qt{constructor(t){n(this,"ctx");const e=t.getContext("2d");if(!e)throw new Error("canvas context not found");this.ctx=e}save(){this.ctx.save()}restore(){this.ctx.restore()}translate(t,e){this.ctx.translate(t,e)}setCursor(t="default"){this.ctx.canvas.style.cursor=t}clear(t=0,e=0,i,s){this.ctx.clearRect(t,e,i||this.ctx.canvas.width,s||this.ctx.canvas.height)}drawShadow(t,e,i,s,o){const{fillColor:r,side:a,shadowWidth:h,colorStart:c,colorEnd:f}=o;this.ctx.save(),r&&(this.ctx.fillStyle=r,this.ctx.fillRect(t,e,i,s));let l;switch(a){case"left":l=this.ctx.createLinearGradient(t-h,e,t,e),l.addColorStop(0,c),l.addColorStop(1,f),this.ctx.fillStyle=l,this.ctx.fillRect(t-h,e,h,s);break;case"right":l=this.ctx.createLinearGradient(t+i,e,t+i+h,e),l.addColorStop(0,c),l.addColorStop(1,f),this.ctx.fillStyle=l,this.ctx.fillRect(t+i,e,h,s);break;case"top":l=this.ctx.createLinearGradient(t,e-h,t,e),l.addColorStop(0,c),l.addColorStop(1,f),this.ctx.fillStyle=l,this.ctx.fillRect(t,e-h,i,h);break;case"bottom":l=this.ctx.createLinearGradient(t,e+s,t,e+s+h),l.addColorStop(0,c),l.addColorStop(1,f),this.ctx.fillStyle=l,this.ctx.fillRect(t,e+s,i,h);break;default:console.error("Invalid side specified for shadow");break}}drawLine(t,e){if(t.length<4||t.length%2!==0)throw new Error("A valid array of points is required to draw a line");this.ctx.save();const{borderColor:i="black",borderWidth:s=1}=e;this.ctx.beginPath(),this.ctx.moveTo(t[0]+.5,t[1]+.5);for(let o=2;o<t.length;o+=2)this.ctx.lineTo(t[o]+.5,t[o+1]+.5);this.ctx.strokeStyle=i,this.ctx.lineWidth=s,e.lineDash&&(this.ctx.lineDashOffset=4,this.ctx.setLineDash(e.lineDash)),e.fillColor&&(this.ctx.fillStyle=e.fillColor,this.ctx.fill()),e.borderColor&&(this.ctx.strokeStyle=e.borderColor),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}drawImage(t,e,i,s,o){this.ctx.save(),this.ctx.drawImage(t,e,i,s,o),this.ctx.restore()}drawRect(t,e,i,s,{borderWidth:o=1,borderColor:r,fillColor:a,radius:h=0}={}){if(this.ctx.save(),this.ctx.beginPath(),a!==void 0&&(this.ctx.fillStyle=a),r!==void 0&&(this.ctx.lineWidth=o,this.ctx.strokeStyle=r),h===0)this.ctx.rect(t+.5,e+.5,i,s);else{const[c,f,l,x]=typeof h=="number"?[h,h,h,h]:h;this.ctx.moveTo(t+c,e),this.ctx.arcTo(t+i,e,t+i,e+f,f),this.ctx.arcTo(t+i,e+s,t+i-l,e+s,l),this.ctx.arcTo(t,e+s,t,e+s-x,x),this.ctx.arcTo(t,e,t+c,e,c)}a!==void 0&&this.ctx.fill(),r!==void 0&&this.ctx.stroke(),this.ctx.restore()}drawText(t="",e,i,s,o,r={}){this.ctx.save();const{font:a="12px Arial",align:h="center",color:c="#495060",padding:f=0,verticalAlign:l="middle"}=r;this.ctx.font=a,this.ctx.fillStyle=c,this.ctx.textBaseline=l,this.ctx.textAlign=h;let x=0;l==="top"?x=i+f:l==="bottom"?x=i+o-f:x=i+(o+f)/2;let w=0;h==="left"?w=e+f:h==="right"?w=e+s-f:w=e+s/2;const{_text:p,ellipsis:g}=this.handleEllipsis(t,s,f);return this.ctx.fillText(p,w,x),this.ctx.restore(),g}handleEllipsis(t,e,i=0){let s=!1,o=t;if(t==null||t==="")return{_text:"",ellipsis:s};const r=this.ctx.measureText("...").width,a=this.ctx.measureText(t).width;if(a&&a+r>=e-i*2){s=!0;let h=0;for(let c=0;c<t.length;c++)if(h+=this.ctx.measureText(t[c]).width,h>=e-i*2-r){o=t.slice(0,c)+"...";break}}return{_text:o,ellipsis:s}}}class Gt{constructor(t){n(this,"PROCESSOR_NUM",50);n(this,"CSS_PREFIX","evirt-table");n(this,"ICONS",[]);n(this,"ROW_KEY","");n(this,"HEAD_FONTFAMILY","Arial");n(this,"HEAD_LINE_HEIGHT",1.2);n(this,"HEAD_FONT_SIZE",12);n(this,"HEAD_FONT_STYLE","normal");n(this,"BODY_FONTFAMILY","Arial");n(this,"BODY_FONT_SIZE",12);n(this,"BODY_FONT_STYLE","normal");n(this,"BODY_LINE_HEIGHT",1.2);n(this,"BORDER_COLOR","#e1e6eb");n(this,"WIDTH",0);n(this,"HEIGHT",0);n(this,"EMPTY_BODY_HEIGHT",120);n(this,"MAX_HEIGHT",1e3);n(this,"BORDER_RADIUS",8);n(this,"ENABLE_OFFSET_HEIGHT",!1);n(this,"OFFSET_HEIGHT",0);n(this,"HEADER_HEIGHT",36);n(this,"HEADER_BG_COLOR","#F8FAFF");n(this,"BODY_BG_COLOR","#FFF");n(this,"HEADER_TEXT_COLOR","#1D2129");n(this,"LOADING_ICON_SVG","");n(this,"LOADING_ICON_COLOR","#4E5969");n(this,"EXPAND_ICON_SVG","");n(this,"SHRINK_ICON_SVG","");n(this,"EXPAND_ICON_COLOR","#4E5969");n(this,"SHRINK_ICON_COLOR","#4E5969");n(this,"ERROR_TIP_ICON_COLOR","red");n(this,"ERROR_TIP_ICON_SIZE",6);n(this,"EXPAND_LAZY",!0);n(this,"DEFAULT_EXPAND_ALL",!1);n(this,"CELL_WIDTH",100);n(this,"CELL_HEIGHT",36);n(this,"CELL_PADDING",8);n(this,"CELL_HOVER_ICON_SIZE",20);n(this,"SCROLLER_TRACK_SIZE",14);n(this,"SCROLLER_SIZE",8);n(this,"SCROLLER_COLOR","#dee0e3");n(this,"SCROLLER_TRACK_COLOR","#fff");n(this,"SCROLLER_FOCUS_COLOR","#bbbec4");n(this,"SELECT_BORDER_COLOR","rgb(82,146,247)");n(this,"SELECT_AREA_COLOR","rgba(82,146,247,0.1)");n(this,"SELECT_BG_COLOR","rgba(82,146,247,0.1)");n(this,"EDIT_BG_COLOR","#fcf6ed");n(this,"CHECKBOX_KEY","");n(this,"CHECKBOX_COLOR","rgb(82,146,247)");n(this,"CHECKBOX_SIZE",20);n(this,"CHECKBOX_DISABLED_SVG","");n(this,"CHECKBOX_CHECK_SVG","");n(this,"CHECKBOX_UNCHECK_SVG","");n(this,"CHECKBOX_INDETERMINATE_SVG","");n(this,"READONLY_COLOR","#fff");n(this,"READONLY_TEXT_COLOR","#4E5969");n(this,"ERROR_TIP_COLOR","#ED3F14");n(this,"FOOTER_BG_COLOR","#fafafa");n(this,"FOOTER_FIXED",!1);n(this,"CELL_FOOTER_HEIGHT",36);n(this,"ENABLE_SELECTOR",!1);n(this,"ENABLE_SELECTOR_SINGLE",!1);n(this,"ENABLE_SELECTOR_SPAN_COL",!0);n(this,"ENABLE_SELECTOR_SPAN_ROW",!0);n(this,"ENABLE_SELECTOR_ALL_ROWS",!0);n(this,"ENABLE_SELECTOR_ALL_COLS",!0);n(this,"ENABLE_AUTOFILL",!1);n(this,"ENABLE_CONTEXTMENU",!0);n(this,"ENABLE_COPY",!0);n(this,"ENABLE_PASTER",!0);n(this,"ENABLE_RESIZE_ROW",!0);n(this,"ENABLE_RESIZE_COLUMN",!0);n(this,"RESIZE_ROW_LINE_COLOR","#e1e6eb");n(this,"RESIZE_COLUMN_LINE_COLOR","#e1e6eb");n(this,"RESIZE_ROW_MIN_HEIGHT",36);n(this,"RESIZE_COLUMN_MIN_WIDTH",50);n(this,"ENABLE_KEYBOARD",!1);n(this,"ENABLE_HISTORY",!1);n(this,"ENABLE_VALIDATOR_IMMEDIATE",!0);n(this,"HISTORY_NUM",50);n(this,"HIGHLIGHT_HOVER_ROW",!1);n(this,"HIGHLIGHT_HOVER_ROW_COLOR","rgba(186,203,231,0.1)");n(this,"HIGHLIGHT_SELECTED_ROW",!1);n(this,"HIGHLIGHT_SELECTED_ROW_COLOR","rgba(82,146,247,0.1)");n(this,"TOOLTIP_BG_COLOR","#000");n(this,"TOOLTIP_TEXT_COLOR","#fff");n(this,"TOOLTIP_CUSTOM",!0);n(this,"CONTEXT_MENU",[{label:"复制",value:"copy"},{label:"剪切",value:"cut"},{label:"粘贴",value:"paste"},{label:"清空选中内容",value:"clearSelected"}]);n(this,"BODY_CELL_STYLE_METHOD");n(this,"CELL_READONLY_METHOD");n(this,"CELL_RULES_METHOD");n(this,"CELL_TYPE_METHOD");n(this,"CELL_EDITOR_TYPE_METHOD");n(this,"CELL_RENDER_METHOD");n(this,"CELL_HOVER_ICON_METHOD");n(this,"SPAN_METHOD");n(this,"SELECTABLE_METHOD");n(this,"EXPAND_LAZY_METHOD");Object.assign(this,t)}}class Ut{constructor(t){n(this,"ctx");n(this,"list",[{name:"loading",configName:"LOADING_ICON_SVG",configColorName:"LOADING_ICON_COLOR",svg:'<svg t="1724133395728" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2893" width="32" height="32"><path d="M512 226.8476541a19.82487759 19.82487759 0 0 1 14.66497778 5.70304692c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497779v122.20814825a19.82487759 19.82487759 0 0 1-5.70304693 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304691 19.82487759 19.82487759 0 0 1-14.66497778-5.70304691 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778v-122.20814825a19.82487759 19.82487759 0 0 1 5.70304693-14.66497779 19.82487759 19.82487759 0 0 1 14.66497778-5.70304692z m0 407.36049415a19.82487759 19.82487759 0 0 1 14.66497778 5.70304691c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497778v122.20814827a19.82487759 19.82487759 0 0 1-5.70304693 14.66497776 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693 19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497776v-122.20814827a19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304691zM797.1523459 512a19.82487759 19.82487759 0 0 1-5.70304692 14.66497778 19.82487759 19.82487759 0 0 1-14.66497779 5.70304693h-122.20814825a19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304693h122.20814825a19.82487759 19.82487759 0 0 1 14.66497779 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304692 14.66497778z m-407.36049415 0a19.82487759 19.82487759 0 0 1-5.70304691 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693h-122.20814827a19.82487759 19.82487759 0 0 1-14.66497776-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497776-5.70304693h122.20814827a19.82487759 19.82487759 0 0 1 14.66497778 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304691 14.66497778zM310.22076878 310.22076878a21.29137537 21.29137537 0 0 1 14.66497779-5.70304693c5.51294514 0 10.18401235 1.90101585 14.01320099 5.70304693l86.55052591 86.57768347a20.91117183 20.91117183 0 0 1 5.73020449 14.31193182 19.28172983 19.28172983 0 0 1-6.05609289 14.013201 19.11878565 19.11878565 0 0 1-14.013201 6.05609289 20.96548698 20.96548698 0 0 1-14.31193182-5.70304692L310.22076878 338.87178998a19.06447114 19.06447114 0 0 1-5.70304693-14.01320099c0-5.54010272 1.90101585-10.42842865 5.70304693-14.66497778z m288.32975775 288.32975775a19.79772001 19.79772001 0 0 1 14.3390894-6.35482371c5.29568642 0 10.04822572 2.11827457 14.31193182 6.38198066l86.57768347 86.55052651c3.80203107 3.80203107 5.70304692 8.47309828 5.70304691 14.01320102a19.55330372 19.55330372 0 0 1-6.05609225 14.31193182 19.66193339 19.66193339 0 0 1-14.31193245 6.05609288 19.01015661 19.01015661 0 0 1-14.01320099-5.70304692l-86.55052591-86.57768347a19.79772001 19.79772001 0 0 1-6.38198129-14.31193245c0-5.29568642 2.11827457-10.07538268 6.38198129-14.33908939zM713.77923122 310.22076878c3.80203107 4.26370672 5.70304692 9.15203265 5.70304693 14.66497779s-1.90101585 10.18401235-5.70304693 14.01320099l-86.57768347 86.55052591a20.91117183 20.91117183 0 0 1-14.31193182 5.73020449 19.28172983 19.28172983 0 0 1-14.013201-6.05609289 19.11878565 19.11878565 0 0 1-6.05609289-14.013201c0-5.29568642 1.90101585-10.07538268 5.70304692-14.31193182l86.57768348-86.57768347c3.80203107-3.80203107 8.50025585-5.70304692 14.01320099-5.70304693 5.54010272 0 10.40127108 1.90101585 14.66497779 5.70304693zM425.44947347 598.57768347a19.79772001 19.79772001 0 0 1 6.35482371 14.33908939c0 5.29568642-2.11827457 10.04822572-6.38198066 14.31193245L338.89894756 713.77923122a19.06447114 19.06447114 0 0 1-14.01320099 5.70304693 19.55330372 19.55330372 0 0 1-14.31193245-6.05609227 19.68909035 19.68909035 0 0 1-6.05609227-14.31193245 19.01015661 19.01015661 0 0 1 5.70304693-14.01320099l86.57768347-86.55052591a19.79772001 19.79772001 0 0 1 14.31193182-6.38198129c5.29568642 0 10.07538268 2.11827457 14.3390894 6.38198129z" fill="#000000" fill-opacity=".65" p-id="2894"></path></svg>',color:"#4E5969"},{name:"expand",configName:"EXPAND_ICON_SVG",configColorName:"EXPAND_ICON_COLOR",svg:'<svg t="1724122015492" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4237" width="32" height="32"><path d="M401.472 316.992l159.04 217.664L591.488 512l-30.976-22.656-159.04 217.728q-2.24 3.008-3.84 6.464-1.6 3.456-2.496 7.104-0.896 3.648-1.024 7.424-0.192 3.84 0.384 7.552 0.64 3.712 1.92 7.296 1.28 3.52 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992 3.072 2.24 6.464 3.84 3.456 1.6 7.168 2.496 3.648 0.896 7.424 1.024 3.776 0.192 7.488-0.448 3.776-0.576 7.296-1.856 3.584-1.28 6.784-3.264 3.2-1.92 6.016-4.48 2.816-2.56 5.056-5.632l159.04-217.728q3.584-4.928 5.504-10.752 1.92-5.76 1.92-11.904 0-6.08-1.92-11.904-1.92-5.76-5.504-10.752L463.488 271.68q-2.24-3.072-5.056-5.632-2.752-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.52-1.28-7.296-1.856-3.712-0.576-7.488-0.448-3.84 0.192-7.424 1.088-3.712 0.896-7.168 2.496-3.392 1.6-6.4 3.84-3.136 2.176-5.696 4.992-2.56 2.752-4.48 6.016-1.984 3.2-3.264 6.784-1.28 3.52-1.92 7.296-0.576 3.712-0.384 7.488 0.128 3.84 1.024 7.488 0.896 3.648 2.496 7.04 1.6 3.456 3.84 6.528z m30.976-61.056q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.24-3.52 1.408-6.656 3.52-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.232 1.408 3.456 3.52 6.592 2.112 3.2 4.8 5.824 2.688 2.688 5.76 4.8 3.2 2.112 6.72 3.52 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.656 1.472-3.52 2.24-7.232 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.456-3.52-6.592-2.112-3.2-4.8-5.824-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.52-3.52-1.472-7.232-2.24Q436.224 256 432.448 256z m0 435.392q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.176-3.52 1.472-6.656 3.584-3.2 2.112-5.824 4.736-2.688 2.688-4.8 5.824-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.76 2.688 2.752 5.76 4.8 3.2 2.112 6.72 3.584 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.472 6.592-3.584 3.2-2.048 5.824-4.736 2.688-2.688 4.8-5.824 2.112-3.2 3.52-6.656 1.472-3.456 2.24-7.168 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.52-3.52-6.656-2.112-3.136-4.8-5.76-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704z" p-id="4238"></path></svg>',color:"#4E5969"},{name:"shrink",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"SHRINK_ICON_COLOR",svg:'<svg t="1724122044148" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M707.648 401.28L489.28 560.704l22.656 30.976 22.656-30.976L316.16 401.216q-3.072-2.24-6.464-3.84-3.456-1.536-7.104-2.432-3.712-0.896-7.488-1.088-3.776-0.128-7.488 0.448-3.776 0.64-7.296 1.92-3.584 1.28-6.784 3.2-3.2 1.984-6.016 4.544-2.816 2.56-5.056 5.632-2.176 3.072-3.84 6.464-1.536 3.456-2.432 7.104-0.896 3.712-1.088 7.488-0.128 3.776 0.448 7.488 0.64 3.776 1.92 7.296 1.28 3.584 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992l218.368 159.552q4.928 3.584 10.752 5.504 5.76 1.92 11.904 1.92 6.08 0 11.904-1.92 5.76-1.92 10.752-5.504l218.368-159.552q3.008-2.24 5.568-4.992 2.56-2.816 4.544-6.016 1.92-3.2 3.264-6.784 1.28-3.52 1.92-7.296 0.576-3.712 0.384-7.488-0.128-3.84-1.024-7.488-0.896-3.648-2.496-7.04-1.6-3.456-3.84-6.528-2.24-3.072-4.992-5.632-2.816-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.584-1.28-7.296-1.856-3.712-0.64-7.488-0.448-3.84 0.192-7.488 1.088-3.648 0.896-7.04 2.496-3.456 1.536-6.528 3.84z m61.056 30.976q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.472-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.72-3.584-3.456-1.408-7.168-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.656 3.584-3.136 2.112-5.76 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.584 6.656-1.408 3.52-2.176 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.176 7.168 1.472 3.52 3.584 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.168-2.176 3.52-1.408 6.656-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.048-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z m-436.736 0q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.408-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.592 3.584-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.24 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.24 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z" p-id="4552"></path></svg>',color:"#4E5969"},{name:"checkbox-uncheck",configName:"CHECKBOX_UNCHECK_SVG",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:""},{name:"checkbox-check",configName:"CHECKBOX_CHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-hover",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-indeterminate",configName:"CHECKBOX_INDETERMINATE_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595280953" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4394" width="32" height="32"><path d="M128 384v256q0 12.608 1.28 25.088 1.216 12.544 3.648 24.832 2.432 12.352 6.08 24.384t8.448 23.68q4.864 11.584 10.752 22.72 5.952 11.072 12.928 21.504 7.04 10.496 14.976 20.224 8 9.728 16.896 18.56 8.896 8.96 18.56 16.896 9.728 8 20.224 14.976 10.432 7.04 21.504 12.928 11.136 5.888 22.72 10.688 11.648 4.864 23.68 8.512 12.032 3.648 24.32 6.08 12.352 2.432 24.896 3.712Q371.392 896 384 896h256q12.608 0 25.088-1.28 12.544-1.216 24.832-3.648 12.352-2.432 24.384-6.08t23.68-8.512q11.584-4.8 22.72-10.688 11.072-5.952 21.504-12.928 10.496-7.04 20.224-14.976 9.728-8 18.56-16.896 8.96-8.832 16.896-18.56 8-9.728 14.976-20.224 7.04-10.432 12.928-21.504 5.888-11.136 10.688-22.72 4.864-11.648 8.512-23.68 3.648-12.032 6.08-24.32 2.432-12.352 3.712-24.896Q896 652.608 896 640V384q0-12.608-1.28-25.088-1.216-12.544-3.648-24.832-2.432-12.352-6.08-24.384t-8.512-23.68q-4.8-11.584-10.688-22.72-5.952-11.072-12.928-21.504-7.04-10.496-14.976-20.224-8-9.664-16.896-18.56-8.832-8.96-18.56-16.896-9.728-8-20.224-14.976-10.432-7.04-21.504-12.928-11.136-5.888-22.72-10.752-11.648-4.8-23.68-8.448-12.032-3.648-24.32-6.08-12.352-2.432-24.896-3.712Q652.608 128 640 128H384q-12.608 0-25.088 1.28-12.544 1.216-24.832 3.648-12.352 2.432-24.384 6.08t-23.68 8.448q-11.584 4.864-22.72 10.752-11.072 5.952-21.504 12.928-10.496 7.04-20.224 14.976-9.664 8-18.56 16.896-8.96 8.896-16.896 18.56-8 9.728-14.976 20.224-7.04 10.432-12.928 21.504-5.888 11.136-10.752 22.72-4.8 11.648-8.448 23.68-3.648 12.032-6.08 24.32-2.432 12.352-3.712 24.896Q128 371.392 128 384z m566.016 166.336H330.112a38.4 38.4 0 0 1 0-76.8h363.904a38.4 38.4 0 0 1 0 76.8z" p-id="4395"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-check-disabled",configName:"CHECKBOX_CHECK_SVG",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"#DDE0EA"},{name:"checkbox-disabled",configName:"CHECKBOX_DISABLED_SVG",svg:'<svg t="1722595946663" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4865" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z" fill="#F1F2F4" p-id="4866"></path><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4867"></path></svg>',color:""}]);n(this,"icons",new Map);this.ctx=t,this.init()}async init(){const t=[];for(let e=0;e<this.list.length;e++){const i=this.list[e];let s=i.color;if(i.configColorName){const r=this.ctx.config[i.configColorName];r&&(s=r)}const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}for(let e=0;e<this.ctx.config.ICONS.length;e++){const i=this.ctx.config.ICONS[e];let s=i.color;const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}await Promise.all(t),this.ctx.emit("draw")}get(t){return this.icons.get(t)}async createImageFromSVG(t,e){const o=new DOMParser().parseFromString(t,"image/svg+xml").documentElement;e&&o.querySelectorAll("*").forEach(c=>{c.setAttribute("fill",e)});const r=new Image,a=new Blob([new XMLSerializer().serializeToString(o)],{type:"image/svg+xml"}),h=URL.createObjectURL(a);return r.src=h,new Promise((c,f)=>{r.onerror=()=>f(new Error("Failed to load image")),r.onload=()=>{c(r)}})}}class at{constructor(t,e,i,s,o,r){n(this,"ctx");n(this,"x",0);n(this,"y",0);n(this,"width",0);n(this,"height",0);n(this,"fixed");this.ctx=t,this.x=e,this.y=i,this.width=s,this.height=o,this.fixed=r}isHorizontalVisible(){if(this.fixed)return!0;const{target:t,fixedLeftWidth:e,scrollX:i,fixedRightWidth:s}=this.ctx,o=t.offsetWidth;return!(this.x+this.width-e-i<=0||this.x-i>=o-s)}isVerticalVisible(){const{target:t,scrollY:e}=this.ctx,i=t.offsetHeight;return!(this.y+this.height-e<=0||this.y-e>=i)}getDrawX(){return this.fixed==="left"?this.x:this.fixed==="right"?this.ctx.header.visibleWidth-(this.ctx.header.width-this.x):this.x-this.ctx.scrollX}getDrawY(){return this.y-this.ctx.scrollY}getLeftFixedX(){return this.x-this.ctx.scrollX}getRightFixedX(){}}class ht extends at{constructor(e,i,s,o,r,a,h,c,f,l="body"){super(e,o,r,a,h,c.fixed);n(this,"formatter");n(this,"hoverIconName","");n(this,"align");n(this,"verticalAlign");n(this,"fixed");n(this,"type");n(this,"editorType");n(this,"cellType");n(this,"level");n(this,"colspan",1);n(this,"rowspan",1);n(this,"key");n(this,"column");n(this,"rowIndex");n(this,"colIndex");n(this,"rowKey");n(this,"row");n(this,"value");n(this,"render");n(this,"renderFooter");n(this,"style",{});n(this,"rules",{});n(this,"message","");n(this,"text","");n(this,"displayText","");n(this,"visibleWidth",0);n(this,"visibleHeight",0);n(this,"drawX",0);n(this,"drawY",0);n(this,"drawCellBgColor","");n(this,"drawCellSkyBgColor","");n(this,"drawTextColor","");n(this,"drawTextX",0);n(this,"drawTextY",0);n(this,"drawImageX",0);n(this,"drawImageY",0);n(this,"drawImageWidth",0);n(this,"drawImageHeight",0);n(this,"drawImageName","");n(this,"drawImageSource");n(this,"ellipsis",!1);this.visibleWidth=this.width,this.visibleHeight=this.height,this.colIndex=s,this.rowIndex=i,this.key=c.key,this.type=c.type||"text",this.editorType=c.editorType||"text",this.cellType=l,this.align=c.align||"center",this.verticalAlign=c.verticalAlign||"middle",this.fixed=c.fixed,this.level=c.level,this.column=c,this.rules=c.rules,this.row=f,this.rowKey=this.ctx.database.getRowKeyForRowIndex(i),this.value=this.getValue(),this.render=c.render,this.renderFooter=c.renderFooter,this.hoverIconName=c.hoverIconName,this.formatter=c.formatter,this.update()}getValidationMessage(){const e=this.ctx.database.getValidationError(this.rowKey,this.key);if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message}return this.message}update(){this.drawX=this.getDrawX(),this.drawY=this.getDrawY(),this.drawTextX=this.drawX,this.drawTextY=this.drawY,this.updateSpan(),this.updateType(),this.updateHoverIcon(),this.updateSelection(),this.updateTree(),this.updateEditorType(),this.updateRender(),this.getValidationMessage(),this.updateContainer(),this.text=this.getText(),this.displayText=this.getDisplayText()}updateSpan(){if(this.cellType==="footer")return;const{SPAN_METHOD:e}=this.ctx.config;if(typeof e=="function"){const i=e,{colspan:s=1,rowspan:o=1}=i({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue(),headIndex:this.ctx.body.headIndex,headPosition:this.ctx.database.getPositionForRowIndex(this.ctx.body.headIndex),visibleRows:this.ctx.body.visibleRows,visibleLeafColumns:this.ctx.header.visibleLeafColumns,rows:this.ctx.body.data})||{};this.colspan=s,this.rowspan=o,this.visibleWidth=this.getWidthByColIndexColSpan(this.colIndex,this.colspan),this.visibleHeight=this.ctx.database.getHeightByRowIndexRowSpan(this.rowIndex,this.rowspan)}}updateType(){const{CELL_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.type=s)}}updateEditorType(){const{CELL_EDITOR_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.editorType=s)}}updateRender(){const{CELL_RENDER_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.render=s)}}validate(){this.ctx.database.getValidator(this.rowKey,this.key).then(()=>{this.ctx.database.setValidationError(this.rowKey,this.key,[]),this.message=""}).catch(e=>{if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message,this.ctx.database.setValidationError(this.rowKey,this.key,e)}}).finally(()=>{this.ctx.emit("asyncDrawBody")})}updateStyle(){this.style=this.getOverlayerViewsStyle()}updateTree(){const{CELL_PADDING:e=0}=this.ctx.config,{rowKey:i,cellType:s}=this;let o,r=0,a="";if(this.type==="tree"&&s==="body"){const h=this.ctx.database.getRowForRowKey(i),{expand:c=!1,hasChildren:f=!1,expandLoading:l=!1,level:x=0}=h||{};if(l){const w=this.ctx.icons.get("loading");a="loading",o=w,r=x*8}else if(f){const w=this.ctx.icons.get("expand"),p=this.ctx.icons.get("shrink");o=c?p:w,a=c?"shrink":"expand",r=x*8}else r=x*8;if(o){let w=20,p=20,g=this.drawX+r+e,y=this.drawY+(this.visibleHeight-p)/2+2;this.ctx.paint.drawImage(o,g,y,w,p),this.drawImageX=g,this.drawImageY=y,this.drawImageWidth=w,this.drawImageHeight=p,this.drawImageName=a,this.drawImageSource=o,this.align="left",this.drawTextX=r+this.drawX+w+.5}}}updateContainer(){const{BODY_BG_COLOR:e,EDIT_BG_COLOR:i,BODY_CELL_STYLE_METHOD:s,READONLY_TEXT_COLOR:o,FOOTER_BG_COLOR:r,HIGHLIGHT_SELECTED_ROW:a,HIGHLIGHT_SELECTED_ROW_COLOR:h,HIGHLIGHT_HOVER_ROW:c,HIGHLIGHT_HOVER_ROW_COLOR:f}=this.ctx.config,l=this,{rowKey:x,key:w,type:p}=this;let g=e,y=o;if(this.ctx.database.getReadonly(x,w)||["index","index-selection","selection"].includes(p)||(g=i),typeof s=="function"){const b=s,{backgroundColor:I,color:v}=b({row:l.row,rowIndex:l.rowIndex,colIndex:l.colIndex,column:l.column,value:l.getValue()})||{};I&&(g=I),v&&(y=v)}l.cellType==="footer"&&(g=r);let u="transparent";const C=this.ctx.focusCell,m=this.ctx.hoverCell;c&&(m==null?void 0:m.rowKey)===this.rowKey&&(u=f),a&&(C==null?void 0:C.rowKey)===this.rowKey&&(u=h),this.drawCellSkyBgColor=u,this.drawCellBgColor=g,this.drawTextColor=y}updateSelection(){const{visibleWidth:e,visibleHeight:i,rowspan:s,colspan:o,cellType:r,type:a,rowIndex:h,rowKey:c}=this;if(!(s===0||o===0)&&r!=="footer"&&["index-selection","selection"].includes(a)){const f=this.ctx.database.getRowSelection(c),l=this.ctx.database.getRowSelectable(c),{CHECKBOX_SIZE:x=0}=this.ctx.config,w=this.drawX+(e-x)/2,p=this.drawY+(i-x)/2;let g=this.ctx.icons.get("checkbox-uncheck"),y="checkbox-uncheck";f&&l?(g=this.ctx.icons.get("checkbox-check"),y="checkbox-check"):f&&l?(g=this.ctx.icons.get("checkbox-check-disabled"),y="checkbox-check-disabled"):!f&&l?(g=this.ctx.icons.get("checkbox-uncheck"),y="checkbox-uncheck"):(g=this.ctx.icons.get("checkbox-disabled"),y="checkbox-disabled"),g&&a=="index-selection"?(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===h||["checkbox-disabled","checkbox-check"].includes(y))&&(this.drawImageX=w,this.drawImageY=p,this.drawImageWidth=x,this.drawImageHeight=x,this.drawImageName=y,this.drawImageSource=g):g&&a==="selection"&&(this.drawImageX=w,this.drawImageY=p,this.drawImageWidth=x,this.drawImageHeight=x,this.drawImageName=y,this.drawImageSource=g)}}updateHoverIcon(){const{CELL_HOVER_ICON_METHOD:e,CELL_HOVER_ICON_SIZE:i,CELL_PADDING:s}=this.ctx.config;if(typeof e=="function"){const h=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});h!==void 0&&(this.hoverIconName=h)}const o=this.drawX+this.width-i-s,r=this.drawY+(this.height-i)/2;if(this.hoverIconName&&this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex){const a=this.ctx.icons.get(this.hoverIconName);this.drawImageX=o,this.drawImageY=r,this.drawImageWidth=i,this.drawImageHeight=i,this.drawImageName=this.hoverIconName,this.drawImageSource=a}}getDisplayText(){if(this.cellType==="footer"){if(this.renderFooter)return"";const e=this.row[this.key];return[null,void 0].includes(e)?"":e}else return this.rowspan===0||this.colspan===0||this.render||this.type==="index-selection"&&(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex||["checkbox-disabled","checkbox-check"].includes(this.drawImageName))?"":this.text}getText(){return typeof this.formatter=="function"?this.formatter({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()}):["index-selection","index"].includes(this.type)?`${this.rowIndex+1}`:(this.value=this.ctx.database.getItemValue(this.rowKey,this.key),this.value)}getValue(){return this.ctx.database.getItemValue(this.rowKey,this.key)}getOverlayerViewsStyle(){}draw(){const{paint:e,config:{BORDER_COLOR:i}}=this.ctx,{drawX:s,drawY:o}=this;e.drawRect(s,o,this.visibleWidth,this.visibleHeight,{borderColor:i,fillColor:this.drawCellBgColor}),e.drawRect(s,o,this.width,this.height,{borderColor:"transparent",borderWidth:1,fillColor:this.drawCellSkyBgColor}),this.ellipsis=this.drawText(),this.drawImage(),this.drawSelector(),this.drawAutofillPiont()}getWidthByColIndexColSpan(e,i){if(i===0)return 0;let s=0;for(let o=e;o<e+i;o++){const r=this.ctx.header.leafCellHeaders[o];s+=r.width}return s}drawText(){const{CELL_PADDING:e=0,BODY_FONTFAMILY:i,BODY_FONT_SIZE:s,BODY_FONT_STYLE:o}=this.ctx.config,r=`${s}px ${o} ${i}`;return this.ctx.paint.drawText(this.displayText,this.drawTextX,this.drawTextY,this.visibleWidth,this.visibleHeight,{font:r,padding:e,align:this.align,verticalAlign:this.verticalAlign,color:this.drawTextColor})}drawImage(){this.drawImageSource&&this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight)}drawAutofillPiont(){if(this.cellType==="footer")return;const{SELECT_BORDER_COLOR:e,ENABLE_AUTOFILL:i,ENABLE_SELECTOR:s}=this.ctx.config;if(!s||!i)return;const{xArr:o,yArr:r}=this.ctx.selector,a=o[1],h=r[1],{colIndex:c,rowIndex:f,drawX:l,drawY:x}=this;c===a&&f===h&&this.ctx.paint.drawRect(l+this.width-6,x+this.height-6,6,6,{borderColor:"#fff",fillColor:e})}drawSelector(){if(this.cellType==="footer")return;const{ENABLE_SELECTOR:e}=this.ctx.config;if(!e)return;const{xArr:i,yArr:s,xArrCopy:o,yArrCopy:r}=this.ctx.selector;this.drawBorder({xArr:o,yArr:r,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:this.ctx.autofill.xArr,yArr:this.ctx.autofill.yArr,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:i,yArr:s,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1})}drawBorder(e){const{drawX:i,drawY:s,width:o,rowIndex:r,colIndex:a}=this,h=i+.5;let c=s+.5,f=this.height;r===0&&(c=this.y+1,f=f-1);const{xArr:l,yArr:x,lineDash:w=[],borderWidth:p=1,borderColor:g,fillColor:y}=e,u=l[0],C=l[1],m=x[0],b=x[1];a>=u&&a<=C&&r===m&&this.ctx.paint.drawLine([h,c,h+o-2,c],{borderColor:g,fillColor:y,borderWidth:p,lineCap:"round",lineJoin:"round",lineDash:w}),a>=u&&a<=C&&r===b&&this.ctx.paint.drawLine([h,c+f-1.5,h+o,c+f-1.5],{borderColor:g,fillColor:y,borderWidth:p,lineCap:"round",lineJoin:"round",lineDash:w}),a===u&&r>=m&&r<=b&&this.ctx.paint.drawLine([h,c,h,c+f-1],{borderColor:g,fillColor:y,borderWidth:p,lineCap:"round",lineJoin:"round",lineDash:w}),a===C&&r>=m&&r<=b&&this.ctx.paint.drawLine([h+o-1,c,h+o-1,c+f-1],{borderColor:g,fillColor:y,borderWidth:p,lineCap:"round",lineJoin:"round",lineDash:w})}}class ct extends at{constructor(e,i,s,o,r,a,h){super(e,s,o,r,a,h.fixed);n(this,"align");n(this,"verticalAlign","middle");n(this,"fixed");n(this,"type");n(this,"editorType");n(this,"level");n(this,"text");n(this,"displayText","");n(this,"colspan");n(this,"rowspan");n(this,"key");n(this,"required",!1);n(this,"readonly",!1);n(this,"children",[]);n(this,"column");n(this,"colIndex");n(this,"rowKey");n(this,"rules");n(this,"hasChildren");n(this,"render");n(this,"style",{});n(this,"drawX",0);n(this,"drawY",0);n(this,"drawImageX",0);n(this,"drawImageY",0);n(this,"drawImageWidth",0);n(this,"drawImageHeight",0);n(this,"drawImageName","");n(this,"drawImageSource");this.ctx=e,this.x=s,this.y=o,this.width=r,this.height=a,this.colIndex=i,this.key=h.key,this.type=h.type,this.editorType=h.editorType||"text",this.align=h.align||"center",this.verticalAlign=h.verticalAlign||"middle",this.fixed=h.fixed,this.level=h.level,this.text=h.title,this.column=h,this.colspan=h.colspan,this.rowspan=h.rowspan,this.rules=h.rules,this.readonly=h.readonly,this.required=h.required,this.rowKey=$(),this.hasChildren=h.children&&h.children.length>0||!1,this.render=h.renderHeader}getDrawY(){return this.y}isVerticalVisible(){const{target:e}=this.ctx,i=e.offsetHeight;return!(this.y+this.height<=0||this.y>=i)}updateStyle(){}update(){this.updateStyle(),this.displayText=this.getText(),this.drawX=this.getDrawX(),this.drawY=this.getDrawY()}draw(){const{paint:e,config:{BORDER_COLOR:i,HEADER_BG_COLOR:s,CELL_PADDING:o,HEAD_FONTFAMILY:r,HEAD_FONT_SIZE:a,HEAD_FONT_STYLE:h}}=this.ctx,{drawX:c,drawY:f,displayText:l}=this;e.drawRect(c,f,this.width,this.height,{borderColor:i,fillColor:s});const x=`${a}px ${h} ${r}`;e.drawText(l,c,f,this.width,this.height,{font:x,padding:o,align:this.align,verticalAlign:this.verticalAlign}),this.drawSelection()}drawSelection(){const{width:e,height:i,type:s}=this;if(["index-selection","selection"].includes(s)){const{indeterminate:o,check:r,selectable:a}=this.ctx.database.getCheckedState(),{CHECKBOX_SIZE:h=0}=this.ctx.config,c=this.drawX+(e-h)/2,f=this.drawY+(i-h)/2;let l=this.ctx.icons.get("checkbox-uncheck"),x="checkbox-uncheck";o?(l=this.ctx.icons.get("checkbox-indeterminate"),x="checkbox-indeterminate"):r&&a?(l=this.ctx.icons.get("checkbox-check"),x="checkbox-check"):r&&a?(l=this.ctx.icons.get("checkbox-check-disabled"),x="checkbox-check-disabled"):!r&&a?(l=this.ctx.icons.get("checkbox-uncheck"),x="checkbox-uncheck"):(l=this.ctx.icons.get("checkbox-disabled"),x="checkbox-disabled"),l&&(this.drawImageX=c,this.drawImageY=f,this.drawImageWidth=h,this.drawImageHeight=h,this.drawImageName=x,this.drawImageSource=l,this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight))}}getText(){return this.render?"":this.text}}class Zt{constructor(t){n(this,"ctx");n(this,"resizeObserver");this.ctx=t,this.init()}init(){this.resizeObserver=new ResizeObserver(()=>{this.ctx.emit("resizeObserver"),this.ctx.emit("draw")}),this.ctx.target.parentElement&&this.resizeObserver.observe(this.ctx.target),this.ctx.on("mousedown",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),h=r.getDrawY();if(i>a&&i<a+r.width&&e>h&&e<h+r.height){this.ctx.focusCellHeader=r,this.ctx.emit("cellHeaderMousedown",r,t);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const h of a){const c=h.getDrawX(),f=h.getDrawY();if(i>c&&i<c+h.width&&e>f&&e<f+h.height){this.ctx.setFocusCell(h),this.ctx.emit("cellMousedown",h,t);return}}}}),this.ctx.on("click",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),h=r.getDrawY();if(i>a&&i<a+r.width&&e>h&&e<h+r.height){this.ctx.clickCellHeader=r,this.ctx.emit("cellHeaderClick",r,t),this.selectionClick(r);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const h of a){const c=h.getDrawX(),f=h.getDrawY();if(i>c&&i<c+h.width&&e>f&&e<f+h.height){this.ctx.clickCell=h,this.ctx.emit("cellClick",h,t),this.selectionClick(h),this.treeClick(h);return}}}}),this.ctx.on("mousemove",t=>{var r;if(this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const a of s){const h=a.getDrawX(),c=a.getDrawY();if(i>h&&i<h+a.width&&e>c&&e<c+a.height){if(this.ctx.emit("cellHeaderMouseenter",a,t),this.ctx.hoverCellHeader&&this.ctx.hoverCellHeader!==a&&this.ctx.emit("cellHeaderMouseleave",this.ctx.hoverCellHeader,t),this.imageEnterAndLeave(a,t),this.ctx.hoverCellHeader===a)return;this.ctx.hoverCellHeader=a,this.ctx.emit("cellHeaderHoverChange",a);return}}const o=this.ctx.body.renderRows;for(const a of o){const h=a.fixedCells.concat(a.noFixedCells);for(const c of h){const f=c.getDrawX(),l=c.getDrawY();if(i>f&&i<f+c.visibleWidth&&e>l&&e<l+c.visibleHeight&&this.imageEnterAndLeave(c,t),i>f&&i<f+c.width&&e>l&&e<l+c.height){if(this.ctx.emit("cellMouseenter",c,t),this.ctx.hoverCell&&this.ctx.hoverCell!==c&&this.ctx.emit("cellMouseleave",this.ctx.hoverCell,t),this.ctx.hoverCell===c)return;((r=this.ctx.hoverCell)==null?void 0:r.rowKey)!==c.rowKey&&(this.ctx.hoverCell=c,this.ctx.hoverRow=this.ctx.body.renderRows[c.rowIndex],this.ctx.emit("rowHoverChange",this.ctx.hoverRow,c),this.ctx.emit("draw")),this.ctx.hoverCell=c,this.ctx.emit("cellHoverChange",c);return}}}})}selectionClick(t){if(["selection","index-selection"].includes(t.type)&&this.ctx.isPointer)if(t instanceof ct)t.drawImageName==="checkbox-uncheck"||t.drawImageName==="checkbox-indeterminate"?this.ctx.database.toggleAllSelection():t.drawImageName==="checkbox-check"&&this.ctx.database.clearSelection();else{if(!this.ctx.database.getRowSelectable(t.rowKey))return;this.ctx.database.toggleRowSelection(t.rowKey)}}treeClick(t){if(t.type==="tree"&&this.ctx.isPointer){const e=this.ctx.database.getRowForRowKey(t.rowKey),{expand:i=!1,expandLazy:s=!1}=e||{},{EXPAND_LAZY:o,EXPAND_LAZY_METHOD:r}=this.ctx.config;if(o&&r&&!i&&!s)typeof r=="function"&&(this.ctx.database.expandLoading(t.rowKey,!0),r({row:t.row,rowIndex:t.rowIndex,colIndex:t.colIndex,column:t.column,value:t.getValue()}).then(h=>{this.ctx.database.setExpandChildren(t.rowKey,h),this.ctx.database.expandLoading(t.rowKey,!1)}).catch(h=>{this.ctx.database.expandLoading(t.rowKey,!1),console.error(h)}));else{const a=this.ctx.database.getIsExpand(t.rowKey);this.ctx.database.expandItem(t.rowKey,!a),this.ctx.emit("expandChange")}}}imageEnterAndLeave(t,e){const i=e.offsetY,s=e.offsetX;s>t.drawImageX&&s<t.drawImageX+t.drawImageWidth&&i>t.drawImageY&&i<t.drawImageY+t.drawImageHeight?(this.ctx.target.style.cursor="pointer",this.ctx.isPointer=!0,t instanceof ht&&["selection","index-selection"].includes(t.type)&&(this.ctx.database.getRowSelectable(t.rowKey)||(this.ctx.target.style.cursor="not-allowed"))):(this.ctx.isPointer=!1,this.ctx.target.style.cursor==="pointer"&&(this.ctx.target.style.cursor="default"))}isBusy(t){const e=t.offsetY,i=t.offsetX;if(!(t.target instanceof HTMLCanvasElement)||!this.ctx.isTarget(t.target)||this.ctx.target.style.cursor==="row-resize"||this.ctx.target.style.cursor==="col-resize"||this.ctx.columnResizing||this.ctx.rowResizing)return!0;const{SCROLLER_TRACK_SIZE:s}=this.ctx.config;return!!(this.ctx.scrollerMove||this.ctx.scrollerFocus||e>this.ctx.target.offsetHeight-s||i>this.ctx.target.offsetWidth-s)}destroy(){this.resizeObserver.unobserve(this.ctx.target)}}class $t{constructor(t,e){n(this,"eventBus");n(this,"eventBrowser");n(this,"eventTable");n(this,"uuid",$());n(this,"target");n(this,"paint");n(this,"icons");n(this,"mousedown",!1);n(this,"isPointer",!1);n(this,"rowResizing",!1);n(this,"columnResizing",!1);n(this,"scrollerMove",!1);n(this,"scrollerFocus",!1);n(this,"autofillMove",!1);n(this,"scrollY",0);n(this,"scrollX",0);n(this,"fixedLeftWidth",0);n(this,"fixedRightWidth",0);n(this,"maxColIndex",0);n(this,"maxRowIndex",0);n(this,"hoverRow");n(this,"clickCell");n(this,"focusCell");n(this,"hoverCell");n(this,"clickCellHeader");n(this,"focusCellHeader");n(this,"hoverCellHeader");n(this,"body",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,headIndex:0,tailIndex:0,visibleRows:[],renderRows:[],data:[]});n(this,"footer",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0});n(this,"header",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,visibleLeafColumns:[],leafCellHeaders:[],renderLeafCellHeaders:[],renderCellHeaders:[]});n(this,"selector",{enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]});n(this,"autofill",{enable:!1,xArr:[-1,-1],yArr:[-1,-1]});n(this,"database");n(this,"history");n(this,"config");this.target=t,this.target.setAttribute("uuid",this.uuid),this.config=new Gt(e.config||{}),this.eventBus=new Pt,this.eventBrowser=new Vt(this),this.eventTable=new Zt(this),this.paint=new qt(t),this.database=new Wt(this,e),this.history=new zt(this),this.icons=new Ut(this)}setFocusCell(t){var e;this.focusCell!==t&&(((e=this.focusCell)==null?void 0:e.rowKey)!==t.rowKey&&(this.focusCell=t,this.emit("rowFocusChange",t)),this.focusCell=t,this.emit("cellFocusChange",t))}clearSelector(){this.selector={enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]}}clearAutofill(){this.autofill={enable:!1,xArr:[-1,-1],yArr:[-1,-1]}}getSelectedData(){const t=[],e=this.selector.yArr,i=this.selector.xArr;let s="";for(let o=0;o<=e[1]-e[0];o++){const r=[];for(let a=0;a<=i[1]-i[0];a++){const h=o+e[0],c=a+i[0],f=this.database.getItemValueForRowIndexAndColIndex(h,c);f&&r.push(f.value)}s+=`${r.join("	")}\r`,t.push(r)}return s=s?s.replace(/\r$/,""):" ",{xArr:i,yArr:e,text:s,value:t}}setScroll(t,e){let i=Math.floor(t);const s=this.body.width-this.body.visibleWidth;i<0?i=0:i>s&&(i=s);let o=Math.floor(e);const r=this.body.height-this.body.visibleHeight-this.footer.height;o<0?o=0:o>r&&(o=r),this.emit("setScroll",i,o)}setScrollX(t){let e=Math.floor(t);const i=this.body.width-this.body.visibleWidth;e<0?e=0:e>i&&(e=i),this.emit("setScrollX",e)}setScrollY(t){let e=Math.floor(t);const i=this.body.height-this.body.visibleHeight-this.footer.height;e<0?e=0:e>i&&(e=i),this.emit("setScrollY",e)}isTarget(t){if(t===null)return!1;const e=t.getAttribute("uuid");return this.uuid===e}hasEvent(t){return this.eventBus.has(t)}on(t,e){this.eventBus.on(t,e)}once(t,e){this.eventBus.once(t,e)}off(t,e){this.eventBus.off(t,e)}emit(t,...e){this.eventBus.emit(t,...e)}destroy(){this.eventTable.destroy(),this.eventBrowser.destroy(),this.eventBus.destroy()}}class lt{constructor(t,e){n(this,"ctx");n(this,"type");n(this,"isFocus",!1);n(this,"trackX",0);n(this,"trackY",0);n(this,"trackWidth",0);n(this,"trackHeight",0);n(this,"splitPoints",[]);n(this,"barX",0);n(this,"barY",0);n(this,"barWidth",0);n(this,"barHeight",0);n(this,"distance",0);n(this,"visibleDistance",0);n(this,"offsetX",0);n(this,"offsetY",0);n(this,"dragStart",0);n(this,"isDragging",!1);n(this,"scroll",0);this.ctx=t,this.type=e,this.type==="vertical"?this.scroll=this.ctx.scrollY:this.scroll=this.ctx.scrollX}onWheel(t){this.updateScroll(t)}onMouseDown(t){const{offsetX:e,offsetY:i}=t;if(!(e==this.offsetX&&i==this.offsetY)){if(this.isOnScrollbar(e,i))this.offsetX=e,this.offsetY=i,this.isDragging=!0,this.ctx.scrollerMove=!0,this.isFocus=!0,this.dragStart=this.scroll;else if(this.isOnTrack(e,i)){let s=0;this.type==="vertical"?s=(i-this.ctx.header.height-this.barHeight/2)/(this.visibleDistance-this.barHeight)*this.distance:s=(e-this.barWidth/2)/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(s,this.distance))}}}onMouseUp(){this.isDragging=!1,this.isFocus=!1,this.offsetY=0,this.offsetX=0}onMouseMove(t){const{offsetX:e,offsetY:i}=t;if(this.isOnScrollbar(e,i)&&t.target===this.ctx.target?this.isFocus=!0:this.isFocus=!1,e==this.offsetX&&i==this.offsetY)return;let s=0;if(this.type==="horizontal"?s=e-this.offsetX:s=i-this.offsetY,this.isDragging&&s!==0){let o=0;this.type==="vertical"?o=this.dragStart+s/(this.visibleDistance-this.barHeight)*this.distance:o=this.dragStart+s/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(o,this.distance))}}isPointInElement(t,e,i,s,o,r){return t>=i&&t<=i+o&&e>=s&&e<=s+r}isOnScrollbar(t,e){return this.isPointInElement(t,e,this.barX,this.barY,this.barWidth,this.barHeight)}isOnTrack(t,e){return this.isPointInElement(t,e,this.trackX,this.trackY,this.trackWidth,this.trackHeight)}updateScroll(t){t.preventDefault();const e=t.deltaX,i=t.deltaY;this.type==="vertical"&&t.shiftKey===!1?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.type==="horizontal"&&(t.shiftKey?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.scroll=Math.max(0,Math.min(this.scroll+e,this.distance)))}updatedSize(){const{body:t,header:e,config:{SCROLLER_TRACK_SIZE:i=0,SCROLLER_SIZE:s=0}}=this.ctx,o=this.ctx.target.offsetWidth,r=this.ctx.target.offsetHeight,a=e.height,h=e.width,c=t.height;if(this.type==="vertical"){this.visibleDistance=r-i-a,this.distance=c-this.visibleDistance,this.trackX=o-i,this.trackY=0,this.splitPoints=[this.trackX,a,this.trackX+i,a],this.trackWidth=i,this.trackHeight=r,this.barX=this.trackX+(i-s)/2,this.barWidth=s;const f=this.distance?this.visibleDistance/c:0;let l=Math.floor(f*this.visibleDistance);l<30?l=30:l>this.visibleDistance&&(l=0),this.barHeight=l,this.barY=a+this.scroll/this.distance*(this.visibleDistance-this.barHeight),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}else{this.visibleDistance=o-i,this.distance=h-this.visibleDistance,this.splitPoints=[o-i,r-i,o-i,r],this.trackX=0,this.trackY=r-i,this.trackWidth=o,this.trackHeight=i;const f=this.distance?this.visibleDistance/h:0;let l=Math.floor(f*this.visibleDistance);this.barY=this.trackY+(i-s)/2,l<30?l=30:l>this.visibleDistance&&(l=0),this.barWidth=l,this.barHeight=s,this.barX=this.scroll/this.distance*(this.visibleDistance-this.barWidth),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}}draw(){const{config:{SCROLLER_FOCUS_COLOR:t,SCROLLER_COLOR:e,BORDER_COLOR:i,SCROLLER_TRACK_COLOR:s}}=this.ctx;this.updatedSize(),this.ctx.paint.drawRect(this.trackX,this.trackY,this.trackWidth,this.trackHeight,{borderColor:i,fillColor:s}),this.ctx.paint.drawRect(this.barX,this.barY,this.barWidth,this.barHeight,{fillColor:this.isFocus||this.isDragging?t:e,radius:4}),this.splitPoints.length>0&&this.ctx.paint.drawLine(this.splitPoints,{borderColor:i,borderWidth:1}),this.ctx.scrollerFocus=this.isFocus}}class jt{constructor(t){n(this,"ctx");n(this,"verticalScrollbar");n(this,"horizontalScrollbar");this.ctx=t,this.verticalScrollbar=new lt(t,"vertical"),this.horizontalScrollbar=new lt(t,"horizontal"),this.ctx.on("wheel",e=>this.onWheel(e)),this.ctx.on("mousedown",e=>this.onMouseDown(e)),this.ctx.on("mousemove",e=>this.onMouseMove(e)),this.ctx.on("mouseup",()=>this.onMouseUp()),this.ctx.on("setScroll",(e,i)=>{this.setScroll(e,i)}),this.ctx.on("setScrollX",e=>{this.setScrollX(e)}),this.ctx.on("setScrollY",e=>{this.setScrollY(e)})}onWheel(t){this.verticalScrollbar.onWheel(t),this.horizontalScrollbar.onWheel(t),this.draw()}onMouseDown(t){this.verticalScrollbar.onMouseDown(t),this.horizontalScrollbar.onMouseDown(t),this.draw()}onMouseMove(t){this.verticalScrollbar.onMouseMove(t),this.horizontalScrollbar.onMouseMove(t),this.draw()}onMouseUp(){this.verticalScrollbar.onMouseUp(),this.horizontalScrollbar.onMouseUp(),this.ctx.scrollerMove=!1}draw(){this.verticalScrollbar.draw(),this.horizontalScrollbar.draw();const t=Math.floor(this.horizontalScrollbar.scroll),e=Math.floor(this.verticalScrollbar.scroll);(t!==this.ctx.scrollX||e!==this.ctx.scrollY)&&(this.ctx.scrollX=t,this.ctx.scrollY=e,this.ctx.emit("draw"),this.ctx.emit("onScroll",t,e),t!==this.ctx.scrollX&&this.ctx.emit("onScrollX",t),e!==this.ctx.scrollY&&this.ctx.emit("onScrollY",e))}setScroll(t,e){this.horizontalScrollbar.scroll=t,this.verticalScrollbar.scroll=e,this.ctx.emit("draw")}setScrollX(t){this.horizontalScrollbar.scroll=t,this.ctx.emit("draw")}setScrollY(t){this.verticalScrollbar.scroll=t,this.ctx.emit("draw")}scrollToColkey(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.key===t);i&&this.setScrollX(i.x+e.visibleWidth/2)}scrollToColIndex(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.colIndex===t);i&&i.x>e.visibleWidth/2&&this.setScrollX(i.x+e.visibleWidth/2)}scrollToRowIndex(t){const{body:e,database:i}=this.ctx,{top:s}=i.getPositionForRowIndex(t);s>e.visibleHeight&&this.setScrollY(s+e.visibleHeight/2)}scrollToRowKey(t){const{body:e,database:i}=this.ctx,s=i.getRowIndexForRowKey(t),{top:o}=i.getPositionForRowIndex(s);this.setScrollY(-o+e.visibleHeight/2)}}class Jt{constructor(t){n(this,"ctx");n(this,"x",0);n(this,"y",0);n(this,"width",0);n(this,"height",0);n(this,"resizeTarget",null);n(this,"isResizing",!1);n(this,"offsetX",0);n(this,"resizeDiff",0);n(this,"columnIndex",0);n(this,"isMouseDown",!1);n(this,"columns");n(this,"visibleLeafColumns",[]);n(this,"visibleHeight",0);n(this,"visibleWidth",0);n(this,"allCellHeaders",[]);n(this,"leafCellHeaders",[]);n(this,"renderLeafCellHeaders",[]);n(this,"fixedLeftCellHeaders",[]);n(this,"centerCellHeaders",[]);n(this,"fixedRightCellHeaders",[]);n(this,"renderCenterCellHeaders",[]);n(this,"renderFixedCellHeaders",[]);this.ctx=t,this.init(),this.initResizeColumn()}init(){const{config:{HEADER_HEIGHT:t=0,SCROLLER_TRACK_SIZE:e=0}}=this.ctx,i=this.ctx.database.getColumns();this.columns=i,this.allCellHeaders=[],this.leafCellHeaders=[],this.fixedLeftCellHeaders=[],this.fixedRightCellHeaders=[],this.centerCellHeaders=[];const s=ot(i),o=j(i);this.height=t*s,this.width=o.reduce((c,f)=>c+((f==null?void 0:f.width)||100),0),this.visibleHeight=this.height;const r=Yt(nt(i,s));this.columnIndex=0,this.render(r,0),this.ctx.database.updateColIndexKeyMap(this.leafCellHeaders);const a=this.fixedLeftCellHeaders.filter(c=>!c.hasChildren);this.ctx.fixedLeftWidth=a.reduce((c,f)=>c+f.width,0);const h=this.fixedRightCellHeaders.filter(c=>!c.hasChildren);this.ctx.fixedRightWidth=h.reduce((c,f)=>c+f.width,e),this.ctx.maxColIndex=this.leafCellHeaders.length-1,this.ctx.header.x=this.x,this.ctx.header.y=this.y,this.ctx.header.width=this.width,this.ctx.header.height=this.height,this.ctx.header.visibleHeight=this.visibleHeight}initResizeColumn(){const{config:{ENABLE_RESIZE_COLUMN:t}}=this.ctx;t&&(this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetX=e.offsetX,this.resizeTarget?(this.isResizing=!0,this.ctx.columnResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeColumn(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.isResizing=!1,this.ctx.columnResizing=!1,this.offsetX=0}),this.ctx.on("mousemove",e=>{const{target:i,config:{RESIZE_COLUMN_MIN_WIDTH:s=0}}=this.ctx;if(this.isResizing&&this.resizeTarget){const o=this.resizeTarget.width;let r=e.offsetX-this.offsetX;r+o<s&&(r=-(o-s)),this.resizeDiff=r,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown)return;this.ctx.target.style.cursor==="col-resize"&&(this.ctx.target.style.cursor="default");const o=[...this.renderFixedCellHeaders,...this.renderCenterCellHeaders];for(const r of o){const a=e.layerX,h=r.getDrawX();a>h+r.width-5&&a<h+r.width+4&&a<i.offsetWidth-4&&r.colspan<=1&&e.target instanceof HTMLCanvasElement&&this.ctx.isTarget(e.target)&&e.layerY<=this.height&&(this.ctx.target.style.cursor="col-resize",this.resizeTarget=r)}}}))}resizeColumn(t,e){const i=s=>{s.forEach(o=>{if(o.children&&o.children.length>0&&i(o.children),o.key===t.key){const r=o.width||100;o.width=r+e}})};i(this.columns),this.ctx.database.setColumns(this.columns),this.init(),this.ctx.emit("draw"),this.ctx.emit("resizeColumnChange",{colIndex:t.colIndex,key:t.key,oldWidth:t.width,width:t.width+e,column:t.column,columns:this.columns})}getWidthByColIndexColSpan(t,e){if(e===0)return 0;let i=0;for(let s=t;s<t+e;s++){const o=this.leafCellHeaders[s];i+=o.width}return i}render(t,e){const i=t.length;let s=e;const{HEADER_HEIGHT:o=0}=this.ctx.config;for(let r=0;r<i;r++){const a=t[r],h=o*(a.rowspan||1),c=o*a.level;let f=a.width||100;a.children&&(f=j(a.children).reduce((w,p)=>w+((p==null?void 0:p.width)||100),0));const l=new ct(this.ctx,this.columnIndex,s,c,f,h,a);this.ctx.database.setHeader(a.key,l),this.allCellHeaders.push(l),a.children||this.leafCellHeaders.push(l),a.fixed==="left"?this.fixedLeftCellHeaders.push(l):a.fixed==="right"?this.fixedRightCellHeaders.push(l):this.centerCellHeaders.push(l),!a.children&&this.columnIndex++,a.children&&this.render(a.children,s),s+=f}}update(){const t=[],e=[],i=[];this.ctx.database.clearRenderHeaderCell(),this.centerCellHeaders.forEach(r=>{r.isHorizontalVisible()&&r.isVerticalVisible()&&(e.push(r),r.hasChildren||t.push(r))}),this.fixedLeftCellHeaders.forEach(r=>{i.push(r),r.hasChildren||t.push(r)}),this.fixedRightCellHeaders.forEach(r=>{i.push(r),r.hasChildren||t.push(r)}),this.renderCenterCellHeaders=e,this.renderFixedCellHeaders=i,this.renderLeafCellHeaders=t.sort((r,a)=>r.x-a.x),this.visibleLeafColumns=this.renderLeafCellHeaders.map(r=>r.column);const{config:{SCROLLER_TRACK_SIZE:s=0},target:o}=this.ctx;this.visibleWidth=o.offsetWidth-s,this.ctx.header.visibleLeafColumns=this.visibleLeafColumns,this.ctx.header.visibleWidth=this.visibleWidth,this.ctx.header.visibleHeight=this.visibleHeight,this.ctx.header.leafCellHeaders=this.leafCellHeaders,this.ctx.header.renderLeafCellHeaders=this.renderLeafCellHeaders,this.ctx.header.renderCellHeaders=this.renderFixedCellHeaders.concat(this.renderCenterCellHeaders)}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,config:{RESIZE_COLUMN_LINE_COLOR:e}}=this.ctx,i=this.resizeTarget.getDrawX(),s=this.resizeTarget.width,o=i+s+this.resizeDiff-.5,r=[o+.5,0,o+.5,t.offsetHeight];this.ctx.paint.drawLine(r,{borderColor:e,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<s.width-s.visibleWidth&&e!==a){const h=s.width-(this.x+this.width)+o.offsetWidth-e;this.ctx.paint.drawShadow(h+.5,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}draw(){this.renderCenterCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawFiexShadow(),this.renderFixedCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawTipLine()}}class Qt{constructor(t,e,i=0,s=0,o=0,r=0,a,h="body"){n(this,"ctx");n(this,"x",0);n(this,"y",0);n(this,"width",0);n(this,"height");n(this,"cells",[]);n(this,"fixedCells",[]);n(this,"noFixedCells",[]);n(this,"rowIndex",0);n(this,"rowKey","");n(this,"rowType","body");n(this,"data");this.ctx=t,this.x=i,this.y=s,this.width=o,this.height=r,this.rowIndex=e,this.rowKey=t.database.getRowKeyForRowIndex(e),this.rowType=h,this.data=a,this.update()}update(){const{header:t}=this.ctx,e=[],i=[],s=[];t.renderLeafCellHeaders.forEach(o=>{const r=new ht(this.ctx,this.rowIndex,o.colIndex,o.x,this.y,o.width,this.height,o.column,this.data,this.rowType);r.fixed?i.push(r):s.push(r),e.push(r)}),this.cells=e,this.fixedCells=i,this.noFixedCells=s}drawCenter(){this.noFixedCells.forEach(t=>{t.draw()})}drawFixed(){this.fixedCells.forEach(t=>{t.draw()})}draw(){this.noFixedCells.forEach(t=>{t.draw()}),this.fixedCells.forEach(t=>{t.draw()})}}class te{constructor(t){n(this,"resizeTarget",null);n(this,"isMouseDown",!1);n(this,"resizeDiff",0);n(this,"offsetY",0);n(this,"ctx");n(this,"x",0);n(this,"y",0);n(this,"width",0);n(this,"height",0);n(this,"headIndex",0);n(this,"tailIndex",0);n(this,"isResizing",!1);n(this,"renderRows",[]);n(this,"visibleRows",[]);n(this,"visibleHeight",0);n(this,"visibleWidth",0);n(this,"data",[]);this.ctx=t,this.init(),this.initResizeRow()}init(){var H;const{target:t,header:e,database:i,config:{FOOTER_FIXED:s,CELL_FOOTER_HEIGHT:o=0,SCROLLER_TRACK_SIZE:r=0,BORDER_COLOR:a,BORDER_RADIUS:h,HEIGHT:c,WIDTH:f,EMPTY_BODY_HEIGHT:l=0,MAX_HEIGHT:x=0,ENABLE_OFFSET_HEIGHT:w=0,OFFSET_HEIGHT:p=0}}=this.ctx;if(!e.width)return;this.x=0,this.y=e.height;const{data:g,sumHeight:y}=i.getData();this.height=y,this.data=g;const{left:u,top:C}=t.getBoundingClientRect();this.width=e.width;const m=window.innerWidth,b=((H=t.parentElement)==null?void 0:H.clientWidth)||m-u,I=this.width+r;let v=0;f?v=f:I>b?v=b:v=I,t.width=v,this.visibleWidth=t.width-r;const S=this.ctx.database.getFooterData().reduce(V=>V+o,0);this.data.length||(this.height=l);const K=this.data.length?"not-empty":"empty";this.ctx.emit("emptyChange",{isEmpty:K,headerHeight:e.height,bodyHeight:this.height,width:this.width,height:this.data.length?0:l+S});let N=this.height+e.height+r;N+=S;let A=0;this.data.length&&w?(A=window.innerHeight-C-p,A<0&&(A=32,console.error("There is an error in the height calculation ENABLE_OFFSET_HEIGHT and OFFSET_HEIGHT are invalid"))):this.data.length&&c?A=c:this.data.length&&x&&N>x?A=x:A=N,t.setAttribute("style",`outline: none; position: relative; border-radius: ${h}px; border: 1px solid ${a}; height:${A}px;width:${v-1}px;`),A>0&&(t.height=A);let T=t.height-e.height-r;s?this.visibleHeight=T-S:this.visibleHeight=T,this.ctx.body.x=this.x,this.ctx.body.y=this.y,this.ctx.body.width=this.width,this.ctx.body.height=this.height,this.ctx.body.visibleWidth=this.visibleWidth,this.ctx.body.visibleHeight=this.visibleHeight,this.ctx.body.data=g}initResizeRow(){const{config:{ENABLE_RESIZE_ROW:t}}=this.ctx;t&&(this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeRow(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.resizeDiff=0,this.isResizing=!1,this.ctx.rowResizing=!1,this.offsetY=0}),this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetY=e.offsetY,this.resizeTarget?(this.isResizing=!0,this.ctx.rowResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mousemove",e=>{const i=e.offsetY,s=e.offsetX,{target:o,scrollY:r,config:{RESIZE_ROW_MIN_HEIGHT:a=0}}=this.ctx;if(this.isResizing&&this.resizeTarget){const h=this.resizeTarget.height;let c=i-this.offsetY;c+h<a&&(c=-(h-a)),this.resizeDiff=c,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown||this.ctx.target.style.cursor==="crosshair")return;this.ctx.target.style.cursor==="row-resize"&&(this.ctx.target.style.cursor="default");for(let h=0;h<this.renderRows.length;h++){const c=this.renderRows[h];if(i>c.y-r+c.height-1.5&&i<c.y-r+c.height+1.5&&i<o.offsetHeight-4)for(let l=0;l<c.cells.length;l++){const x=c.cells[l];s>x.drawX+10&&s<x.drawX+x.width-10&&x.rowspan===1&&(this.ctx.target.style.cursor="row-resize",this.resizeTarget=c)}}}}))}resizeRow(t,e){const{rowIndex:i,height:s,rowKey:o,data:r}=t;this.ctx.database.setRowHeight(i,s+e),this.init(),this.ctx.emit("draw"),this.ctx.emit("resizeRowChange",{rowIndex:i,oldHeight:s,height:s+e,rowKey:o,row:r,data:this.data})}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,scrollY:e,config:{RESIZE_ROW_LINE_COLOR:i}}=this.ctx,s=this.resizeTarget.y-e,o=this.resizeTarget.height,r=s+o+this.resizeDiff-.5,a=[0,r+.5,t.offsetWidth,r+.5];this.ctx.paint.drawLine(a,{borderColor:i,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<s.width-s.visibleWidth&&e!==a){const h=s.width-(this.x+this.width)+o.offsetWidth-e;this.ctx.paint.drawShadow(h+.5,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}binarySearch(t,e){let i=0,s=t.length-1,o=-1;for(;i<=s;){let r=Math.floor((i+s)/2),a=t[r].bottom;if(a===e)return r;a<e?i=r+1:(o=r,s=r-1)}return o}update(){this.init();const{header:t,database:e,scrollY:i}=this.ctx,s=i,{data:o,positions:r}=e.getData();this.ctx.maxRowIndex=o.length-1;const a=this.binarySearch(r,s);let h=this.binarySearch(r,s+this.visibleHeight);h===-1&&(h=o.length),this.headIndex=Math.max(0,a),this.tailIndex=Math.min(this.ctx.maxRowIndex,h+1),this.visibleRows=o.slice(this.headIndex,this.tailIndex+1),this.ctx.body.headIndex=this.headIndex,this.ctx.body.tailIndex=this.tailIndex,this.ctx.body.visibleRows=this.visibleRows;const c=[];for(let f=0;f<this.visibleRows.length;f++){const l=this.headIndex+f,x=this.visibleRows[f],{height:w,top:p}=this.ctx.database.getPositionForRowIndex(l),g=new Qt(this.ctx,l,0,p+this.y,t.width,w,x);c.push(g)}this.renderRows=c,this.ctx.body.renderRows=c}draw(){this.renderRows.forEach(t=>{t.drawCenter()}),this.drawFiexShadow(),this.renderRows.forEach(t=>{t.drawFixed()}),this.drawTipLine()}}class ee{constructor(t){n(this,"isCut",!1);n(this,"isMultipleRow",!1);n(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellHoverChange",t=>{if(!this.ctx.autofillMove){if(["index-selection","selection","index"].includes(t.type)){this.selectRows(t,!1);return}this.isMultipleRow||this.mouseenter()}}),this.ctx.on("cellMousedown",(t,e)=>{if(this.ctx.isTarget(e.target)&&this.ctx.target.style.cursor!=="pointer"&&!this.ctx.isPointer&&this.ctx.target.style.cursor!=="crosshair"){if(["index-selection","selection","index"].includes(t.type)){this.isMultipleRow=!0,this.selectRows(t);return}this.isMultipleRow=!1,this.click(e.shiftKey)}}),this.ctx.on("cellHeaderHoverChange",t=>{this.ctx.mousedown&&this.selectCols(t)}),this.ctx.on("cellHeaderMousedown",t=>{this.ctx.target.style.cursor!=="pointer"&&(this.ctx.isPointer||this.selectCols(t))}),this.ctx.on("keydown",t=>{if(t.ctrlKey&&t.code==="KeyV"||t.metaKey&&t.code==="KeyV"){this.paste();return}if(t.ctrlKey&&t.code==="KeyC"||t.metaKey&&t.code==="KeyC"){t.preventDefault(),this.copy(),this.isCut=!1;return}if(t.ctrlKey&&t.code==="KeyX"||t.metaKey&&t.code==="KeyX"){t.preventDefault(),this.isCut=!0,this.copy();return}if((t.ctrlKey&&t.code==="KeyA"||t.metaKey&&t.code==="KeyA")&&(t.preventDefault(),this.selectAll()),t.code==="ArrowLeft"){t.preventDefault(),this.moveFocus("LEFT");return}if(t.code==="ArrowUp"){t.preventDefault(),this.moveFocus("TOP");return}if(t.code==="ArrowRight"||t.code==="Tab"){t.preventDefault(),this.moveFocus("RIGHT");return}if(t.code==="ArrowDown"){t.preventDefault(),this.moveFocus("BOTTOM");return}if(t.code==="Delete"||t.code==="Backspace"){t.preventDefault();const{xArr:e,yArr:i}=this.ctx.selector;this.clearSelectedData(e,i);return}})}setSelector(t,e){const{ENABLE_SELECTOR_SPAN_COL:i,ENABLE_SELECTOR_SPAN_ROW:s}=this.ctx.config;let o=t,r=e;if(!s){const[a]=r;r=[a,a]}if(!i){const[a]=o;o=[a,a]}(JSON.stringify(this.ctx.selector.xArr)!==JSON.stringify(o)||JSON.stringify(this.ctx.selector.yArr)!==JSON.stringify(r))&&(this.ctx.selector.enable=!0,this.ctx.selector.xArr=o,this.ctx.selector.yArr=r,this.ctx.emit("setSelector",this.ctx.selector),this.ctx.emit("draw"))}selectCols(t){if(this.ctx.columnResizing||this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_ROWS)return;if(["index","index-selection","selection"].includes(t.type)){this.selectAll();return}const e=0,i=this.ctx.maxRowIndex;if(this.ctx.mousedown&&this.ctx.focusCellHeader){const{colIndex:s}=this.ctx.focusCellHeader;if(t.colIndex>=s){const o=[s,t.colIndex+t.colspan-1],r=[e,i];this.setSelector(o,r)}else{const o=[t.colIndex,s],r=[e,i];this.setSelector(o,r)}}else{const s=[t.colIndex,t.colIndex+t.colspan-1],o=[e,i];this.setSelector(s,o)}}selectAll(){const{ENABLE_SELECTOR_ALL_ROWS:t,ENABLE_SELECTOR_ALL_COLS:e}=this.ctx.config;if(t&&e){const s=this.ctx.maxColIndex,o=0,r=this.ctx.maxRowIndex,a=[1,s],h=[o,r];this.setSelector(a,h)}}selectRows(t,e=!0){if(this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_COLS)return;const i=this.ctx.maxColIndex,s=t.colIndex+1;if(e){this.ctx.setFocusCell(t);const o=[s,i],r=[t.rowIndex,t.rowIndex];this.setSelector(o,r)}if(this.ctx.focusCell&&this.ctx.mousedown){const{rowIndex:o}=this.ctx.focusCell;if(t.rowIndex>=o){const r=[s,i],a=[o,t.rowIndex];this.setSelector(r,a)}else{const r=[s,i],a=[t.rowIndex,o];this.setSelector(r,a)}}}mouseenter(){if(this.ctx.config.ENABLE_SELECTOR_SINGLE)return;const{mousedown:t,focusCell:e,hoverCell:i}=this.ctx;if(t&&e&&i){const{rowIndex:s,colIndex:o}=e,r=Math.min(i.colIndex,o),a=Math.max(i.colIndex,o),h=Math.min(i.rowIndex,s),c=Math.max(i.rowIndex,s),f=[r,a],l=[h,c];this.setSelector(f,l)}}click(t=!1){const{focusCell:e,clickCell:i}=this.ctx;if(e)if(this.ctx.selector.enable=!0,i&&t){const{colIndex:s,rowIndex:o}=i,{colIndex:r,rowIndex:a}=e,h=Math.min(r,s),c=Math.max(r,s),f=Math.min(a,o),l=Math.max(a,o),x=[h,c],w=[f,l];this.setSelector(x,w)}else{const s=[e.colIndex,e.colIndex],o=[e.rowIndex,e.rowIndex];this.setSelector(s,o),this.adjustBoundaryPosition()}}clearSelector(){this.ctx.selector.enable=!1,this.ctx.selector.xArr=[-1,-1],this.ctx.selector.yArr=[-1,-1],this.clearCopyLine()}clearCopyLine(){this.ctx.selector.xArrCopy=[-1,-1],this.ctx.selector.yArrCopy=[-1,-1]}getCell(t,e){const i=this.ctx.body.renderRows.find(o=>o.rowIndex===t);return i==null?void 0:i.cells.find(o=>o.colIndex===e)}copy(){if(!this.ctx.config.ENABLE_COPY)return;const{text:t}=this.ctx.getSelectedData();navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{this.ctx.selector.xArrCopy=this.ctx.selector.xArr.slice(),this.ctx.selector.yArrCopy=this.ctx.selector.yArr.slice(),this.ctx.emit("setCopy",this.ctx.selector),this.ctx.emit("draw")}).catch(e=>console.error("复制失败：",e)):console.error("当前浏览器不支持Clipboard API")}clearSelectedData(t,e,i=!1){let s=[];const o=new Set;for(let a=0;a<=e[1]-e[0];a++)for(let h=0;h<=t[1]-t[0];h++){const c=a+e[0],f=h+t[0],l=this.ctx.database.getItemValueForRowIndexAndColIndex(c,f);if(l){const{rowKey:x,key:w}=l;this.ctx.database.getReadonly(x,w)||(o.add(x),s.push({rowKey:x,key:w,value:null,row:{}}))}}if(!s.length)return[];if(i)return s;this.ctx.database.batchSetItemValue(s,!0);let r=[];return o.forEach(a=>{r.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("clearSelectedDataChange",s,r),s}paste(){if(!navigator.clipboard){console.error("当前浏览器不支持Clipboard API");return}const{ENABLE_PASTER:t}=this.ctx.config;if(this.ctx.selector.enable&&t){const e=this.ctx.selector.yArr[0],i=this.ctx.selector.xArr[0],s=new Set;navigator.clipboard.readText().then(o=>{let r=[];const a=o.split("\r");a.length===1?r=a[0].split(`
`).map(l=>l.split("	")):r=a.map(f=>f.split("	"));let h=[];for(let f=0;f<=r.length-1;f++){const l=r[f].length;for(let x=0;x<=l-1;x++){const w=f+e,p=x+i,g=r[f][x],y=this.ctx.database.getItemValueForRowIndexAndColIndex(w,p);if(y){const{rowKey:u,key:C}=y;this.ctx.database.getReadonly(u,C)||(s.add(u),h.push({rowKey:u,key:C,value:g,row:{}}))}}}if(this.isCut){const f=this.clearSelectedData(this.ctx.selector.xArrCopy,this.ctx.selector.yArrCopy,!0),l=h.map(x=>`${x.rowKey}-${x.key}`);f.forEach(x=>{l.includes(`${x.rowKey}-${x.key}`)||h.unshift(x)}),this.isCut=!1}if(!h.length)return;this.ctx.database.batchSetItemValue(h,!0);let c=[];s.forEach(f=>{c.push(this.ctx.database.getRowDataItemForRowKey(f))}),this.ctx.emit("pasteChange",h,c),this.clearCopyLine(),this.ctx.emit("draw")}).catch(o=>{console.error("获取剪贴板内容失败：",o)})}}moveFocus(t){const{focusCell:e}=this.ctx;if(!e)return;let{colIndex:i=0,rowIndex:s=0}=e;const o=0,r=0,a=this.ctx.maxColIndex,h=this.ctx.maxRowIndex;switch(t){case"LEFT":i>o&&i--;break;case"TOP":s>r&&s--;break;case"RIGHT":i<a&&i++;break;case"BOTTOM":s<h&&s++;break}const c=[i,i],f=[s,s],l=this.getCell(s,i);l&&this.ctx.setFocusCell(l),this.setSelector(c,f),this.adjustBoundaryPosition()}adjustBoundaryPosition(){const{target:t,focusCell:e,fixedRightWidth:i,fixedLeftWidth:s,header:o,footer:r,scrollX:a,scrollY:h}=this.ctx;if(!e)return;const{SCROLLER_TRACK_SIZE:c=0,FOOTER_FIXED:f}=this.ctx.config;let l=0;f&&(l=r.visibleHeight);const x=s-e.drawX+1,w=e.drawX+e.width-(t.offsetWidth-i)+1,p=o.height-e.drawY,g=e.drawY+e.height-(t.offsetHeight-l-c);w>0&&!e.fixed?this.ctx.setScrollX(a+w):x>0&&!e.fixed&&this.ctx.setScrollX(a-x),p>0?this.ctx.setScrollY(h-p):g>0&&this.ctx.setScrollY(h+g)}destroy(){}}class ie{constructor(t){n(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellMouseenter",(t,e)=>{this.ctx.target.style.cursor==="crosshair"&&(this.ctx.target.style.cursor="default");const{xArr:i,yArr:s}=this.ctx.selector,o=i[1],r=s[1],{colIndex:a,rowIndex:h,drawX:c,drawY:f,width:l,height:x}=t;if(this.ctx.config.ENABLE_AUTOFILL&&a===o&&h===r){const p=c+l-6,g=f+x-6;e.offsetX>p&&e.offsetY>g&&(this.ctx.target.style.cursor="crosshair")}this.mouseenter(t)}),this.ctx.on("cellMousedown",()=>{this.ctx.target.style.cursor==="crosshair"&&this.setMousedown()}),this.ctx.on("mouseup",()=>{this.setMouseUp()})}isAutofillIng(){const{xArr:t,yArr:e}=this.ctx.selector;return!(JSON.stringify(this.ctx.autofill.xArr)===JSON.stringify(t)&&JSON.stringify(this.ctx.autofill.yArr)===JSON.stringify(e))}setMousedown(){this.ctx.autofill.enable=!0,this.ctx.autofillMove=!0}setMouseUp(){if(!this.ctx.autofill.enable)return;this.isAutofillIng()&&this.autofillData(),this.ctx.autofill.enable=!1,this.ctx.autofillMove=!1,this.ctx.autofill.xArr=[-1,-1],this.ctx.autofill.yArr=[-1,-1]}setAutofill(t,e){const{ENABLE_AUTOFILL:i,ENABLE_SELECTOR_SPAN_COL:s,ENABLE_SELECTOR_SPAN_ROW:o}=this.ctx.config;if(!i)return;let r=t,a=e;if(!o){const[h]=a;a=[h,h]}if(!s){const[h]=r;r=[h,h]}(JSON.stringify(this.ctx.autofill.xArr)!==JSON.stringify(r)||JSON.stringify(this.ctx.autofill.yArr)!==JSON.stringify(a))&&(this.ctx.autofill.xArr=r,this.ctx.autofill.yArr=a,this.ctx.emit("setAutofill",this.ctx.autofill),this.ctx.emit("draw"))}autofillData(){const t=new Set,e=this.ctx.getSelectedData(),i=new Map;for(let l=0;l<=e.yArr[1]-e.yArr[0];l++)for(let x=0;x<=e.xArr[1]-e.xArr[0];x++){const w=l+e.yArr[0],p=x+e.xArr[0];i.set(`${w}-${p}`,!0)}const{value:s}=e,o=s[0].length,r=s.length,a=this.ctx.autofill.xArr,h=this.ctx.autofill.yArr;let c=[];for(let l=0;l<=h[1]-h[0];l++)for(let x=0;x<=a[1]-a[0];x++){const w=x+a[0],p=l+h[0],g=s[l%r][x%o],y=this.ctx.database.getItemValueForRowIndexAndColIndex(p,w),u=`${p}-${w}`;if(y&&!i.has(u)){const{rowKey:C,key:m}=y;this.ctx.database.getReadonly(C,m)||(t.add(C),c.push({rowKey:C,key:m,value:g,row:{}}))}}if(!c.length)return;this.ctx.database.batchSetItemValue(c,!0);let f=[];t.forEach(l=>{f.push(this.ctx.database.getRowDataItemForRowKey(l))}),this.ctx.emit("autofillChange",c,f),this.ctx.selector.xArr=this.ctx.autofill.xArr,this.ctx.selector.yArr=this.ctx.autofill.yArr,this.ctx.emit("draw")}mouseenter(t){if(["index","selection","index-selection"].includes(t.type))return;const{selector:e,autofill:i}=this.ctx;if(this.ctx.mousedown&&e.enable&&i.enable){const{rowIndex:s,colIndex:o}=t,r=e.xArr.slice(),a=e.yArr.slice();s>=e.yArr[0]&&s<=e.yArr[1]?o>e.xArr[1]?r.splice(1,1,o):o<e.xArr[0]&&r.splice(0,1,o):s>e.yArr[1]?a.splice(1,1,s):s<e.yArr[0]&&a.splice(0,1,s),this.setAutofill(r,a)}}destroy(){}}class se{constructor(t){n(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellHoverChange",t=>{t.ellipsis&&this.show(t)}),this.ctx.on("cellMouseleave",()=>{this.hide()})}show(t){let e=t.getText();t.message&&(e=t.message),this.ctx.emit("overlayerTooltipChange",{cell:t,text:e,show:!0})}hide(){this.ctx.emit("overlayerTooltipChange",{cell:{},text:"",show:!1})}destroy(){}}class re{constructor(t,e){n(this,"target");n(this,"scroller");n(this,"header");n(this,"body");n(this,"selector");n(this,"autofill");n(this,"tooltip");n(this,"ctx");this.target=t,this.ctx=new $t(t,e),this.header=new Jt(this.ctx),this.body=new te(this.ctx),this.scroller=new jt(this.ctx),this.selector=new ee(this.ctx),this.autofill=new ie(this.ctx),this.tooltip=new se(this.ctx),console.log(this.ctx);const{config:{BORDER_COLOR:i,BORDER_RADIUS:s,WIDTH:o=0,HEIGHT:r=0}}=this.ctx;this.target.width=o-1,this.target.height=r-1,this.target.setAttribute("style",`outline: none; position: relative; border-radius: ${s}px; border: 1px solid ${i};`),this.ctx.on("draw",this.draw.bind(this)),this.draw()}draw(){requestAnimationFrame(()=>{console.time("draw"),this.header.update(),this.body.update(),this.ctx.paint.clear(),this.body.draw(),this.header.draw(),this.scroller.draw(),console.timeEnd("draw")})}loadConfig(t){}loadColumns(t){this.ctx.database.setColumns(t),this.ctx.emit("draw")}loadData(t){this.ctx.database.setData(t),this.ctx.emit("draw")}loadFooterData(t){this.ctx.database.setFooterData(t),this.ctx.emit("draw")}setLoading(t){this.ctx.database.setLoading(t)}on(t,e){this.ctx.on(t,e)}off(t,e){this.ctx.off(t,e)}filterMethod(t){this.ctx.setScrollY(0),this.ctx.setScrollX(0),this.ctx.database.init(),this.ctx.database.setFilterMethod(t),this.ctx.emit("draw")}setItemValue(t,e,i,s=!0,o=!0){this.ctx.database.setItemValue(t,e,i,s,o,!1)}batchSetItemValue(t,e=!0,i=!0){this.ctx.database.batchSetItemValue(t,e),i&&this.ctx.emit("draw")}setItemValueByEditor(t,e,i,s=!0,o=!0){this.ctx.database.setItemValue(t,e,i,s,o,!0)}doLayout(){this.ctx.emit("draw")}getChangedData(){return this.ctx.database.getChangedData()}getChangedRows(){return this.ctx.database.getChangedRows()}clearValidate(){this.ctx.database.clearValidate(),this.ctx.emit("draw")}async validate(t=!0){return new Promise(async(e,i)=>{try{const s=await this.getValidations();e(s)}catch(s){if(t&&Array.isArray(s)&&s.length){const[o]=s;if(Array.isArray(o)&&o.length){const[r]=o,{rowKey:a,key:h}=r;this.scrollToRowkey(a),this.scrollToColkey(h)}}i(s)}})}getValidations(){return new Promise(async(t,e)=>{const i=this.ctx.database.getAllRowsData(),s=this.header.leafCellHeaders;let o=[];for(let r=0;r<i.length;r++)for(let a=0;a<s.length;a++){const h=this.ctx.database.getRowKeyByItem(i[r]),f=s[a].key,l=await this.ctx.database.getValidator(h,f);Array.isArray(l)&&l.length&&o.push(l)}o.length?(e(o),this.ctx.emit("draw")):(t([]),this.ctx.emit("draw"))})}scrollTo(t,e){this.scrollXTo(t),this.scrollYTo(e)}scrollXTo(t){this.ctx.setScrollX(t)}scrollToColkey(t){this.scroller.scrollToColkey(t)}scrollToRowkey(t){this.scroller.scrollToRowKey(t)}scrollToColIndex(t){this.scroller.scrollToColIndex(t)}scrollToRowIndex(t){this.scroller.scrollToRowIndex(t)}scrollYTo(t){this.ctx.setScrollY(t)}clearSelection(){this.ctx.database.clearSelection(),this.ctx.emit("draw")}toggleRowSelection(t){const e=this.ctx.database.getRowKeyByItem(t);this.ctx.database.toggleRowSelection(e),this.ctx.emit("draw")}setSelectionByRows(t,e=!0){t.forEach(i=>{const s=this.ctx.database.getRowKeyByItem(i);this.ctx.database.setRowSelection(s,e)}),this.ctx.emit("draw")}setSelectionByRowKeys(t,e=!0){t.forEach(i=>{this.ctx.database.setRowSelection(i,e)}),this.ctx.emit("draw")}toggleAllSelection(){this.ctx.database.toggleAllSelection(),this.ctx.emit("draw")}getSelectionRows(){return this.ctx.database.getSelectionRows()}getPositionForRowIndex(t){return this.ctx.database.getPositionForRowIndex(t)}destroy(){this.tooltip.destroy(),this.selector.destroy(),this.autofill.destroy(),this.ctx.destroy(),this.target.remove(),console.log("销毁")}}return re});
//# sourceMappingURL=index.umd.js.map
