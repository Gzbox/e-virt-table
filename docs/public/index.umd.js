(function(S,M){typeof exports=="object"&&typeof module<"u"?module.exports=M():typeof define=="function"&&define.amd?define(M):(S=typeof globalThis<"u"?globalThis:S||self,S.EVirtTable=M())})(this,function(){"use strict";var Xi=Object.defineProperty;var Yi=(S,M,V)=>M in S?Xi(S,M,{enumerable:!0,configurable:!0,writable:!0,value:V}):S[M]=V;var c=(S,M,V)=>Yi(S,typeof M!="symbol"?M+"":M,V);function S(){return S=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},S.apply(this,arguments)}function M(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,st(n,t)}function V(n){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(n)}function st(n,t){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},st(n,t)}function de(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ft(n,t,e){return de()?ft=Reflect.construct.bind():ft=function(s,o,r){var a=[null];a.push.apply(a,o);var h=Function.bind.apply(s,a),l=new h;return r&&st(l,r.prototype),l},ft.apply(null,arguments)}function fe(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function bt(n){var t=typeof Map=="function"?new Map:void 0;return bt=function(i){if(i===null||!fe(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(i))return t.get(i);t.set(i,s)}function s(){return ft(i,arguments,V(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),st(s,i)},bt(n)}var ue=/%[sdj%]/g,kt=function(){};typeof process<"u"&&process.env&&process.env.NODE_ENV!=="production"&&typeof window<"u"&&typeof document<"u"&&(kt=function(t,e){typeof console<"u"&&console.warn&&typeof ASYNC_VALIDATOR_NO_WARNING>"u"&&e.every(function(i){return typeof i=="string"})&&console.warn(t,e)});function Et(n){if(!n||!n.length)return null;var t={};return n.forEach(function(e){var i=e.field;t[i]=t[i]||[],t[i].push(e)}),t}function F(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];var s=0,o=e.length;if(typeof n=="function")return n.apply(null,e);if(typeof n=="string"){var r=n.replace(ue,function(a){if(a==="%%")return"%";if(s>=o)return a;switch(a){case"%s":return String(e[s++]);case"%d":return Number(e[s++]);case"%j":try{return JSON.stringify(e[s++])}catch{return"[Circular]"}break;default:return a}});return r}return n}function xe(n){return n==="string"||n==="url"||n==="hex"||n==="email"||n==="date"||n==="pattern"}function O(n,t){return!!(n==null||t==="array"&&Array.isArray(n)&&!n.length||xe(t)&&typeof n=="string"&&!n)}function ge(n,t,e){var i=[],s=0,o=n.length;function r(a){i.push.apply(i,a||[]),s++,s===o&&e(i)}n.forEach(function(a){t(a,r)})}function Kt(n,t,e){var i=0,s=n.length;function o(r){if(r&&r.length){e(r);return}var a=i;i=i+1,a<s?t(n[a],o):e([])}o([])}function we(n){var t=[];return Object.keys(n).forEach(function(e){t.push.apply(t,n[e]||[])}),t}var Bt=function(n){M(t,n);function t(e,i){var s;return s=n.call(this,"Async Validation Error")||this,s.errors=e,s.fields=i,s}return t}(bt(Error));function pe(n,t,e,i,s){if(t.first){var o=new Promise(function(u,x){var w=function(p){return i(p),p.length?x(new Bt(p,Et(p))):u(s)},g=we(n);Kt(g,e,w)});return o.catch(function(u){return u}),o}var r=t.firstFields===!0?Object.keys(n):t.firstFields||[],a=Object.keys(n),h=a.length,l=0,f=[],d=new Promise(function(u,x){var w=function(y){if(f.push.apply(f,y),l++,l===h)return i(f),f.length?x(new Bt(f,Et(f))):u(s)};a.length||(i(f),u(s)),a.forEach(function(g){var y=n[g];r.indexOf(g)!==-1?Kt(y,e,w):ge(y,e,w)})});return d.catch(function(u){return u}),d}function ye(n){return!!(n&&n.message!==void 0)}function me(n,t){for(var e=n,i=0;i<t.length;i++){if(e==null)return e;e=e[t[i]]}return e}function Xt(n,t){return function(e){var i;return n.fullFields?i=me(t,n.fullFields):i=t[e.field||n.fullField],ye(e)?(e.field=e.field||n.fullField,e.fieldValue=i,e):{message:typeof e=="function"?e():e,fieldValue:i,field:e.field||n.fullField}}}function Yt(n,t){if(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];typeof i=="object"&&typeof n[e]=="object"?n[e]=S({},n[e],i):n[e]=i}}return n}var Wt=function(t,e,i,s,o,r){t.required&&(!i.hasOwnProperty(t.field)||O(e,r||t.type))&&s.push(F(o.messages.required,t.fullField))},be=function(t,e,i,s,o){(/^\s+$/.test(e)||e==="")&&s.push(F(o.messages.whitespace,t.fullField))},ut,Ee=function(){if(ut)return ut;var n="[a-fA-F\\d:]",t=function(b){return b&&b.includeBoundaries?"(?:(?<=\\s|^)(?="+n+")|(?<="+n+")(?=\\s|$))":""},e="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",s=(`
(?:
(?:`+i+":){7}(?:"+i+`|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:`+i+":){6}(?:"+e+"|:"+i+`|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:`+i+":){5}(?::"+e+"|(?::"+i+`){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:`+i+":){4}(?:(?::"+i+"){0,1}:"+e+"|(?::"+i+`){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:`+i+":){3}(?:(?::"+i+"){0,2}:"+e+"|(?::"+i+`){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:`+i+":){2}(?:(?::"+i+"){0,3}:"+e+"|(?::"+i+`){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:`+i+":){1}(?:(?::"+i+"){0,4}:"+e+"|(?::"+i+`){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::`+i+"){0,5}:"+e+"|(?::"+i+`){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`).replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp("(?:^"+e+"$)|(?:^"+s+"$)"),r=new RegExp("^"+e+"$"),a=new RegExp("^"+s+"$"),h=function(b){return b&&b.exact?o:new RegExp("(?:"+t(b)+e+t(b)+")|(?:"+t(b)+s+t(b)+")","g")};h.v4=function(m){return m&&m.exact?r:new RegExp(""+t(m)+e+t(m),"g")},h.v6=function(m){return m&&m.exact?a:new RegExp(""+t(m)+s+t(m),"g")};var l="(?:(?:[a-z]+:)?//)",f="(?:\\S+(?::\\S*)?@)?",d=h.v4().source,u=h.v6().source,x="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",w="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",y="(?::\\d{2,5})?",p='(?:[/?#][^\\s"]*)?',E="(?:"+l+"|www\\.)"+f+"(?:localhost|"+d+"|"+u+"|"+x+w+g+")"+y+p;return ut=new RegExp("(?:^"+E+"$)","i"),ut},Pt={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},rt={integer:function(t){return rt.number(t)&&parseInt(t,10)===t},float:function(t){return rt.number(t)&&!rt.integer(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch{return!1}},date:function(t){return typeof t.getTime=="function"&&typeof t.getMonth=="function"&&typeof t.getYear=="function"&&!isNaN(t.getTime())},number:function(t){return isNaN(t)?!1:typeof t=="number"},object:function(t){return typeof t=="object"&&!rt.array(t)},method:function(t){return typeof t=="function"},email:function(t){return typeof t=="string"&&t.length<=320&&!!t.match(Pt.email)},url:function(t){return typeof t=="string"&&t.length<=2048&&!!t.match(Ee())},hex:function(t){return typeof t=="string"&&!!t.match(Pt.hex)}},ve=function(t,e,i,s,o){if(t.required&&e===void 0){Wt(t,e,i,s,o);return}var r=["integer","float","array","regexp","object","method","email","number","date","url","hex"],a=t.type;r.indexOf(a)>-1?rt[a](e)||s.push(F(o.messages.types[a],t.fullField,t.type)):a&&typeof e!==t.type&&s.push(F(o.messages.types[a],t.fullField,t.type))},Ce=function(t,e,i,s,o){var r=typeof t.len=="number",a=typeof t.min=="number",h=typeof t.max=="number",l=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=e,d=null,u=typeof e=="number",x=typeof e=="string",w=Array.isArray(e);if(u?d="number":x?d="string":w&&(d="array"),!d)return!1;w&&(f=e.length),x&&(f=e.replace(l,"_").length),r?f!==t.len&&s.push(F(o.messages[d].len,t.fullField,t.len)):a&&!h&&f<t.min?s.push(F(o.messages[d].min,t.fullField,t.min)):h&&!a&&f>t.max?s.push(F(o.messages[d].max,t.fullField,t.max)):a&&h&&(f<t.min||f>t.max)&&s.push(F(o.messages[d].range,t.fullField,t.min,t.max))},U="enum",Re=function(t,e,i,s,o){t[U]=Array.isArray(t[U])?t[U]:[],t[U].indexOf(e)===-1&&s.push(F(o.messages[U],t.fullField,t[U].join(", ")))},Ie=function(t,e,i,s,o){if(t.pattern){if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||s.push(F(o.messages.pattern.mismatch,t.fullField,e,t.pattern));else if(typeof t.pattern=="string"){var r=new RegExp(t.pattern);r.test(e)||s.push(F(o.messages.pattern.mismatch,t.fullField,e,t.pattern))}}},C={required:Wt,whitespace:be,type:ve,range:Ce,enum:Re,pattern:Ie},Oe=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e,"string")&&!t.required)return i();C.required(t,e,s,r,o,"string"),O(e,"string")||(C.type(t,e,s,r,o),C.range(t,e,s,r,o),C.pattern(t,e,s,r,o),t.whitespace===!0&&C.whitespace(t,e,s,r,o))}i(r)},_e=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},Le=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e===""&&(e=void 0),O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},Se=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},Te=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),O(e)||C.type(t,e,s,r,o)}i(r)},Ae=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},He=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},De=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(e==null&&!t.required)return i();C.required(t,e,s,r,o,"array"),e!=null&&(C.type(t,e,s,r,o),C.range(t,e,s,r,o))}i(r)},Me=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C.type(t,e,s,r,o)}i(r)},Fe="enum",Ne=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o),e!==void 0&&C[Fe](t,e,s,r,o)}i(r)},ke=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e,"string")&&!t.required)return i();C.required(t,e,s,r,o),O(e,"string")||C.pattern(t,e,s,r,o)}i(r)},Ke=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e,"date")&&!t.required)return i();if(C.required(t,e,s,r,o),!O(e,"date")){var h;e instanceof Date?h=e:h=new Date(e),C.type(t,h,s,r,o),h&&C.range(t,h.getTime(),s,r,o)}}i(r)},Be=function(t,e,i,s,o){var r=[],a=Array.isArray(e)?"array":typeof e;C.required(t,e,s,r,o,a),i(r)},vt=function(t,e,i,s,o){var r=t.type,a=[],h=t.required||!t.required&&s.hasOwnProperty(t.field);if(h){if(O(e,r)&&!t.required)return i();C.required(t,e,s,a,o,r),O(e,r)||C.type(t,e,s,a,o)}i(a)},Xe=function(t,e,i,s,o){var r=[],a=t.required||!t.required&&s.hasOwnProperty(t.field);if(a){if(O(e)&&!t.required)return i();C.required(t,e,s,r,o)}i(r)},ot={string:Oe,method:_e,number:Le,boolean:Se,regexp:Te,integer:Ae,float:He,array:De,object:Me,enum:Ne,pattern:ke,date:Ke,url:vt,hex:vt,email:vt,required:Be,any:Xe};function Ct(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}var Rt=Ct(),nt=function(){function n(e){this.rules=null,this._messages=Rt,this.define(e)}var t=n.prototype;return t.define=function(i){var s=this;if(!i)throw new Error("Cannot configure a schema with no rules");if(typeof i!="object"||Array.isArray(i))throw new Error("Rules must be an object");this.rules={},Object.keys(i).forEach(function(o){var r=i[o];s.rules[o]=Array.isArray(r)?r:[r]})},t.messages=function(i){return i&&(this._messages=Yt(Ct(),i)),this._messages},t.validate=function(i,s,o){var r=this;s===void 0&&(s={}),o===void 0&&(o=function(){});var a=i,h=s,l=o;if(typeof h=="function"&&(l=h,h={}),!this.rules||Object.keys(this.rules).length===0)return l&&l(null,a),Promise.resolve(a);function f(g){var y=[],p={};function E(b){if(Array.isArray(b)){var v;y=(v=y).concat.apply(v,b)}else y.push(b)}for(var m=0;m<g.length;m++)E(g[m]);y.length?(p=Et(y),l(y,p)):l(null,a)}if(h.messages){var d=this.messages();d===Rt&&(d=Ct()),Yt(d,h.messages),h.messages=d}else h.messages=this.messages();var u={},x=h.keys||Object.keys(this.rules);x.forEach(function(g){var y=r.rules[g],p=a[g];y.forEach(function(E){var m=E;typeof m.transform=="function"&&(a===i&&(a=S({},a)),p=a[g]=m.transform(p)),typeof m=="function"?m={validator:m}:m=S({},m),m.validator=r.getValidationMethod(m),m.validator&&(m.field=g,m.fullField=m.fullField||g,m.type=r.getType(m),u[g]=u[g]||[],u[g].push({rule:m,value:p,source:a,field:g}))})});var w={};return pe(u,h,function(g,y){var p=g.rule,E=(p.type==="object"||p.type==="array")&&(typeof p.fields=="object"||typeof p.defaultField=="object");E=E&&(p.required||!p.required&&g.value),p.field=g.field;function m(R,T){return S({},T,{fullField:p.fullField+"."+R,fullFields:p.fullFields?[].concat(p.fullFields,[R]):[R]})}function b(R){R===void 0&&(R=[]);var T=Array.isArray(R)?R:[R];!h.suppressWarning&&T.length&&n.warning("async-validator:",T),T.length&&p.message!==void 0&&(T=[].concat(p.message));var _=T.map(Xt(p,a));if(h.first&&_.length)return w[p.field]=1,y(_);if(!E)y(_);else{if(p.required&&!g.value)return p.message!==void 0?_=[].concat(p.message).map(Xt(p,a)):h.error&&(_=[h.error(p,F(h.messages.required,p.field))]),y(_);var I={};p.defaultField&&Object.keys(g.value).map(function(L){I[L]=p.defaultField}),I=S({},I,g.rule.fields);var D={};Object.keys(I).forEach(function(L){var A=I[L],H=Array.isArray(A)?A:[A];D[L]=H.map(m.bind(null,L))});var B=new n(D);B.messages(h.messages),g.rule.options&&(g.rule.options.messages=h.messages,g.rule.options.error=h.error),B.validate(g.value,g.rule.options||h,function(L){var A=[];_&&_.length&&A.push.apply(A,_),L&&L.length&&A.push.apply(A,L),y(A.length?A:null)})}}var v;if(p.asyncValidator)v=p.asyncValidator(p,g.value,b,g.source,h);else if(p.validator){try{v=p.validator(p,g.value,b,g.source,h)}catch(R){console.error==null||console.error(R),h.suppressValidatorError||setTimeout(function(){throw R},0),b(R.message)}v===!0?b():v===!1?b(typeof p.message=="function"?p.message(p.fullField||p.field):p.message||(p.fullField||p.field)+" fails"):v instanceof Array?b(v):v instanceof Error&&b(v.message)}v&&v.then&&v.then(function(){return b()},function(R){return b(R)})},function(g){f(g)},a)},t.getType=function(i){if(i.type===void 0&&i.pattern instanceof RegExp&&(i.type="pattern"),typeof i.validator!="function"&&i.type&&!ot.hasOwnProperty(i.type))throw new Error(F("Unknown rule type %s",i.type));return i.type||"string"},t.getValidationMethod=function(i){if(typeof i.validator=="function")return i.validator;var s=Object.keys(i),o=s.indexOf("message");return o!==-1&&s.splice(o,1),s.length===1&&s[0]==="required"?ot.required:ot[this.getType(i)]||void 0},n}();nt.register=function(t,e){if(typeof e!="function")throw new Error("Cannot register a validator by type, validator is not a function");ot[t]=e},nt.warning=kt,nt.messages=Rt,nt.validators=ot;function It(){return"xxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(n){const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)})}function Vt(n){return n?n.map(t=>Vt(t.children)+1).sort((t,e)=>e-t)[0]:0}function Ye(n=[]){let t=[],e=[],i=[];return n.forEach(s=>{s.fixed==="left"?t.push(s):s.fixed==="right"?i.push(s):e.push(s)}),[...t,...e,...i]}function zt(n=[],t=1,e=0){return n.map(i=>{if(i.children){let s=0,o=i.fixed;i.children.forEach(a=>{a.fixed=o});const r=zt(i.children,t-1,e+1);return r&&r.forEach(a=>{s+=a.colspan}),{...i,width:i.width,level:e,rowspan:1,colspan:s,children:r}}return{...i,level:e,rowspan:t,colspan:1}})}function Ot(n=[]){let t=[];return n.forEach(e=>{e.children?t=t.concat(Ot(e.children)):t.push(e)}),t}class We{constructor(t,e){c(this,"loading",!1);c(this,"ctx");c(this,"data");c(this,"columns");c(this,"footerData",[]);c(this,"rowKeyMap",new Map);c(this,"colIndexKeyMap",new Map);c(this,"headerMap",new Map);c(this,"rowIndexRowKeyMap",new Map);c(this,"checkboxKeyMap",new Map);c(this,"originalDataMap",new Map);c(this,"changedDataMap",new Map);c(this,"validationErrorMap",new Map);c(this,"itemRowKeyMap",new WeakMap);c(this,"bufferData",[]);c(this,"sumHeight",0);c(this,"filterMethod");c(this,"positions",[]);this.ctx=t;const{data:i=[],columns:s=[],footerData:o=[]}=e;this.data=i,this.footerData=o,this.columns=s,this.setLoading(!0),this.init()}init(){this.clearBufferData(),this.rowKeyMap.clear(),this.checkboxKeyMap.clear(),this.headerMap.clear(),this.colIndexKeyMap.clear(),this.rowIndexRowKeyMap.clear(),this.originalDataMap.clear(),this.changedDataMap.clear(),this.validationErrorMap.clear(),this.itemRowKeyMap=new WeakMap,this.initData(this.data)}clearBufferData(){this.bufferData=[]}initData(t,e=0){t.forEach((i,s)=>{let o=!1;Array.isArray(i.children)&&(o=!0,this.initData(i.children,e+1));const{ROW_KEY:r="",DEFAULT_EXPAND_ALL:a,CELL_HEIGHT:h,SELECTABLE_METHOD:l,CHECKBOX_KEY:f}=this.ctx.config,d=i[r],u=d??It();this.itemRowKeyMap.set(i,u);const x=i._height||h,w=i._readonly;let g=!0;if(typeof l=="function"&&(g=l),f){const y=i[f];if(this.checkboxKeyMap.has(y)){const p=this.checkboxKeyMap.get(y);p.push(u),this.checkboxKeyMap.set(y,p)}else this.checkboxKeyMap.set(y,[u])}this.rowKeyMap.set(u,{readonly:w,index:s,rowIndex:s,level:e,height:x,check:!1,selectable:g,expand:a,expandLazy:!1,hasChildren:o,expandLoading:!1,item:i})})}setRowHeight(t,e){const i=this.rowIndexRowKeyMap.get(t),s=this.rowKeyMap.get(i);s.height=e,s.item._height=e,this.clearBufferData()}getAllRowsData(){let t=[];const e=i=>{i.forEach(s=>{t.push(s),Array.isArray(s.children)&&e(s.children)})};return e(this.data),t}getColumns(){return this.columns}setColumns(t){this.columns=t,this.clearBufferData()}setData(t){this.data=t,this.columns.length&&this.init()}getData(){if(this.bufferData.length>0)return{data:this.bufferData,sumHeight:this.sumHeight,positions:this.positions};let t=[],e=0;this.sumHeight=0,this.positions=[];const i=o=>{o.forEach(r=>{t.push(r);const a=this.itemRowKeyMap.get(r),{expand:h,hasChildren:l,height:f}=this.rowKeyMap.get(a),d=this.sumHeight;this.sumHeight+=f,this.rowIndexRowKeyMap.set(e,a),this.positions.push({top:d,height:f,bottom:this.sumHeight}),e+=1,h&&l&&i(r.children)})};this.rowIndexRowKeyMap.clear();let s=this.data;return typeof this.filterMethod=="function"&&(s=this.filterMethod(s)),i(s),this.bufferData=t,{data:t,sumHeight:this.sumHeight,positions:this.positions}}setFooterData(t){this.footerData=t}getFooterData(){return this.footerData}setFilterMethod(t){this.filterMethod=t}clearFilterMethod(){this.filterMethod=void 0}expandItem(t,e=!1){const i=this.rowKeyMap.get(t);i.expand=e,this.clearBufferData(),this.ctx.emit("draw")}expandAll(t){this.rowKeyMap.forEach(e=>{e.expand=t}),this.clearBufferData(),this.ctx.emit("draw")}expandLoading(t,e=!1){const i=this.rowKeyMap.get(t);i.expandLoading=e,this.clearBufferData(),this.ctx.emit("draw")}setExpandChildren(t,e){const i=this.rowKeyMap.get(t);i.expand=!0,i.expandLazy=!0,i.item.children=e,this.initData(i.item.children,i.level+1),this.clearBufferData()}getIsExpandLoading(t){return this.rowKeyMap.get(t).expandLoading}getIsExpandLazy(t){return this.rowKeyMap.get(t).expandLazy}getIsExpand(t){return this.rowKeyMap.get(t).expand}getRowForRowKey(t){return this.rowKeyMap.get(t)}getRowKeyForRowIndex(t){return this.rowIndexRowKeyMap.get(t)}getRowKeyByItem(t){return this.itemRowKeyMap.get(t)}getRowIndexForRowKey(t){return this.rowKeyMap.get(t).index}getItemValueForRowIndexAndColIndex(t,e){if(!(this.rowIndexRowKeyMap.has(t)&&this.colIndexKeyMap.get(e)))return null;const s=this.rowIndexRowKeyMap.get(t),o=this.colIndexKeyMap.get(e);return{rowKey:s,key:o,value:this.getItemValue(s,o)}}getItemValue(t,e){const i=this.rowKeyMap.get(t);return i&&i.item?i.item[e]===void 0?null:i.item[e]:null}batchSetItemValue(t,e=!1){let i=[];const s=new Set;t.forEach(a=>{const{value:h,rowKey:l,key:f}=a,{oldValue:d,newValue:u}=this.setItemValue(l,f,h);s.add(l),i.push({rowKey:l,key:f,oldValue:d,newValue:u})});let o=[];const r=i.map(a=>{const h=this.ctx.database.getRowDataItemForRowKey(a.rowKey);return{rowKey:a.rowKey,key:a.key,value:a.newValue,row:h}});return s.forEach(a=>{o.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("change",r,o),e&&this.ctx.history.pushState({changeList:i,type:"multiple"}),i}setItemValue(t,e,i,s=!1,o=!1,r=!1){if(!this.rowKeyMap.has(t))return{};const{item:a}=this.rowKeyMap.get(t);let h=a[e];if(this.ctx.database.getReadonly(t,e))return{oldValue:h,newValue:h};a[e]!==null&&typeof a[e]=="object"&&(h=JSON.parse(JSON.stringify(a[e])));const l=`${t}_${e}`;if(this.originalDataMap.has(l)||this.originalDataMap.set(l,h),this.changedDataMap.set(l,i),a[e]=i,r){const f=this.ctx.database.getRowDataItemForRowKey(t),d={rowKey:t,key:e,value:i,row:f};this.ctx.emit("change",[d],[f]),this.ctx.emit("editChange",{rowKey:t,key:e,oldValue:h,value:i,originalValue:this.originalDataMap.get(l),row:f})}return this.ctx.hasEvent("iterationChange")&&this.ctx.emit("iterationChange",{rowKey:t,key:e,oldValue:h,value:i,originalValue:this.originalDataMap.get(l),row:this.ctx.database.getRowDataItemForRowKey(t)}),s&&this.ctx.history.pushState({type:"single",changeList:[{rowKey:t,key:e,oldValue:h,newValue:i}]}),o&&this.ctx.emit("asyncDrawBody"),{oldValue:h,newValue:i}}getRowDataItemForRowKey(t){if(!this.rowKeyMap.has(t))return{};const{item:e}=this.rowKeyMap.get(t);return e}setRowSelectionByCheckboxKey(t,e){const{CHECKBOX_KEY:i}=this.ctx.config;if(i){if(!this.rowKeyMap.has(t))return!1;const{item:s}=this.rowKeyMap.get(t),o=s[i];this.checkboxKeyMap.has(o)&&this.checkboxKeyMap.get(o).forEach(a=>{const h=this.rowKeyMap.get(a);h.check=e})}}toggleRowSelection(t){const e=this.rowKeyMap.get(t);e.check=!e.check,this.setRowSelectionByCheckboxKey(t,e.check),this.ctx.emit("toggleRowSelection");const i=this.getSelectionRows();this.ctx.emit("selectionChange",i),this.ctx.emit("draw")}setRowSelection(t,e){const i=this.rowKeyMap.get(t);i.check=e,this.setRowSelectionByCheckboxKey(t,i.check);const s=this.getSelectionRows();this.ctx.emit("setRowSelection",s),this.ctx.emit("draw")}getSelectionRows(){let t=[];return this.rowKeyMap.forEach(e=>{e.check&&t.push(e.item)}),t}getRowSelection(t){const{check:e}=this.rowKeyMap.get(t);return e}getRowSelectable(t){const{selectable:e,item:i,rowIndex:s}=this.rowKeyMap.get(t);return typeof e=="function"?e({row:i,rowIndex:s}):e}toggleAllSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!0):i&&(e.check=!0)}),this.ctx.emit("toggleAllSelection");const t=this.getSelectionRows();this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}clearSelection(){this.rowKeyMap.forEach(e=>{const i=e.selectable;typeof i=="function"?i({row:e.item,rowIndex:e.rowIndex})&&(e.check=!1):i&&(e.check=!1)}),this.ctx.emit("clearSelection");const t=this.getSelectionRows();this.ctx.emit("selectionChange",t),this.ctx.emit("draw")}getCheckedState(){let t=0,e=0;this.rowKeyMap.forEach(r=>{r.check&&(t+=1);const a=r.selectable;typeof a=="function"?a({row:r.item,rowIndex:r.rowIndex})&&(e+=1):a&&(e+=1)});const i=e&&e>t&&t>0;return{check:e&&e===t,indeterminate:i,selectable:e!==0}}updateColIndexKeyMap(t=[]){this.colIndexKeyMap.clear(),t.forEach(e=>{this.colIndexKeyMap.set(e.colIndex,e.key)})}getChangedData(){let t=[];return this.changedDataMap.forEach((e,i)=>{const s=this.originalDataMap.get(i),o=i.split("_")[0],r=i.split("_")[1];s!==e&&t.push({rowKey:o,colKey:r,originalValue:s,row:this.rowKeyMap.get(o),value:e})}),t}getChangedRows(){const t=new Set;this.changedDataMap.forEach((i,s)=>{const o=this.originalDataMap.get(s),r=s.split("_")[0];o!==i&&t.add(r)});let e=[];return t.forEach(i=>{e.push(this.ctx.database.getRowDataItemForRowKey(i))}),e}isHasChangedData(t,e){const i=`${t}_${e}`;if(!this.changedDataMap.has(i))return!1;const s=this.originalDataMap.get(i),o=this.changedDataMap.get(i);return s!==o}getPositionForRowIndex(t){return t<this.positions.length?this.positions[t]:{height:0,top:0,bottom:0}}setHeader(t,e){return t?(this.headerMap.set(t,e),!0):!1}getReadonly(t,e){const i=this.rowKeyMap.get(t),s=this.headerMap.get(e),o=i==null?void 0:i.readonly,r=s==null?void 0:s.readonly,{CELL_READONLY_METHOD:a}=this.ctx.config;if(typeof a=="function"){const l=a({row:i.item,rowIndex:i.rowIndex,colIndex:s.colIndex,column:s.column,value:this.getItemValue(t,e)});if(l!==void 0)return l}return r||o}clearValidate(){this.validationErrorMap.clear()}getValidator(t,e){return new Promise(i=>{const s=this.rowKeyMap.get(t),o=this.headerMap.get(e),{CELL_RULES_METHOD:r}=this.ctx.config,a=o.column;let h=a.rules;if(typeof r=="function"){const f=r({row:s.item,rowIndex:s.rowIndex,colIndex:o.colIndex,column:a,value:this.getItemValue(t,e)});f&&(h=f)}if(h){let l={},f={};if(f[e]=this.getItemValue(t,e),Array.isArray(h)&&h.length){const u=h.map(x=>({...x,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex}));l[e]=u}else l[e]={...h,row:s.item,column:a,rowIndex:s.rowIndex,colIndex:o.colIndex};new nt(l).validate(f).then(()=>{this.setValidationError(t,e,[]),i([])}).catch(({errors:u})=>{const x=u.map(w=>({...w,column:a,key:e,row:s.item,rowKey:t}));this.setValidationError(t,e,x),i(x)})}else i([])})}getHeightByRowIndexRowSpan(t,e){let i=0;for(let s=0;s<e;s++){const o=this.positions[t+s];o&&(i+=o.height)}return i}setLoading(t){this.loading=t,this.ctx.emit("loadingChange",t)}getLoading(){return this.loading}setValidationError(t,e,i){const s=`${t}_${e}`;this.validationErrorMap.set(s,i)}getValidationError(t,e){const i=`${t}_${e}`;return this.validationErrorMap.get(i)||[]}}class Pe{constructor(t){c(this,"ctx");c(this,"history",[]);c(this,"historyIndex",-1);this.ctx=t,this.init()}init(){this.ctx.on("keydown",t=>{if(t.ctrlKey&&!t.shiftKey&&t.code==="KeyZ"||t.metaKey&&!t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.backState();return}if(t.ctrlKey&&t.code==="KeyY"||t.ctrlKey&&t.shiftKey&&t.code==="KeyZ"||t.metaKey&&t.shiftKey&&t.code==="KeyZ"){t.preventDefault(),this.ctx.clearSelector(),this.ctx.clearAutofill(),this.forwardState();return}})}pushState(t){const{HISTORY_NUM:e=0,ENABLE_HISTORY:i}=this.ctx.config;i&&(this.history.push(t),this.history.length>e&&this.history.splice(0,1),this.historyIndex=this.history.length-1)}backState(){if(this.historyIndex>=0){const{changeList:t}=this.history[this.historyIndex],e=t.map(i=>({rowKey:i.rowKey,key:i.key,value:i.oldValue,row:{}}));this.ctx.database.batchSetItemValue(e,!1),this.historyIndex-=1,this.ctx.emit("draw")}}forwardState(){if(this.historyIndex<this.history.length-1){this.historyIndex+=1;const{changeList:t}=this.history[this.historyIndex],e=t.map(i=>({rowKey:i.rowKey,key:i.key,value:i.newValue,row:{}}));this.ctx.database.batchSetItemValue(e,!1),this.ctx.emit("draw")}}clear(){this.history=[],this.historyIndex=-1}}class Ve{constructor(t){c(this,"eventTasks",new Map);c(this,"ctx");this.ctx=t,this.init()}init(){this.bind(window,"resize",this.handleResize.bind(this)),this.bind(window,"mousedown",this.handleMouseDown.bind(this)),this.bind(window,"mouseup",this.handleMouseUp.bind(this)),this.bind(window,"mousemove",this.handleMousemove.bind(this)),this.bind(this.ctx.target,"click",this.handleClick.bind(this)),this.bind(this.ctx.target,"keydown",this.handleKeydown.bind(this)),this.bind(this.ctx.target,"wheel",this.handleWheel.bind(this))}destroy(){this.eventTasks.forEach((t,e)=>{this.unbind(window,e,t)}),this.eventTasks.clear()}handleResize(t){this.ctx.emit("resize",t),this.ctx.emit("draw")}handleMouseDown(t){t.button===0&&(this.ctx.mousedown=!0),this.ctx.emit("mousedown",t)}handleMousemove(t){this.ctx.emit("mousemove",t)}handleMouseUp(t){t.button===0&&(this.ctx.mousedown=!1),this.ctx.emit("mouseup",t)}handleClick(t){this.ctx.emit("click",t)}handleKeydown(t){const{ENABLE_KEYBOARD:e}=this.ctx.config;e&&this.ctx.emit("keydown",t)}handleWheel(t){this.ctx.emit("wheel",t)}bind(t,e,i){t instanceof HTMLCanvasElement&&e==="keydown"&&(t.tabIndex=0),t.addEventListener(e,i),this.eventTasks.set(e,i)}unbind(t,e,i){t.removeEventListener(e,i),this.eventTasks.delete(e)}}class ze{constructor(){c(this,"events",new Map)}has(t){return this.events.has(t)}on(t,e){const i=this.events.get(t)||[];i.push(e),this.events.set(t,i)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};return this.on(t,i),this}off(t,e){const i=this.events.get(t);if(i){const s=i.indexOf(e);s>=0&&(console.log("off",t,s),i.splice(s,1),i.length===0?this.events.delete(t):this.events.set(t,i))}}emit(t,...e){const i=this.events.get(t);i&&i.forEach(s=>{s(...e)})}destroy(){this.events.clear()}}class qe{constructor(t){c(this,"ctx");const e=t.getContext("2d");if(!e)throw new Error("canvas context not found");this.ctx=e}save(){this.ctx.save()}restore(){this.ctx.restore()}translate(t,e){this.ctx.translate(t,e)}setCursor(t="default"){this.ctx.canvas.style.cursor=t}clear(t=0,e=0,i,s){this.ctx.clearRect(t,e,i||this.ctx.canvas.width,s||this.ctx.canvas.height)}drawShadow(t,e,i,s,o){const{fillColor:r,side:a,shadowWidth:h,colorStart:l,colorEnd:f}=o;this.ctx.save(),r&&(this.ctx.fillStyle=r,this.ctx.fillRect(t,e,i,s));let d;switch(a){case"left":d=this.ctx.createLinearGradient(t-h,e,t,e),d.addColorStop(0,l),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t-h,e,h,s);break;case"right":d=this.ctx.createLinearGradient(t+i,e,t+i+h,e),d.addColorStop(0,l),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t+i,e,h,s);break;case"top":d=this.ctx.createLinearGradient(t,e-h,t,e),d.addColorStop(0,l),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t,e-h,i,h);break;case"bottom":d=this.ctx.createLinearGradient(t,e+s,t,e+s+h),d.addColorStop(0,l),d.addColorStop(1,f),this.ctx.fillStyle=d,this.ctx.fillRect(t,e+s,i,h);break;default:console.error("Invalid side specified for shadow");break}}drawLine(t,e){if(t.length<4||t.length%2!==0)throw new Error("A valid array of points is required to draw a line");this.ctx.save();const{borderColor:i="black",borderWidth:s=1}=e;this.ctx.beginPath(),this.ctx.moveTo(t[0]+.5,t[1]+.5);for(let o=2;o<t.length;o+=2)this.ctx.lineTo(t[o]+.5,t[o+1]+.5);this.ctx.strokeStyle=i,this.ctx.lineWidth=s,e.lineDash&&(this.ctx.lineDashOffset=4,this.ctx.setLineDash(e.lineDash)),e.fillColor&&(this.ctx.fillStyle=e.fillColor,this.ctx.fill()),e.borderColor&&(this.ctx.strokeStyle=e.borderColor),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}drawImage(t,e,i,s,o){this.ctx.save(),this.ctx.drawImage(t,e,i,s,o),this.ctx.restore()}drawRect(t,e,i,s,{borderWidth:o=1,borderColor:r,fillColor:a,radius:h=0}={}){if(this.ctx.save(),this.ctx.beginPath(),a!==void 0&&(this.ctx.fillStyle=a),r!==void 0&&(this.ctx.lineWidth=o,this.ctx.strokeStyle=r),h===0)this.ctx.rect(t+.5,e+.5,i,s);else{const[l,f,d,u]=typeof h=="number"?[h,h,h,h]:h;this.ctx.moveTo(t+l,e),this.ctx.arcTo(t+i,e,t+i,e+f,f),this.ctx.arcTo(t+i,e+s,t+i-d,e+s,d),this.ctx.arcTo(t,e+s,t,e+s-u,u),this.ctx.arcTo(t,e,t+l,e,l)}a!==void 0&&this.ctx.fill(),r!==void 0&&this.ctx.stroke(),this.ctx.restore()}drawText(t="",e,i,s,o,r={}){this.ctx.save();const{font:a="12px Arial",align:h="center",color:l="#495060",padding:f=0,verticalAlign:d="middle"}=r;this.ctx.font=a,this.ctx.fillStyle=l,this.ctx.textBaseline=d,this.ctx.textAlign=h;let u=0;d==="top"?u=i+f:d==="bottom"?u=i+o-f:u=i+(o+f)/2;let x=0;h==="left"?x=e+f:h==="right"?x=e+s-f:x=e+s/2;const{_text:w,ellipsis:g}=this.handleEllipsis(t,s,f);return this.ctx.fillText(w,x,u),this.ctx.restore(),g}handleEllipsis(t,e,i=0){let s=!1,o=t;if(t==null||t==="")return{_text:"",ellipsis:s};const r=this.ctx.measureText("...").width,a=this.ctx.measureText(t).width;if(a&&a+r>=e-i*2){s=!0;let h=0;for(let l=0;l<t.length;l++)if(h+=this.ctx.measureText(t[l]).width,h>=e-i*2-r){o=t.slice(0,l)+"...";break}}return{_text:o,ellipsis:s}}}class Ge{constructor(t){c(this,"PROCESSOR_NUM",50);c(this,"CSS_PREFIX","evirt-table");c(this,"ICONS",[]);c(this,"ROW_KEY","");c(this,"HEAD_FONTFAMILY","Arial");c(this,"HEAD_LINE_HEIGHT",1.2);c(this,"HEAD_FONT_SIZE",12);c(this,"HEAD_FONT_STYLE","normal");c(this,"BODY_FONTFAMILY","Arial");c(this,"BODY_FONT_SIZE",12);c(this,"BODY_FONT_STYLE","normal");c(this,"BODY_LINE_HEIGHT",1.2);c(this,"BORDER_COLOR","#e1e6eb");c(this,"WIDTH",0);c(this,"HEIGHT",0);c(this,"EMPTY_BODY_HEIGHT",120);c(this,"MAX_HEIGHT",1e3);c(this,"BORDER_RADIUS",8);c(this,"ENABLE_OFFSET_HEIGHT",!1);c(this,"OFFSET_HEIGHT",0);c(this,"HEADER_HEIGHT",36);c(this,"HEADER_BG_COLOR","#F8FAFF");c(this,"BODY_BG_COLOR","#FFF");c(this,"HEADER_TEXT_COLOR","#1D2129");c(this,"LOADING_ICON_SVG","");c(this,"LOADING_ICON_COLOR","#4E5969");c(this,"EXPAND_ICON_SVG","");c(this,"SHRINK_ICON_SVG","");c(this,"EXPAND_ICON_COLOR","#4E5969");c(this,"SHRINK_ICON_COLOR","#4E5969");c(this,"ERROR_TIP_ICON_COLOR","red");c(this,"ERROR_TIP_ICON_SIZE",6);c(this,"EXPAND_LAZY",!0);c(this,"DEFAULT_EXPAND_ALL",!1);c(this,"CELL_WIDTH",100);c(this,"CELL_HEIGHT",36);c(this,"CELL_PADDING",8);c(this,"CELL_HOVER_ICON_SIZE",20);c(this,"SCROLLER_TRACK_SIZE",14);c(this,"SCROLLER_SIZE",8);c(this,"SCROLLER_COLOR","#dee0e3");c(this,"SCROLLER_TRACK_COLOR","#fff");c(this,"SCROLLER_FOCUS_COLOR","#bbbec4");c(this,"SELECT_BORDER_COLOR","rgb(82,146,247)");c(this,"SELECT_AREA_COLOR","rgba(82,146,247,0.1)");c(this,"SELECT_BG_COLOR","rgba(82,146,247,0.1)");c(this,"EDIT_BG_COLOR","#fcf6ed");c(this,"CHECKBOX_KEY","");c(this,"CHECKBOX_COLOR","rgb(82,146,247)");c(this,"CHECKBOX_SIZE",20);c(this,"CHECKBOX_DISABLED_SVG","");c(this,"CHECKBOX_CHECK_SVG","");c(this,"CHECKBOX_UNCHECK_SVG","");c(this,"CHECKBOX_INDETERMINATE_SVG","");c(this,"READONLY_COLOR","#fff");c(this,"READONLY_TEXT_COLOR","#4E5969");c(this,"ERROR_TIP_COLOR","#ED3F14");c(this,"FOOTER_BG_COLOR","#fafafa");c(this,"FOOTER_FIXED",!1);c(this,"CELL_FOOTER_HEIGHT",36);c(this,"ENABLE_SELECTOR",!1);c(this,"ENABLE_SELECTOR_SINGLE",!1);c(this,"ENABLE_SELECTOR_SPAN_COL",!0);c(this,"ENABLE_SELECTOR_SPAN_ROW",!0);c(this,"ENABLE_SELECTOR_ALL_ROWS",!0);c(this,"ENABLE_SELECTOR_ALL_COLS",!0);c(this,"ENABLE_AUTOFILL",!1);c(this,"ENABLE_CONTEXTMENU",!0);c(this,"ENABLE_COPY",!0);c(this,"ENABLE_PASTER",!0);c(this,"ENABLE_RESIZE_ROW",!0);c(this,"ENABLE_RESIZE_COLUMN",!0);c(this,"RESIZE_ROW_LINE_COLOR","#e1e6eb");c(this,"RESIZE_COLUMN_LINE_COLOR","#e1e6eb");c(this,"RESIZE_ROW_MIN_HEIGHT",36);c(this,"RESIZE_COLUMN_MIN_WIDTH",50);c(this,"ENABLE_KEYBOARD",!1);c(this,"ENABLE_HISTORY",!1);c(this,"ENABLE_VALIDATOR_IMMEDIATE",!0);c(this,"HISTORY_NUM",50);c(this,"HIGHLIGHT_HOVER_ROW",!1);c(this,"HIGHLIGHT_HOVER_ROW_COLOR","rgba(186,203,231,0.1)");c(this,"HIGHLIGHT_SELECTED_ROW",!1);c(this,"HIGHLIGHT_SELECTED_ROW_COLOR","rgba(82,146,247,0.1)");c(this,"TOOLTIP_BG_COLOR","#303133");c(this,"TOOLTIP_TEXT_COLOR","#fff");c(this,"TOOLTIP_ZINDEX",3e3);c(this,"TOOLTIP_CUSTOM_STYLE",{});c(this,"CONTEXT_MENU",[{label:"复制",value:"copy"},{label:"剪切",value:"cut"},{label:"粘贴",value:"paste"},{label:"清空选中内容",value:"clearSelected"}]);c(this,"BODY_CELL_STYLE_METHOD");c(this,"CELL_READONLY_METHOD");c(this,"CELL_RULES_METHOD");c(this,"CELL_TYPE_METHOD");c(this,"CELL_EDITOR_TYPE_METHOD");c(this,"CELL_RENDER_METHOD");c(this,"CELL_HOVER_ICON_METHOD");c(this,"SPAN_METHOD");c(this,"SELECTABLE_METHOD");c(this,"EXPAND_LAZY_METHOD");Object.assign(this,t)}}class $e{constructor(t){c(this,"ctx");c(this,"list",[{name:"loading",configName:"LOADING_ICON_SVG",configColorName:"LOADING_ICON_COLOR",svg:'<svg t="1724133395728" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2893" width="32" height="32"><path d="M512 226.8476541a19.82487759 19.82487759 0 0 1 14.66497778 5.70304692c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497779v122.20814825a19.82487759 19.82487759 0 0 1-5.70304693 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304691 19.82487759 19.82487759 0 0 1-14.66497778-5.70304691 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778v-122.20814825a19.82487759 19.82487759 0 0 1 5.70304693-14.66497779 19.82487759 19.82487759 0 0 1 14.66497778-5.70304692z m0 407.36049415a19.82487759 19.82487759 0 0 1 14.66497778 5.70304691c3.80203107 3.82918865 5.70304692 8.71751457 5.70304693 14.66497778v122.20814827a19.82487759 19.82487759 0 0 1-5.70304693 14.66497776 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693 19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497776v-122.20814827a19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304691zM797.1523459 512a19.82487759 19.82487759 0 0 1-5.70304692 14.66497778 19.82487759 19.82487759 0 0 1-14.66497779 5.70304693h-122.20814825a19.82487759 19.82487759 0 0 1-14.66497778-5.70304693 19.82487759 19.82487759 0 0 1-5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 5.70304691-14.66497778 19.82487759 19.82487759 0 0 1 14.66497778-5.70304693h122.20814825a19.82487759 19.82487759 0 0 1 14.66497779 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304692 14.66497778z m-407.36049415 0a19.82487759 19.82487759 0 0 1-5.70304691 14.66497778 19.82487759 19.82487759 0 0 1-14.66497778 5.70304693h-122.20814827a19.82487759 19.82487759 0 0 1-14.66497776-5.70304693 19.82487759 19.82487759 0 0 1-5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 5.70304693-14.66497778 19.82487759 19.82487759 0 0 1 14.66497776-5.70304693h122.20814827a19.82487759 19.82487759 0 0 1 14.66497778 5.70304693c3.80203107 3.82918865 5.70304692 8.71751457 5.70304691 14.66497778zM310.22076878 310.22076878a21.29137537 21.29137537 0 0 1 14.66497779-5.70304693c5.51294514 0 10.18401235 1.90101585 14.01320099 5.70304693l86.55052591 86.57768347a20.91117183 20.91117183 0 0 1 5.73020449 14.31193182 19.28172983 19.28172983 0 0 1-6.05609289 14.013201 19.11878565 19.11878565 0 0 1-14.013201 6.05609289 20.96548698 20.96548698 0 0 1-14.31193182-5.70304692L310.22076878 338.87178998a19.06447114 19.06447114 0 0 1-5.70304693-14.01320099c0-5.54010272 1.90101585-10.42842865 5.70304693-14.66497778z m288.32975775 288.32975775a19.79772001 19.79772001 0 0 1 14.3390894-6.35482371c5.29568642 0 10.04822572 2.11827457 14.31193182 6.38198066l86.57768347 86.55052651c3.80203107 3.80203107 5.70304692 8.47309828 5.70304691 14.01320102a19.55330372 19.55330372 0 0 1-6.05609225 14.31193182 19.66193339 19.66193339 0 0 1-14.31193245 6.05609288 19.01015661 19.01015661 0 0 1-14.01320099-5.70304692l-86.55052591-86.57768347a19.79772001 19.79772001 0 0 1-6.38198129-14.31193245c0-5.29568642 2.11827457-10.07538268 6.38198129-14.33908939zM713.77923122 310.22076878c3.80203107 4.26370672 5.70304692 9.15203265 5.70304693 14.66497779s-1.90101585 10.18401235-5.70304693 14.01320099l-86.57768347 86.55052591a20.91117183 20.91117183 0 0 1-14.31193182 5.73020449 19.28172983 19.28172983 0 0 1-14.013201-6.05609289 19.11878565 19.11878565 0 0 1-6.05609289-14.013201c0-5.29568642 1.90101585-10.07538268 5.70304692-14.31193182l86.57768348-86.57768347c3.80203107-3.80203107 8.50025585-5.70304692 14.01320099-5.70304693 5.54010272 0 10.40127108 1.90101585 14.66497779 5.70304693zM425.44947347 598.57768347a19.79772001 19.79772001 0 0 1 6.35482371 14.33908939c0 5.29568642-2.11827457 10.04822572-6.38198066 14.31193245L338.89894756 713.77923122a19.06447114 19.06447114 0 0 1-14.01320099 5.70304693 19.55330372 19.55330372 0 0 1-14.31193245-6.05609227 19.68909035 19.68909035 0 0 1-6.05609227-14.31193245 19.01015661 19.01015661 0 0 1 5.70304693-14.01320099l86.57768347-86.55052591a19.79772001 19.79772001 0 0 1 14.31193182-6.38198129c5.29568642 0 10.07538268 2.11827457 14.3390894 6.38198129z" fill="#000000" fill-opacity=".65" p-id="2894"></path></svg>',color:"#4E5969"},{name:"expand",configName:"EXPAND_ICON_SVG",configColorName:"EXPAND_ICON_COLOR",svg:'<svg t="1724122015492" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4237" width="32" height="32"><path d="M401.472 316.992l159.04 217.664L591.488 512l-30.976-22.656-159.04 217.728q-2.24 3.008-3.84 6.464-1.6 3.456-2.496 7.104-0.896 3.648-1.024 7.424-0.192 3.84 0.384 7.552 0.64 3.712 1.92 7.296 1.28 3.52 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992 3.072 2.24 6.464 3.84 3.456 1.6 7.168 2.496 3.648 0.896 7.424 1.024 3.776 0.192 7.488-0.448 3.776-0.576 7.296-1.856 3.584-1.28 6.784-3.264 3.2-1.92 6.016-4.48 2.816-2.56 5.056-5.632l159.04-217.728q3.584-4.928 5.504-10.752 1.92-5.76 1.92-11.904 0-6.08-1.92-11.904-1.92-5.76-5.504-10.752L463.488 271.68q-2.24-3.072-5.056-5.632-2.752-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.52-1.28-7.296-1.856-3.712-0.576-7.488-0.448-3.84 0.192-7.424 1.088-3.712 0.896-7.168 2.496-3.392 1.6-6.4 3.84-3.136 2.176-5.696 4.992-2.56 2.752-4.48 6.016-1.984 3.2-3.264 6.784-1.28 3.52-1.92 7.296-0.576 3.712-0.384 7.488 0.128 3.84 1.024 7.488 0.896 3.648 2.496 7.04 1.6 3.456 3.84 6.528z m30.976-61.056q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.24-3.52 1.408-6.656 3.52-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.232 1.408 3.456 3.52 6.592 2.112 3.2 4.8 5.824 2.688 2.688 5.76 4.8 3.2 2.112 6.72 3.52 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.656 1.472-3.52 2.24-7.232 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.456-3.52-6.592-2.112-3.2-4.8-5.824-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.52-3.52-1.472-7.232-2.24Q436.224 256 432.448 256z m0 435.392q-3.776 0-7.488 0.704-3.712 0.768-7.168 2.176-3.52 1.472-6.656 3.584-3.2 2.112-5.824 4.736-2.688 2.688-4.8 5.824-2.112 3.2-3.52 6.656-1.472 3.52-2.176 7.232-0.768 3.712-0.768 7.488 0 3.776 0.768 7.488 0.704 3.712 2.176 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.76 2.688 2.752 5.76 4.8 3.2 2.112 6.72 3.584 3.456 1.472 7.168 2.176 3.712 0.768 7.488 0.768 3.84 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.472 6.592-3.584 3.2-2.048 5.824-4.736 2.688-2.688 4.8-5.824 2.112-3.2 3.52-6.656 1.472-3.456 2.24-7.168 0.704-3.712 0.704-7.488 0-3.84-0.704-7.488-0.768-3.712-2.24-7.232-1.408-3.52-3.52-6.656-2.112-3.136-4.8-5.76-2.624-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704z" p-id="4238"></path></svg>',color:"#4E5969"},{name:"shrink",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"SHRINK_ICON_COLOR",svg:'<svg t="1724122044148" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M707.648 401.28L489.28 560.704l22.656 30.976 22.656-30.976L316.16 401.216q-3.072-2.24-6.464-3.84-3.456-1.536-7.104-2.432-3.712-0.896-7.488-1.088-3.776-0.128-7.488 0.448-3.776 0.64-7.296 1.92-3.584 1.28-6.784 3.2-3.2 1.984-6.016 4.544-2.816 2.56-5.056 5.632-2.176 3.072-3.84 6.464-1.536 3.456-2.432 7.104-0.896 3.712-1.088 7.488-0.128 3.776 0.448 7.488 0.64 3.776 1.92 7.296 1.28 3.584 3.2 6.784 1.984 3.2 4.544 6.016 2.56 2.752 5.632 4.992l218.368 159.552q4.928 3.584 10.752 5.504 5.76 1.92 11.904 1.92 6.08 0 11.904-1.92 5.76-1.92 10.752-5.504l218.368-159.552q3.008-2.24 5.568-4.992 2.56-2.816 4.544-6.016 1.92-3.2 3.264-6.784 1.28-3.52 1.92-7.296 0.576-3.712 0.384-7.488-0.128-3.84-1.024-7.488-0.896-3.648-2.496-7.04-1.6-3.456-3.84-6.528-2.24-3.072-4.992-5.632-2.816-2.56-6.016-4.48-3.2-1.984-6.784-3.328-3.584-1.28-7.296-1.856-3.712-0.64-7.488-0.448-3.84 0.192-7.488 1.088-3.648 0.896-7.04 2.496-3.456 1.536-6.528 3.84z m61.056 30.976q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.472-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.72-3.584-3.456-1.408-7.168-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.656 3.584-3.136 2.112-5.76 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.584 6.656-1.408 3.52-2.176 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.176 7.168 1.472 3.52 3.584 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.168-2.176 3.52-1.408 6.656-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.048-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z m-436.736 0q0-3.84-0.768-7.488-0.704-3.712-2.176-7.232-1.408-3.456-3.52-6.656-2.112-3.136-4.8-5.76-2.688-2.688-5.76-4.8-3.2-2.112-6.656-3.584-3.52-1.408-7.232-2.176-3.712-0.704-7.488-0.704-3.84 0-7.488 0.704-3.712 0.768-7.232 2.176-3.456 1.472-6.592 3.584-3.2 2.112-5.824 4.8-2.688 2.624-4.8 5.76-2.112 3.2-3.52 6.656-1.472 3.52-2.24 7.232-0.704 3.712-0.704 7.488 0 3.776 0.704 7.488 0.768 3.712 2.24 7.168 1.408 3.52 3.52 6.656 2.112 3.2 4.8 5.824 2.624 2.688 5.76 4.8 3.2 2.112 6.656 3.52 3.52 1.472 7.232 2.176 3.712 0.768 7.488 0.768 3.776 0 7.488-0.768 3.712-0.704 7.232-2.176 3.456-1.408 6.592-3.52 3.2-2.112 5.824-4.8 2.688-2.688 4.8-5.76 2.112-3.2 3.52-6.72 1.472-3.456 2.176-7.168 0.768-3.712 0.768-7.488z" p-id="4552"></path></svg>',color:"#4E5969"},{name:"checkbox-uncheck",configName:"CHECKBOX_UNCHECK_SVG",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:""},{name:"checkbox-check",configName:"CHECKBOX_CHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-hover",configName:"CHECKBOX_UNCHECK_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595639920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4708" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4709"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-indeterminate",configName:"CHECKBOX_INDETERMINATE_SVG",configColorName:"CHECKBOX_COLOR",svg:'<svg t="1722595280953" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4394" width="32" height="32"><path d="M128 384v256q0 12.608 1.28 25.088 1.216 12.544 3.648 24.832 2.432 12.352 6.08 24.384t8.448 23.68q4.864 11.584 10.752 22.72 5.952 11.072 12.928 21.504 7.04 10.496 14.976 20.224 8 9.728 16.896 18.56 8.896 8.96 18.56 16.896 9.728 8 20.224 14.976 10.432 7.04 21.504 12.928 11.136 5.888 22.72 10.688 11.648 4.864 23.68 8.512 12.032 3.648 24.32 6.08 12.352 2.432 24.896 3.712Q371.392 896 384 896h256q12.608 0 25.088-1.28 12.544-1.216 24.832-3.648 12.352-2.432 24.384-6.08t23.68-8.512q11.584-4.8 22.72-10.688 11.072-5.952 21.504-12.928 10.496-7.04 20.224-14.976 9.728-8 18.56-16.896 8.96-8.832 16.896-18.56 8-9.728 14.976-20.224 7.04-10.432 12.928-21.504 5.888-11.136 10.688-22.72 4.864-11.648 8.512-23.68 3.648-12.032 6.08-24.32 2.432-12.352 3.712-24.896Q896 652.608 896 640V384q0-12.608-1.28-25.088-1.216-12.544-3.648-24.832-2.432-12.352-6.08-24.384t-8.512-23.68q-4.8-11.584-10.688-22.72-5.952-11.072-12.928-21.504-7.04-10.496-14.976-20.224-8-9.664-16.896-18.56-8.832-8.96-18.56-16.896-9.728-8-20.224-14.976-10.432-7.04-21.504-12.928-11.136-5.888-22.72-10.752-11.648-4.8-23.68-8.448-12.032-3.648-24.32-6.08-12.352-2.432-24.896-3.712Q652.608 128 640 128H384q-12.608 0-25.088 1.28-12.544 1.216-24.832 3.648-12.352 2.432-24.384 6.08t-23.68 8.448q-11.584 4.864-22.72 10.752-11.072 5.952-21.504 12.928-10.496 7.04-20.224 14.976-9.664 8-18.56 16.896-8.96 8.896-16.896 18.56-8 9.728-14.976 20.224-7.04 10.432-12.928 21.504-5.888 11.136-10.752 22.72-4.8 11.648-8.448 23.68-3.648 12.032-6.08 24.32-2.432 12.352-3.712 24.896Q128 371.392 128 384z m566.016 166.336H330.112a38.4 38.4 0 0 1 0-76.8h363.904a38.4 38.4 0 0 1 0 76.8z" p-id="4395"></path></svg>',color:"rgb(82,146,247)"},{name:"checkbox-check-disabled",configName:"CHECKBOX_CHECK_SVG",svg:'<svg t="1722595535853" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4551" width="32" height="32"><path d="M640 128H384c-170.496 0-256 85.504-256 256v256c0 170.496 85.504 256 256 256h256c170.496 0 256-85.504 256-256V384c0-170.496-85.504-256-256-256z m67.584 302.592c-2.048 4.608-4.608 8.704-8.192 12.288L506.88 634.88c-3.584 3.584-7.68 6.144-12.288 8.192-4.608 2.048-9.728 3.072-14.848 3.072s-10.24-1.024-14.848-3.072c-4.608-2.048-8.704-4.608-12.288-8.192l-96.256-96.256c-3.584-3.584-6.144-7.68-8.192-12.288-2.048-4.608-3.072-9.728-3.072-14.848 0-2.56 0-5.12 1.024-7.68 0.512-2.56 1.024-5.12 2.048-7.168 1.024-2.56 2.048-4.608 3.584-6.656 1.536-2.048 3.072-4.096 4.608-5.632 1.536-2.048 3.584-3.584 5.632-4.608 2.048-1.536 4.096-2.56 6.656-3.584 2.56-1.024 4.608-1.536 7.168-2.048 2.56-0.512 5.12-0.512 7.68-0.512 5.12 0 10.24 1.024 14.848 3.072 4.608 2.048 8.704 4.608 12.288 8.192l69.12 68.608L645.12 389.12c3.584-3.584 7.68-6.144 12.288-8.192 4.608-2.048 9.728-3.072 14.848-3.072 2.56 0 5.12 0 7.68 0.512s5.12 1.024 7.168 2.048c2.56 1.024 4.608 2.048 6.656 3.584 2.048 1.536 4.096 3.072 5.632 4.608 1.536 1.536 3.584 3.584 4.608 5.632 1.536 2.048 2.56 4.096 3.584 6.656 1.024 2.56 1.536 4.608 2.048 7.168 0.512 2.56 1.024 5.12 1.024 7.68 0 5.12-1.024 10.24-3.072 14.848z" p-id="4552"></path></svg>',color:"#DDE0EA"},{name:"checkbox-disabled",configName:"CHECKBOX_DISABLED_SVG",svg:'<svg t="1722595946663" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4865" width="32" height="32"><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z" fill="#F1F2F4" p-id="4866"></path><path d="M128 640V384a256 256 0 0 1 256-256h256a256 256 0 0 1 256 256v256a256 256 0 0 1-256 256H384a256 256 0 0 1-256-256z m64 0q0 79.552 56.256 135.744Q304.448 832 384 832h256q79.552 0 135.744-56.256Q832 719.552 832 640V384q0-79.552-56.256-135.744Q719.552 192 640 192H384q-79.552 0-135.744 56.256Q192 304.448 192 384v256z" fill="#DDE0EA" p-id="4867"></path></svg>',color:""}]);c(this,"icons",new Map);this.ctx=t,this.init()}async init(){const t=[];for(let e=0;e<this.list.length;e++){const i=this.list[e];let s=i.color;if(i.configColorName){const r=this.ctx.config[i.configColorName];r&&(s=r)}const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}for(let e=0;e<this.ctx.config.ICONS.length;e++){const i=this.ctx.config.ICONS[e];let s=i.color;const o=this.createImageFromSVG(i.svg,s).then(r=>{this.icons.set(i.name,r)});t.push(o)}await Promise.all(t),this.ctx.emit("draw")}async createImageFromSVG(t,e){const o=new DOMParser().parseFromString(t,"image/svg+xml").documentElement;e&&o.querySelectorAll("*").forEach(l=>{l.setAttribute("fill",e)});const r=new Image,a=new Blob([new XMLSerializer().serializeToString(o)],{type:"image/svg+xml"}),h=URL.createObjectURL(a);return r.src=h,new Promise((l,f)=>{r.onerror=()=>f(new Error("Failed to load image")),r.onload=()=>{l(r)}})}get(t){return this.icons.get(t)}}class qt{constructor(t,e,i,s,o,r,a){c(this,"ctx");c(this,"x",0);c(this,"y",0);c(this,"width",0);c(this,"height",0);c(this,"fixed");c(this,"cellType");this.ctx=t,this.x=e,this.y=i,this.width=s,this.height=o,this.fixed=r,this.cellType=a}isHorizontalVisible(){if(this.fixed)return!0;const{target:t,fixedLeftWidth:e,scrollX:i,fixedRightWidth:s}=this.ctx,o=t.offsetWidth;return!(this.x+this.width-e-i<=0||this.x-i>=o-s)}isVerticalVisible(){const{target:t,scrollY:e}=this.ctx,i=t.offsetHeight;return!(this.y+this.height-e<=0||this.y-e>=i)}getDrawX(){return this.fixed==="left"?this.x:this.fixed==="right"?this.ctx.header.visibleWidth-(this.ctx.header.width-this.x):this.x-this.ctx.scrollX}getDrawY(){return this.cellType==="header"?this.y:this.cellType==="footer"&&this.ctx.config.FOOTER_FIXED?this.y:this.y-this.ctx.scrollY}getLeftFixedX(){return this.x-this.ctx.scrollX}getRightFixedX(){}}class Gt extends qt{constructor(e,i,s,o,r,a,h,l,f,d="body"){super(e,o,r,a,h,l.fixed,d);c(this,"formatter");c(this,"hoverIconName","");c(this,"align");c(this,"verticalAlign");c(this,"fixed");c(this,"type");c(this,"editorType");c(this,"cellType");c(this,"level");c(this,"colspan",1);c(this,"rowspan",1);c(this,"key");c(this,"column");c(this,"rowIndex");c(this,"colIndex");c(this,"rowKey");c(this,"row");c(this,"value");c(this,"render");c(this,"renderFooter");c(this,"style",{});c(this,"rules",{});c(this,"message","");c(this,"text","");c(this,"displayText","");c(this,"visibleWidth",0);c(this,"visibleHeight",0);c(this,"drawX",0);c(this,"drawY",0);c(this,"drawCellBgColor","");c(this,"drawCellSkyBgColor","");c(this,"drawTextColor","");c(this,"drawTextX",0);c(this,"drawTextY",0);c(this,"drawImageX",0);c(this,"drawImageY",0);c(this,"drawImageWidth",0);c(this,"drawImageHeight",0);c(this,"drawImageName","");c(this,"drawImageSource");c(this,"ellipsis",!1);c(this,"overflowTooltipShow",!0);c(this,"overflowTooltipWidth",500);c(this,"overflowTooltipPlacement","top");this.visibleWidth=this.width,this.visibleHeight=this.height,this.colIndex=s,this.rowIndex=i,this.key=l.key,this.type=l.type||"text",this.editorType=l.editorType||"text",this.cellType=d,this.align=l.align||"center",this.verticalAlign=l.verticalAlign||"middle",this.fixed=l.fixed,this.level=l.level,this.column=l,this.rules=l.rules,this.row=f,this.rowKey=this.ctx.database.getRowKeyForRowIndex(i),this.value=this.getValue(),this.render=l.render,this.overflowTooltipShow=l.overflowTooltipShow||!0,this.overflowTooltipWidth=l.overflowTooltipWidth||500,this.overflowTooltipPlacement=l.overflowTooltipPlacement||"top",this.renderFooter=l.renderFooter,this.hoverIconName=l.hoverIconName,this.formatter=l.formatter,this.update()}getValidationMessage(){const e=this.ctx.database.getValidationError(this.rowKey,this.key);if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message}return this.message}update(){this.drawX=this.getDrawX(),this.drawY=this.getDrawY(),this.drawTextX=this.drawX,this.drawTextY=this.drawY,this.updateSpan(),this.updateType(),this.updateHoverIcon(),this.updateSelection(),this.updateTree(),this.updateEditorType(),this.updateRender(),this.getValidationMessage(),this.updateContainer(),this.text=this.getText(),this.displayText=this.getDisplayText()}updateSpan(){if(this.cellType==="footer")return;const{SPAN_METHOD:e}=this.ctx.config;if(typeof e=="function"){const i=e,{colspan:s=1,rowspan:o=1}=i({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue(),headIndex:this.ctx.body.headIndex,headPosition:this.ctx.database.getPositionForRowIndex(this.ctx.body.headIndex),visibleRows:this.ctx.body.visibleRows,visibleLeafColumns:this.ctx.header.visibleLeafColumns,rows:this.ctx.body.data})||{};this.colspan=s,this.rowspan=o,this.visibleWidth=this.getWidthByColIndexColSpan(this.colIndex,this.colspan),this.visibleHeight=this.ctx.database.getHeightByRowIndexRowSpan(this.rowIndex,this.rowspan)}}updateType(){const{CELL_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.type=s)}}updateEditorType(){const{CELL_EDITOR_TYPE_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.editorType=s)}}updateRender(){const{CELL_RENDER_METHOD:e}=this.ctx.config;if(typeof e=="function"){const s=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});s!==void 0&&(this.render=s)}}validate(){this.ctx.database.getValidator(this.rowKey,this.key).then(()=>{this.ctx.database.setValidationError(this.rowKey,this.key,[]),this.message=""}).catch(e=>{if(Array.isArray(e)&&e.length){const[i]=e;this.message=i.message,this.ctx.database.setValidationError(this.rowKey,this.key,e)}}).finally(()=>{this.ctx.emit("asyncDrawBody")})}updateStyle(){this.style=this.getOverlayerViewsStyle()}updateTree(){const{CELL_PADDING:e=0}=this.ctx.config,{rowKey:i,cellType:s}=this;let o,r=0,a="";if(this.type==="tree"&&s==="body"){const h=this.ctx.database.getRowForRowKey(i),{expand:l=!1,hasChildren:f=!1,expandLoading:d=!1,level:u=0}=h||{};if(d){const x=this.ctx.icons.get("loading");a="loading",o=x,r=u*8}else if(f){const x=this.ctx.icons.get("expand"),w=this.ctx.icons.get("shrink");o=l?w:x,a=l?"shrink":"expand",r=u*8}else r=u*8;if(o){let x=20,w=20,g=this.drawX+r+e,y=this.drawY+(this.visibleHeight-w)/2+2;this.ctx.paint.drawImage(o,g,y,x,w),this.drawImageX=g,this.drawImageY=y,this.drawImageWidth=x,this.drawImageHeight=w,this.drawImageName=a,this.drawImageSource=o,this.align="left",this.drawTextX=r+this.drawX+x+.5}}}updateContainer(){const{BODY_BG_COLOR:e,EDIT_BG_COLOR:i,BODY_CELL_STYLE_METHOD:s,READONLY_TEXT_COLOR:o,FOOTER_BG_COLOR:r,HIGHLIGHT_SELECTED_ROW:a,HIGHLIGHT_SELECTED_ROW_COLOR:h,HIGHLIGHT_HOVER_ROW:l,HIGHLIGHT_HOVER_ROW_COLOR:f}=this.ctx.config,d=this,{rowKey:u,key:x,type:w}=this;let g=e,y=o;if(this.ctx.database.getReadonly(u,x)||["index","index-selection","selection"].includes(w)||(g=i),typeof s=="function"){const b=s,{backgroundColor:v,color:R}=b({row:d.row,rowIndex:d.rowIndex,colIndex:d.colIndex,column:d.column,value:d.getValue()})||{};v&&(g=v),R&&(y=R)}d.cellType==="footer"&&(g=r);let p="transparent";const E=this.ctx.focusCell,m=this.ctx.hoverCell;l&&(m==null?void 0:m.rowKey)===this.rowKey&&(p=f),a&&(E==null?void 0:E.rowKey)===this.rowKey&&(p=h),this.drawCellSkyBgColor=p,this.drawCellBgColor=g,this.drawTextColor=y}updateSelection(){const{visibleWidth:e,visibleHeight:i,rowspan:s,colspan:o,cellType:r,type:a,rowIndex:h,rowKey:l}=this;if(!(s===0||o===0)&&r!=="footer"&&["index-selection","selection"].includes(a)){const f=this.ctx.database.getRowSelection(l),d=this.ctx.database.getRowSelectable(l),{CHECKBOX_SIZE:u=0}=this.ctx.config,x=this.drawX+(e-u)/2,w=this.drawY+(i-u)/2;let g=this.ctx.icons.get("checkbox-uncheck"),y="checkbox-uncheck";f&&d?(g=this.ctx.icons.get("checkbox-check"),y="checkbox-check"):f&&d?(g=this.ctx.icons.get("checkbox-check-disabled"),y="checkbox-check-disabled"):!f&&d?(g=this.ctx.icons.get("checkbox-uncheck"),y="checkbox-uncheck"):(g=this.ctx.icons.get("checkbox-disabled"),y="checkbox-disabled"),g&&a=="index-selection"?(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===h||["checkbox-disabled","checkbox-check"].includes(y))&&(this.drawImageX=x,this.drawImageY=w,this.drawImageWidth=u,this.drawImageHeight=u,this.drawImageName=y,this.drawImageSource=g):g&&a==="selection"&&(this.drawImageX=x,this.drawImageY=w,this.drawImageWidth=u,this.drawImageHeight=u,this.drawImageName=y,this.drawImageSource=g)}}updateHoverIcon(){const{CELL_HOVER_ICON_METHOD:e,CELL_HOVER_ICON_SIZE:i,CELL_PADDING:s}=this.ctx.config;if(typeof e=="function"){const h=e({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()});h!==void 0&&(this.hoverIconName=h)}const o=this.drawX+this.width-i-s,r=this.drawY+(this.height-i)/2;if(this.hoverIconName&&this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex){const a=this.ctx.icons.get(this.hoverIconName);this.drawImageX=o,this.drawImageY=r,this.drawImageWidth=i,this.drawImageHeight=i,this.drawImageName=this.hoverIconName,this.drawImageSource=a}}getDisplayText(){if(this.cellType==="footer"){if(this.renderFooter)return"";const e=this.row[this.key];return this.text===null||this.text===void 0?"":e}else return this.rowspan===0||this.colspan===0||this.render||this.type==="index-selection"&&(this.ctx.hoverCell&&this.ctx.hoverCell.rowIndex===this.rowIndex||["checkbox-disabled","checkbox-check"].includes(this.drawImageName))||this.text===null||this.text===void 0?"":`${this.text}`}getText(){return typeof this.formatter=="function"?this.formatter({row:this.row,rowIndex:this.rowIndex,colIndex:this.colIndex,column:this.column,value:this.getValue()}):["index-selection","index"].includes(this.type)?`${this.rowIndex+1}`:(this.value=this.ctx.database.getItemValue(this.rowKey,this.key),this.value)}getValue(){return this.ctx.database.getItemValue(this.rowKey,this.key)}getOverlayerViewsStyle(){}draw(){const{paint:e,config:{BORDER_COLOR:i}}=this.ctx,{drawX:s,drawY:o}=this;e.drawRect(s,o,this.visibleWidth,this.visibleHeight,{borderColor:i,fillColor:this.drawCellBgColor}),e.drawRect(s,o,this.width,this.height,{borderColor:"transparent",borderWidth:1,fillColor:this.drawCellSkyBgColor}),this.ellipsis=this.drawText(),this.drawImage(),this.drawSelector(),this.drawAutofillPiont()}getWidthByColIndexColSpan(e,i){if(i===0)return 0;let s=0;for(let o=e;o<e+i;o++){const r=this.ctx.header.leafCellHeaders[o];s+=r.width}return s}drawText(){const{CELL_PADDING:e=0,BODY_FONTFAMILY:i,BODY_FONT_SIZE:s,BODY_FONT_STYLE:o}=this.ctx.config,r=`${s}px ${o} ${i}`;return this.ctx.paint.drawText(this.displayText,this.drawTextX,this.drawTextY,this.visibleWidth,this.visibleHeight,{font:r,padding:e,align:this.align,verticalAlign:this.verticalAlign,color:this.drawTextColor})}drawImage(){this.drawImageSource&&this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight)}drawAutofillPiont(){if(this.cellType==="footer")return;const{SELECT_BORDER_COLOR:e,ENABLE_AUTOFILL:i,ENABLE_SELECTOR:s}=this.ctx.config;if(!s||!i)return;const{xArr:o,yArr:r}=this.ctx.selector,a=o[1],h=r[1],{colIndex:l,rowIndex:f,drawX:d,drawY:u}=this;l===a&&f===h&&this.ctx.paint.drawRect(d+this.width-6,u+this.height-6,6,6,{borderColor:"#fff",fillColor:e})}drawSelector(){if(this.cellType==="footer")return;const{ENABLE_SELECTOR:e}=this.ctx.config;if(!e)return;const{xArr:i,yArr:s,xArrCopy:o,yArrCopy:r}=this.ctx.selector;this.drawBorder({xArr:o,yArr:r,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:this.ctx.autofill.xArr,yArr:this.ctx.autofill.yArr,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1,lineDash:[4,4]}),this.drawBorder({xArr:i,yArr:s,borderColor:this.ctx.config.SELECT_BORDER_COLOR||"rgb(82,146,247)",fillColor:this.ctx.config.SELECT_AREA_COLOR||"rgba(82,146,247,0.1)",borderWidth:1})}drawBorder(e){const{drawX:i,drawY:s,width:o,rowIndex:r,colIndex:a}=this,h=i+.5;let l=s+.5,f=this.height;r===0&&(l=this.y+1,f=f-1);const{xArr:d,yArr:u,lineDash:x=[],borderWidth:w=1,borderColor:g,fillColor:y}=e,p=d[0],E=d[1],m=u[0],b=u[1];a>=p&&a<=E&&r===m&&this.ctx.paint.drawLine([h,l,h+o-2,l],{borderColor:g,fillColor:y,borderWidth:w,lineCap:"round",lineJoin:"round",lineDash:x}),a>=p&&a<=E&&r===b&&this.ctx.paint.drawLine([h,l+f-1.5,h+o,l+f-1.5],{borderColor:g,fillColor:y,borderWidth:w,lineCap:"round",lineJoin:"round",lineDash:x}),a===p&&r>=m&&r<=b&&this.ctx.paint.drawLine([h,l,h,l+f-1],{borderColor:g,fillColor:y,borderWidth:w,lineCap:"round",lineJoin:"round",lineDash:x}),a===E&&r>=m&&r<=b&&this.ctx.paint.drawLine([h+o-1,l,h+o-1,l+f-1],{borderColor:g,fillColor:y,borderWidth:w,lineCap:"round",lineJoin:"round",lineDash:x})}}class $t extends qt{constructor(e,i,s,o,r,a,h){super(e,s,o,r,a,h.fixed,"header");c(this,"align");c(this,"verticalAlign","middle");c(this,"fixed");c(this,"type");c(this,"editorType");c(this,"level");c(this,"text");c(this,"displayText","");c(this,"colspan");c(this,"rowspan");c(this,"key");c(this,"required",!1);c(this,"readonly",!1);c(this,"children",[]);c(this,"column");c(this,"colIndex");c(this,"rowKey");c(this,"rules");c(this,"hasChildren");c(this,"render");c(this,"style",{});c(this,"drawX",0);c(this,"drawY",0);c(this,"drawImageX",0);c(this,"drawImageY",0);c(this,"drawImageWidth",0);c(this,"drawImageHeight",0);c(this,"drawImageName","");c(this,"drawImageSource");this.ctx=e,this.x=s,this.y=o,this.width=r,this.height=a,this.colIndex=i,this.key=h.key,this.type=h.type,this.editorType=h.editorType||"text",this.align=h.align||"center",this.verticalAlign=h.verticalAlign||"middle",this.fixed=h.fixed,this.level=h.level,this.text=h.title,this.column=h,this.colspan=h.colspan,this.rowspan=h.rowspan,this.rules=h.rules,this.readonly=h.readonly,this.required=h.required,this.rowKey=It(),this.hasChildren=h.children&&h.children.length>0||!1,this.render=h.renderHeader}isVerticalVisible(){const{target:e}=this.ctx,i=e.offsetHeight;return!(this.y+this.height<=0||this.y>=i)}updateStyle(){}update(){this.updateStyle(),this.displayText=this.getText(),this.drawX=this.getDrawX(),this.drawY=this.getDrawY()}draw(){const{paint:e,config:{BORDER_COLOR:i,HEADER_BG_COLOR:s,CELL_PADDING:o,HEAD_FONTFAMILY:r,HEAD_FONT_SIZE:a,HEAD_FONT_STYLE:h}}=this.ctx,{drawX:l,drawY:f,displayText:d}=this;e.drawRect(l,f,this.width,this.height,{borderColor:i,fillColor:s});const u=`${a}px ${h} ${r}`;e.drawText(d,l,f,this.width,this.height,{font:u,padding:o,align:this.align,verticalAlign:this.verticalAlign}),this.drawSelection()}drawSelection(){const{width:e,height:i,type:s}=this;if(["index-selection","selection"].includes(s)){const{indeterminate:o,check:r,selectable:a}=this.ctx.database.getCheckedState(),{CHECKBOX_SIZE:h=0}=this.ctx.config,l=this.drawX+(e-h)/2,f=this.drawY+(i-h)/2;let d=this.ctx.icons.get("checkbox-uncheck"),u="checkbox-uncheck";o?(d=this.ctx.icons.get("checkbox-indeterminate"),u="checkbox-indeterminate"):r&&a?(d=this.ctx.icons.get("checkbox-check"),u="checkbox-check"):r&&a?(d=this.ctx.icons.get("checkbox-check-disabled"),u="checkbox-check-disabled"):!r&&a?(d=this.ctx.icons.get("checkbox-uncheck"),u="checkbox-uncheck"):(d=this.ctx.icons.get("checkbox-disabled"),u="checkbox-disabled"),d&&(this.drawImageX=l,this.drawImageY=f,this.drawImageWidth=h,this.drawImageHeight=h,this.drawImageName=u,this.drawImageSource=d,this.ctx.paint.drawImage(this.drawImageSource,this.drawImageX,this.drawImageY,this.drawImageWidth,this.drawImageHeight))}}getText(){return this.render?"":this.text}}class je{constructor(t){c(this,"ctx");c(this,"resizeObserver");this.ctx=t,this.init()}init(){this.resizeObserver=new ResizeObserver(()=>{this.ctx.emit("resizeObserver"),this.ctx.emit("draw")}),this.ctx.target.parentElement&&this.resizeObserver.observe(this.ctx.target),this.ctx.on("mousedown",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),h=r.getDrawY();if(i>a&&i<a+r.width&&e>h&&e<h+r.height){this.ctx.focusCellHeader=r,this.ctx.emit("cellHeaderMousedown",r,t);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const h of a){const l=h.getDrawX(),f=h.getDrawY();if(i>l&&i<l+h.width&&e>f&&e<f+h.height){this.ctx.setFocusCell(h),this.ctx.emit("cellMousedown",h,t);return}}}}),this.ctx.on("click",t=>{if(t.button!==0||this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const r of s){const a=r.getDrawX(),h=r.getDrawY();if(i>a&&i<a+r.width&&e>h&&e<h+r.height){this.ctx.clickCellHeader=r,this.ctx.emit("cellHeaderClick",r,t),this.selectionClick(r);return}}const o=this.ctx.body.renderRows;for(const r of o){const a=r.fixedCells.concat(r.noFixedCells);for(const h of a){const l=h.getDrawX(),f=h.getDrawY();if(i>l&&i<l+h.width&&e>f&&e<f+h.height){this.ctx.clickCell=h,this.ctx.emit("cellClick",h,t),this.selectionClick(h),this.treeClick(h);return}}}}),this.ctx.on("mousemove",t=>{var r;if(this.isBusy(t))return;const e=t.offsetY,i=t.offsetX,s=this.ctx.header.renderCellHeaders;for(const a of s){const h=a.getDrawX(),l=a.getDrawY();if(i>h&&i<h+a.width&&e>l&&e<l+a.height){if(this.ctx.emit("cellHeaderMouseenter",a,t),this.ctx.hoverCellHeader&&this.ctx.hoverCellHeader!==a&&this.ctx.emit("cellHeaderMouseleave",this.ctx.hoverCellHeader,t),this.imageEnterAndLeave(a,t),this.ctx.hoverCellHeader===a)return;this.ctx.hoverCellHeader=a,this.ctx.emit("cellHeaderHoverChange",a);return}}const o=this.ctx.body.renderRows;for(const a of o){const h=a.fixedCells.concat(a.noFixedCells);for(const l of h){const f=l.getDrawX(),d=l.getDrawY();if(i>f&&i<f+l.visibleWidth&&e>d&&e<d+l.visibleHeight&&this.imageEnterAndLeave(l,t),i>f&&i<f+l.width&&e>d&&e<d+l.height){if(this.ctx.emit("cellMouseenter",l,t),this.ctx.hoverCell&&this.ctx.hoverCell!==l&&this.ctx.emit("cellMouseleave",this.ctx.hoverCell,t),this.ctx.hoverCell===l)return;((r=this.ctx.hoverCell)==null?void 0:r.rowKey)!==l.rowKey&&(this.ctx.hoverCell=l,this.ctx.hoverRow=this.ctx.body.renderRows[l.rowIndex],this.ctx.emit("rowHoverChange",this.ctx.hoverRow,l,t),this.ctx.emit("draw")),this.ctx.hoverCell=l,this.ctx.emit("cellHoverChange",l,t);return}}}})}selectionClick(t){if(["selection","index-selection"].includes(t.type)&&this.ctx.isPointer)if(t instanceof $t)t.drawImageName==="checkbox-uncheck"||t.drawImageName==="checkbox-indeterminate"?this.ctx.database.toggleAllSelection():t.drawImageName==="checkbox-check"&&this.ctx.database.clearSelection();else{if(!this.ctx.database.getRowSelectable(t.rowKey))return;this.ctx.database.toggleRowSelection(t.rowKey)}}treeClick(t){if(t.type==="tree"&&this.ctx.isPointer){const e=this.ctx.database.getRowForRowKey(t.rowKey),{expand:i=!1,expandLazy:s=!1}=e||{},{EXPAND_LAZY:o,EXPAND_LAZY_METHOD:r}=this.ctx.config;if(o&&r&&!i&&!s)typeof r=="function"&&(this.ctx.database.expandLoading(t.rowKey,!0),r({row:t.row,rowIndex:t.rowIndex,colIndex:t.colIndex,column:t.column,value:t.getValue()}).then(h=>{this.ctx.database.setExpandChildren(t.rowKey,h),this.ctx.database.expandLoading(t.rowKey,!1)}).catch(h=>{this.ctx.database.expandLoading(t.rowKey,!1),console.error(h)}));else{const a=this.ctx.database.getIsExpand(t.rowKey);this.ctx.database.expandItem(t.rowKey,!a),this.ctx.emit("expandChange")}}}imageEnterAndLeave(t,e){const i=e.offsetY,s=e.offsetX;s>t.drawImageX&&s<t.drawImageX+t.drawImageWidth&&i>t.drawImageY&&i<t.drawImageY+t.drawImageHeight?(this.ctx.target.style.cursor="pointer",this.ctx.isPointer=!0,t instanceof Gt&&["selection","index-selection"].includes(t.type)&&(this.ctx.database.getRowSelectable(t.rowKey)||(this.ctx.target.style.cursor="not-allowed"))):(this.ctx.isPointer=!1,this.ctx.target.style.cursor==="pointer"&&(this.ctx.target.style.cursor="default"))}isBusy(t){const e=t.offsetY,i=t.offsetX;if(!(t.target instanceof HTMLCanvasElement)||!this.ctx.isTarget(t.target)||this.ctx.target.style.cursor==="row-resize"||this.ctx.target.style.cursor==="col-resize"||this.ctx.columnResizing||this.ctx.rowResizing)return!0;const{SCROLLER_TRACK_SIZE:s}=this.ctx.config;return!!(this.ctx.scrollerMove||this.ctx.scrollerFocus||e>this.ctx.target.offsetHeight-s||i>this.ctx.target.offsetWidth-s)}destroy(){this.resizeObserver.unobserve(this.ctx.target)}}class Ue{constructor(t,e,i){c(this,"eventBus");c(this,"eventBrowser");c(this,"eventTable");c(this,"uuid",It());c(this,"targetContainer");c(this,"target");c(this,"paint");c(this,"icons");c(this,"mousedown",!1);c(this,"isPointer",!1);c(this,"rowResizing",!1);c(this,"columnResizing",!1);c(this,"scrollerMove",!1);c(this,"scrollerFocus",!1);c(this,"autofillMove",!1);c(this,"scrollY",0);c(this,"scrollX",0);c(this,"fixedLeftWidth",0);c(this,"fixedRightWidth",0);c(this,"maxColIndex",0);c(this,"maxRowIndex",0);c(this,"hoverRow");c(this,"clickCell");c(this,"focusCell");c(this,"hoverCell");c(this,"clickCellHeader");c(this,"focusCellHeader");c(this,"hoverCellHeader");c(this,"body",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,headIndex:0,tailIndex:0,visibleRows:[],renderRows:[],data:[]});c(this,"footer",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0});c(this,"header",{x:0,y:0,width:0,height:0,visibleHeight:0,visibleWidth:0,visibleLeafColumns:[],leafCellHeaders:[],renderLeafCellHeaders:[],renderCellHeaders:[]});c(this,"selector",{enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]});c(this,"autofill",{enable:!1,xArr:[-1,-1],yArr:[-1,-1]});c(this,"database");c(this,"history");c(this,"config");this.target=e,this.targetContainer=t,this.target.setAttribute("uuid",this.uuid),this.config=new Ge(i.config||{}),this.eventBus=new ze,this.eventBrowser=new Ve(this),this.eventTable=new je(this),this.paint=new qe(e),this.database=new We(this,i),this.history=new Pe(this),this.icons=new $e(this)}setFocusCell(t){var e;this.focusCell!==t&&(((e=this.focusCell)==null?void 0:e.rowKey)!==t.rowKey&&(this.focusCell=t,this.emit("rowFocusChange",t)),this.focusCell=t,this.emit("cellFocusChange",t))}clearSelector(){this.selector={enable:!1,xArr:[-1,-1],yArr:[-1,-1],xArrCopy:[-1,-1],yArrCopy:[-1,-1]}}clearAutofill(){this.autofill={enable:!1,xArr:[-1,-1],yArr:[-1,-1]}}getSelectedData(){const t=[],e=this.selector.yArr,i=this.selector.xArr;let s="";for(let o=0;o<=e[1]-e[0];o++){const r=[];for(let a=0;a<=i[1]-i[0];a++){const h=o+e[0],l=a+i[0],f=this.database.getItemValueForRowIndexAndColIndex(h,l);f&&r.push(f.value)}s+=`${r.join("	")}\r`,t.push(r)}return s=s?s.replace(/\r$/,""):" ",{xArr:i,yArr:e,text:s,value:t}}setScroll(t,e){let i=Math.floor(t);const s=this.body.width-this.body.visibleWidth;i<0?i=0:i>s&&(i=s);let o=Math.floor(e);const r=this.body.height-this.body.visibleHeight-this.footer.height;o<0?o=0:o>r&&(o=r),this.emit("setScroll",i,o)}setScrollX(t){let e=Math.floor(t);const i=this.body.width-this.body.visibleWidth;e<0?e=0:e>i&&(e=i),this.emit("setScrollX",e)}setScrollY(t){let e=Math.floor(t);const i=this.body.height-this.body.visibleHeight-this.footer.height;e<0?e=0:e>i&&(e=i),this.emit("setScrollY",e)}isTarget(t){if(t===null)return!1;const e=t.getAttribute("uuid");return this.uuid===e}hasEvent(t){return this.eventBus.has(t)}on(t,e){this.eventBus.on(t,e)}once(t,e){this.eventBus.once(t,e)}off(t,e){this.eventBus.off(t,e)}emit(t,...e){this.eventBus.emit(t,...e)}destroy(){this.eventTable.destroy(),this.eventBrowser.destroy(),this.eventBus.destroy()}}class jt{constructor(t,e){c(this,"ctx");c(this,"type");c(this,"isFocus",!1);c(this,"trackX",0);c(this,"trackY",0);c(this,"trackWidth",0);c(this,"trackHeight",0);c(this,"splitPoints",[]);c(this,"barX",0);c(this,"barY",0);c(this,"barWidth",0);c(this,"barHeight",0);c(this,"distance",0);c(this,"visibleDistance",0);c(this,"offsetX",0);c(this,"offsetY",0);c(this,"dragStart",0);c(this,"isDragging",!1);c(this,"scroll",0);this.ctx=t,this.type=e,this.type==="vertical"?this.scroll=this.ctx.scrollY:this.scroll=this.ctx.scrollX}onWheel(t){this.updateScroll(t)}onMouseDown(t){const{offsetX:e,offsetY:i}=t;if(!(e==this.offsetX&&i==this.offsetY)){if(this.isOnScrollbar(e,i))this.offsetX=e,this.offsetY=i,this.isDragging=!0,this.ctx.scrollerMove=!0,this.isFocus=!0,this.dragStart=this.scroll;else if(this.isOnTrack(e,i)){let s=0;this.type==="vertical"?s=(i-this.ctx.header.height-this.barHeight/2)/(this.visibleDistance-this.barHeight)*this.distance:s=(e-this.barWidth/2)/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(s,this.distance))}}}onMouseUp(){this.isDragging=!1,this.isFocus=!1,this.offsetY=0,this.offsetX=0}onMouseMove(t){const{offsetX:e,offsetY:i}=t;if(this.isOnScrollbar(e,i)&&t.target===this.ctx.target?this.isFocus=!0:this.isFocus=!1,e==this.offsetX&&i==this.offsetY)return;let s=0;if(this.type==="horizontal"?s=e-this.offsetX:s=i-this.offsetY,this.isDragging&&s!==0){let o=0;this.type==="vertical"?o=this.dragStart+s/(this.visibleDistance-this.barHeight)*this.distance:o=this.dragStart+s/(this.visibleDistance-this.barWidth)*this.distance,this.scroll=Math.max(0,Math.min(o,this.distance))}}isPointInElement(t,e,i,s,o,r){return t>=i&&t<=i+o&&e>=s&&e<=s+r}isOnScrollbar(t,e){return this.isPointInElement(t,e,this.barX,this.barY,this.barWidth,this.barHeight)}isOnTrack(t,e){return this.isPointInElement(t,e,this.trackX,this.trackY,this.trackWidth,this.trackHeight)}updateScroll(t){t.preventDefault();const e=t.deltaX,i=t.deltaY;this.type==="vertical"&&t.shiftKey===!1?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.type==="horizontal"&&(t.shiftKey?this.scroll=Math.max(0,Math.min(this.scroll+i,this.distance)):this.scroll=Math.max(0,Math.min(this.scroll+e,this.distance)))}updatedSize(){const{body:t,header:e,config:{SCROLLER_TRACK_SIZE:i=0,SCROLLER_SIZE:s=0}}=this.ctx,o=this.ctx.target.offsetWidth,r=this.ctx.target.offsetHeight,a=e.height,h=e.width,l=t.height,f=this.ctx.footer.height;if(this.type==="vertical"){this.visibleDistance=r-i-a,this.distance=l-this.visibleDistance+f,this.trackX=o-i,this.trackY=0,this.splitPoints=[this.trackX,a,this.trackX+i,a],this.trackWidth=i,this.trackHeight=r,this.barX=this.trackX+(i-s)/2,this.barWidth=s;const d=this.distance?this.visibleDistance/l:0;let u=Math.floor(d*this.visibleDistance);u<30?u=30:u>this.visibleDistance&&(u=0),this.barHeight=u,this.barY=a+this.scroll/this.distance*(this.visibleDistance-this.barHeight),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}else{this.visibleDistance=o-i,this.distance=h-this.visibleDistance,this.splitPoints=[o-i,r-i,o-i,r],this.trackX=0,this.trackY=r-i,this.trackWidth=o,this.trackHeight=i;const d=this.distance?this.visibleDistance/h:0;let u=Math.floor(d*this.visibleDistance);this.barY=this.trackY+(i-s)/2,u<30?u=30:u>this.visibleDistance&&(u=0),this.barWidth=u,this.barHeight=s,this.barX=this.scroll/this.distance*(this.visibleDistance-this.barWidth),this.scroll=Math.max(0,Math.min(this.scroll,this.distance))}}draw(){const{config:{SCROLLER_FOCUS_COLOR:t,SCROLLER_COLOR:e,BORDER_COLOR:i,SCROLLER_TRACK_COLOR:s}}=this.ctx;this.updatedSize(),this.ctx.paint.drawRect(this.trackX,this.trackY,this.trackWidth,this.trackHeight,{borderColor:i,fillColor:s}),this.ctx.paint.drawRect(this.barX,this.barY,this.barWidth,this.barHeight,{fillColor:this.isFocus||this.isDragging?t:e,radius:4}),this.splitPoints.length>0&&this.ctx.paint.drawLine(this.splitPoints,{borderColor:i,borderWidth:1}),this.ctx.scrollerFocus=this.isFocus}}class Ze{constructor(t){c(this,"ctx");c(this,"verticalScrollbar");c(this,"horizontalScrollbar");this.ctx=t,this.verticalScrollbar=new jt(t,"vertical"),this.horizontalScrollbar=new jt(t,"horizontal"),this.ctx.on("wheel",e=>this.onWheel(e)),this.ctx.on("mousedown",e=>this.onMouseDown(e)),this.ctx.on("mousemove",e=>this.onMouseMove(e)),this.ctx.on("mouseup",()=>this.onMouseUp()),this.ctx.on("setScroll",(e,i)=>{this.setScroll(e,i)}),this.ctx.on("setScrollX",e=>{this.setScrollX(e)}),this.ctx.on("setScrollY",e=>{this.setScrollY(e)})}onWheel(t){this.verticalScrollbar.onWheel(t),this.horizontalScrollbar.onWheel(t),this.draw()}onMouseDown(t){this.verticalScrollbar.onMouseDown(t),this.horizontalScrollbar.onMouseDown(t),this.draw()}onMouseMove(t){this.verticalScrollbar.onMouseMove(t),this.horizontalScrollbar.onMouseMove(t),this.draw()}onMouseUp(){this.verticalScrollbar.onMouseUp(),this.horizontalScrollbar.onMouseUp(),this.ctx.scrollerMove=!1}draw(){this.verticalScrollbar.draw(),this.horizontalScrollbar.draw();const t=Math.floor(this.horizontalScrollbar.scroll),e=Math.floor(this.verticalScrollbar.scroll);(t!==this.ctx.scrollX||e!==this.ctx.scrollY)&&(this.ctx.scrollX=t,this.ctx.scrollY=e,this.ctx.emit("draw"),this.ctx.emit("onScroll",t,e),t!==this.ctx.scrollX&&this.ctx.emit("onScrollX",t),e!==this.ctx.scrollY&&this.ctx.emit("onScrollY",e))}setScroll(t,e){this.horizontalScrollbar.scroll=t,this.verticalScrollbar.scroll=e,this.ctx.emit("draw")}setScrollX(t){this.horizontalScrollbar.scroll=t,this.ctx.emit("draw")}setScrollY(t){this.verticalScrollbar.scroll=t,this.ctx.emit("draw")}scrollToColkey(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.key===t);i&&this.setScrollX(i.x+e.visibleWidth/2)}scrollToColIndex(t){const{header:e}=this.ctx,i=e.leafCellHeaders.find(s=>s.colIndex===t);i&&i.x>e.visibleWidth/2&&this.setScrollX(i.x+e.visibleWidth/2)}scrollToRowIndex(t){const{body:e,database:i}=this.ctx,{top:s}=i.getPositionForRowIndex(t);s>e.visibleHeight&&this.setScrollY(s+e.visibleHeight/2)}scrollToRowKey(t){const{body:e,database:i}=this.ctx,s=i.getRowIndexForRowKey(t),{top:o}=i.getPositionForRowIndex(s);this.setScrollY(-o+e.visibleHeight/2)}}class Je{constructor(t){c(this,"ctx");c(this,"x",0);c(this,"y",0);c(this,"width",0);c(this,"height",0);c(this,"resizeTarget",null);c(this,"isResizing",!1);c(this,"offsetX",0);c(this,"resizeDiff",0);c(this,"columnIndex",0);c(this,"isMouseDown",!1);c(this,"columns");c(this,"visibleLeafColumns",[]);c(this,"visibleHeight",0);c(this,"visibleWidth",0);c(this,"allCellHeaders",[]);c(this,"leafCellHeaders",[]);c(this,"renderLeafCellHeaders",[]);c(this,"fixedLeftCellHeaders",[]);c(this,"centerCellHeaders",[]);c(this,"fixedRightCellHeaders",[]);c(this,"renderCenterCellHeaders",[]);c(this,"renderFixedCellHeaders",[]);this.ctx=t,this.init(),this.initResizeColumn()}init(){const{config:{HEADER_HEIGHT:t=0,SCROLLER_TRACK_SIZE:e=0}}=this.ctx,i=this.ctx.database.getColumns();this.columns=i,this.allCellHeaders=[],this.leafCellHeaders=[],this.fixedLeftCellHeaders=[],this.fixedRightCellHeaders=[],this.centerCellHeaders=[];const s=Vt(i),o=Ot(i);this.height=t*s,this.width=o.reduce((l,f)=>l+((f==null?void 0:f.width)||100),0),this.visibleHeight=this.height;const r=Ye(zt(i,s));this.columnIndex=0,this.render(r,0),this.ctx.database.updateColIndexKeyMap(this.leafCellHeaders);const a=this.fixedLeftCellHeaders.filter(l=>!l.hasChildren);this.ctx.fixedLeftWidth=a.reduce((l,f)=>l+f.width,0);const h=this.fixedRightCellHeaders.filter(l=>!l.hasChildren);this.ctx.fixedRightWidth=h.reduce((l,f)=>l+f.width,e),this.ctx.maxColIndex=this.leafCellHeaders.length-1,this.ctx.header.x=this.x,this.ctx.header.y=this.y,this.ctx.header.width=this.width,this.ctx.header.height=this.height,this.ctx.header.visibleHeight=this.visibleHeight}initResizeColumn(){const{config:{ENABLE_RESIZE_COLUMN:t}}=this.ctx;t&&(this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetX=e.offsetX,this.resizeTarget?(this.isResizing=!0,this.ctx.columnResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeColumn(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.isResizing=!1,this.ctx.columnResizing=!1,this.offsetX=0}),this.ctx.on("mousemove",e=>{const{target:i,config:{RESIZE_COLUMN_MIN_WIDTH:s=0}}=this.ctx;if(this.isResizing&&this.resizeTarget){const o=this.resizeTarget.width;let r=e.offsetX-this.offsetX;r+o<s&&(r=-(o-s)),this.resizeDiff=r,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown)return;this.ctx.target.style.cursor==="col-resize"&&(this.ctx.target.style.cursor="default");const o=[...this.renderFixedCellHeaders,...this.renderCenterCellHeaders];for(const r of o){const a=e.layerX,h=r.getDrawX();a>h+r.width-5&&a<h+r.width+4&&a<i.offsetWidth-4&&r.colspan<=1&&e.target instanceof HTMLCanvasElement&&this.ctx.isTarget(e.target)&&e.layerY<=this.height&&(this.ctx.target.style.cursor="col-resize",this.resizeTarget=r)}}}))}resizeColumn(t,e){const i=s=>{s.forEach(o=>{if(o.children&&o.children.length>0&&i(o.children),o.key===t.key){const r=o.width||100;o.width=r+e}})};i(this.columns),this.ctx.database.setColumns(this.columns),this.init(),this.ctx.emit("draw"),this.ctx.emit("resizeColumnChange",{colIndex:t.colIndex,key:t.key,oldWidth:t.width,width:t.width+e,column:t.column,columns:this.columns})}render(t,e){const i=t.length;let s=e;const{HEADER_HEIGHT:o=0}=this.ctx.config;for(let r=0;r<i;r++){const a=t[r],h=o*(a.rowspan||1),l=o*a.level;let f=a.width||100;a.children&&(f=Ot(a.children).reduce((x,w)=>x+((w==null?void 0:w.width)||100),0));const d=new $t(this.ctx,this.columnIndex,s,l,f,h,a);this.ctx.database.setHeader(a.key,d),this.allCellHeaders.push(d),a.children||this.leafCellHeaders.push(d),a.fixed==="left"?this.fixedLeftCellHeaders.push(d):a.fixed==="right"?this.fixedRightCellHeaders.push(d):this.centerCellHeaders.push(d),!a.children&&this.columnIndex++,a.children&&this.render(a.children,s),s+=f}}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,config:{RESIZE_COLUMN_LINE_COLOR:e}}=this.ctx,i=this.resizeTarget.getDrawX(),s=this.resizeTarget.width,o=i+s+this.resizeDiff-.5,r=[o+.5,0,o+.5,t.offsetHeight];this.ctx.paint.drawLine(r,{borderColor:e,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<s.width-s.visibleWidth&&e!==a){const h=s.width-(this.x+this.width)+o.offsetWidth-e;this.ctx.paint.drawShadow(h+.5,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}update(){const t=[],e=[],i=[];this.centerCellHeaders.forEach(r=>{r.isHorizontalVisible()&&r.isVerticalVisible()&&(e.push(r),r.hasChildren||t.push(r))}),this.fixedLeftCellHeaders.forEach(r=>{i.push(r),r.hasChildren||t.push(r)}),this.fixedRightCellHeaders.forEach(r=>{i.push(r),r.hasChildren||t.push(r)}),this.renderCenterCellHeaders=e,this.renderFixedCellHeaders=i,this.renderLeafCellHeaders=t.sort((r,a)=>r.x-a.x),this.visibleLeafColumns=this.renderLeafCellHeaders.map(r=>r.column);const{config:{SCROLLER_TRACK_SIZE:s=0},target:o}=this.ctx;this.visibleWidth=o.offsetWidth-s,this.ctx.header.visibleLeafColumns=this.visibleLeafColumns,this.ctx.header.visibleWidth=this.visibleWidth,this.ctx.header.visibleHeight=this.visibleHeight,this.ctx.header.leafCellHeaders=this.leafCellHeaders,this.ctx.header.renderLeafCellHeaders=this.renderLeafCellHeaders,this.ctx.header.renderCellHeaders=this.renderFixedCellHeaders.concat(this.renderCenterCellHeaders)}draw(){this.renderCenterCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawFiexShadow(),this.renderFixedCellHeaders.forEach(t=>{t.update(),t.draw()}),this.drawTipLine()}}class Ut{constructor(t,e,i=0,s=0,o=0,r=0,a,h="body"){c(this,"ctx");c(this,"x",0);c(this,"y",0);c(this,"width",0);c(this,"height");c(this,"cells",[]);c(this,"fixedCells",[]);c(this,"noFixedCells",[]);c(this,"rowIndex",0);c(this,"rowKey","");c(this,"rowType","body");c(this,"data");this.ctx=t,this.x=i,this.y=s,this.width=o,this.height=r,this.rowIndex=e,this.rowKey=t.database.getRowKeyForRowIndex(e),this.rowType=h,this.data=a,this.update()}update(){const{header:t}=this.ctx,e=[],i=[],s=[];t.renderLeafCellHeaders.forEach(o=>{const r=new Gt(this.ctx,this.rowIndex,o.colIndex,o.x,this.y,o.width,this.height,o.column,this.data,this.rowType);r.fixed?i.push(r):s.push(r),e.push(r)}),this.cells=e,this.fixedCells=i,this.noFixedCells=s}drawCenter(){this.noFixedCells.forEach(t=>{t.draw()})}drawFixed(){this.fixedCells.forEach(t=>{t.draw()})}draw(){this.noFixedCells.forEach(t=>{t.draw()}),this.fixedCells.forEach(t=>{t.draw()})}}class Qe{constructor(t){c(this,"resizeTarget",null);c(this,"isMouseDown",!1);c(this,"resizeDiff",0);c(this,"offsetY",0);c(this,"ctx");c(this,"x",0);c(this,"y",0);c(this,"width",0);c(this,"height",0);c(this,"headIndex",0);c(this,"tailIndex",0);c(this,"isResizing",!1);c(this,"renderRows",[]);c(this,"visibleRows",[]);c(this,"visibleHeight",0);c(this,"visibleWidth",0);c(this,"data",[]);this.ctx=t,this.init(),this.initResizeRow()}init(){var B;const{target:t,header:e,database:i,config:{FOOTER_FIXED:s,SCROLLER_TRACK_SIZE:o=0,BORDER_COLOR:r,BORDER_RADIUS:a,HEIGHT:h,WIDTH:l,EMPTY_BODY_HEIGHT:f=0,MAX_HEIGHT:d=0,ENABLE_OFFSET_HEIGHT:u=0,OFFSET_HEIGHT:x=0}}=this.ctx;if(!e.width)return;this.x=0,this.y=e.height;const{data:w,sumHeight:g}=i.getData();this.height=g,this.data=w;const{left:y,top:p}=t.getBoundingClientRect();this.width=e.width;const E=window.innerWidth,m=((B=t.parentElement)==null?void 0:B.clientWidth)||E-y,b=this.width+o;let v=0;l?v=l:b>m?v=m:v=b,t.width=v,this.visibleWidth=t.width-o;const R=this.ctx.footer.height;this.data.length||(this.height=f);const T=this.data.length?"not-empty":"empty";this.ctx.emit("emptyChange",{isEmpty:T,headerHeight:e.height,bodyHeight:this.height,width:this.width,height:this.data.length?0:f+R});let _=this.height+e.height+o;_+=R;let I=0;this.data.length&&u?(I=window.innerHeight-p-x,I<0&&(I=32,console.error("There is an error in the height calculation ENABLE_OFFSET_HEIGHT and OFFSET_HEIGHT are invalid"))):this.data.length&&h?I=h:this.data.length&&d&&_>d?I=d:I=_,t.setAttribute("style",`outline: none; position: relative; border-radius: ${a}px; border: 1px solid ${r}; height:${I}px;width:${v-1}px;`),I>0&&(t.height=I);let D=t.height-e.height-o;s?this.visibleHeight=D-R:this.visibleHeight=D,this.ctx.body.x=this.x,this.ctx.body.y=this.y,this.ctx.body.width=this.width,this.ctx.body.height=this.height,this.ctx.body.visibleWidth=this.visibleWidth,this.ctx.body.visibleHeight=this.visibleHeight,this.ctx.body.data=w}initResizeRow(){const{config:{ENABLE_RESIZE_ROW:t}}=this.ctx;t&&(this.ctx.on("mouseup",()=>{this.isMouseDown=!1,this.resizeDiff!==0&&this.resizeTarget&&this.resizeRow(this.resizeTarget,this.resizeDiff),this.resizeTarget=null,this.resizeDiff=0,this.isResizing=!1,this.ctx.rowResizing=!1,this.offsetY=0}),this.ctx.on("mousedown",e=>{this.ctx.isTarget(e.target)&&(this.offsetY=e.offsetY,this.resizeTarget?(this.isResizing=!0,this.ctx.rowResizing=!0):this.isResizing=!1,this.isMouseDown=!0)}),this.ctx.on("mousemove",e=>{const i=e.offsetY,s=e.offsetX,{target:o,scrollY:r,config:{RESIZE_ROW_MIN_HEIGHT:a=0}}=this.ctx;if(this.isResizing&&this.resizeTarget){const h=this.resizeTarget.height;let l=i-this.offsetY;l+h<a&&(l=-(h-a)),this.resizeDiff=l,this.ctx.emit("draw")}else{if(this.resizeTarget=null,this.isMouseDown||this.ctx.target.style.cursor==="crosshair")return;this.ctx.target.style.cursor==="row-resize"&&(this.ctx.target.style.cursor="default");for(let h=0;h<this.renderRows.length;h++){const l=this.renderRows[h];if(i>l.y-r+l.height-1.5&&i<l.y-r+l.height+1.5&&i<o.offsetHeight-4)for(let d=0;d<l.cells.length;d++){const u=l.cells[d];s>u.drawX+10&&s<u.drawX+u.width-10&&u.rowspan===1&&(this.ctx.target.style.cursor="row-resize",this.resizeTarget=l)}}}}))}resizeRow(t,e){const{rowIndex:i,height:s,rowKey:o,data:r}=t;this.ctx.database.setRowHeight(i,s+e),this.init(),this.ctx.emit("draw"),this.ctx.emit("resizeRowChange",{rowIndex:i,oldHeight:s,height:s+e,rowKey:o,row:r,data:this.data})}drawTipLine(){if(this.isResizing&&this.resizeTarget){const{target:t,scrollY:e,config:{RESIZE_ROW_LINE_COLOR:i}}=this.ctx,s=this.resizeTarget.y-e,o=this.resizeTarget.height,r=s+o+this.resizeDiff-.5,a=[0,r+.5,t.offsetWidth,r+.5];this.ctx.paint.drawLine(a,{borderColor:i,borderWidth:1})}}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;if(i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,this.y,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<s.width-s.visibleWidth&&e!==a){const h=s.width-(this.x+this.width)+o.offsetWidth-e;this.ctx.paint.drawShadow(h+.5,this.y,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}binarySearch(t,e){let i=0,s=t.length-1,o=-1;for(;i<=s;){let r=Math.floor((i+s)/2),a=t[r].bottom;if(a===e)return r;a<e?i=r+1:(o=r,s=r-1)}return o}update(){this.init();const{header:t,database:e,scrollY:i}=this.ctx,s=i,{data:o,positions:r}=e.getData();this.ctx.maxRowIndex=o.length-1;const a=this.binarySearch(r,s);let h=this.binarySearch(r,s+this.visibleHeight);h===-1&&(h=o.length),this.headIndex=Math.max(0,a),this.tailIndex=Math.min(this.ctx.maxRowIndex,h+1),this.visibleRows=o.slice(this.headIndex,this.tailIndex+1),this.ctx.body.headIndex=this.headIndex,this.ctx.body.tailIndex=this.tailIndex,this.ctx.body.visibleRows=this.visibleRows;const l=[];for(let f=0;f<this.visibleRows.length;f++){const d=this.headIndex+f,u=this.visibleRows[f],{height:x,top:w}=this.ctx.database.getPositionForRowIndex(d),g=new Ut(this.ctx,d,0,w+this.y,t.width,x,u);l.push(g)}this.renderRows=l,this.ctx.body.renderRows=l}draw(){this.renderRows.forEach(t=>{t.drawCenter()}),this.drawFiexShadow(),this.renderRows.forEach(t=>{t.drawFixed()}),this.drawTipLine()}}class ti{constructor(t){c(this,"ctx");c(this,"renderRows",[]);c(this,"data",[]);c(this,"x",0);c(this,"y",0);c(this,"width",0);c(this,"height",0);c(this,"visibleWidth",0);c(this,"visibleHeight",0);this.ctx=t,this.init()}init(){this.data=this.ctx.database.getFooterData();const{header:t,body:e,config:{CELL_FOOTER_HEIGHT:i,FOOTER_FIXED:s,SCROLLER_TRACK_SIZE:o}}=this.ctx;this.width=t.width,this.visibleWidth=t.visibleWidth,this.height=this.data.reduce(r=>r+i,0),this.visibleHeight=this.height,s?this.y=this.ctx.target.offsetHeight-this.height-o:this.y=e.y+e.height,this.ctx.footer.x=this.x,this.ctx.footer.y=this.y,this.ctx.footer.height=this.height,this.ctx.footer.width=this.width,this.ctx.footer.visibleWidth=this.visibleWidth,this.ctx.footer.visibleHeight=this.visibleHeight}drawFiexShadow(){const{fixedLeftWidth:t,fixedRightWidth:e,scrollX:i,header:s,target:o,config:{HEADER_BG_COLOR:r,SCROLLER_TRACK_SIZE:a}}=this.ctx;let h=this.y;if(this.ctx.config.FOOTER_FIXED||(h=this.y-this.ctx.scrollY,console.log(h)),i>0&&t!==0&&this.ctx.paint.drawShadow(this.x,h,t,this.height,{fillColor:r,side:"right",shadowWidth:4,colorStart:"rgba(0,0,0,0.1)",colorEnd:"rgba(0,0,0,0)"}),i<s.width-s.visibleWidth&&e!==a){const l=s.width-(this.x+this.width)+o.offsetWidth-e;this.ctx.paint.drawShadow(l+.5,h,e,this.height,{fillColor:r,side:"left",shadowWidth:4,colorStart:"rgba(0,0,0,0)",colorEnd:"rgba(0,0,0,0.1)"})}}update(){this.init();const{CELL_FOOTER_HEIGHT:t}=this.ctx.config;let e=this.y;const i=[];this.data.forEach((s,o)=>{const r=new Ut(this.ctx,o,0,e,this.width,t,s,"footer");e+=t,i.push(r)}),this.renderRows=i}draw(){this.renderRows.forEach(t=>{t.drawCenter()}),this.drawFiexShadow(),this.renderRows.forEach(t=>{t.drawFixed()})}}class ei{constructor(t){c(this,"isCut",!1);c(this,"isMultipleRow",!1);c(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellHoverChange",t=>{if(!this.ctx.autofillMove){if(["index-selection","selection","index"].includes(t.type)){this.selectRows(t,!1);return}this.isMultipleRow||this.mouseenter()}}),this.ctx.on("cellMousedown",(t,e)=>{if(this.ctx.isTarget(e.target)&&this.ctx.target.style.cursor!=="pointer"&&!this.ctx.isPointer&&this.ctx.target.style.cursor!=="crosshair"){if(["index-selection","selection","index"].includes(t.type)){this.isMultipleRow=!0,this.selectRows(t);return}this.isMultipleRow=!1,this.click(e.shiftKey)}}),this.ctx.on("cellHeaderHoverChange",t=>{this.ctx.mousedown&&this.selectCols(t)}),this.ctx.on("cellHeaderMousedown",t=>{this.ctx.target.style.cursor!=="pointer"&&(this.ctx.isPointer||this.selectCols(t))}),this.ctx.on("keydown",t=>{if(t.ctrlKey&&t.code==="KeyV"||t.metaKey&&t.code==="KeyV"){this.paste();return}if(t.ctrlKey&&t.code==="KeyC"||t.metaKey&&t.code==="KeyC"){t.preventDefault(),this.copy(),this.isCut=!1;return}if(t.ctrlKey&&t.code==="KeyX"||t.metaKey&&t.code==="KeyX"){t.preventDefault(),this.isCut=!0,this.copy();return}if((t.ctrlKey&&t.code==="KeyA"||t.metaKey&&t.code==="KeyA")&&(t.preventDefault(),this.selectAll()),t.code==="ArrowLeft"){t.preventDefault(),this.moveFocus("LEFT");return}if(t.code==="ArrowUp"){t.preventDefault(),this.moveFocus("TOP");return}if(t.code==="ArrowRight"||t.code==="Tab"){t.preventDefault(),this.moveFocus("RIGHT");return}if(t.code==="ArrowDown"){t.preventDefault(),this.moveFocus("BOTTOM");return}if(t.code==="Delete"||t.code==="Backspace"){t.preventDefault();const{xArr:e,yArr:i}=this.ctx.selector;this.clearSelectedData(e,i);return}})}setSelector(t,e){const{ENABLE_SELECTOR_SPAN_COL:i,ENABLE_SELECTOR_SPAN_ROW:s}=this.ctx.config;let o=t,r=e;if(!s){const[a]=r;r=[a,a]}if(!i){const[a]=o;o=[a,a]}(JSON.stringify(this.ctx.selector.xArr)!==JSON.stringify(o)||JSON.stringify(this.ctx.selector.yArr)!==JSON.stringify(r))&&(this.ctx.selector.enable=!0,this.ctx.selector.xArr=o,this.ctx.selector.yArr=r,this.ctx.emit("setSelector",this.ctx.selector),this.ctx.emit("draw"))}selectCols(t){if(this.ctx.columnResizing||this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_ROWS)return;if(["index","index-selection","selection"].includes(t.type)){this.selectAll();return}const e=0,i=this.ctx.maxRowIndex;if(this.ctx.mousedown&&this.ctx.focusCellHeader){const{colIndex:s}=this.ctx.focusCellHeader;if(t.colIndex>=s){const o=[s,t.colIndex+t.colspan-1],r=[e,i];this.setSelector(o,r)}else{const o=[t.colIndex,s],r=[e,i];this.setSelector(o,r)}}else{const s=[t.colIndex,t.colIndex+t.colspan-1],o=[e,i];this.setSelector(s,o)}}selectAll(){const{ENABLE_SELECTOR_ALL_ROWS:t,ENABLE_SELECTOR_ALL_COLS:e}=this.ctx.config;if(t&&e){const s=this.ctx.maxColIndex,o=0,r=this.ctx.maxRowIndex,a=[1,s],h=[o,r];this.setSelector(a,h)}}selectRows(t,e=!0){if(this.ctx.config.ENABLE_SELECTOR_SINGLE||!this.ctx.config.ENABLE_SELECTOR_ALL_COLS)return;const i=this.ctx.maxColIndex,s=t.colIndex+1;if(e){this.ctx.setFocusCell(t);const o=[s,i],r=[t.rowIndex,t.rowIndex];this.setSelector(o,r)}if(this.ctx.focusCell&&this.ctx.mousedown){const{rowIndex:o}=this.ctx.focusCell;if(t.rowIndex>=o){const r=[s,i],a=[o,t.rowIndex];this.setSelector(r,a)}else{const r=[s,i],a=[t.rowIndex,o];this.setSelector(r,a)}}}mouseenter(){if(this.ctx.config.ENABLE_SELECTOR_SINGLE)return;const{mousedown:t,focusCell:e,hoverCell:i}=this.ctx;if(t&&e&&i){const{rowIndex:s,colIndex:o}=e,r=Math.min(i.colIndex,o),a=Math.max(i.colIndex,o),h=Math.min(i.rowIndex,s),l=Math.max(i.rowIndex,s),f=[r,a],d=[h,l];this.setSelector(f,d)}}click(t=!1){const{focusCell:e,clickCell:i}=this.ctx;if(e)if(this.ctx.selector.enable=!0,i&&t){const{colIndex:s,rowIndex:o}=i,{colIndex:r,rowIndex:a}=e,h=Math.min(r,s),l=Math.max(r,s),f=Math.min(a,o),d=Math.max(a,o),u=[h,l],x=[f,d];this.setSelector(u,x)}else{const s=[e.colIndex,e.colIndex],o=[e.rowIndex,e.rowIndex];this.setSelector(s,o),this.adjustBoundaryPosition()}}clearCopyLine(){this.ctx.selector.xArrCopy=[-1,-1],this.ctx.selector.yArrCopy=[-1,-1]}getCell(t,e){const i=this.ctx.body.renderRows.find(o=>o.rowIndex===t);return i==null?void 0:i.cells.find(o=>o.colIndex===e)}copy(){if(!this.ctx.config.ENABLE_COPY)return;const{text:t}=this.ctx.getSelectedData();navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{this.ctx.selector.xArrCopy=this.ctx.selector.xArr.slice(),this.ctx.selector.yArrCopy=this.ctx.selector.yArr.slice(),this.ctx.emit("setCopy",this.ctx.selector),this.ctx.emit("draw")}).catch(e=>console.error("复制失败：",e)):console.error("当前浏览器不支持Clipboard API")}clearSelectedData(t,e,i=!1){let s=[];const o=new Set;for(let a=0;a<=e[1]-e[0];a++)for(let h=0;h<=t[1]-t[0];h++){const l=a+e[0],f=h+t[0],d=this.ctx.database.getItemValueForRowIndexAndColIndex(l,f);if(d){const{rowKey:u,key:x}=d;this.ctx.database.getReadonly(u,x)||(o.add(u),s.push({rowKey:u,key:x,value:null,row:{}}))}}if(!s.length)return[];if(i)return s;this.ctx.database.batchSetItemValue(s,!0);let r=[];return o.forEach(a=>{r.push(this.ctx.database.getRowDataItemForRowKey(a))}),this.ctx.emit("clearSelectedDataChange",s,r),this.ctx.emit("draw"),s}paste(){if(!navigator.clipboard){console.error("当前浏览器不支持Clipboard API");return}const{ENABLE_PASTER:t}=this.ctx.config;if(this.ctx.selector.enable&&t){const e=this.ctx.selector.yArr[0],i=this.ctx.selector.xArr[0],s=new Set;navigator.clipboard.readText().then(o=>{let r=[];const a=o.split("\r");a.length===1?r=a[0].split(`
`).map(d=>d.split("	")):r=a.map(f=>f.split("	"));let h=[];for(let f=0;f<=r.length-1;f++){const d=r[f].length;for(let u=0;u<=d-1;u++){const x=f+e,w=u+i,g=r[f][u],y=this.ctx.database.getItemValueForRowIndexAndColIndex(x,w);if(y){const{rowKey:p,key:E}=y;this.ctx.database.getReadonly(p,E)||(s.add(p),h.push({rowKey:p,key:E,value:g,row:{}}))}}}if(this.isCut){const f=this.clearSelectedData(this.ctx.selector.xArrCopy,this.ctx.selector.yArrCopy,!0),d=h.map(u=>`${u.rowKey}-${u.key}`);f.forEach(u=>{d.includes(`${u.rowKey}-${u.key}`)||h.unshift(u)}),this.isCut=!1}if(!h.length)return;this.ctx.database.batchSetItemValue(h,!0);let l=[];s.forEach(f=>{l.push(this.ctx.database.getRowDataItemForRowKey(f))}),this.ctx.emit("pasteChange",h,l),this.clearCopyLine(),this.ctx.emit("draw")}).catch(o=>{console.error("获取剪贴板内容失败：",o)})}}moveFocus(t){const{focusCell:e}=this.ctx;if(!e)return;let{colIndex:i=0,rowIndex:s=0}=e;const o=0,r=0,a=this.ctx.maxColIndex,h=this.ctx.maxRowIndex;switch(t){case"LEFT":i>o&&i--;break;case"TOP":s>r&&s--;break;case"RIGHT":i<a&&i++;break;case"BOTTOM":s<h&&s++;break}const l=[i,i],f=[s,s],d=this.getCell(s,i);d&&this.ctx.setFocusCell(d),this.setSelector(l,f),this.adjustBoundaryPosition()}adjustBoundaryPosition(){const{target:t,focusCell:e,fixedRightWidth:i,fixedLeftWidth:s,header:o,footer:r,scrollX:a,scrollY:h}=this.ctx;if(!e)return;const{SCROLLER_TRACK_SIZE:l=0,FOOTER_FIXED:f}=this.ctx.config;let d=0;f&&(d=r.visibleHeight);const u=s-e.drawX+1,x=e.drawX+e.width-(t.offsetWidth-i)+1,w=o.height-e.drawY,g=e.drawY+e.height-(t.offsetHeight-d-l);x>0&&!e.fixed?this.ctx.setScrollX(a+x):u>0&&!e.fixed&&this.ctx.setScrollX(a-u),w>0?this.ctx.setScrollY(h-w):g>0&&this.ctx.setScrollY(h+g)}destroy(){}}class ii{constructor(t){c(this,"ctx");this.ctx=t,this.init()}init(){this.ctx.on("cellMouseenter",(t,e)=>{this.ctx.target.style.cursor==="crosshair"&&(this.ctx.target.style.cursor="default");const{xArr:i,yArr:s}=this.ctx.selector,o=i[1],r=s[1],{colIndex:a,rowIndex:h,drawX:l,drawY:f,width:d,height:u}=t;if(this.ctx.config.ENABLE_AUTOFILL&&a===o&&h===r){const w=l+d-6,g=f+u-6;e.offsetX>w&&e.offsetY>g&&(this.ctx.target.style.cursor="crosshair")}this.mouseenter(t)}),this.ctx.on("cellMousedown",()=>{this.ctx.target.style.cursor==="crosshair"&&this.setMousedown()}),this.ctx.on("mouseup",()=>{this.setMouseUp()})}isAutofillIng(){const{xArr:t,yArr:e}=this.ctx.selector;return!(JSON.stringify(this.ctx.autofill.xArr)===JSON.stringify(t)&&JSON.stringify(this.ctx.autofill.yArr)===JSON.stringify(e))}setMousedown(){this.ctx.autofill.enable=!0,this.ctx.autofillMove=!0}setMouseUp(){if(!this.ctx.autofill.enable)return;this.isAutofillIng()&&this.autofillData(),this.ctx.autofill.enable=!1,this.ctx.autofillMove=!1,this.ctx.autofill.xArr=[-1,-1],this.ctx.autofill.yArr=[-1,-1]}setAutofill(t,e){const{ENABLE_AUTOFILL:i,ENABLE_SELECTOR_SPAN_COL:s,ENABLE_SELECTOR_SPAN_ROW:o}=this.ctx.config;if(!i)return;let r=t,a=e;if(!o){const[h]=a;a=[h,h]}if(!s){const[h]=r;r=[h,h]}(JSON.stringify(this.ctx.autofill.xArr)!==JSON.stringify(r)||JSON.stringify(this.ctx.autofill.yArr)!==JSON.stringify(a))&&(this.ctx.autofill.xArr=r,this.ctx.autofill.yArr=a,this.ctx.emit("setAutofill",this.ctx.autofill),this.ctx.emit("draw"))}autofillData(){const t=new Set,e=this.ctx.getSelectedData(),i=new Map;for(let d=0;d<=e.yArr[1]-e.yArr[0];d++)for(let u=0;u<=e.xArr[1]-e.xArr[0];u++){const x=d+e.yArr[0],w=u+e.xArr[0];i.set(`${x}-${w}`,!0)}const{value:s}=e,o=s[0].length,r=s.length,a=this.ctx.autofill.xArr,h=this.ctx.autofill.yArr;let l=[];for(let d=0;d<=h[1]-h[0];d++)for(let u=0;u<=a[1]-a[0];u++){const x=u+a[0],w=d+h[0],g=s[d%r][u%o],y=this.ctx.database.getItemValueForRowIndexAndColIndex(w,x),p=`${w}-${x}`;if(y&&!i.has(p)){const{rowKey:E,key:m}=y;this.ctx.database.getReadonly(E,m)||(t.add(E),l.push({rowKey:E,key:m,value:g,row:{}}))}}if(!l.length)return;this.ctx.database.batchSetItemValue(l,!0);let f=[];t.forEach(d=>{f.push(this.ctx.database.getRowDataItemForRowKey(d))}),this.ctx.emit("autofillChange",l,f),this.ctx.selector.xArr=this.ctx.autofill.xArr,this.ctx.selector.yArr=this.ctx.autofill.yArr,this.ctx.emit("draw")}mouseenter(t){if(["index","selection","index-selection"].includes(t.type))return;const{selector:e,autofill:i}=this.ctx;if(this.ctx.mousedown&&e.enable&&i.enable){const{rowIndex:s,colIndex:o}=t,r=e.xArr.slice(),a=e.yArr.slice();s>=e.yArr[0]&&s<=e.yArr[1]?o>e.xArr[1]?r.splice(1,1,o):o<e.xArr[0]&&r.splice(0,1,o):s>e.yArr[1]?a.splice(1,1,s):s<e.yArr[0]&&a.splice(0,1,s),this.setAutofill(r,a)}}destroy(){}}const at=Math.min,Z=Math.max,xt=Math.round,z=n=>({x:n,y:n}),si={left:"right",right:"left",bottom:"top",top:"bottom"},ri={start:"end",end:"start"};function _t(n,t,e){return Z(n,at(t,e))}function ct(n,t){return typeof n=="function"?n(t):n}function j(n){return n.split("-")[0]}function ht(n){return n.split("-")[1]}function Zt(n){return n==="x"?"y":"x"}function Lt(n){return n==="y"?"height":"width"}function J(n){return["top","bottom"].includes(j(n))?"y":"x"}function St(n){return Zt(J(n))}function oi(n,t,e){e===void 0&&(e=!1);const i=ht(n),s=St(n),o=Lt(s);let r=s==="x"?i===(e?"end":"start")?"right":"left":i==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(r=gt(r)),[r,gt(r)]}function ni(n){const t=gt(n);return[Tt(n),t,Tt(t)]}function Tt(n){return n.replace(/start|end/g,t=>ri[t])}function ai(n,t,e){const i=["left","right"],s=["right","left"],o=["top","bottom"],r=["bottom","top"];switch(n){case"top":case"bottom":return e?t?s:i:t?i:s;case"left":case"right":return t?o:r;default:return[]}}function ci(n,t,e,i){const s=ht(n);let o=ai(j(n),e==="start",i);return s&&(o=o.map(r=>r+"-"+s),t&&(o=o.concat(o.map(Tt)))),o}function gt(n){return n.replace(/left|right|bottom|top/g,t=>si[t])}function hi(n){return{top:0,right:0,bottom:0,left:0,...n}}function Jt(n){return typeof n!="number"?hi(n):{top:n,right:n,bottom:n,left:n}}function wt(n){const{x:t,y:e,width:i,height:s}=n;return{width:i,height:s,top:e,left:t,right:t+i,bottom:e+s,x:t,y:e}}function Qt(n,t,e){let{reference:i,floating:s}=n;const o=J(t),r=St(t),a=Lt(r),h=j(t),l=o==="y",f=i.x+i.width/2-s.width/2,d=i.y+i.height/2-s.height/2,u=i[a]/2-s[a]/2;let x;switch(h){case"top":x={x:f,y:i.y-s.height};break;case"bottom":x={x:f,y:i.y+i.height};break;case"right":x={x:i.x+i.width,y:d};break;case"left":x={x:i.x-s.width,y:d};break;default:x={x:i.x,y:i.y}}switch(ht(t)){case"start":x[r]-=u*(e&&l?-1:1);break;case"end":x[r]+=u*(e&&l?-1:1);break}return x}const li=async(n,t,e)=>{const{placement:i="bottom",strategy:s="absolute",middleware:o=[],platform:r}=e,a=o.filter(Boolean),h=await(r.isRTL==null?void 0:r.isRTL(t));let l=await r.getElementRects({reference:n,floating:t,strategy:s}),{x:f,y:d}=Qt(l,i,h),u=i,x={},w=0;for(let g=0;g<a.length;g++){const{name:y,fn:p}=a[g],{x:E,y:m,data:b,reset:v}=await p({x:f,y:d,initialPlacement:i,placement:u,strategy:s,middlewareData:x,rects:l,platform:r,elements:{reference:n,floating:t}});f=E??f,d=m??d,x={...x,[y]:{...x[y],...b}},v&&w<=50&&(w++,typeof v=="object"&&(v.placement&&(u=v.placement),v.rects&&(l=v.rects===!0?await r.getElementRects({reference:n,floating:t,strategy:s}):v.rects),{x:f,y:d}=Qt(l,u,h)),g=-1)}return{x:f,y:d,placement:u,strategy:s,middlewareData:x}};async function te(n,t){var e;t===void 0&&(t={});const{x:i,y:s,platform:o,rects:r,elements:a,strategy:h}=n,{boundary:l="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:u=!1,padding:x=0}=ct(t,n),w=Jt(x),y=a[u?d==="floating"?"reference":"floating":d],p=wt(await o.getClippingRect({element:(e=await(o.isElement==null?void 0:o.isElement(y)))==null||e?y:y.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:l,rootBoundary:f,strategy:h})),E=d==="floating"?{x:i,y:s,width:r.floating.width,height:r.floating.height}:r.reference,m=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),b=await(o.isElement==null?void 0:o.isElement(m))?await(o.getScale==null?void 0:o.getScale(m))||{x:1,y:1}:{x:1,y:1},v=wt(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:E,offsetParent:m,strategy:h}):E);return{top:(p.top-v.top+w.top)/b.y,bottom:(v.bottom-p.bottom+w.bottom)/b.y,left:(p.left-v.left+w.left)/b.x,right:(v.right-p.right+w.right)/b.x}}const di=n=>({name:"arrow",options:n,async fn(t){const{x:e,y:i,placement:s,rects:o,platform:r,elements:a,middlewareData:h}=t,{element:l,padding:f=0}=ct(n,t)||{};if(l==null)return{};const d=Jt(f),u={x:e,y:i},x=St(s),w=Lt(x),g=await r.getDimensions(l),y=x==="y",p=y?"top":"left",E=y?"bottom":"right",m=y?"clientHeight":"clientWidth",b=o.reference[w]+o.reference[x]-u[x]-o.floating[w],v=u[x]-o.reference[x],R=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l));let T=R?R[m]:0;(!T||!await(r.isElement==null?void 0:r.isElement(R)))&&(T=a.floating[m]||o.floating[w]);const _=b/2-v/2,I=T/2-g[w]/2-1,D=at(d[p],I),B=at(d[E],I),L=D,A=T-g[w]-B,H=T/2-g[w]/2+_,it=_t(L,H,A),P=!h.arrow&&ht(s)!=null&&H!==it&&o.reference[w]/2-(H<L?D:B)-g[w]/2<0,Y=P?H<L?H-L:H-A:0;return{[x]:u[x]+Y,data:{[x]:it,centerOffset:H-it-Y,...P&&{alignmentOffset:Y}},reset:P}}}),fi=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var e,i;const{placement:s,middlewareData:o,rects:r,initialPlacement:a,platform:h,elements:l}=t,{mainAxis:f=!0,crossAxis:d=!0,fallbackPlacements:u,fallbackStrategy:x="bestFit",fallbackAxisSideDirection:w="none",flipAlignment:g=!0,...y}=ct(n,t);if((e=o.arrow)!=null&&e.alignmentOffset)return{};const p=j(s),E=J(a),m=j(a)===a,b=await(h.isRTL==null?void 0:h.isRTL(l.floating)),v=u||(m||!g?[gt(a)]:ni(a)),R=w!=="none";!u&&R&&v.push(...ci(a,g,w,b));const T=[a,...v],_=await te(t,y),I=[];let D=((i=o.flip)==null?void 0:i.overflows)||[];if(f&&I.push(_[p]),d){const H=oi(s,r,b);I.push(_[H[0]],_[H[1]])}if(D=[...D,{placement:s,overflows:I}],!I.every(H=>H<=0)){var B,L;const H=(((B=o.flip)==null?void 0:B.index)||0)+1,it=T[H];if(it)return{data:{index:H,overflows:D},reset:{placement:it}};let P=(L=D.filter(Y=>Y.overflows[0]<=0).sort((Y,G)=>Y.overflows[1]-G.overflows[1])[0])==null?void 0:L.placement;if(!P)switch(x){case"bestFit":{var A;const Y=(A=D.filter(G=>{if(R){const $=J(G.placement);return $===E||$==="y"}return!0}).map(G=>[G.placement,G.overflows.filter($=>$>0).reduce(($,Bi)=>$+Bi,0)]).sort((G,$)=>G[1]-$[1])[0])==null?void 0:A[0];Y&&(P=Y);break}case"initialPlacement":P=a;break}if(s!==P)return{reset:{placement:P}}}return{}}}};async function ui(n,t){const{placement:e,platform:i,elements:s}=n,o=await(i.isRTL==null?void 0:i.isRTL(s.floating)),r=j(e),a=ht(e),h=J(e)==="y",l=["left","top"].includes(r)?-1:1,f=o&&h?-1:1,d=ct(t,n);let{mainAxis:u,crossAxis:x,alignmentAxis:w}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof w=="number"&&(x=a==="end"?w*-1:w),h?{x:x*f,y:u*l}:{x:u*l,y:x*f}}const xi=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(t){var e,i;const{x:s,y:o,placement:r,middlewareData:a}=t,h=await ui(t,n);return r===((e=a.offset)==null?void 0:e.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:s+h.x,y:o+h.y,data:{...h,placement:r}}}}},gi=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:e,y:i,placement:s}=t,{mainAxis:o=!0,crossAxis:r=!1,limiter:a={fn:y=>{let{x:p,y:E}=y;return{x:p,y:E}}},...h}=ct(n,t),l={x:e,y:i},f=await te(t,h),d=J(j(s)),u=Zt(d);let x=l[u],w=l[d];if(o){const y=u==="y"?"top":"left",p=u==="y"?"bottom":"right",E=x+f[y],m=x-f[p];x=_t(E,x,m)}if(r){const y=d==="y"?"top":"left",p=d==="y"?"bottom":"right",E=w+f[y],m=w-f[p];w=_t(E,w,m)}const g=a.fn({...t,[u]:x,[d]:w});return{...g,data:{x:g.x-e,y:g.y-i,enabled:{[u]:o,[d]:r}}}}}};function pt(){return typeof window<"u"}function Q(n){return ee(n)?(n.nodeName||"").toLowerCase():"#document"}function N(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function W(n){var t;return(t=(ee(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function ee(n){return pt()?n instanceof Node||n instanceof N(n).Node:!1}function k(n){return pt()?n instanceof Element||n instanceof N(n).Element:!1}function X(n){return pt()?n instanceof HTMLElement||n instanceof N(n).HTMLElement:!1}function ie(n){return!pt()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof N(n).ShadowRoot}function lt(n){const{overflow:t,overflowX:e,overflowY:i,display:s}=K(n);return/auto|scroll|overlay|hidden|clip/.test(t+i+e)&&!["inline","contents"].includes(s)}function wi(n){return["table","td","th"].includes(Q(n))}function yt(n){return[":popover-open",":modal"].some(t=>{try{return n.matches(t)}catch{return!1}})}function At(n){const t=Ht(),e=k(n)?K(n):n;return e.transform!=="none"||e.perspective!=="none"||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(e.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(e.contain||"").includes(i))}function pi(n){let t=q(n);for(;X(t)&&!tt(t);){if(At(t))return t;if(yt(t))return null;t=q(t)}return null}function Ht(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function tt(n){return["html","body","#document"].includes(Q(n))}function K(n){return N(n).getComputedStyle(n)}function mt(n){return k(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function q(n){if(Q(n)==="html")return n;const t=n.assignedSlot||n.parentNode||ie(n)&&n.host||W(n);return ie(t)?t.host:t}function se(n){const t=q(n);return tt(t)?n.ownerDocument?n.ownerDocument.body:n.body:X(t)&&lt(t)?t:se(t)}function Dt(n,t,e){var i;t===void 0&&(t=[]),e===void 0&&(e=!0);const s=se(n),o=s===((i=n.ownerDocument)==null?void 0:i.body),r=N(s);if(o){const a=Mt(r);return t.concat(r,r.visualViewport||[],lt(s)?s:[],a&&e?Dt(a):[])}return t.concat(s,Dt(s,[],e))}function Mt(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function re(n){const t=K(n);let e=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const s=X(n),o=s?n.offsetWidth:e,r=s?n.offsetHeight:i,a=xt(e)!==o||xt(i)!==r;return a&&(e=o,i=r),{width:e,height:i,$:a}}function oe(n){return k(n)?n:n.contextElement}function et(n){const t=oe(n);if(!X(t))return z(1);const e=t.getBoundingClientRect(),{width:i,height:s,$:o}=re(t);let r=(o?xt(e.width):e.width)/i,a=(o?xt(e.height):e.height)/s;return(!r||!Number.isFinite(r))&&(r=1),(!a||!Number.isFinite(a))&&(a=1),{x:r,y:a}}const yi=z(0);function ne(n){const t=N(n);return!Ht()||!t.visualViewport?yi:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function mi(n,t,e){return t===void 0&&(t=!1),!e||t&&e!==N(n)?!1:t}function dt(n,t,e,i){t===void 0&&(t=!1),e===void 0&&(e=!1);const s=n.getBoundingClientRect(),o=oe(n);let r=z(1);t&&(i?k(i)&&(r=et(i)):r=et(n));const a=mi(o,e,i)?ne(o):z(0);let h=(s.left+a.x)/r.x,l=(s.top+a.y)/r.y,f=s.width/r.x,d=s.height/r.y;if(o){const u=N(o),x=i&&k(i)?N(i):i;let w=u,g=Mt(w);for(;g&&i&&x!==w;){const y=et(g),p=g.getBoundingClientRect(),E=K(g),m=p.left+(g.clientLeft+parseFloat(E.paddingLeft))*y.x,b=p.top+(g.clientTop+parseFloat(E.paddingTop))*y.y;h*=y.x,l*=y.y,f*=y.x,d*=y.y,h+=m,l+=b,w=N(g),g=Mt(w)}}return wt({width:f,height:d,x:h,y:l})}function bi(n){let{elements:t,rect:e,offsetParent:i,strategy:s}=n;const o=s==="fixed",r=W(i),a=t?yt(t.floating):!1;if(i===r||a&&o)return e;let h={scrollLeft:0,scrollTop:0},l=z(1);const f=z(0),d=X(i);if((d||!d&&!o)&&((Q(i)!=="body"||lt(r))&&(h=mt(i)),X(i))){const u=dt(i);l=et(i),f.x=u.x+i.clientLeft,f.y=u.y+i.clientTop}return{width:e.width*l.x,height:e.height*l.y,x:e.x*l.x-h.scrollLeft*l.x+f.x,y:e.y*l.y-h.scrollTop*l.y+f.y}}function Ei(n){return Array.from(n.getClientRects())}function Ft(n,t){const e=mt(n).scrollLeft;return t?t.left+e:dt(W(n)).left+e}function vi(n){const t=W(n),e=mt(n),i=n.ownerDocument.body,s=Z(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),o=Z(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let r=-e.scrollLeft+Ft(n);const a=-e.scrollTop;return K(i).direction==="rtl"&&(r+=Z(t.clientWidth,i.clientWidth)-s),{width:s,height:o,x:r,y:a}}function Ci(n,t){const e=N(n),i=W(n),s=e.visualViewport;let o=i.clientWidth,r=i.clientHeight,a=0,h=0;if(s){o=s.width,r=s.height;const l=Ht();(!l||l&&t==="fixed")&&(a=s.offsetLeft,h=s.offsetTop)}return{width:o,height:r,x:a,y:h}}function Ri(n,t){const e=dt(n,!0,t==="fixed"),i=e.top+n.clientTop,s=e.left+n.clientLeft,o=X(n)?et(n):z(1),r=n.clientWidth*o.x,a=n.clientHeight*o.y,h=s*o.x,l=i*o.y;return{width:r,height:a,x:h,y:l}}function ae(n,t,e){let i;if(t==="viewport")i=Ci(n,e);else if(t==="document")i=vi(W(n));else if(k(t))i=Ri(t,e);else{const s=ne(n);i={...t,x:t.x-s.x,y:t.y-s.y}}return wt(i)}function ce(n,t){const e=q(n);return e===t||!k(e)||tt(e)?!1:K(e).position==="fixed"||ce(e,t)}function Ii(n,t){const e=t.get(n);if(e)return e;let i=Dt(n,[],!1).filter(a=>k(a)&&Q(a)!=="body"),s=null;const o=K(n).position==="fixed";let r=o?q(n):n;for(;k(r)&&!tt(r);){const a=K(r),h=At(r);!h&&a.position==="fixed"&&(s=null),(o?!h&&!s:!h&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||lt(r)&&!h&&ce(n,r))?i=i.filter(f=>f!==r):s=a,r=q(r)}return t.set(n,i),i}function Oi(n){let{element:t,boundary:e,rootBoundary:i,strategy:s}=n;const r=[...e==="clippingAncestors"?yt(t)?[]:Ii(t,this._c):[].concat(e),i],a=r[0],h=r.reduce((l,f)=>{const d=ae(t,f,s);return l.top=Z(d.top,l.top),l.right=at(d.right,l.right),l.bottom=at(d.bottom,l.bottom),l.left=Z(d.left,l.left),l},ae(t,a,s));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}}function _i(n){const{width:t,height:e}=re(n);return{width:t,height:e}}function Li(n,t,e){const i=X(t),s=W(t),o=e==="fixed",r=dt(n,!0,o,t);let a={scrollLeft:0,scrollTop:0};const h=z(0);if(i||!i&&!o)if((Q(t)!=="body"||lt(s))&&(a=mt(t)),i){const x=dt(t,!0,o,t);h.x=x.x+t.clientLeft,h.y=x.y+t.clientTop}else s&&(h.x=Ft(s));let l=0,f=0;if(s&&!i&&!o){const x=s.getBoundingClientRect();f=x.top+a.scrollTop,l=x.left+a.scrollLeft-Ft(s,x)}const d=r.left+a.scrollLeft-h.x-l,u=r.top+a.scrollTop-h.y-f;return{x:d,y:u,width:r.width,height:r.height}}function Nt(n){return K(n).position==="static"}function he(n,t){if(!X(n)||K(n).position==="fixed")return null;if(t)return t(n);let e=n.offsetParent;return W(n)===e&&(e=e.ownerDocument.body),e}function le(n,t){const e=N(n);if(yt(n))return e;if(!X(n)){let s=q(n);for(;s&&!tt(s);){if(k(s)&&!Nt(s))return s;s=q(s)}return e}let i=he(n,t);for(;i&&wi(i)&&Nt(i);)i=he(i,t);return i&&tt(i)&&Nt(i)&&!At(i)?e:i||pi(n)||e}const Si=async function(n){const t=this.getOffsetParent||le,e=this.getDimensions,i=await e(n.floating);return{reference:Li(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function Ti(n){return K(n).direction==="rtl"}const Ai={convertOffsetParentRelativeRectToViewportRelativeRect:bi,getDocumentElement:W,getClippingRect:Oi,getOffsetParent:le,getElementRects:Si,getClientRects:Ei,getDimensions:_i,getScale:et,isElement:k,isRTL:Ti},Hi=xi,Di=gi,Mi=fi,Fi=di,Ni=(n,t,e)=>{const i=new Map,s={platform:Ai,...e},o={...s.platform,_c:i};return li(n,t,{...s,platform:o})};class ki{constructor(t){c(this,"ctx");c(this,"contentEl");c(this,"floatingEl");c(this,"arrowEl");this.ctx=t;const{TOOLTIP_BG_COLOR:e,TOOLTIP_TEXT_COLOR:i,TOOLTIP_ZINDEX:s,TOOLTIP_CUSTOM_STYLE:o}=this.ctx.config;this.contentEl=document.createElement("div"),this.arrowEl=document.createElement("div"),this.floatingEl=document.createElement("div");const r={display:"none",position:"absolute",background:e,color:i,boxSizing:"border-box",zIndex:s,padding:"8px",borderRadius:"4px",fontSize:"12px",...o},a={position:"absolute",width:"10px",height:"10px",background:r.background,backgroundColor:r.backgroundColor,transform:"rotate(45deg)",zIndex:r.zIndex};Object.assign(this.arrowEl.style,a),Object.assign(this.floatingEl.style,r),this.floatingEl.appendChild(this.contentEl),this.floatingEl.appendChild(this.arrowEl),this.ctx.targetContainer.appendChild(this.floatingEl),this.init()}init(){this.ctx.on("mousemove",t=>{this.ctx.isTarget(t.target)||this.hide()}),this.ctx.on("cellHoverChange",t=>{t.ellipsis&&this.show(t)}),this.ctx.on("cellMouseleave",()=>{this.hide()})}show(t){if(!t.overflowTooltipShow||this.ctx.mousedown)return;this.floatingEl.style.display="block";let e=t.getText();t.message&&(e=t.message),this.contentEl.style.maxWidth="500px",this.contentEl.style.width="100%",this.contentEl.style.display="inline-block",this.contentEl.style.wordBreak="break-all",this.contentEl.style.lineHeight="1.5",this.contentEl.innerText=e;const i=t.drawX+this.ctx.targetContainer.offsetLeft,s=t.drawY+this.ctx.targetContainer.offsetTop;Ni({getBoundingClientRect(){return{width:t.visibleWidth,height:t.visibleHeight,x:i,y:s,left:i,right:i+t.visibleWidth,top:s,bottom:s+t.visibleHeight}}},this.floatingEl,{placement:t.overflowTooltipPlacement,middleware:[Di(),Mi(),Hi(6),Fi({element:this.arrowEl})]}).then(r=>{const{x:a,y:h,placement:l,middlewareData:f}=r;if(Object.assign(this.floatingEl.style,{top:`${h}px`,left:`${a}px`}),f.arrow){const d=f.arrow;["left","left-start","left-end"].includes(l)?Object.assign(this.arrowEl.style,{top:`${d.y}px`,bottom:"",left:"",right:"-5px"}):["right","right-start","right-end"].includes(l)?Object.assign(this.arrowEl.style,{top:`${d.y}px`,bottom:"",left:"-5px",right:""}):["bottom","bottom-start","bottom-end"].includes(l)?Object.assign(this.arrowEl.style,{top:"-5px",bottom:"",left:`${d.x}px`,right:""}):["top","top-start","top-end"].includes(l)&&Object.assign(this.arrowEl.style,{top:"",bottom:"-5px",left:`${d.x}px`,right:""})}})}hide(){this.floatingEl.style.display="none"}destroy(){}}class Ki{constructor(t,e){c(this,"targetContainer");c(this,"target");c(this,"scroller");c(this,"header");c(this,"body");c(this,"footer");c(this,"selector");c(this,"autofill");c(this,"tooltip");c(this,"ctx");this.target=document.createElement("canvas"),this.targetContainer=t,this.targetContainer.style.position="relative",this.targetContainer.appendChild(this.target),this.ctx=new Ue(this.targetContainer,this.target,e),this.header=new Je(this.ctx),this.body=new Qe(this.ctx),this.footer=new ti(this.ctx),this.scroller=new Ze(this.ctx),this.selector=new ei(this.ctx),this.autofill=new ii(this.ctx),this.tooltip=new ki(this.ctx),console.log(this.ctx);const{config:{BORDER_COLOR:i,BORDER_RADIUS:s,WIDTH:o=0,HEIGHT:r=0}}=this.ctx;this.target.width=o-1,this.target.height=r-1,this.target.setAttribute("style",`outline: none; position: relative; border-radius: ${s}px; border: 1px solid ${i};`),this.ctx.on("draw",this.draw.bind(this)),this.draw()}draw(){requestAnimationFrame(()=>{console.time("draw"),this.header.update(),this.footer.update(),this.body.update(),this.ctx.paint.clear(),this.body.draw(),this.footer.draw(),this.header.draw(),this.scroller.draw(),console.timeEnd("draw")})}loadConfig(t){}loadColumns(t){this.ctx.database.setColumns(t),this.ctx.emit("draw")}loadData(t){this.ctx.database.setData(t),this.ctx.emit("draw")}loadFooterData(t){this.ctx.database.setFooterData(t),this.ctx.emit("draw")}setLoading(t){this.ctx.database.setLoading(t)}on(t,e){this.ctx.on(t,e)}off(t,e){this.ctx.off(t,e)}filterMethod(t){this.ctx.setScrollY(0),this.ctx.setScrollX(0),this.ctx.database.init(),this.ctx.database.setFilterMethod(t),this.ctx.emit("draw")}setItemValue(t,e,i,s=!0,o=!0){this.ctx.database.setItemValue(t,e,i,s,o,!1)}batchSetItemValue(t,e=!0,i=!0){this.ctx.database.batchSetItemValue(t,e),i&&this.ctx.emit("draw")}setItemValueByEditor(t,e,i,s=!0,o=!0){this.ctx.database.setItemValue(t,e,i,s,o,!0)}doLayout(){this.ctx.emit("draw")}getChangedData(){return this.ctx.database.getChangedData()}getChangedRows(){return this.ctx.database.getChangedRows()}clearValidate(){this.ctx.database.clearValidate(),this.ctx.emit("draw")}async validate(t=!0){return new Promise(async(e,i)=>{try{const s=await this.getValidations();e(s)}catch(s){if(t&&Array.isArray(s)&&s.length){const[o]=s;if(Array.isArray(o)&&o.length){const[r]=o,{rowKey:a,key:h}=r;this.scrollToRowkey(a),this.scrollToColkey(h)}}i(s)}})}getValidations(){return new Promise(async(t,e)=>{const i=this.ctx.database.getAllRowsData(),s=this.ctx.header.leafCellHeaders;let o=[];for(let r=0;r<i.length;r++)for(let a=0;a<s.length;a++){const h=this.ctx.database.getRowKeyByItem(i[r]),f=s[a].key,d=await this.ctx.database.getValidator(h,f);Array.isArray(d)&&d.length&&o.push(d)}o.length?(e(o),this.ctx.emit("draw")):(t([]),this.ctx.emit("draw"))})}scrollTo(t,e){this.scrollXTo(t),this.scrollYTo(e)}scrollXTo(t){this.ctx.setScrollX(t)}scrollToColkey(t){this.scroller.scrollToColkey(t)}scrollToRowkey(t){this.scroller.scrollToRowKey(t)}scrollToColIndex(t){this.scroller.scrollToColIndex(t)}scrollToRowIndex(t){this.scroller.scrollToRowIndex(t)}scrollYTo(t){this.ctx.setScrollY(t)}clearSelection(){this.ctx.database.clearSelection(),this.ctx.emit("draw")}toggleRowSelection(t){const e=this.ctx.database.getRowKeyByItem(t);this.ctx.database.toggleRowSelection(e),this.ctx.emit("draw")}setSelectionByRows(t,e=!0){t.forEach(i=>{const s=this.ctx.database.getRowKeyByItem(i);this.ctx.database.setRowSelection(s,e)}),this.ctx.emit("draw")}setSelectionByRowKeys(t,e=!0){t.forEach(i=>{this.ctx.database.setRowSelection(i,e)}),this.ctx.emit("draw")}toggleAllSelection(){this.ctx.database.toggleAllSelection(),this.ctx.emit("draw")}getSelectionRows(){return this.ctx.database.getSelectionRows()}getPositionForRowIndex(t){return this.ctx.database.getPositionForRowIndex(t)}destroy(){this.tooltip.destroy(),this.selector.destroy(),this.autofill.destroy(),this.ctx.destroy(),this.target.remove(),console.log("销毁")}}return Ki});
//# sourceMappingURL=index.umd.js.map
